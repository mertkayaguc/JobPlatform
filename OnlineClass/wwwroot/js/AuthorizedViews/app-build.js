function BAppTranslate(e){var e=e;isInitBAppTranslate=!0,this.translate=function(t,n,r){_.isEmpty(n)&&(n="M");var i=n==="F"?"_F":"";return typeof e[t]!="undefined"&&_.isEmpty(r)?e[t+i]:typeof e[t]!="undefined"?_.str.vsprintf(e[t+i],r):t+i},this.translatePlural=function(t,n,r,i,s){var o="";_.isEmpty(s)&&(s="M");var u=s==="F"?"_F":"";return parseInt(r)==1&&typeof e[t]!="undefined"&&_.isEmpty(i)?o=e[t+u]:parseInt(r)==1&&typeof e[t]!="undefined"&&!_.isEmpty(i)?o=_.str.vsprintf(e[t+u],i):parseInt(r)>1&&_.isEmpty(i)?o=e[n]:parseInt(r)>1&&(o=_.str.vsprintf(e[n],i)),o}}function translate(e){return typeof _T!="undefined"&&typeof _T.translate!="undefined"?_T.translate(e):e}function translatePlural(e,t,n){if(!_.isUndefined(_T)){var r="";return n>1?r=_T.translate(t):r=_T.translate(e),r}}function searchText(){var e=encodeURIComponent($("#navigationSearch .searchInput").val().replace("/",""));$.cookie("sm_search_results_page","1"),window.location.href=BAppConfig.get("site_search","pageUrl").replace("__param__",e)}function LinkAttachments(e,t){function u(){var e=_.template($("#generic-dialog").html(),{dialog_id:i,title:translate("site_attach_link"),body:_.template($("#link-attachment-popup-template").html(),{prefix:i}),footer:'<button href="#" class="btn userDefaultBtn" id="'+i+'-attachbtn">'+translate("global_attach")+"</button>"+'<button href="#" class="btn" id="'+i+'-cancelbtn">'+translate("global_cancel")+"</button>"}),t=$(e);t.find("#"+i+"-attachbtn").on("click",_.bind(function(){if($("#"+i+"_form").valid()){t.modal("hide");var e=_.uniqueId(i+"_link_"),r={type:"link",url:$("#"+i+"_url").val(),title:$("#"+i+"_title").val(),description:$("#"+i+"_title").val(),thumb:"",domid:e};s.push(r),_.isFunction(n.onLinkAttached)&&n.onLinkAttached.apply(this,[r,this]),n.listContainer!==null&&($(n.listContainer).append(_.template($("#link-attachment-template").html(),{prefix:e,title:r.title,url:r.url})),$("#"+e+"_close").on("click",_.bind(function(e){var t=e.target.id.replace("_close",""),i=a(t);$("#"+t).remove(),s.splice(s.indexOf(i),1),_.isFunction(n.onLinkRemoved)&&n.onLinkRemoved.apply(this,[r,this])},this)))}},this)),t.find("#"+i+"-cancelbtn").on("click",_.bind(function(){t.modal("hide")},this)),$("#"+i).remove(),$("body").append(t),(navigator.appName=="Opera"||navigator.appVersion.indexOf("MSIE 10")!=-1)&&t.attr("class","modal hide modal-narrow"),o=$("#"+i+"_form").validate({rules:{"data[url]":{required:!0,url:!0},"data[title]":{required:!0}}}),$("#"+i).modal({show:!1,backdrop:"static"})}function a(e){var t=null;for(var n in s)if(s.hasOwnProperty(n)&&!_.isUndefined(n)){var r=s[n];if(r.domid==e){t=r;break}}return t}var n={attachmentsContainer:null,onLinkAttached:null,onLinkChanged:null,onLinkRemoved:null,listContainer:null},r=$(e),i=_.uniqueId("_link_attachments_"),s=[],o=null;_.extend(n,t),this.onTargetClicked=function(){this.show()},this.show=function(){$("#"+i+"_form").get(0).reset(),o.resetForm(),$("#"+i+"_url").val("http://"),$("#"+i).modal("show")},this.hide=function(){$("#"+i+"_form").get(0).reset(),o.resetForm(),$("#"+i+"_url").val("http://"),$("#"+i).modal("hide")},this.getLinks=function(){return s},this.setLinks=function(e){$.each(e,function(e,t){linkData=t;var r=_.uniqueId(i+"_link_");s.push(linkData),_.isFunction(n.onLinkAttached)&&n.onLinkAttached.apply(this,[linkData,this]),n.listContainer!==null&&($(n.listContainer).append(_.template($("#link-attachment-template").html(),{prefix:r,title:linkData.title,url:linkData.url})),$("#"+r+"_close").on("click",_.bind(function(e){var t=e.target.id.replace("_close",""),r=a(t);$("#"+t).remove(),s.splice(s.indexOf(r),1),_.isFunction(n.onLinkRemoved)&&n.onLinkRemoved.apply(this,[linkData,this])},this)))})},r.on("click",_.bind(this.onTargetClicked,this)),u=_.bind(u,this),u()}function FileAttachments(e,t){function a(){r.attr("id")!=""&&r.length>0&&(u||(u=new plupload.Uploader({runtimes:"html5,flash,html4",browse_button:r.attr("id")+"_browse",container:r.attr("id"),max_file_size:n.fileSizeLimit+"mb",url:n.uploaderUrl!==null?n.uploaderUrl:"upload/index.php",multipart_params:{csrf_token:_.isUndefined(_csrf_token)?"":_csrf_token,lesid:$.cookie("bp"),"return":!0,return_type:"json"},multi_selection:n.multiSelection,file_data_name:n.fileObjName!==null?n.fileObjName:"attachments",flash_swf_url:BAppConfig.get("global","swfUploader")})),u.init(),u.bind("FilesAdded",_.bind(function(e,r){var i=[];$.each(r,_.bind(function(a,l){if(!n.multiSelection&&u.files.length!=1){n.confirmMessage===null?(title=translate("attachments_confirm_remove_title"),message=translate("remove_attachment_to_upload_new")):(title=n.confirmMessage.title,message=n.confirmMessage.uploadNew),Utils.alert(title,message,function(){}),u.removeFile(l);return}var c=$(_.template($("#file-attachment-template").html(),{prefix:l.id,fileName:l.name}));$("#"+n.listContainer).append(c),c.find("#"+l.id+"_close").on("click",_.bind(function(e){n.blockContainer===!0&&Utils.block("#"+n.listContainer),u.stop(),n.confirmMessage===null?(title=translate("attachments_confirm_remove_title"),message=translate("attachments_confirm_remove")):(title=n.confirmMessage.title,message=n.confirmMessage.message),Utils.confirm(title,message,_.bind(function(r){if(r=="yes"){o.push(l.id);var i=f(e.target.id.replace("_close",""));_.indexOf(s,i)>-1&&s.splice(_.indexOf(s,i),1),_.isFunction(n.onFileRemoved)&&n.onFileRemoved.apply(this,[i,this]);var a=u.getFile(l.id);a&&u.removeFile(a),t.questionButtonId!=null&&$(t.questionButtonId).trigger("uploadedFile",l.id),s.length>=u.files.length&&(t.questionButtonId!=null?$(t.questionButtonId).trigger("filesFinishedUploading"):n.blockButtonIdFileAttachment!=null?$(n.blockButtonIdFileAttachment).attr("disabled",!1):n.blockButtonId!=null&&$(t.blockButtonId).trigger("uploadFinished",!1)),u.start()}else u.start();n.blockContainer===!0&&Utils.unblock("#"+n.listContainer)}))},this));if(n.removeCompleted){var h=!1,p=function(){_.isFunction(n.onFileRemoved)&&n.onFileRemoved.apply(this,[l.id,this]);var t=u.getFile(l.id);l.size>e.settings.max_file_size&&(i.push(t),$("#"+n.listContainer).find("#"+l.id).remove()),t&&t.loaded==t.size&&(i.push(t),u.removeFile(t)),i.length<=r.length&&!h&&setTimeout(p,n.removeTimeout*1e3),i.length==r.length&&(h=!0)};p()}},this)),u.start()},this)),u.bind("UploadFile",_.bind(function(e,r){t.questionButtonId!=null?$(t.questionButtonId).trigger("startFileUpload",r.id):t.blockButtonId!=null?$(t.blockButtonId).trigger("startUpload"):n.blockButtonIdFileAttachment!=null&&$(n.blockButtonIdFileAttachment).attr("disabled",!0),e.runtime=="html4"&&$("#"+r.id+" .data").html('<span class="uploading">'+translate("global_uploading")+"</span>")},this)),u.bind("FilesRemoved",_.bind(function(e,t){$.each(t,_.bind(function(e,t){$("#"+n.listContainer).find("#"+t.id).remove()},this))},this)),u.bind("UploadProgress",_.bind(function(e,t){t.percent!=100&&$("#"+t.id+" .data").html(t.percent+"%"),t.loaded==t.size&&$("#"+t.id+" .data").html(t.percent+"%")},this)),u.bind("FileUploaded",_.bind(function(e,r,i){var o={type:"file",title:r.fileName,domid:r.id},a=$.parseJSON(i.response);if(a!=null&&typeof a!="undefined"&&a.status==1)o.fileId=a.fileId,o.title=a.fileName,s.push(o),t.questionButtonId!=null&&$(t.questionButtonId).trigger("uploadedFile",r.id),_.isFunction(n.onFileAttached)&&n.onFileAttached.apply(this,[o,this]);else if(a!=null&&a.status==0){if(a.error!=undefined){switch(a.error){case"fileSizeTooBig":case"fileUploadErrorIniSize":Utils.flashMessage(Utils.FLASH_ERROR,translate("upload_error")+" "+r.name,translate("file_size")+" "+a.maxFileSize,"#"+n.listContainer);break;case"fileExtensionFalse":Utils.flashMessage(Utils.FLASH_ERROR,translate("upload_error")+" "+r.name,translate("accepted_file_types"),"#"+n.listContainer);break;case"empty_max_file_size":case"empty_accepted_file_types":Utils.flashMessage(Utils.FLASH_ERROR,translate("upload_error")+" "+r.name,translate(a.error),"#"+n.listContainer);break;default:Utils.flashMessage(Utils.FLASH_ERROR,translate("upload_error")+" "+r.name,translate("general_upload_error"),"#"+n.listContainer)}t.questionButtonId!=null&&$(t.questionButtonId).trigger("uploadedFile",r.id);var f=e.getFile(r.id);f&&e.removeFile(f),e.refresh()}}else{var f=e.getFile(r.id);f&&e.removeFile(f),e.refresh()}s.length>=u.files.length&&(t.questionButtonId!=null?$(t.questionButtonId).trigger("filesFinishedUploading"):n.blockButtonIdFileAttachment!=null?$(n.blockButtonIdFileAttachment).attr("disabled",!1):n.blockButtonId!=null&&$(t.blockButtonId).trigger("uploadFinished",!1))},this)),u.bind("Error",function(e,t){switch(t.code){case window.plupload.FILE_SIZE_ERROR:Utils.flashMessage(Utils.FLASH_ERROR,translate("upload_error")+" "+t.file.name,translate("file_size")+" "+n.fileSizeLimit+"MB","#"+n.listContainer);break;case window.plupload.GENERIC_ERROR:case window.plupload.HTTP_ERROR:case window.plupload.IO_ERROR:case window.plupload.SECURITY_ERROR:case window.plupload.INIT_ERROR:case window.plupload.FILE_EXTENSION_ERROR:case window.plupload.IMAGE_FORMAT_ERROR:case window.plupload.IMAGE_MEMORY_ERROR:case window.plupload.IMAGE_DIMENSIONS_ERROR:Utils.flashMessage(Utils.FLASH_ERROR,translate("upload_error")+" "+t.file.name,translate("file_failed")+" "+t.file.name,"#"+n.listContainer);break;default:Utils.flashMessage(Utils.FLASH_ERROR,translate("upload_error")+" "+t.file.name,translate("file_failed")+" "+t.file.name,"#"+n.listContainer)}var r=e.getFile(t.file.id);r&&e.removeFile(r),e.refresh()}))}function f(e){var t=null;for(var n in s)if(s.hasOwnProperty(n)&&!_.isUndefined(n)){var r=s[n];if(r.domid==e){t=r;break}}return t}var n={attachmentsContainer:null,onFileAttached:null,onFileChanged:null,onFileRemoved:null,listContainer:null,fileObjName:null,fileSizeLimit:0,uploaderUrl:null,buttonText:null,clientUploader:null,removeCompleted:!1,removeTimeout:3,multiSelection:!0,blockContainer:!1,confirmMessage:null,blockButtonIdFileAttachment:null},r=$(e),i=_.uniqueId("_file_attachments_"),s=[];_.extend(n,t);var o=[],u=null;this.getFiles=function(){return s},this.setFiles=function(e){$.each(e,function(e,t){t.fileId=t.id,s.push(t),_.isFunction(n.onFileAttached)&&n.onFileAttached.apply(this,[t,this]);var r=$(_.template($("#file-attachment-template").html(),{prefix:"file_"+t.id,fileName:t.name}));$("#"+n.listContainer).append(r),n.removeCompleted||r.find("#file_"+t.id+"_close").on("click",_.bind(function(e){Utils.confirm(translate("attachments_confirm_remove_title"),translate("attachments_confirm_remove"),_.bind(function(e){e=="yes"&&(s.splice($.inArray(t,s),1),_.isFunction(n.onFileRemoved)&&n.onFileRemoved.apply(this,[t,this]),$("#file_"+t.id).remove())}))},this))})},a=_.bind(a,this),setTimeout(a,500)}function Attachments(e,t){function a(){var t=_.template($("#"+n.template).html(),{prefix:i,canShare:n.canShare});$(e).html(t),n.canShare&&typeof n.initShareHandler=="function"&&n.initShareHandler.apply(this,[{container:"#"+i+"_sharefile",attachmentsComponent:this}]),o=new LinkAttachments("#"+i+"_attlinks",{onLinkAttached:_.bind(function(e,t){s.push(e),_.isFunction(n.onAttachmentAdded)&&n.onAttachmentAdded.apply(this,[e,this])},this),onLinkRemoved:_.bind(function(e,t){s.splice(_.indexOf(s,e),1),_.isFunction(n.onAttachmentRemoved)&&n.onAttachmentRemoved.apply(this,[e,this])},this),listContainer:"#"+i+"_attachments_container"}),$(n.blockButtonId).off("startUpload").on("startUpload",_.bind(function(){$(n.blockButtonId).attr("disabled",!0)},this)),$(n.blockButtonId).off("uploadFinished").on("uploadFinished",_.bind(function(){$(n.blockButtonId).attr("disabled",!1)},this)),u=new FileAttachments("#"+i+"_attfiles",{onFileAttached:_.bind(function(e,t){s.push(e),_.isFunction(n.onAttachmentAdded)&&n.onAttachmentAdded.apply(this,[e,this])},this),onFileRemoved:_.bind(function(e,t){_.indexOf(s,e)>-1&&s.splice(_.indexOf(s,e),1),_.isFunction(n.onAttachmentRemoved)&&n.onAttachmentRemoved.apply(this,[e,this])},this),listContainer:i+"_attachments_container",uploaderUrl:n.uploaderUrl,clientUploader:n.clientUploader,fileSizeLimit:BAppConfig.get("global","max_file_size"),blockButtonId:n.blockButtonId,questionButtonId:n.questionButtonId}),n.attachments&&this.setAttachments(n.attachments)}var n={attachmentsContainer:null,onAttachmentAdded:null,onAttachmentChanged:null,onAttachmentRemoved:null,template:"attachments-template",prefix:"_attachemnts_box",uploaderUrl:null,clientUploader:null,attachments:null,canShare:!1,initShareHandler:null,blockButtonId:null,questionButtonId:null},r=$(e),i=_.uniqueId(n.prefix),s=[],o=null,u=null;_.extend(n,t),this.onTargetClicked=function(){this.show()},this.addAttachments=function(e){s.push(e)},this.deleteAttachments=function(e){_.indexOf(s,e)>-1&&s.splice(_.indexOf(s,e),1)},this.getAttachments=function(){var e=[];return _.each(s,function(t,n,r){var i=jQuery.extend({},t);delete i.domid,e.push(i)}),e},this.addFileAttachments=function(e){u.setFiles(e)},this.setAttachments=function(e){typeof e.link!="undefined"&&o.setLinks(e.link),typeof e.file!="undefined"&&u.setFiles(e.file)},a=_.bind(a,this),setTimeout(a,500)}function AppPaginator(e,t){function a(e){var t=e.target.id.replace(o+"_p","");t=="next"?this.goNext():t=="prev"?this.goPrev():this.goToPage(parseInt(t))}function f(){n.onPageSelected&&_.isFunction(n.onPageSelected)&&n.onPageSelected.apply(this,[s])}var n={pages:0,page:0,onPageSelected:null,render:!0,visiblePages:5},r=$(e);r.hasClass("pagination")||r.addClass("pagination"),_.extend(n,t);var i=n.pages,s=n.page,o="paginator_"+_.uniqueId(),u=null;this.getPaginatorId=function(){return o},this.getConfig=function(){return n},this.getCurrentPage=function(){return s},this.setCurrentPage=function(e){s=parseInt(e)},this.getTotalPages=function(){return i},this.setTotalPages=function(e){i=e},this.hide=function(){u.hide()},this.show=function(){u.show()},this.render=function(){u===null&&(u=$('<ul id="'+o+'" class="clearfix"></ul>'),r.append(u)),u.empty(),u.off("click","a.paginator_pg"),u.off("click","a.paginator_prev"),u.off("click","a.paginator_next");var e=s-parseInt(n.visiblePages/2);e<1&&(e=1),e+n.visiblePages>i&&(e=i-n.visiblePages+1,e<1&&(e=1));var t=e+(n.visiblePages-1);t>i&&(t=i),u.append("<li "+(1==s?'class="disabled"':"")+' id="'+o+'_prev"><a class="paginator_prev" href="javascript:void(0)" id="'+o+'_pprev">«</a></li>');if(i>0)for(var f=e;f<=t;f++)u.append("<li "+(f==s?'class="active"':"")+'><a href="javascript:void(0)" class="paginator_pg" id="'+o+"_p"+f+'">'+f+"</a></li>");u.append("<li "+(i==s?'class="disabled"':"")+' id="'+o+'_next"><a class="paginator_next" href="javascript:void(0)" id="'+o+'_pnext">»</a></li>'),u.on("click","a.paginator_pg",_.bind(a,this)),u.on("click","a.paginator_next",_.bind(this.goNext,this)),u.on("click","a.paginator_prev",_.bind(this.goPrev,this)),this.show()},this.goToPage=function(e){e>0&&e>i&&(e=i),e>0&&e<=i&&(s=e,f(),this.render())},this.goNext=function(){s+1<=i&&(s++,f(),this.render())},this.goPrev=function(){s-1>0&&(s--,f(),this.render())},_.bind(this.render,this),n.render&&this.render()}function videoProcessor(){this.initialize=function(e){this.urlRules=["http://(?:www\\.)?xkcd\\.com/\\d+/?","https?://soundcloud.com/.*/.*","http://www\\.ted\\.com/talks/.+\\.html","http://(?:www\\.)?theverge\\.com/\\d{4}/\\d{1,2}/\\d{1,2}/\\d+/[^/]+/?$","http://www\\.theonion\\.com/articles/[^/]+/?","http://yfrog\\.com/[0-9a-zA-Z]+/?$","https?://(?:www.)?skitch.com/([^/]+)/[^/]+/.+","http://skit.ch/[^/]+","https?://(alpha|posts|photos)\\.app\\.net/.*","https?://gist\\.github\\.com/(?:[-0-9a-zA-Z]+/)?([0-9a-fA-f]+)","https?://www\\.(dropbox\\.com/s/.+\\.(?:jpg|png|gif))","https?://db\\.tt/[a-zA-Z0-9]+","https?://[^\\.]+\\.wikipedia\\.org/wiki/(?!Talk:)[^#]+(?:#(.+))?","http://www.traileraddict.com/trailer/[^/]+/trailer","http://lockerz\\.com/[sd]/\\d+","http://trailers\\.apple\\.com/trailers/[^/]+/[^/]+","http://bash\\.org/\\?(\\d+)","http://arstechnica\\.com/[^/]+/\\d+/\\d+/[^/]+/?$","http://imgur\\.com/gallery/[0-9a-zA-Z]+","http://www\\.asciiartfarts\\.com/[0-9]+\\.html","http://www\\.monoprice\\.com/products/product\\.asp\\?.*p_id=\\d+","https?://(?:[^\\.]+\\.)?youtube\\.com/watch/?\\?(?:.+&)?v=([^&\\s]+)","https?://youtu\\.be/([a-zA-Z0-9_-]+)","https?://github\\.com/([^/]+)/([^/]+)/commit/(.+)","http://git\\.io/[_0-9a-zA-Z]+","https?://open\\.spotify\\.com/(track|album)/([0-9a-zA-Z]{22})","https?://path\\.com/p/([0-9a-zA-Z]+)$","http://www.funnyordie.com/videos/[^/]+/.+","http://(?:www\\.)?twitpic\\.com/([^/]+)","https?://www\\.giantbomb\\.com/videos/[^/]+/\\d+-\\d+/?","http://(?:www\\.)?beeradvocate\\.com/beer/profile/\\d+/\\d+","http://(?:www\\.)?imdb.com/title/(tt\\d+)","http://cl\\.ly/(?:image/)?[0-9a-zA-Z]+/?$","http://www\\.hulu\\.com/watch/.*","https?://(?:www\\.)?twitter\\.com/(?:#!/)?[^/]+/status(?:es)?/(\\d+)/?$","http://t\\.co/[a-zA-Z0-9]+","https?://(?:www\\.)?vimeo\\.com/[0-9a-zA-Z]+","http://www\\.amazon\\.com/(?:.+/)?[gd]p/(?:product/)?(?:tags-on-product/)?([a-zA-Z0-9]+)","http://amzn\\.com/([^/]+)","http://qik\\.com/video/.*","http://www\\.rdio\\.com/#/artist/[^/]+/album/[^/]+/?","http://www\\.rdio\\.com/#/artist/[^/]+/album/[^/]+/track/[^/]+/?","http://www\\.rdio\\.com/#/people/[^/]+/playlists/\\d+/[^/]+","http://www\\.slideshare\\.net/.*/.*","http://imgur\\.com/([0-9a-zA-Z]+)$","https?://instagr(?:\\.am|am\\.com)/p/.+","http://www\\.twitlonger\\.com/show/[a-zA-Z0-9]+","http://tl\\.gd/[^/]+","https?://vine.co/v/[a-zA-Z0-9]+","http://www\\.urbandictionary\\.com/define\\.php\\?term=.+","http://picplz\\.com/user/[^/]+/pic/[^/]+","https?://(?:www\\.)?twitter\\.com/(?:#!/)?[^/]+/status(?:es)?/(\\d+)/photo/\\d+(?:/large|/)?$","https?://pic\\.twitter\\.com/.+"],this.regEx=new RegExp(this.urlRules.join("|"),"g"),this.result=null,this.container=e.container,this.embedUrl=BAppConfig.get("global","embedUrl")},this.getVideo=function(e){$.ajax({type:"GET",url:document.location.protocol+"//"+this.embedUrl+encodeURIComponent(e)+"&maxwidth=420&nowrap=on&callback=?",success:_.bind(function(t){t.error==undefined&&t.type=="video"&&(this.result=t,this.result.currentUrl=e),this.container.trigger("addVideoPreview",[this.result])},this),dataType:"jsonp"})},this.getRegExp=function(){return this.regEx}}function VideoAttachments(e,t){function o(e){var t=null;for(var n in i)if(i.hasOwnProperty(n)&&!_.isUndefined(n)){var r=i[n];if(r.url==e){t=r;break}}return t}var n={listContainer:null,onVideoAttached:null,onVideoRemoved:null};this.urlsToEmbed=[],this.alreadyEmbeded=[];var r=$(e),i=[],s=new videoProcessor;s.initialize({container:r}),this.regEx=s.getRegExp(),_.extend(n,t),this.onTargetKeyUp=function(){this.getVideosTemplates()},this.getVideos=function(){return i},this.addVideo=_.bind(function(e){var t=this.setVideoData(e);_.isFunction(n.onVideoAttached)&&n.onVideoAttached.apply(this,[t,this]),i.push(t)},this),this.setVideoData=function(e){var t=$("<div></div>");t.append(e.html);var n=t.find("iframe").attr("src");if(_.str.include(n,"?"))var r=n+"&wmode=transparent";else var r=n+"?wmode=transparent";t.find("iframe").attr("src",r),e.html=t.html();var i={type:"video",title:e.title,version:e.version,height:e.height,width:e.width,html:Base64.encode(e.html),provider:e.provider_name,url:e.url,thumbnail_url:e.thumbnail_url,thumbnail_width:e.thumbnail_width,thumbnail_height:e.thumbnail_height};return i},this.getVideosTemplates=_.bind(function(){this.urlsToEmbed=r.val().match(this.regEx),this.urlsToEmbed!==null?($.each(this.alreadyEmbeded,_.bind(function(e,t){this.removeEmbededVideo(t)},this)),$.each(this.urlsToEmbed,_.bind(function(e,t){this.urlsToEmbed[e]!==null&&this.urlsToEmbed[e]!==undefined&&$.inArray(this.urlsToEmbed[e],this.alreadyEmbeded)===-1&&s.getVideo(this.urlsToEmbed[e])},this))):this.alreadyEmbeded!=[]&&$.each(this.alreadyEmbeded,_.bind(function(e,t){this.removeEmbededVideo(t)},this))},this),this.renderVideoTemplate=function(e,t){if(e!=undefined&&e!=null){var r={id:_.uniqueId(["video_"]),thumbnail_url:e.thumbnail_url,title:e.title,width:e.width,html:e.html,url:t},i=$(_.template($("#embeded-video-attachment").html(),r));n.listContainer.append(i)}},this.addVideoPreview=function(e){e!==null&&this.removeEmbededVideo(e.currentUrl),!_.isEmpty(e)&&!_.isEmpty(e.html)&&$.inArray(e.currentUrl,this.alreadyEmbeded)===-1&&$.inArray(e.currentUrl,this.urlsToEmbed)!==-1&&(this.addVideo(e),this.renderVideoTemplate(e,e.currentUrl),this.alreadyEmbeded.push(e.currentUrl))},this.removeEmbededVideo=_.bind(function(e){if($.inArray(e,this.alreadyEmbeded)!==-1)if(this.urlsToEmbed===null||$.inArray(e,this.urlsToEmbed)===-1){var t=n.listContainer.find("a[url='"+e+"']").attr("id"),r=t.replace("_close","");$("#"+r).remove();var s=$.inArray(e,this.alreadyEmbeded);s>-1&&this.alreadyEmbeded.splice(s,1);var u=o(e),s=$.inArray(u,i);s>-1&&i.splice(s,1),_.isFunction(n.onVideoRemoved)&&u!=null&&n.onVideoRemoved.apply(this,[u,this])}},this),r.on("keyup",_.bind(this.onTargetKeyUp,this)),r.on("addVideoPreview",_.bind(function(e,t){this.addVideoPreview(t)},this)),n.listContainer!=null&&n.listContainer.find(".jqDeleteVideo").live("click",_.bind(function(e){var t=$(e.target).attr("url"),n=$.inArray(t,this.urlsToEmbed);n>-1&&this.urlsToEmbed.splice(n,1),this.removeEmbededVideo(t)},this))}function tableToGrid(e,t){jQuery(e).each(function(){if(!this.grid){jQuery(this).width("99%");var e=jQuery(this).width(),n=jQuery("tr td:first-child input[type=checkbox]:first",jQuery(this)),r=jQuery("tr td:first-child input[type=radio]:first",jQuery(this)),n=0<n.length,r=!n&&0<r.length,i=n||r,s=[],o=[];jQuery("th",jQuery(this)).each(function(){0===s.length&&i?(s.push({name:"__selection__",index:"__selection__",width:0,hidden:!0}),o.push("__selection__")):(s.push({name:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(" ").join("_"),index:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(" ").join("_"),width:jQuery(this).width()||150}),o.push(jQuery(this).html()))});var u=[],a=[],f=[];jQuery("tbody > tr",jQuery(this)).each(function(){var e={},t=0;jQuery("td",jQuery(this)).each(function(){if(0===t&&i){var n=jQuery("input",jQuery(this)),r=n.attr("value");a.push(r||u.length),n.is(":checked")&&f.push(r),e[s[t].name]=n.attr("value")}else e[s[t].name]=jQuery(this).html();t++}),0<t&&u.push(e)}),jQuery(this).empty(),jQuery(this).addClass("scroll"),jQuery(this).jqGrid(jQuery.extend({datatype:"local",width:e,colNames:o,colModel:s,multiselect:n},t||{}));for(e=0;e<u.length;e++)r=null,0<a.length&&(r=a[e])&&r.replace&&(r=encodeURIComponent(r).replace(/[.\-%]/g,"_")),null===r&&(r=e+1),jQuery(this).jqGrid("addRowData",r,u[e]);for(e=0;e<f.length;e++)jQuery(this).jqGrid("setSelection",f[e])}})}var BAppConfig={configs:{},init:function(e){this.configs=e},get:function(e,t){return this.configs[e]&&this.configs[e][t]?this.configs[e][t]:null}};define("config",function(){}),define("beyazpano",["order!jquery","order!underscore","order!backbone","order!config"],function(){var e={init:function(){this.config={};var e=BAppConfig.get("site_app","config");e!==null&&(this.config=_.extend(this.config,e))},run:function(e,t){this.config||this.init(),require([e],function(e){typeof isInitBAppTranslate!="undefined"&&!isInitBAppTranslate&&BAppTranslate(translations),_.isEmpty(BAppConfig.configs)&&BAppConfig.init(configs);var n=new e;typeof t!="undefined"&&t.length!=0?n.run(t):n.run()})},appendTemplate:function(e,t){document.getElementById(e)||$("body").append('<div id="'+e+'" class="hide"></div>'),$("#"+e).html(t);var n={};return $("#"+e).find("script").each(function(e,t){n[t.id]=!0}),n},renderTemplate:function(e,t){var n=_.template($("#"+e).html(),t);return n}};return Backbone.sync=function(e,t,n){var r="POST";n||(n={});var i={type:r,dataType:"json"};return!n.data&&t&&(e=="create"||e=="update")&&(i.contentType="application/json",i.data=JSON.stringify(t.toJSON())),i.url="",_.isFunction(t.url)?i.url=t.url():i.url=t.url,e=="read"?t instanceof Backbone.Collection?i.url+="/list":t instanceof Backbone.Model&&(i.url+="/get",i.data||(i.data={}),i.data.id=t.get("id")):e=="create"||e=="update"?i.url+="/save":e=="delete"&&(i.url+="/delete"),$.ajax(_.extend(i,n))},e});var isInitBAppTranslate=!1;define("translate",function(){}),define("text!profile/templates.html",[],function(){return'<script type="text/template" id="profile_updates">\n    <h2 class="middleZoneTitle"><%- userinfo.first_name %> <%- userinfo.last_name %></h2>\n    <% if(access){ %>\n    <div id="post_updates_container" class="postUpdatesContainer"></div>\n    <% } %>\n    <div id="updates_list_container"></div>\n\n</script>\n\n<script type="text/template" id="profile_updates_right_column">\n    <div id="upcoming_assignments_container"></div>\n    <div id="courses_container"></div>\n    <div id="groups_container"></div>\n</script>\n\n<script type="text/template" id="profile_info_right_column">\n    <div id="courses_container"></div>\n    <div id="groups_container"></div>\n</script>\n\n<script type="text/template" id="friend_request_btn">\n    <div>\n        <a class="<% print(friend_request_class) %> clearfix" id="friend-request-<% print(friend_request_userid) %>" data-request="<%= friend_request_userid %>" href="javascript:void(0);">\n            <i class="btnicon-<% print(friend_request_class) %>"></i>\n            <p><% print(_.escape(friend_request_label)) %></p>\n        </a>\n        <% if(show_decline != undefined && show_decline > 0) {%>\n        <a class="decline-friend-request clearfix" id="friend-request-<% print(friend_request_userid) %>" data-request="<%= friend_request_userid %>" href="javascript:void(0);">\n            <i class="btnicon-decline-friend-request"></i>\n            <p><%print(translate(\'request_decline_label\'))%></p>\n        </a>\n        <% } %>\n    </div>\n</script>   \n\n<script type="text/template" id="notifications-template">\n    <a href="#"  class="dropdown-toggle <% if(total > 0) {%>has-new-notification<%}%>">\n        <% if(!_.isNull(total) && total > 0){ %>\n        <span><%= total %></span>\n        <% } %>\n    </a>\n    <ul class="dropdown-menu notificationsDropdown clearfix">\n        <li>\n            <h3><% print(translate(\'global_notifications\')); %></h3>\n        </li>\n        <% if(notifications.length > 0) {%>\n        <% _.each(notifications, function(n) { %>\n        <li id="notification_dropdown_item_<%= n.user_notification_id %>" class="clearfix notifOuterContainer">\n            <div class="notifDropdownContainer"><%= n.text %>\n                <div class="dropDownDate"><% print(Utils.formatDate(n.timestamp,\'dd MMM yyyy HH:mm tt\')) %></div>\n            </div>         \n            <div class="dismissBtn"><button class="jq-dismiss">x</button></div>\n        </li>\n        <li class="divider"> </li>\n        <% }) %>\n        <% } else { %>\n        <li  class="notifListEmpty">\n            <span><% print(translate(\'notification_list_empty\')) %></span>\n        </li>\n        <% } %>\n        <li class="dropdownMenuFooter clearfix">\n            <a id ="allNotifications" href="<% print(BAppConfig.get(\'site_notifications\', \'notificationsPage\')) %>" class="connections"><% print(translate(\'goto_notifications_page\')) %></a>\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="profile_avatar_container">\n    <div id="avatar_container"></div>\n</script>\n\n<script type="text/template" id="profile_avatar">\n    <div class="avatarContainer">\n        <a href="<%= originalUrl %>" id="avatar_lightbox">\n            <img src="<%= avatarUrl %>" title="<%- userName %>" alt="<%- userName %>" width="170"/>\n        </a>\n    </div>\n</script>\n\n<script type="text/template" id="profile_info">\n    <section class="profileInfo">\n        <h2><%- userinfo.first_name %> <%- userinfo.last_name %></h2>\n        <% if(canEdit) { %>\n        <a class="btn" href="<%= editProfileLink %>"><i class="btnicon-edit"></i><% print(_.escape(translate(\'global_edit\'))) %></a>\n        <% } %>\n        <!--        <div id="friend-request-btn"></div>-->\n        <% if(userinfo.institution || userinfo.role || userinfo.subjects_taught || userinfo.grades_taught ||  userinfo.gender || userinfo.birthdate || userinfo.bio || userinfo.position || userinfo.countryName || userinfo.cityName) { %>\n        <h3><% print(translate(\'profile_about_me\')) %></h3>\n        <ul class="profileInfo clearfix">\n            <% if(userinfo.countryName) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"> <% print(translate(\'profile_country\')) %> </div>\n                <div><% print(_.escape(userinfo.countryName).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.cityName) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"> <% print(translate(\'profile_city\')) %> </div>\n                <div><% print(_.escape(userinfo.cityName).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.institution) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"> <% print(translate(\'profile_institution\')) %> </div>\n                <div><% print(_.escape(userinfo.institution).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.id_number) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"> <% print(translate(\'profile_id_number\')) %> </div>\n                <div><% print(_.escape(userinfo.id_number).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.role) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"><% print(translate(\'profile_role\')) %> </div>\n                <div><% \n                if(userinfo.role == \'INSTRUCTOR\') {\n                    print(translate(\'global_instructor\').toUpperCase());\n                } else {\n                    print(translate(\'global_student\').toUpperCase());\n                }\n                %></div>\n            </li>\n            <% } %>\n\n\n            <% if(userinfo.subjects_taught) { %>\n            <li class="clearfix">\n                <div class="fieldDescription"><% print(translate(\'profile_subjects_taught\')) %> </div>\n                <div><%- userinfo.subjects_taught %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.grades_taught) { %>\n            <li class="clearfix">\n                <div class="fieldDescription"><% print(translate(\'profile_grades_taught\')) %> </div>\n                <div><%- userinfo.grades_taught %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.gender) { %>\n            <li class="clearfix">\n                <div class="fieldDescription">\n                    <% print(translate(\'profile_gender\')) %> </div>\n                <div><% \n                if (userinfo.gender == \'M\') {\n                    print(translate(\'global_gender_male\'));\n                } else if (userinfo.gender == \'F\') {\n                    if(userinfo.role == \'STUDENT\'){\n                    print(translate(\'global_gender_female_girl\'));\n                    } else{\n                    print(translate(\'global_gender_female\'));\n                    }\n                } \n                %></div>\n            </li>\n            <% } %>\n            <% if((userinfo.birthdate != \'0000-00-00\') && !_.isEmpty(userinfo.birthdate)) { %>\n            <% var date = new Date(); %>\n            <% var birthDate = date.getTime(userinfo.birthdate);%>\n            <li class="clearfix">\n                <div class="fieldDescription">\n                    <% print(translate(\'profile_birthday\')) %> </div>\n                <div><% print(Utils.formatDate(userinfo.birthdate,\'dd MMMM yyyy\')) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.bio) { %>\n            <li class="clearfix">\n                <div class="fieldDescription">\n                    <% print(translate(\'profile_bio\')) %> </div>\n                <div><%= _.escape(userinfo.bio) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.position) { %>\n            <li class="clearfix">\n                <div class="fieldDescription">\n                    <% print(translate(\'profile_position\')) %> </div>\n                <div><%= _.escape(userinfo.position) %></div>\n            </li>\n            <% } %>\n\n        </ul>\n        <% } %>\n        <% if(userinfo.email || userinfo.phone || userinfo.email || userinfo.address) { %>\n        <h3><% print(translate(\'profile_contact_info\')) %></h3>\n        <ul class="profileInfo clearfix">\n            <% if(userinfo.email) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"><% print(translate(\'profile_email\')) %> </div>\n                <div><%- userinfo.email %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.phone) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"><% print(translate(\'profile_phone\')) %> </div>\n                <div><%- userinfo.phone %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.websites) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"><% print(translate(\'profile_websites\')) %> </div>\n                <div><% print(_.escape(userinfo.websites).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.address) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"><% print(translate(\'profile_address\')) %> </div>\n                <div><% print(_.escape(userinfo.address).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n        </ul>\n        <% } %>\n\n\n\n        <% if(userinfo.activities || userinfo.interests) { %>\n        <h3><% print(translate(\'profile_activities_interests\')) %></h3>\n        <ul class="profileInfo clearfix">\n            <% if(userinfo.activities) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"> <% print(translate(\'profile_activities\')) %> </div>\n                <div><% print(_.escape(userinfo.activities).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n            <% if(userinfo.interests) { %>\n            <li class="clearfix">\n                <div  class="fieldDescription"><% print(translate(\'profile_interests\')) %> </div>\n                <div><% print(_.escape(userinfo.interests).replace(/\\n/g,\'<br />\')) %></div>\n            </li>\n            <% } %>\n        </ul>\n        <% } %>\n        <!--<h3><% print(translate(\'profile_connections\')) %></h3>\n           <ul class="profileInfo clearfix">\n                <li class="clearfix">\n                    <div  class="fieldDescription"><% print(translate(\'profile_connections\')) %> </div>\n                    <div><%- connections %></div>\n                </li>\n                <% if(hasStudents) { %>\n                    <li class="clearfix">\n                        <div  class="fieldDescription"><% print(translate(\'profile_nr_of_students\')) %> </div>\n                        <div><%- nrOfStudents %></div>\n                    </li>\n                <% } %>\n            </ul>    -->\n    </section>\n</script>\n\n<script type="text/template" id="avatar-edit-dialog">\n    <div class="modal fade modal-narrow" id="<%= dialog_id %>" data-backdrop="static">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3 id="<%= dialog_id %>-title"><%- title %></h3>\n            </div>\n        </div>\n        <div class="modal-body" id="<%= dialog_id %>-body">\n            <div class="modalContent">\n                <img src="<%= image %>" id="avatar-edit-image" />\n                <input type="hidden" id="avatar-edit-image-x">\n                <input type="hidden" id="avatar-edit-image-y">\n            </div>\n        </div>\n        <div class="modal-footer" id="<%= dialog_id %>-footer">\n            <div class="modalFooterContainer">\n                <div class="modalButtons">\n                    <%= footer %>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n'}),define("profile/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("profile_templates",n);return r}),define("profile/views/notificationDropdown",["require","beyazpano","profile/_templates"],function(e,t){var n=Backbone.View.extend({templateNames:{main:"notifications-template"},notificationList:[],more:!0,total:null,limit:5,initialize:function(e){this.el="#notifications-dropdown",this.$el=$(this.el),e&&e.limit&&(this.limit=e.limit),$("#notifications-dropdown").on("notificationsAvailable",_.bind(function(e){this.getContent()},this))},getContent:function(){$.ajax({type:"POST",data:{limit:this.limit},url:BAppConfig.get("site_notifications","getDropdownNotifications"),dataType:"json",success:_.bind(function(e){e.success&&(this.notificationList=e.data.notifications,this.more=e.data.more,this.total=e.data.total,this.renderWithData({notifications:this.notificationList,more:this.more,total:this.total}))},this)})},render:function(){var e={notifications:this.notificationList,more:this.more,total:this.total};this.renderWithData(e),this.initEvents()},markRead:function(){this.renderWithData({notifications:this.notificationList,more:this.more,total:this.total})},renderWithData:function(e){var n=$(t.renderTemplate(this.templateNames.main,e));$("#notifications-dropdown").empty().append(n)},initEvents:function(){var e=this;$(".jq-dismiss",this.$el).live("click",function(){var t=$(this).closest('li[id^="notification_dropdown_item_"]'),n=t.attr("id").replace("notification_dropdown_item_","");$.ajax({type:"POST",data:{userNotificationId:n},url:BAppConfig.get("site_notifications","markSeen"),dataType:"json",success:_.bind(function(t){t.success&&e.getContent()},this)})}),$("#allNotifications",this.$el).live("click",function(e){e.preventDefault(),$.cookie("sm_notifications_page",1),window.location=$(e.currentTarget).attr("href")}),$("#notifications-dropdown").click(function(t){var n=[];$.each(e.notificationList,function(e,t){n.push(t.user_notification_id)}),$.ajax({type:"POST",data:{ids:n},url:BAppConfig.get("site_notifications","markSeen"),dataType:"json",success:_.bind(function(e){e.success&&$(".has-new-notification span").remove()},this)})})}});return n}),define("requests/model/requests",["beyazpano"],function(e){var t=Backbone.Model.extend({initialize:function(){}});return t}),define("requests/collection/requests",["requests/model/requests"],function(e){var t=Backbone.Collection.extend({model:e,initialize:function(){this.details={ts:0}},parse:function(e){if(e.success)return this.details.ts=e.ts,e.data;e.msg?this.trigger("error",e.msg):this.trigger("error",translate("requests_error_occured"))},getRequests:function(){this.fetch({success:_.bind(function(e,t){e.trigger("requestsReceived",t,e)},this)})},getNewRequests:function(e){this.fetch({data:this.details,add:!e,success:_.bind(function(t,n){e||(this.details.ts=n.ts,n.success?t.trigger("requestsAdded",n.data,t):n.msg?this.trigger("error",n.msg):this.trigger("error",translate("requests_error_occured")))},this),error:_.bind(function(e,t){this.trigger("error",translate("requests_error_occured"))},this)})}});return t}),define("text!requests/templates.html",[],function(){return'<script type="text/template" id="requests-dropdown-template">\n    <a href="#"  class="dropdown-toggle <% if(totalRequests > 0) {%>has-new-friend-requests<%}%>">\n        <span class="total-requests"><%= totalRequests %></span>\n    </a>\n    <ul class="dropdown-menu">\n        <% print(_.template($(\'#requests-containers\').html(), {requestsPageUrl: requestsPageUrl})) %>\n    </ul>\n</script>\n\n<script type="text/template" id="requests-page-template">\n    <ul class="requests">\n        <% print(_.template($(\'#requests-containers\').html(), {})) %>\n    </ul>\n</script>\n\n<script type="text/template" id="requests-containers">\n    <li class="alert_requests"></li>\n    <li>\n        <h3><%- translate(\'global_requests\') %></h3>\n    </li>\n    <li class="friend-requests">\n        <span class="no-requests"><%- translate(\'request_list_empty\') %></span>\n    </li>\n    <li>\n        <h3><%- translate(\'global_event_requests\') %></h3>\n    </li>\n    <li class="event-requests">\n        <span class="no-requests"><%- translate(\'request_list_empty\') %></span>\n    </li>\n    <li>\n        <h3><%- translate(\'global_section_requests\') %></h3>\n    </li>\n    <li class="section-requests">\n        <span class="no-requests"><%- translate(\'request_list_empty\') %></span>\n    </li>\n    <li>\n        <h3><%- translate(\'global_group_requests\') %></h3>\n    </li>\n    <li class="group-requests">\n        <span class="no-requests"><%- translate(\'request_list_empty\') %></span>\n    </li>\n    <% if(typeof requestsPageUrl !== \'undefined\') { %>\n    <li class="dropdownMenuFooter">\n        <a href="<%= requestsPageUrl %>" class="requests"><%- translate(\'global_goto_received_requests_page\') %></a>\n    </li>\n    <% } %>\n</script>\n\n<script type="text/template" id="requests-no-items">\n    <span class="no-requests"><%- translate(\'request_list_empty\') %></span>\n</script>\n\n<script type="text/template" id="requests-items">\n    <% if(!_.isEmpty(data)) { %>\n    <ul class="requestItems">\n        <% _.each(data, _.bind(function(item) { %>\n        <li class="clearfix breakWord" data-request-element="<%= item.id %>">\n            <div class="userData">\n                <img src="<%= item.userAvatar %>" class="<%= avatarClass %>"> \n                <a href="<%= item.userLink %>" class="requestUser">\n                    <%= item.userName %>\n                </a>\n                <%= item.text %>\n            </div>\n            <div class="right requestUserAction">\n                <button class="btn accept-request userDefaultBtn" data-request="<%= item.id %>"><%- translate(\'request_accept_short_label\')%></button>\n                <button class="btn decline-request" data-request="<%= item.id %>"><%- translate(\'request_decline_label\')%></button>\n            </div>\n            <div class="dropDownDate clear"><%= Utils.formatDate(item.created,\'dd MMM yyyy HH:mm tt\') %></div>\n        </li>\n        <% }, this)) %>\n    </ul>\n    <% } %>\n</script>'}),define("requests/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("requests_templates",n);return r}),define("requests/views/requests",["require","beyazpano","requests/collection/requests","requests/_templates"],function(e,t,n){var r=Backbone.View.extend({templateNames:{mainDropdown:"requests-dropdown-template",mainPage:"requests-page-template",noRequests:"requests-no-items",requestItems:"requests-items"},containers:{friendRequests:".friend-requests",eventRequests:".event-requests",classRequests:".section-requests",groupRequests:".group-requests"},initialize:function(e){this.config={typeDropdown:_.isUndefined(e.dropdown)?!0:e.dropdown,avatarClass:_.isUndefined(e.dropdown)?"userSmallIcon":"userMediumIcon",requestsUrl:BAppConfig.get("site_requests","userRequestsDataUrl"),requestsUrlAccept:BAppConfig.get("site_requests","userRequestsUrlAccept"),requestsUrlDecline:BAppConfig.get("site_requests","userRequestsUrlDecline"),requestsPageUrl:BAppConfig.get("site_requests","requestsPage"),requestTypes:BAppConfig.get("site_requests","config").requestTypes,requestVerbs:BAppConfig.get("site_requests","config").requestVerbs,sectionWallUrl:BAppConfig.get("site_sections","sectionUrl"),groupWallUrl:BAppConfig.get("site_groups","groupUrl"),eventUrl:BAppConfig.get("site_event","config").eventPageLink,userUrl:BAppConfig.get("site_profile","config").userProfileUpdatesLink},$("#requests-dropdown").on("requestsReceived",_.bind(function(e,t){this.renderAllRequests(t),$("#requests-dropdown").trigger("initialRequestsReceived",[t])},this)),$("#requests-dropdown").on("requestsAdded",_.bind(function(e,t){this.renderNewRequests(t)},this)),$("#requests-dropdown").on("error",_.bind(function(e){_.delay(_.bind(function(){this.manageErrors(e)},this),1e3)},this)),$("#requests-dropdown").on("externalAcceptRequest",_.bind(function(e,t){this.acceptRequest(t)},this)),$("#requests-dropdown").on("externalDeclineRequest",_.bind(function(e,t){this.declineRequest(t)},this)),this.totalRequests=0},render:function(){return this.config.typeDropdown===!0?$("#requests-dropdown").on("pageElementRemoved",_.bind(function(e,t){this.removeElementFromDropdown(t)},this)):($("#requests-dropdown").on("initialRequestsReceived",_.bind(function(e,t){this.renderAllRequests(t)},this)),$("#requests-dropdown").on("dataChanged",_.bind(function(e,t){_.each(t,_.bind(function(e,t){_.size(e)>0&&this.renderRequestItems(e,t,"#requestsMiddleZone")},this))},this)),$("#requests-dropdown").on("dropdownElementRemoved",_.bind(function(e,t){this.removeElementFromPage(t)},this))),this.initHandlers(),this},initHandlers:function(){$("#requests-dropdown .dropdown-menu button").live("click",function(e){$("#requests-dropdown").addClass("open")}),this.$(".accept-request").live("click",_.bind(this.acceptRequest,this)),this.$(".decline-request").live("click",_.bind(this.declineRequest,this))},renderAllRequests:function(e){var n=e;_.size(n)>0&&_.each(n,_.bind(function(e){this.totalRequests=this.totalRequests+_.size(e)},this));var r={totalRequests:this.totalRequests,requestsPageUrl:this.config.requestsPageUrl},i;this.config.typeDropdown===!0?i=$(t.renderTemplate(this.templateNames.mainDropdown,r)):i=$(t.renderTemplate(this.templateNames.mainPage,r)),this.$el.html(i);if(_.size(n)>0)_.each(n,_.bind(function(e,t){_.size(e)>0&&this.renderRequestItems(e,t)},this));else{var s=this.templateNames.noRequests;_.each(this.containers,_.bind(function(e){var n=$(t.renderTemplate(s,{}));this.$(e).html(n)},this))}},renderNewRequests:function(e){_.size(e)>0&&(_.each(e,_.bind(function(e,t){_.size(e)>0&&(this.totalRequests=this.totalRequests+_.size(e),this.updateTotalRequests(this.totalRequests),this.renderRequestItems(e,t))},this)),$("#requests-dropdown").trigger("dataChanged",[e]))},renderRequestItems:function(e,n,r){n=parseInt(n,10);var i=this.config.userUrl,s=[];_.each(e,_.bind(function(e){if(!_.isUndefined(e)&&!_.isUndefined(e.additional_data)&&!_.isUndefined(e.user)){var t={id:e.id,userLink:i.replace("__userid__",e.user.id),userAvatar:e.user.avatar,userName:_.escape(e.user.first_name)+" "+_.escape(e.user.last_name),created:e.created},r,o,u;switch(n){case this.config.requestTypes.event:r=this.config.eventUrl,r=r.replace("__idevent__",e.additional_data.id),u=e.additional_data.title,o="invited_you_to_event";break;case this.config.requestTypes.section:r=this.config.sectionWallUrl,r=r.replace("__sectionid__",e.additional_data.id),u=e.additional_data.course_name+": "+e.additional_data.name,parseInt(e.verb,10)===this.config.requestVerbs.join?o="wants_to_join_the_section":o="invited_you_to_section";break;case this.config.requestTypes.group:r=this.config.groupWallUrl,r=r.replace("__groupid__",e.additional_data.id),u=e.additional_data.name,parseInt(e.verb,10)===this.config.requestVerbs.join?o="wants_to_join_the_group":o="invited_you_to_group";break;default:}!_.isUndefined(r)&&!_.isUndefined(u)&&!_.isUndefined(o)?(r='<a href="'+r+'">'+_.escape(u)+"</a>",t.text=translate(o,"M",[r])):_.isUndefined(o)?t.text="":t.text=translate(o),s.push(t)}else $("#requests-dropdown").trigger("error","incomplete_data_received")},this));if(!_.isEmpty(s)){var o=this.getContainerByType(n),u={data:s,avatarClass:this.config.avatarClass},a=$(t.renderTemplate(this.templateNames.requestItems,u));_.isUndefined(r)?(this.$(o).find(".no-requests").remove(),this.$(o).prepend(a)):($(r+" "+o).find(".no-requests").remove(),$(r+" "+o).prepend(a))}},manageErrors:function(e,t){_.isUndefined(t)||(t.status===410?e=translate("requests_error_element_not_found"):e=translate("error_occured")),Utils.flashMessage(Utils.FLASH_ERROR,"",e,".alert_requests",0,!0)},showSuccessMessage:function(e){Utils.flashMessage(Utils.FLASH_SUCCESS,"",e,".alert_requests",3e3,!0)},getContainerByType:function(e){e=parseInt(e,10);var t;switch(e){case this.config.requestTypes.friend:t=this.containers.friendRequests;break;case this.config.requestTypes.event:t=this.containers.eventRequests;break;case this.config.requestTypes.section:t=this.containers.classRequests;break;case this.config.requestTypes.group:t=this.containers.groupRequests;break;default:}return t},acceptRequest:function(e){var t=$(e.currentTarget).attr("data-request"),n=$(e.currentTarget).parent();Utils.blockSmall(n),$.ajax({type:"POST",url:this.config.requestsUrlAccept,data:"userRequestId="+t,success:$.proxy(function(e){Utils.unblock(n),e.success?(this.removeElement(t),this.config.typeDropdown===!0&&$("#requests-dropdown").trigger("externalAcceptedFromDropdown"),this.showSuccessMessage(translate("request_accepted"))):this.manageErrors(e.msg)},this),error:$.proxy(function(e,r,i){Utils.unblock(n),e.status===410&&(this.removeElement(t),this.config.typeDropdown===!0&&$("#requests-dropdown").trigger("externalAcceptFromDropdownFailed",[t,e])),this.manageErrors(r,e)},this),dataType:"json"})},declineRequest:function(e){var t=$(e.currentTarget).attr("data-request"),n=$(e.currentTarget).parent();Utils.blockSmall(n),$.ajax({type:"POST",url:this.config.requestsUrlDecline,data:"userRequestId="+t,success:$.proxy(function(e){Utils.unblock(n),e.success?(this.removeElement(t),this.config.typeDropdown===!0&&$("#requests-dropdown").trigger("externalDeclinedFromDropdown",[t]),this.showSuccessMessage(translate("request_declined"))):this.manageErrors(e.msg)},this),error:$.proxy(function(e,r,i){Utils.unblock(n),e.status===410&&(this.removeElement(t),this.config.typeDropdown===!0&&$("#requests-dropdown").trigger("externalDeclineFromDropdownFailed",[t,e])),this.manageErrors(r,e)},this),dataType:"json"})},removeElement:function(e){this.config.typeDropdown===!0?(this.removeElementFromDropdown(e),$("#requests-dropdown").trigger("dropdownElementRemoved",[e])):(this.removeElementFromPage(e),$("#requests-dropdown").trigger("pageElementRemoved",[e]))},removeElementFromDropdown:function(e){$("#requests-dropdown ul.requestItems").find('li[data-request-element="'+e+'"]').remove(),this.totalRequests=this.totalRequests-1,this.updateTotalRequests(this.totalRequests)},removeElementFromPage:function(e){$("#requestsMiddleZone ul.requestItems").find('li[data-request-element="'+e+'"]').remove()},updateTotalRequests:function(e){parseInt(e,10)===0?(e="",$("#requests-dropdown > a").removeClass("has-new-friend-requests")):parseInt(e,10)>0&&!$("#requests-dropdown > a").hasClass("has-new-friend-requests")&&$("#requests-dropdown > a").addClass("has-new-friend-requests"),$("#requests-dropdown .total-requests").html(e)}});return r}),define("text!reminder/templates.html",[],function(){return'<script type="text/template" id="reminders_template">\n    <div class="rightTitleContainer">\n        <h2><%= translate(\'reminders\') %></h2>\n    </div>\n    <% if(isData) { %>\n    <ul class="reminders">\n        <li class="gradeAssignments">\n            <a href="#" class="toggleReminders">\n                <span class="category"></span>\n            </a>\n        </li>\n        <li class="gradeQuizzes">\n            <a href="#" class="toggleReminders">\n                <span class="category"></span>\n            </a>\n        </li>\n        <li class="moderate">\n            <a href="#" class="toggleReminders">\n                <span class="category"></span>\n            </a>\n        </li>\n        <li class="publish">\n            <a href="#" class="toggleReminders">\n                <span class="category"></span>\n            </a>\n        </li>\n    </ul>\n    <% } else {%>\n        <p><%= translate(\'no_reminders\') %></p>\n    <% } %>\n</script>\n\n<script type="text/template" id="reminders_content">\n    <ul class="reminderDetails clearfix hide">\n        <% _.each(items, function(item) { %>\n            <li data-toggle="tooltip" html="true" title="<div class=\'reminderTooltip\'><%= item.tooltipText %></div>">\n                <a href="<%= item.url %>">\n                    <ul class="reminderItem clearfix">\n                        <% if(!_.isUndefined(item.total)) { %>\n                        <li class="total"><span><%= item.total %></span></li>\n                        <% } %>\n                        <li class="icon <%= item.iconClass %>Icon"></li>\n                        <li class="title"><%= item.title %></li>\n                    </ul>\n                </a>\n            </li>\n        <% }) %>\n    </ul>\n</script>'}),define("reminder/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("reminder_templates",n);return r}),define("reminder/views/reminder",["require","beyazpano","reminder/_templates","order!bootstrap.tooltip"],function(e,t,n){var r=Backbone.View.extend({templateNames:{main:"reminders_template",content:"reminders_content"},initialize:function(e){this.config={courses:null,sections:null,groups:null,lang:BAppConfig.get("global","currentLang"),reminderTypes:BAppConfig.get("site_reminder","config").reminderTypes,assignmentUrl:BAppConfig.get("site_assignment","assignment_info"),quizUrl:BAppConfig.get("site_quiz","quizInfo"),sectionWallUrl:BAppConfig.get("site_sections","sectionUrl"),groupWallUrl:BAppConfig.get("site_groups","groupUrl"),eventUrl:BAppConfig.get("site_event","config").eventPageLink,sectionDiscussionsUrl:BAppConfig.get("site_courses","discussionsPageUrl"),groupDiscussionsUrl:BAppConfig.get("group_discussions","discussionsPageUrl"),sectionDiscussionUrl:BAppConfig.get("site_sections","discussionUrl"),groupDiscussionUrl:BAppConfig.get("group_discussions","groupDiscussionUpdates"),gradebookUrl:BAppConfig.get("grading","site_sections_grading")},this.total_assignment=0,this.total_quiz=0,this.total_moderation=0,this.total_publish=0,this.compiledMainTemplate,$("#reminder_list").on("reminderReceived",_.bind(function(e,t){this.render(t)},this))},initHandlers:function(){$(".toggleReminders").on("click",_.bind(this.toggleReminders,this))},render:function(e){this.config.courses=e.courses,this.config.sections=e.sections,this.config.groups=e.groups,this.total_assignment=0,this.total_quiz=0,this.total_moderation=0,this.total_publish=0;if(!_.isEmpty(e)){var n=_.first(_.toArray(e));_.isEmpty(n)||(this.compiledMainTemplate=$(t.renderTemplate(this.templateNames.main,{isData:!0})),this.renderReminders(n),this.total_assignment===0?$(this.compiledMainTemplate).find(".gradeAssignments").remove():$(this.compiledMainTemplate).find(".gradeAssignments > a > .category").html(this.total_assignment+" ").append(translatePlural("reminder_ungraded_dropbox_item","reminder_ungraded_dropbox_more_items",this.total_assignment)),this.total_quiz===0?$(this.compiledMainTemplate).find(".gradeQuizzes").remove():$(this.compiledMainTemplate).find(".gradeQuizzes > a > .category").html(this.total_quiz+" ").append(translatePlural("reminder_quiz_pending_review","reminder_quizzes_pending_review",this.total_quiz)),this.total_moderation===0?$(this.compiledMainTemplate).find(".moderate").remove():$(this.compiledMainTemplate).find(".moderate > a > .category").html(this.total_moderation+" ").append(translatePlural("reminder_moderation_pending","reminder_moderation_pending_more",this.total_moderation)),this.total_publish===0?$(this.compiledMainTemplate).find(".publish").remove():$(this.compiledMainTemplate).find(".publish > a > .category").html(this.total_publish+" ").append(translatePlural("reminder_publish_item","reminder_publish_items",this.total_publish)));if(_.isEmpty(n)||this.total_assignment===0&&this.total_quiz===0&&this.total_moderation===0&&this.total_publish===0)this.compiledMainTemplate=$(t.renderTemplate(this.templateNames.main,{isData:!1}))}$("#reminder_list").html(this.compiledMainTemplate),this.config.lang==="ar"?$(".reminderDetails > li").tooltip({placement:"right"}):$(".reminderDetails > li").tooltip({placement:"left"}),this.initHandlers()},renderReminders:function(e){_.each(e,_.bind(function(e,t,n){t=parseInt(t,10);switch(t){case this.config.reminderTypes.grade_assignment:this.renderGradeAssignment(e);break;case this.config.reminderTypes.grade_quiz:this.renderGradeQuiz(e);break;case this.config.reminderTypes.moderate_class_wall:this.renderModerateClassWall(e);break;case this.config.reminderTypes.moderate_group_wall:this.renderModerateGroupWall(e);break;case this.config.reminderTypes.moderate_assignment_wall:this.renderModerateAssignmentWall(e);break;case this.config.reminderTypes.moderate_quiz_wall:this.renderModerateQuizWall(e);break;case this.config.reminderTypes.moderate_class_event_wall:this.renderModerateClassEventWall(e);break;case this.config.reminderTypes.moderate_group_event_wall:this.renderModerateGroupEventWall(e);break;case this.config.reminderTypes.moderate_class_discussions:this.renderModerateClassDiscussions(e);break;case this.config.reminderTypes.moderate_group_discussions:this.renderModerateGroupDiscussions(e);break;case this.config.reminderTypes.moderate_class_discussion_wall:this.renderModerateClassDiscussionWall(e);break;case this.config.reminderTypes.moderate_group_discussion_wall:this.renderModerateGroupDiscussionWall(e);break;case this.config.reminderTypes.publish_assignment_grades:this.renderPublishAssignment(e);break;case this.config.reminderTypes.publish_quiz_grades:this.renderPublishQuiz(e);break;case this.config.reminderTypes.publish_test_grades:this.renderPublishTest(e)}},this))},renderGradeAssignment:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_assignment=this.total_assignment+parseInt(e.total,10);var t=this.config.assignmentUrl,r=this.config.sections[e.idsection],i=this.config.courses[r.course_id],s={total:e.total,iconClass:"assignment",url:t.replace("__ASSIGNMENT_ID__",e.id),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".gradeAssignments").append(r)},renderGradeQuiz:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_quiz=this.total_quiz+parseInt(e.total,10);var t=this.config.quizUrl,r=this.config.sections[e.section_id],i=this.config.courses[r.course_id],s={total:e.total,iconClass:"quiz",url:t.replace("__QUIZ_ID__",e.id).replace("__TAB__","results"),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".gradeQuizzes").append(r)},renderModerateClassWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.sectionWallUrl,r=this.config.sections[e.id],i=this.config.courses[r.course_id],s={total:e.total,iconClass:"sectionWall",url:t.replace("__sectionid__",e.id),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateGroupWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.groupWallUrl,r={total:e.total,iconClass:"groupWall",url:t.replace("__groupid__",e.id),title:e.name,tooltipText:e.name};n.push(r)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateAssignmentWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.assignmentUrl,r=this.config.sections[e.idsection],i=this.config.courses[r.course_id],s={total:e.total,iconClass:"assignment",url:t.replace("__ASSIGNMENT_ID__",e.id),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateQuizWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.quizUrl,r=this.config.sections[e.section_id],i=this.config.courses[r.course_id],s={total:e.total,iconClass:"quiz",url:t.replace("__QUIZ_ID__",e.id).replace("__TAB__","comments"),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateClassEventWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.eventUrl,r=this.config.sections[e.section_id],i=this.config.courses[r.course_id],s={total:e.total,iconClass:parseInt(e.rsvp,10)===1?"mandatoryEvent":"optionalEvent",url:t.replace("__idevent__",e.id),title:e.title,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateGroupEventWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.eventUrl,r=this.config.groups[e.group_id],i={total:e.total,iconClass:parseInt(e.rsvp,10)===3?"mandatoryEvent":"optionalEvent",url:t.replace("__idevent__",e.id),title:e.title,tooltipText:r};n.push(i)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateClassDiscussions:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.sectionDiscussionsUrl,r=this.config.sections[e.id],i=this.config.courses[r.course_id],s={total:e.total,iconClass:"discussion",url:t.replace("__SECTION_ID__",e.id),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateGroupDiscussions:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.groupDiscussionsUrl,r={total:e.total,iconClass:"discussion",url:t.replace("__groupid__",e.id),title:e.name,tooltipText:e.name};n.push(r)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateClassDiscussionWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.sectionDiscussionUrl,r=this.config.sections[e.section_id],i=this.config.courses[r.course_id],s={total:e.total,iconClass:"discussion",url:t.replace("__SECTIONID__",e.section_id).replace("__DISCUSSIONID__",e.id),title:e.title,tooltipText:i.name+" : "+r.name};n.push(s)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderModerateGroupDiscussionWall:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)&&!_.isUndefined(e.total)){this.total_moderation=this.total_moderation+parseInt(e.total,10);var t=this.config.groupDiscussionUrl,r=this.config.groups[e.group_id],i={total:e.total,iconClass:"discussion",url:t.replace("__groupid__",e.group_id).replace("__discussionid__",e.id),title:e.title,tooltipText:r};n.push(i)}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".moderate").append(r)},renderPublishAssignment:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)){this.total_publish=this.total_publish+1;var t=this.config.gradebookUrl,r=this.config.sections[e.idsection];if(r){var i=this.config.courses[r.course_id],s={iconClass:"assignment",url:t.replace("__SECTION_ID__",e.idsection),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".publish").append(r)},renderPublishQuiz:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)){this.total_publish=this.total_publish+1;var t=this.config.gradebookUrl,r=this.config.sections[e.section_id];if(r){var i=this.config.courses[r.course_id],s={iconClass:"quiz",url:t.replace("__SECTION_ID__",e.section_id),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".publish").append(r)},renderPublishTest:function(e){var n=[];_.each(e,_.bind(function(e){if(!_.isNull(e)&&!_.isUndefined(e)){this.total_publish=this.total_publish+1;var t=this.config.gradebookUrl,r=this.config.sections[e.section_id];if(r){var i=this.config.courses[r.course_id],s={iconClass:"test",url:t.replace("__SECTION_ID__",e.section_id),title:e.name,tooltipText:i.name+" : "+r.name};n.push(s)}}},this));var r=$(t.renderTemplate(this.templateNames.content,{items:n}));$(this.compiledMainTemplate).find(".publish").append(r)},toggleReminders:function(e){e.preventDefault(),$(e.currentTarget).parent().find(".reminderDetails").toggleClass("hide")}});return r}),define("ajax-updates/main",["require","order!translate","order!jquery","order!underscore","order!backbone","order!config","profile/views/notificationDropdown","requests/views/requests","reminder/views/reminder"],function(e,t,n,r,i,s,o,u,a){var f={init:function(){if(!_.isNull(BAppConfig.get("mydata","id"))){this.updatesUrl=BAppConfig.get("ajax-updates","url"),this.timestamp=0,this.dataRequired={notifications:!0,requests:!0};var e=this.getCurrentPage();BAppConfig.get("mydata","role")==="INSTRUCTOR"&&e==="home"&&(this.dataRequired.reminder=!0),this.run()}},run:function(){_.delay(_.bind(function(){this.getUpdates()},this),1e3),setInterval(_.bind(this.getUpdates,this),BAppConfig.get("global","timeout_notifications"))},getUpdates:function(){$.ajax({type:"POST",url:this.updatesUrl,dataType:"json",data:{date:this.timestamp,dataRequired:this.dataRequired},success:$.proxy(function(e){e.data&&e.data.reminder&&!_.isNull(e.data.reminder.data)&&$("#reminder_list").trigger("reminderReceived",[e.data.reminder.data]),e.data&&e.data.requests&&(this.timestamp===0?$("#requests-dropdown").trigger("requestsReceived",[e.data.requests.data]):_.isNull(e.data.requests.data)||$("#requests-dropdown").trigger("requestsAdded",[e.data.requests.data])),e.data&&e.data.notifications&&e.data.notifications.data===!0&&$("#notifications-dropdown").trigger("notificationsAvailable"),this.timestamp=e.ts},this),error:$.proxy(function(e,t,n){},this)})},getCurrentPage:function(){var e=window.location.pathname.split("/");return e[1]}};return f}),define("text!non-app/templates.html",[],function(){return'<script type="text/template" id="generic-dialog">\n    <div class="modal fade modal-narrow" id="<%= dialog_id %>" data-backdrop="static">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3 id="<%= dialog_id %>-title"><%- title %></h3>\n            </div>\n        </div>\n        <div class="modal-body" id="<%= dialog_id %>-body">\n            <div class="modalContent"><%= body %></div>\n        </div>\n        <div class="modal-footer" id="<%= dialog_id %>-footer">\n            <div class="modalFooterContainer modalFooterContainerUser">\n                <div class="modalButtons">\n                    <%= footer %>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="generic-popup">\n    <div class="modal fade modal-narrow" id="<%= dialog_id %>" data-backdrop="static">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3 id="<%= dialog_id %>-title"><%- title %></h3>\n            </div>\n        </div>\n        <div class="modal-body" id="<%= dialog_id %>-body">\n            <div class="modalList modalContent"><%= body %></div>\n        </div>\n        <div class="modal-footer" id="<%= dialog_id %>-footer">\n            <div class="modalFooterContainer modalFooterContainerUser">\n                <div class="modalButtons">\n                    <%= footer %>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="flash-message-template">\n    <div id="<%= flashId %>" class="alert alert-<%= type %> fade in">\n        <a class="close" data-dismiss="alert">×</a>\n        <h4 class="alert-heading"><%- title %></h4>\n        <p><%- message %></p>\n    </div>\n</script>\n\n<script type="text/template" id="attachments-template">\n    <div id="<%= prefix %>_attachments_container"></div>\n    <div class="clear"></div>\n    <ul class="attachmentOptions clearfix">\n        <li>\n	    <div id="<%= prefix %>_attfiles">\n                <a href="#" id="<%= prefix %>_attfiles_browse" class="userAttachements"><% print(_.escape(translate(\'global_upload\'))) %></a>\n            </div>\n	</li>\n	<% if(canShare) { %>\n	<li>\n            <a id="<%= prefix %>_sharefile" href="javascript:void(0)" class="shareButton"><% print(_.escape(translate(\'global_share\'))) %></a>\n        </li>\n	<% } %>\n        <li>\n            <a id="<%= prefix %>_attlinks" href="javascript:void(0)"><% print(_.escape(translate(\'global_link\'))) %></a>\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="link-attachment-template">\n    <div id="<%= prefix %>">\n        <a class="close" id="<%= prefix %>_close" href="#">×</a>\n        <span><%- title %></span>&nbsp;\n        <span><%- url %></span>\n    </div>\n</script>\n\n<script type="text/template" id="file-attachment-template">\n    <div id="<%= prefix %>" class="uploadify-queue-item">\n        <a class="close" id="<%= prefix %>_close" href="javascript:void(0)">×</a>\n        <span class="fileName"><%- fileName %></span>&nbsp;<span class="data"></span>\n    </div>\n</script>\n\n<script type="text/template" id="link-attachment-popup-template">\n    <form id="<%= prefix %>_form">\n        <ul class="modalForm">\n            <li>\n                <label for="<%= prefix %>_url"><% print(translate(\'global_url\')) %></label>\n                <input type="text" class="xlarge" id="<%= prefix %>_url" name="data[url]" />\n            </li>\n            <li>\n                <label for="<%= prefix %>_title"><% print(translate(\'global_title\')) %></label>\n                <input type="text" class="xlarge" id="<%= prefix %>_title" name="data[title]" />\n            </li>\n        </ul>\n    </form>\n</script>\n<script type="text/template" id="embeded-video-attachment">\n    <li id ="<%= id%>" class = "li_post_video">\n        <a id ="<%= id%>_close" class = "close jqDeleteVideo" url = "<%= url %>">x</a>\n        <div class="emVideoTitle"><%= title %></div>\n        <div class="emVideoImage"><img width ="<%= width %>" src="<%= thumbnail_url %>"/></div>\n    </li>\n</script>    '}),define("non-app/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("non_app_templates",n);return r}),Utils={FLASH_ERROR:"error",FLASH_SUCCESS:"success",FLASH_INFO:"info",FLASH_WARNING:"block",flashMessage:function(e,t,n,r,i,s){r||(r=document.body),jQuery.inArray(e,[Utils.FLASH_ERROR,Utils.FLASH_INFO,Utils.FLASH_SUCCESS,Utils.FLASH_WARNING])==-1&&(e=Utils.FLASH_INFO);var o="flash_"+_.uniqueId(),u=_.template($("#flash-message-template").html(),{flashId:o,title:t,message:n,type:e});s===!0?$(r).html(u):$(r).append(u),i!=undefined&&i>0&&_.delay(function(){$(r).find("#"+o).slideUp("slow",function(e){$(r).find("#"+o).remove()})},i),$("#"+o).alert()},loadSubSelect:function(e,t,n,r,i){var s={};for(var o in e)s[e[o].field]=$(e[o].el).val();var u=$(t);$.post(r,s,_.bind(function(e){if(!e.success)Utils.alert("Data Source Error","Data Source Error There was an error while trying to load the data");else{var t=e.data;u.find("option").remove(),u.append('<option value="">'+i.toString()+"</option>");for(var r in t){var s=t[r];u.append('<option value="'+s.value+'">'+s.title+"</option>")}n&&u.val(n).trigger("change")}},this),"json")},alert:function(e,t,n){var r="_dialog_alert",i=_.template($("#generic-dialog").html(),{dialog_id:r,title:e,body:_.escape(t),footer:'<button href="#" class="btn btn-primary" id="'+r+'-okbtn">Ok</button>'}),s=$(i);s.find("#"+r+"-okbtn").on("click",_.bind(function(){s.modal("hide"),n&&n()},this)),$("#"+r).modal("hide"),$("#"+r).remove(),$("body").append(s),$("#"+r).modal({show:!0,backdrop:"static"}),$("#"+r).modal("show")},popup:function(e,t,n){var r="_dialog_popup",i=_.template($("#generic-popup").html(),{dialog_id:r,title:e,body:t,footer:_.isUndefined(n)?'<button href="#" class="btn btn-primary" id="'+r+'-okbtn">'+translate("ok")+"</button>":n}),s=$(i);_.isUndefined(n)&&s.find("#"+r+"-okbtn").on("click",_.bind(function(){s.modal("hide")},this)),$("#"+r).remove(),$("body").append(s),$("#"+r).modal({show:!0,backdrop:"static"});var o=$("#"+r);return o.modal("show"),o},confirm:function(e,t,n){var r="_dialog_confirm",i=_.template($("#generic-dialog").html(),{dialog_id:r,title:e,body:_.escape(t),footer:'<button href="#" class="btn userDefaultBtn" id="'+r+'-yesbtn">'+translate("global_yes")+"</button>"+'<button href="#" class="btn" id="'+r+'-nobtn">'+translate("global_cancel")+"</button>"}),s=$(i);s.find("#"+r+"-yesbtn").on("click",_.bind(function(){s.modal("hide"),n&&n("yes")},this)),s.find("#"+r+"-nobtn, .close").on("click",_.bind(function(){s.modal("hide"),n&&n("no")},this)),$("#"+r).remove(),$("body").append(s),$("#"+r).modal({show:!0,backdrop:"static"}),$("#"+r).modal("show")},formatTimestamp:function(e){var t="";if(e){var n=-e.getTimezoneOffset();e.addMinutes(n);var r=Date.today(),i=Date.today().addDays(1),s=Date.today().addDays(2),o=Date.today().addDays(-1),u=Date.today().moveToMonth(11).moveToLastDayOfMonth().set({hour:23,minute:59,second:59}),a=Date.today().moveToMonth(0).moveToFirstDayOfMonth();e.between(r,i)?t=translate("date_today_at")+" "+e.toString("HH:mm"):e.between(o,r)?t=translate("date_yesterday_at")+" "+e.toString("HH:mm"):e.between(i,s)?t=translate("date_tomorrow_at")+" "+e.toString("HH:mm"):t=e.toString(Date.CultureInfo.formatPatterns.longDate)+" "+e.toString("HH:mm")}return t},formatDate:function(e,t){var n=e.split(" ");n[1]==undefined?e=e+" "+"00:00:00":n[1]!=undefined&&/^\d{2}:\d{2}$/i.test(n[1])&&(e+=":00");var r=Date.parseExact(e,"yyyy-MM-dd HH:mm:ss");if(r&&typeof r.toString=="function"){var i=-r.getTimezoneOffset();return r.addMinutes(i),r.toString(t)}return""},bytesToSize:function(e){var t=["Bytes","KB","MB","GB","TB"];if(e==0)return"n/a";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,n),2)+" "+t[n]},block:function(e,t){$(e).block({message:"<h1>"+translate("global_please_wait")+"</h1>",css:{border:"none",padding:"15px",backgroundColor:"#FFFFFF","border-radius":"10px","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.4,color:"#fffFFF"}})},blockSmall:function(e,t){$(e).block({message:"<p>"+translate("global_please_wait")+"</p>",css:{border:"none",padding:"5px 5px 5px 10px",backgroundColor:"#FFFFFF","border-radius":"10px","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.4,width:"60%",left:"26px","text-align":"left",color:"#fffFFF"}})},unblock:function(e){$(e).unblock()},formatString:function(){var e=arguments[0];for(var t=1;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},setZIndex:function(e){e=_.isUndefined(e)?"div":e+" div",$.browser.msie&&$.browser.version==7&&$(function(){var t=1e3;$(e).each(function(){$(this).css("zIndex",t),t-=10})})},hideFlashMessage:function(e){var t=2e3;t>0&&_.delay(function(){e.slideUp("slow",function(t){e.remove()})},t)},nl2br:function(e){return e.replace(/\n/gm,"<br />")}},define("utils",function(){}),function(e,t,n){function f(e){var t={},r=/^jQuery\d+$/;return n.each(e.attributes,function(e,n){n.specified&&!r.test(n.name)&&(t[n.name]=n.value)}),t}function l(e,r){var i=this,s=n(i);if(i.value==s.attr("placeholder")&&s.hasClass("placeholder"))if(s.data("placeholder-password")){s=s.hide().next().show().attr("id",s.removeAttr("id").data("placeholder-id"));if(e===!0)return s[0].value=r;s.focus()}else i.value="",s.removeClass("placeholder"),i==t.activeElement&&i.select()}function c(){var e,t=this,r=n(t),i=r,s=this.id;if(t.value==""){if(t.type=="password"){if(!r.data("placeholder-textinput")){try{e=r.clone().attr({type:"text"})}catch(o){e=n("<input>").attr(n.extend(f(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":!0,"placeholder-id":s}).bind("focus.placeholder",l),r.data({"placeholder-textinput":e,"placeholder-id":s}).before(e)}r=r.removeAttr("id").hide().prev().attr("id",s).show()}r.addClass("placeholder"),r[0].value=r.attr("placeholder")}else r.removeClass("placeholder")}var r="placeholder"in t.createElement("input"),i="placeholder"in t.createElement("textarea"),s=n.fn,o=n.valHooks,u,a;r&&i?(a=s.placeholder=function(){return this},a.input=a.textarea=!0):(a=s.placeholder=function(){var e=this;return e.filter((r?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":l,"blur.placeholder":c}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},a.input=r,a.textarea=i,u={get:function(e){var t=n(e);return t.data("placeholder-enabled")&&t.hasClass("placeholder")?"":e.value},set:function(e,r){var i=n(e);return i.data("placeholder-enabled")?(r==""?(e.value=r,e!=t.activeElement&&c.call(e)):i.hasClass("placeholder")?l.call(e,!0,r)||(e.value=r):e.value=r,i):e.value=r}},r||(o.input=u),i||(o.textarea=u),n(function(){n(t).delegate("form","submit.placeholder",function(){var e=n(".placeholder",this).each(l);setTimeout(function(){e.each(c)},10)})}),n(e).bind("beforeunload.placeholder",function(){n(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery),define("placeholder",function(){}),require.config({waitSeconds:60}),require(["beyazpano","ajax-updates/main","order!translate","order!config","order!jquery","order!jquery.ajaxSetup","order!jquery.cookie","order!non-app/_templates","order!jquery.blockui","order!underscore","order!underscore.string","order!backbone","order!bootstrap","order!jquery.validate","order!jquery.validate.messages_locale","order!base64","order!fbootstrapp-bootstrap-dropdown","order!date","order!utils","order!placeholder"],function(e,t){isInitBAppTranslate||BAppTranslate(translations),_.isEmpty(BAppConfig.configs)&&BAppConfig.init(configs);var n=function(){var e=$(window).width();e<=1200&&e>940?($("body").addClass("smallResolution"),$("body").removeClass("smallerResolution")):e<=940?($("body").removeClass("smallResolution"),$("body").addClass("smallerResolution")):($("body").removeClass("smallResolution"),$("body").removeClass("smallerResolution"))};Utils.setZIndex();var r=-(new Date).getTimezoneOffset();$("#timezoneOffset").val(r),$(window).resize(n),$(document).ready(function(){n(),$("body").on("show",".modal",function(){(navigator.appName=="Opera"||navigator.appVersion.indexOf("MSIE 10")!=-1)&&$(".modal").removeClass("fade")})}),e.init(),t.init(),$(".langswitch").on("click",function(e){var t=$(this).data("lang");e.target.scrollIntoView(!0);var n=BAppConfig.get("global","switchLanguageUrl").replace("__lang__",t),r=document.URL,i=r.match(/#.*$/i),s="";_.isEmpty(i)||i[0]!="#"&&(s=i[0]),n=n.replace("__goto__",Base64.encode(window.location.pathname.replace(BAppConfig.get("global","baseUrl"),"")+s)),document.location.replace(n)}),$("body").ajaxComplete(function(e,t,n){t.status==401&&(window.location.href=BAppConfig.get("site_home","url_home"))}),$(".flashMessageNotification").length>0&&Utils.hideFlashMessage($(".flashMessageNotification")),$.validator.addMethod("validFormatDate",function(e,t){return Date.parseExact(e,"dd-MM-yyyy")},translate("valid_format_date")),$.validator.addMethod("dateYearBiggerThanCurrent",function(e,t){var n="";_.isUndefined($.data(t,"dueTimeSelect"))||(n=$.data(t,"dueTimeSelect").val());if(!_.isUndefined($.data(t,"DueGlobal"))&&!_.isUndefined($.data(t,"DueGlobal").originalDueDateVal)&&!_.isUndefined($.data(t,"DueGlobal").originalDueTimeVal)&&$.data(t,"DueGlobal").originalDueDateVal==e&&$.data(t,"DueGlobal").originalDueTimeVal==n)return!0;var r=new Date;r.clearTime();var i=Date.parseExact(e,"dd-MM-yyyy");return i.clearTime(),r.compareTo(i)==1?!1:!0},translate("bigger_date")),$.validator.addMethod("afterNow",function(e,t){var n="";_.isUndefined($.data(t,"dueDateSelect"))||(n=$.data(t,"dueDateSelect").val());if(!_.isUndefined($.data(t,"DueGlobal"))&&!_.isUndefined($.data(t,"DueGlobal").originalDueDateVal)&&!_.isUndefined($.data(t,"DueGlobal").originalDueTimeVal)&&$.data(t,"DueGlobal").originalDueDateVal==n&&$.data(t,"DueGlobal").originalDueTimeVal==e)return!0;var r=Date.parseExact(n,"dd-MM-yyyy");if(r==null)return!1;var i=Date.parse(r.toString("yyyy-MM-dd")+"T"+e+":00");return i.getTime()>$.now()},translate("invalid_date_time")),$.validator.addMethod("equalOrBiggerThanStartDate",function(e,t){var n="";_.isUndefined($.data(t,"startDate"))||(n=$.data(t,"startDate").val());var r=Date.parseExact(n,"dd-MM-yyyy");if(_.isNull(r))return!0;var i=Date.parseExact(e,"dd-MM-yyyy");return r.compareTo(i)==1?!1:!0},translate("bigger_date")),$.validator.addMethod("equalOrBiggerThanStartTime",function(e,t){if(!_.isUndefined($.data(t,"startDate"))&&!_.isUndefined($.data(t,"dueDateSelect"))&&!_.isUndefined($.data(t,"startTime"))){if($.data(t,"startDate").val()==$.data(t,"dueDateSelect").val()){var n=$.data(t,"startTime").timeEntry("getTime");if(_.isNull(n))return!1;if(n>$(t).timeEntry("getTime"))return!1}return!0}return!1},translate("bigger_time"))}),define("main",function(){}),define("access-code/main",["require","beyazpano"],function(e,t){var n=function(){this.run=function(){this.initHandlers()},this.initHandlers=function(){$("#reset-access-code").live("click",_.bind(this.resetCodeAccessClickHandler,this)),$(".question").tooltip()},this.resetCodeAccessClickHandler=function(e){var t=$(e.currentTarget).attr("data-entity");Utils.confirm(translate("reset_access_code_title"),translate("reset_access_code_question"),function(e){e=="yes"&&$.ajax({type:"POST",url:BAppConfig.get("site_assignment","ajaxUrlAssignmentsJson")+"/resetaccesscode",data:"idaccesscode="+t,success:$.proxy(function(e){e.success?document.location.reload(!0):Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"})})}};return n}),define("text!add-members/templates.html",[],function(){return'<script type="text/template" id="add_member_popup_container"> \n    <div class="modal-header">\n    <div class="modalHeaderContainer">\n	<a class="close" data-dismiss="modal"></a>\n	<h3><% print(_.escape(translate(\'invite_members_section\'))) %></h3>\n    </div>\n</div>\n<div class="modal-body">\n    <div class="modalContent">\n	<div id="alert_add_members"></div>\n	<form name="sendEmailForm" id="sendEmailForm" action="" method="post">\n	    <ul class="modalForm">\n		<li>\n		    <label><% print(_.escape(translate(\'add_members_text\'))) %></label>\n		    <textarea name="emails" ></textarea>\n		</li>\n		<input type="hidden" name="idEntity" value="<%= data.idEntity %>">\n	    </ul>\n	</form>\n    </div>\n</div>\n<div class="modal-footer ">\n    <div class="modalFooterContainer modalFooterContainerUser">\n	<div class="modalButtons">\n	    <img id="ajax-loading-members" src ="<%= data.loaderImg %>"  style="display:none"/>\n	    <button  id="send-email-members" href="#" class="btn userDefaultBtn" ><% print(_.escape(translate(\'global_invite\'))) %></button>\n	    <button href="#" class="btn" data-dismiss="modal"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n	</div>\n    </div>\n</div>\n</script>\n\n'}),define("add-members/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("add_members_templates",n);return r}),define("add-members/views/addMembersView",["require","beyazpano","add-members/_templates"],function(e,t){var n={rules:{emails:{required:!0}}},r={},i=Backbone.View.extend({templateNames:{addMemberPopup:"add_member_popup_container"},initialize:function(e){e&&(r=_.extend(r,e))},render:function(){$("body").append('<div id="popup_add_members" class="modal fade hide" data-backdrop="static"></div>'),$(".add-member").live("click",_.bind(this.openPopupAddMembertClickHandler,this)),$("#send-email-members").live("click",_.bind(this.sendEmailsColleaguesClickHandler))},openPopupAddMembertClickHandler:function(e){var i=$(e.currentTarget).attr("id").replace("add-member-",""),s=$(t.renderTemplate(this.templateNames.addMemberPopup,{data:{type:r.type,idEntity:i,loaderImg:""}}));$("#popup_add_members").html(s),$("#sendEmailForm").validate(n),$("#popup_add_members").modal("show")},sendEmailsColleaguesClickHandler:function(e){var t=r.sendEmailUrl;if($("#sendEmailForm").valid()){var n=$("#sendEmailForm").serialize();Utils.block("#popup_add_members"),$.ajax({type:"POST",url:t,data:n,success:$.proxy(function(e){Utils.unblock("#popup_add_members");if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_add_members");else $("#popup_add_members").modal("hide"),Utils.flashMessage(Utils.FLASH_SUCCESS,"",e.msg,"#flashmessages",6e3)},this),dataType:"json"})}}});return i}),define("add-members/main",["require","beyazpano","add-members/views/addMembersView","config"],function(e,t,n){var r=function(){this.init=function(e){this.config={type:"section",sendEmailUrl:BAppConfig.get("site_courses","ajaxUrlCourses")+"/sendmailmembers"},e&&(this.config=_.extend(this.config,e));var t=new n(this.config);t.render()},this.run=function(){this.init()}};return r}),define("text!assignments/templates.html",[],function(){return'<script type="text/template" id="popup-assignment">\n    <div id="popup_section" class="modal fade hide" data-backdrop="static"></div>\n</script>\n<script type="text/template" id="site_assignments_upcomming">\n    <ul class="upcomingDetails" id="<%= id %>">\n        <li><h2>Upcoming</h2></li>\n        <li>\n            <h3>Saturday, April 21, 2012</h3>\n            <ul>\n                <li><a href="#">Design Class (Beginners)</a></li>\n                <li><a href="#">Design Class (Masters)</a></li>\n            </ul>\n        </li>\n        <li>\n            <h3>Friday, April 27, 2012t</h3>\n            <ul>\n                <li><a href="#">SEO Class (Beginners)</a></li>\n                <li><a href="#">SEO Class (Masters)</a></li>\n            </ul>\n        </li>\n    </ul>\n</script>'}),define("assignments/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("assignments_templates",n);return r}),define("text!default/templates.html",[],function(){return'<script type="text/template" id="site_header">\n    <div class="headerContent<% if(lang === \'tr\') {%> beyazpano<%}%>">\n        <h1 id="pageLogo" class="left">\n            <a href="<%= home_link %>" title="Home"><span>Beyazpano</span></a>\n\n        </h1>\n        <nav class="left" id="main_navigation"></nav>\n        <div id="user_menu"></div>\n    </div>\n</script>\n\n<script type="text/template" id="site_header_main_menu">\n    <% if(menu_items && menu_items.length > 0) { %>\n    <ul class="nav">\n        <% _.each(menu_items, function(item) { %>\n\n            <% if(item.newMessagesCount && item.newMessagesCount > 0) {%>\n            <li class="inbox <% if(!_.isUndefined(item.selectedMenu)) { %>active<% }%>">\n                <a href="<%= item.url %>" class="has-new-message">\n                    <% print(_.escape(translate(item.label))) %>\n                    <span><%print(item.newMessagesCount); %></span>\n                </a>\n            </li>\n            <%} else {%>\n            <li class="<% if(!_.isUndefined(item.selectedMenu)) { %>active<% }%>">\n                <a href="<%= item.url %>">\n                    <% print(_.escape(translate(item.label))) %>\n                </a>\n            </li>\n            <%}%>\n\n        <% }) %>\n    </ul>\n    <% } %>\n</script>\n\n<script type="text/template" id="site_header_left_menu">\n    <% if(menu_items && menu_items.length > 0) { %>\n    <ul class="navigation" id="<%= id %>">\n        <% _.each(menu_items, function(item) { %>\n            <% if((userid == currentUserId && item.id == \'blocking\') || item.id != \'blocking\'){ %>\n            <li id="<%= id %>_<%= item.id %>" class="<% if(item.id == selected_item) { %>active<% } %><% if(item.cssCls) { %> <%= item.cssCls %><% } %>" ><a href="<%= item.url %>" title="<% if(item.id == \'blocking\') { print(translate(item.title)) } %>" ><% print(translate(item.label)) %></a></li>\n            <% } %>\n        <% }) %>\n    </ul>\n    <% } %>\n</script>\n\n<script type="text/template" id="site_header_user_menu">\n    <ul class="accountDetails right clearfix">\n        <li class="searchTop left" data-dropdown="dropdown">\n            <a href="#"  class="dropdown-toggle"></a>\n            <ul class="dropdown-menu dropdown topbar-wrapper active" data-dropdown="dropdown" >\n                <li>\n                    <form id="navigationSearch" class="clearfix" name="navigation_search" method="post" action="">\n                        <a href="#" class="searchTopButton"></a>\n                        <input name="searchText" class="searchInput" autocomplete="on" placeholder="<% print(translate(\'search_other_users\')) %>">\n                    </form>\n                </li>\n            </ul>\n        </li>\n        <li class="messagesTop left" data-dropdown="dropdown" id="requests-dropdown" >\n            <a href="#"  class="dropdown-toggle"></a>\n        </li>\n        <li class="infoTop left" data-dropdown="dropdown" id="notifications-dropdown">\n            <a href="#"  class="dropdown-toggle" ></a>\n        </li>\n		<li  class="left <% if(isOwnProfile) { %><%= \'active\' %><% } %>">\n            <a href="<%= link.url%>" class="<%= link.cssCls %>">\n                <img src="<%= link.avatar.small%>" width="25" height="25">\n                <span><% print(_.escape(link.label)) %></span>\n            </a>\n        </li>\n        <!--[if IE 8]> <li class="dropdown topbar-wrapper ie8" data-dropdown="dropdown"> <![endif]-->\n        <!--[if !IE 8]><!--> <li class="dropdown topbar-wrapper" data-dropdown="dropdown"> <!--<![endif]-->\n            <a href="#" class="dropdown-toggle dropdownToggle userDropdown"></a>\n            <% if(menuData && menuData.length > 0) { %>\n                <ul class="dropdown-menu" id="<%= id %>">\n                    <% _.each(menuData, function(item) { %>\n                        <% if(item.type == \'divider\') {%>\n                        <li class="divider"></li>\n                        <% } else { %>\n                        <li id="<%= id %>_<%= item.id %>" <% if(item.cssCls) { %>class="<%= item.cssCls %>"<% } %>><a href="<%= item.url %>"><% print(translate(item.label)) %></a></li>\n                        <% } %>\n                    <% }) %>\n                </ul>\n            <% } %>\n            <!--<ul class="dropdown-menu">-->\n                <!--<li class="userName"><a href="#">Jhon Smith</a></li>-->\n                <!--<li class="divider"></li>-->\n                <!--<li><a href="#">Notifications</a></li>-->\n                <!--<li><a href="#">Account Settings</a></li>-->\n                <!--<li><a href="#">Privacy</a></li>-->\n                <!--<li class="divider"></li>-->\n                <!--<li><a href="#">Logout</a></li>-->\n            <!--</ul>\n			<% print(_.escape(translate(\'site_navigation_settings_account\'))) %>\n			-->\n        </li>\n    </ul>\n</script>\n'}),define("default/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var n=t.appendTemplate("default_templates",n);return n}),define("default/views/siteMainMenu",["require","beyazpano","default/_templates"],function(e,t){var n=Backbone.View.extend({templateNames:{main:"site_header_main_menu"},initialize:function(e){e.config&&(this.config=e.config)},render:function(){var e={menu_items:this.config.items};for(var n in e.menu_items){var r=e.menu_items[n];r.id=="inbox"&&(r.newMessagesCount=BAppConfig.get("site_messages","inbox_count")),r.url=r.url.replace("__myuserid__",BAppConfig.get("mydata","id"));var i=BAppConfig.get("site_header","current_route_name");$.inArray(i,r.belonging_pages)>=0&&(r.selectedMenu=1)}var s=$(t.renderTemplate(this.templateNames.main,e));$(this.el).html(s)}});return n}),define("default/views/siteUserMenu",["require","beyazpano","profile/views/notificationDropdown","requests/views/requests","default/_templates"],function(e,t,n,r){var i=Backbone.View.extend({templateNames:{main:"site_header_user_menu"},initialize:function(e){e.config&&(this.config=e.config)},render:function(){var e=this.config.user_menu.items,i=BAppConfig.get("site_header","full_name_link");i.label=BAppConfig.get("mydata","full_name"),i.url=i.url.replace("__userid__",BAppConfig.get("mydata","id")),i.avatar=BAppConfig.get("mydata","avatar");for(var s in e)if(e.hasOwnProperty(s)&&!_.isUndefined(s)){var o=e[s];o.id=="profile"&&(o.url=o.url.replace("__userid__",BAppConfig.get("mydata","id")),o.label=BAppConfig.get("mydata","full_name"))}var u=BAppConfig.get("site_header","isOwnProfile"),a={menuData:e,id:_.uniqueId("user_menu_"),link:i,isOwnProfile:u},f=t.renderTemplate(this.templateNames.main,a);$(this.el).html(f),$(function(){$("#user_menu .dropdown-menu").find("input,button").click(function(e){e.stopPropagation()}),$("#navigationSearch").submit(function(){return searchText(),!1}),$(".searchTopButton").on("click",function(e){e.preventDefault(),searchText()})});var l=new r({el:"#requests-dropdown"});l.render();var c=new n;c.render()}});return i}),define("default/views/siteHeader",["require","beyazpano","default/_templates","./siteMainMenu","./siteUserMenu","order!placeholder"],function(e,t,n,r,i){var s=Backbone.View.extend({templateNames:{main:"site_header"},initialize:function(e){e.config?this.config=e.config:this.config={},this.mainMenuView=null,this.userMenuView=null},render:function(){var e={home_link:BAppConfig.get("site_home","url_home"),lang:BAppConfig.get("global","currentLang")};this.config=BAppConfig.get("site_header","config");var n=t.renderTemplate(this.templateNames.main,e);this.$el.html(n),this.mainMenuView=new r({el:"#main_navigation",config:this.config.main_menu}),this.mainMenuView.render(),this.userMenuView=new i({el:"#user_menu",config:this.config}),this.userMenuView.render(),$("input, textarea").placeholder()}});return new s({el:"#header"})}),define("default/views/siteLeftMenu",["require","beyazpano","default/_templates"],function(e,t){var n=Backbone.View.extend({templateNames:{main:"site_header_left_menu"},initialize:function(e){this.selected_item="",e.config&&(this.config=e.config),this.containerId=_.isUndefined(this.config.id)?_.uniqueId("left_menu_"):this.config.id,_.isUndefined(e.userid)?this.config.userid=BAppConfig.get("mydata","id"):this.userid=e.userid,this.selected_item=e.selected_item?e.selected_item:"",this.triggerEvents=e.triggerEvents?e.triggerEvents:!1,_.isUndefined(e.insertMethod)?this.insertMethod="replace":this.insertMethod=e.insertMethod},render:function(){var e={menu_items:this.config.items,selected_item:this.selected_item,id:this.containerId,userid:this.userid,currentUserId:BAppConfig.get("mydata","id")};for(var n in e.menu_items){var r=e.menu_items[n];r.url=r.url.replace("__userid__",this.userid)}var i=$(t.renderTemplate(this.templateNames.main,e));i.hide();switch(this.insertMethod){case"prepend":$(this.el).prepend(i);break;case"append":$(this.el).append(i);break;case"replace":default:$(this.el).html(i)}this.triggerEvents&&this.addEventHandlers(),i.fadeIn(400)},addEventHandlers:function(){$("#"+this.containerId).find("li").click(_.bind(function(e){e.preventDefault(),$(e.currentTarget).addClass("active").siblings().removeClass("active"),this.trigger("menuItemSelected",e.currentTarget)},this))}});return n}),define("text!comment/templates.html",[],function(){return'<script type="text/template" id="site_comment_container">\n    <div class="commentContainer" entityId="<%= entityId %>" entityType="<%= entityType %>" nrOfComments="<%= nrOfComments %>" shown="<%= items.length %>" pageEntityId="<%= page_entity_id %>">\n        <%= show_all %>\n        <ul class="jqCommentItems">\n            <% print(_.template($(\'#site_comment_item\').html(), {items:items, canComment: canComment, readonly: readonly})) %>\n        </ul>\n        <% if(canComment == true){ %>\n        <div class="jqNewCommentContainer commentBlueContainer">\n            <%= add_new %>\n        </div>\n        <% } %>\n    </div>\n</script>\n\n<script type="text/template" id="site_comment_show_all">\n    <div class="jqShowAll"><%= translate(\'comment_show_all_the_x_comments\',\'M\',[nrOfComments])%></div>\n</script>\n\n<script type="text/template" id="site_comment_item">\n    <% _.each(items, function(item) { %>\n\n    <li id="comment_<%= item.id %>" class="clearfix">\n        <a href="<%= item.user_profile_link %>" title="<%= item.user_name %>" class="userCommentImage">\n            <img title="<%= item.user_name %>" src="<%=item.user.avatar%>"/>\n        </a> \n        <div class="commentInfo">\n            <div class="commentContent breakWord">\n                <a href="<%= item.user_profile_link %>"><%= item.user_name %></a>\n                <span><%=item.body%></span>\n            </div>\n            <% if(item.needApproval){%>\n            <div class="fnone clearfix needsApproval">\n                <span class="greenTxt"><% print(_.escape(translate(\'need_instructor_approval_comment\'))) %></span>\n            </div>\n            <% } %>\n            <div class="commentActions left">\n                <span><%= item.created %></span>\n            </div>\n            <div class="clearfix">\n                <% if(item.canLike) { %>\n                <div class="jqLikeContainer"></div>\n                <% } %>\n            </div>\n            \n            <div class="fnone clearfix">\n                <div class="jqLikers"></div>\n            </div>\n            <% if(item.approved){ %>\n                <% if(canComment == true) { %>\n                        <div class="fnone clearfix btnContainer">\n                            <a href="javascript:void(0)" class="remove_comment right btn" id="remove_comment_<%= item.id %>"><% print(_.escape(translate(\'global_delete\'))) %></a>\n                            <a href="javascript:void(0)" class="approve_comment right btn userDefaultBtn" id="approve_comment_<%= item.id %>"><% print(_.escape(translate(\'global_approve\'))) %></a>\n                        </div>\n                <% } else { %>\n                        <p class="greenTxt notModerated"><% print(_.escape(translate(\'comment_not_moderated\'))) %></p>\n                <% } %>\n            <% } %>\n        </div>\n        <% if(item.canDelete && readonly == 0){ %>\n        <a class="jqDeleteComment" id="remove_comment_<%= item.id %>" href="javascript:void(0)">×</a>\n        <% } %>\n\n    </li>\n    <% }) %>\n</script>\n\n<script type="text/template" id="site_comment_add_new">\n    <input type="text" class="jqWriteComment" value="<%= translate(\'comment_write_a_comment\') %>"/>\n    <div class="jqAddCommentContainer hide">\n        <a href="" class="userCommentImage"><img src="<%= small %>" width="35" height="32"/></a> \n        <textarea class="jqCommentBody"></textarea>\n        <button class="jqPostComment btn userDefaultBtn"><%= translate(\'comment_add_comment\') %></button>\n    </div>\n</script>'}),define("comment/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("comment_templates",n);return r}),define("text!like/templates.html",[],function(){return'<script type="text/template" id="site_like_container">\n    <div class="likeContainer left" entityId="<%= like.entity_id %>" entityType="<%= like.type %>" pageEntityId="<%= like.page_entity_id %>" pageType="<%= like.page_type %>">\n		<% if(canLike) { %>\n		<span class="left">\n	<% if(like.you){ %>\n	<a href="javascript:void(0)" class="jqUnlike"><% print(_.escape(translate(\'global_unlike\'))) %></a>\n	<% } else { %>\n	<a href="javascript:void(0)" class="jqLike"><% print(_.escape(translate(\'global_like\'))) %></a>\n	<% } %>\n        </span>\n		<% } %>\n    </div>\n</script>\n\n<script type="text/template" id="site_like_likers">\n    <div class="likeMessage">\n        <% switch(display) {\n            case 1: %>\n                <span><% print(translate(\'site_like_other_person\',\'\',[\'<a href="javascript:void(0)" class="jqLikers">\'+like.other+\'</a>\'])) %> </span>\n                <div class="likersContainer" entityId="<%= like.entity_id %>" entityType="<%= like.type %>" pageEntityId="<%= like.page_entity_id %>" pageType="<%= like.page_type %>"></div>\n            <% break;\n            case 2: %>\n                <span><% print(translate(\'site_like_other_people\', \'\', [\'<a href="javascript:void(0)" class="jqLikers">\'+like.other+\'</a>\'])) %> </span>\n                <div class="likersContainer" entityId="<%= like.entity_id %>" entityType="<%= like.type %>" pageEntityId="<%= like.page_entity_id %>" pageType="<%= like.page_type %>"></div>\n            <% break;\n            case 3: %>\n                    <span><% print(_.escape(translate(\'site_like_you\'))) %> </span>\n            <% break;\n            case 4: %>\n                <span><% print(translate(\'site_like_other_person_and_you\', \'\', [\'<a href="javascript:void(0)" class="jqLikers">\'+like.other+\'</a>\'])) %> </span>\n                <div class="likersContainer" entityId="<%= like.entity_id %>" entityType="<%= like.type %>" pageEntityId="<%= like.page_entity_id %>" pageType="<%= like.page_type %>"></div>\n            <% break;\n            case 5: %>\n                <span><% print(translate(\'site_like_other_people_and_you\', \'\',[\'<a href="javascript:void(0)" class="jqLikers">\'+like.other+\'</a>\'])) %> </span>\n                <div class="likersContainer" entityId="<%= like.entity_id %>" entityType="<%= like.type %>" pageEntityId="<%= like.page_entity_id %>" pageType="<%= like.page_type %>"></div>\n            <% break; } %>\n    </div>\n    \n</script>'}),define("like/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("like_templates",n);return r}),define("like/views/like",["require","beyazpano","like/_templates"],function(e,t,n){var r=Backbone.View.extend({templateNames:{like_template:"site_like_container",likers_template:"site_like_likers"},initialize:function(e){this.config={likeUrl:BAppConfig.get("like","ajaxLikeUnlikeUrl"),likersUrl:BAppConfig.get("like","ajaxLikersUrl"),canLike:typeof e["canLike"]!="undefined"?e.canLike:!0,OTHER_SINGULAR:1,OTHER_PLURAL:2,YOU:3,YOU_AND_OTHER_SINGULAR:4,YOU_AND_OTHER_PLURAL:5},_.isEmpty(e.likersContainer)||(this.likersContainer=e.likersContainer)},renderLike:function(e){_.isEmpty(e)&&(e=$(this.el).data("likeData"));if(_.isEmpty(e)||_.isEmpty(this.likersContainer))return;var t=_.template($("#"+this.templateNames.like_template).html(),{like:e,canLike:this.config.canLike});$(this.el).html(t),this.config.canLike&&this.initializeLikeEventHandlers(this.el);if(!_.isUndefined(e.you)||!_.isUndefined(e.other)){e.dispay=this.chooseKeyToDisplay(e);var n=_.template($("#"+this.templateNames.likers_template).html(),{like:e});$(this.likersContainer).html(n).show(),this.initializeLikersEventHandlers(this.likersContainer)}else $(this.likersContainer).empty().hide()},initializeLikeEventHandlers:function(e){$(e).find(".jqLike").on("click",_.bind(function(){if(!_.isUndefined(this.$el.data("clicked")))return;var t=this.getEntityContainerLike(),n=t.attr("entityId"),r=t.attr("entityType"),i=t.attr("pageEntityId"),s=t.attr("pageType");this.likeUnlike(e,"like",n,r,i,s)},this)),$(e).find(".jqUnlike").on("click",_.bind(function(){if(!_.isUndefined(this.$el.data("clicked")))return;var t=this.getEntityContainerLike(),n=t.attr("entityId"),r=t.attr("entityType"),i=t.attr("pageEntityId"),s=t.attr("pageType");this.likeUnlike(e,"unlike",n,r,i,s)},this))},initializeLikersEventHandlers:function(e){$(e).find(".jqLikers").on("click",_.bind(function(){var e=this.getEntityContainer(),t=e.attr("entityId"),n=e.attr("entityType");$.ajax(this.config.likersUrl,{type:"post",dataType:"json",data:{entityId:t,entityType:n}}).success(_.bind(function(e,t,n){if(e.success==1){var r=Utils.popup(translate("likers"),e.data);r.find(".jqGoToProfile").click(function(){r.modal("hide")})}else Utils.alert(translate("error_title"),translate("site_like_error"))},this))},this))},getEntityContainer:function(){return $(this.likersContainer).find(".likersContainer")},getEntityContainerLike:function(){return $(this.el).find(".likeContainer")},likeUnlike:function(e,t,n,r,i,s){this.$el.data("clicked",1),$.ajax(this.config.likeUrl,{type:"post",dataType:"json",data:{entityId:n,entityType:r,pageEntityId:i,pageType:s,todo:t}}).success(_.bind(function(e,t,n){e.success==1?this.renderLike(e.data.likeData):Utils.alert(translate("error_title"),translate("site_like_error")),this.$el.removeData("clicked")},this))},chooseKeyToDisplay:function(e){return e.you==1?e.other>1?display=this.config.YOU_AND_OTHER_PLURAL:e.other==1?display=this.config.YOU_AND_OTHER_SINGULAR:display=this.config.YOU:e.other==1?display=this.config.OTHER_SINGULAR:e.other>1&&(display=this.config.OTHER_PLURAL),display}});return r}),define("comment/views/comment",["require","beyazpano","comment/_templates","order!jquery.textarea.autosize","like/views/like"],function(e,t,n,r,i){var s=Backbone.View.extend({templateNames:{comment_container:"site_comment_container",comment_add_new:"site_comment_add_new",comment_show_all:"site_comment_show_all",comment_item:"site_comment_item"},additionalData:null,addCommentLink:null,showEmptyCommentBox:!1,initialize:function(e){this.config={getCommentsUrl:BAppConfig.get("comment","getCommentsUrl"),addCommentUrl:BAppConfig.get("comment","addCommentUrl"),deleteCommentUrl:BAppConfig.get("comment","deleteCommentUrl"),approveCommentUrl:BAppConfig.get("comment","approveCommentUrl"),canComment:typeof e["canComment"]!="undefined"?e.canComment:!0,canLike:typeof e["canLike"]!="undefined"?e.canLike:!0,readonly:typeof e["readonly"]!="undefined"?e.readonly:0},!_.isNull(e.additionalData)&&!_.isUndefined(e.additionalData)&&(this.additionalData=e.additionalData),!_.isNull(e.addCommentLink)&&!_.isUndefined(e.addCommentLink)&&(this.addCommentLink=e.addCommentLink),!_.isNull(e.showEmptyCommentBox)&&!_.isUndefined(e.showEmptyCommentBox)&&(this.showEmptyCommentBox=e.showEmptyCommentBox),this.$el=$(this.el),this.avatarUrls=BAppConfig.get("mydata","avatar")},renderComment:function(e,t,n){if(_.isNull(e)||_.isUndefined(e))e=$(this.el).data("commentData");if(_.isNull(e)||_.isUndefined(e)||_.isNull(e.items)||_.isUndefined(e.items))return;e.add_new="",e.containerClass="",e.canComment=this.config.canComment,e.items.length>0||this.showEmptyCommentBox?(this.config.canComment?e.add_new=_.template($("#"+this.templateNames.comment_add_new).html(),this.avatarUrls):e.add_new="",this.addUserDetails(e.items,t),this.formatData(e)):this.$el.hide(),e.show_all="",e.items.length<e.nrOfComments&&(e.show_all=_.template($("#"+this.templateNames.comment_show_all).html(),{nrOfComments:e.nrOfComments})),e.readonly=this.config.readonly;var r=_.template($("#"+this.templateNames.comment_container).html(),e);$(this.el).html(r),this.initializeEventHandlers(this.el);for(var s in e.items){var o=new i({el:$("#comment_"+e.items[s].id).find(".jqLikeContainer:first"),likersContainer:$("#comment_"+e.items[s].id).find(".jqLikers:first"),canLike:this.config.canLike}),u="comment";e.entityType=="assignment"&&(u="assignment"),e.entityType=="event"&&(u="event"),e.entityType=="profile_post"&&(u="profile"),e.entityType=="quiz"&&(u="quiz"),e.entityType=="group_post"&&(u="comment_group"),e.entityType=="group_discussion_post"&&(u="comment_group_discussion");var a={type:u,entity_id:e.items[s].id},f=null;n!==null&&_.isObject(n)&&typeof n!="undefined"&&(f=n[e.items[s].id]),f!==null&&f!=""&&(a=f),a.page_type=e.entityType,a.page_entity_id=e.entityId,o.renderLike(a)}},refresh:function(){var e=this.getEntityContainer(),t=e.attr("entityId"),n=e.attr("entityType"),r=e.attr("pageEntityId"),i=_.isUndefined($(this.el).data("expanded"))?0:1;$.ajax(this.config.getCommentsUrl,{type:"post",dataType:"json",data:{entityId:t,entityType:n,todo:"refresh",expanded:i,additional:this.additionalData,pageEntityId:r}}).success(_.bind(function(e,n,i){e.success==1&&!_.isUndefined(e.data.comments[t])?(e.data.comments[t].page_entity_id=r,this.renderComment(e.data.comments[t],e.data.users,e.data.likes)):Utils.alert(translate("comment_get_comments_error_title"),translate("comment_get_comments_error_body"))},this))},initializeEventHandlers:function(e){_.isNull(this.addCommentLink)||this.addCommentLink.off("click").on("click",_.bind(function(){var t=$(e).find(".jqWriteComment");t.length==0?(this.$el.show(),$(e).find(".jqNewCommentContainer").html(_.template($("#"+this.templateNames.comment_add_new).html(),this.avatarUrls)),this.initilizeAddCommentEventHandlers($(e).find(".jqNewCommentContainer")),$(e).find(".jqWriteComment").click()):t.click()},this)),$(e).find(".jqShowAll").off("click").on("click",_.bind(function(){var e=this.getEntityContainer(),t=e.attr("entityId"),n=e.attr("entityType"),r=e.attr("shown");r=_.isUndefined(r)||_.isNull(r)?0:r;var i=e.attr("nrOfComments"),s=e.attr("pageEntityId");this.getNotShownComments(t,n,r,i,s)},this)),this.initilizeAddCommentEventHandlers(e)},initilizeAddCommentEventHandlers:function(e){$(e).find(".jqWriteComment").off("click").on("click",_.bind(function(){$(e).find(".jqWriteComment").hide(),$(e).find(".jqAddCommentContainer").show().find(".jqCommentBody").focus()},this)),$(e).find(".jqCommentBody").autosize(),$(e).find(".jqCommentBody").off("blur").on("blur",function(){$(this).val()==""&&($(e).find(".jqAddCommentContainer").hide(),$(e).find(".jqWriteComment").show())}),$(e).find(".jqPostComment").off("click").on("click",_.bind(function(){var t=$(e).find(".jqCommentBody").val();_.isEmpty(t)&&Utils.alert(translate("comment_empty_error_title"),translate("comment_empty_error_body"));var n=this.getEntityContainer(),r=n.attr("entityId"),i=n.attr("entityType"),s=n.attr("pageEntityId");$(e).find(".jqPostComment").attr("disabled","disabled"),this.addComment(r,i,t,s)},this)),$(e).find(".jqDeleteComment").off("click").on("click",_.bind(function(e){var t=e.currentTarget.id.replace("remove_comment_",""),n=this.getEntityContainer(),r=n.attr("entityId"),i=n.attr("entityType");this.deleteComment(t,r,i)},this)),$(e).find(".remove_comment").off("click").on("click",_.bind(function(e){var t=e.currentTarget.id.replace("remove_comment_",""),n=this.getEntityContainer(),r=n.attr("entityId"),i=n.attr("entityType");this.deleteComment(t,r,i)},this)),$(e).find(".approve_comment").off("click").on("click",_.bind(function(e){var t=e.currentTarget.id.replace("approve_comment_",""),n=this.getEntityContainer(),r=n.attr("entityType");this.approveComment(t,r)},this))},addUserDetails:function(e,t){_.each(e,function(e){_.isUndefined(t[e.user_id])||(e.user=t[e.user_id])})},formatData:function(e){_.each(e.items,function(e){var t=Date.parseExact(e.created,"yyyy-MM-dd HH:mm:ss");_.isNull(t)||(e.created=Utils.formatTimestamp(t)),e.user_profile_link=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.user_id),e.user_name=e.user.first_name+" "+e.user.last_name})},getEntityContainer:function(){return $(this.el).find(".commentContainer")},getNotShownComments:function(e,t,n,r,s){var o=$("#feedPage").val();$.ajax(this.config.getCommentsUrl,{type:"post",dataType:"json",data:{entityId:e,entityType:t,offset:n,nrOfComments:r,todo:"more",additional:this.additionalData,pageEntityId:s,feedPage:o}}).success(_.bind(function(t,n,r){if(t.success==1&&!_.isUndefined(t.data.comments[e])){var s=this.getEntityContainer();s.find(".jqShowAll").remove(),$(this.el).data("expanded",!0);var o=t.data.comments[e],u=t.data.likes;this.addUserDetails(o.items,t.data.users),this.formatData(o);var a=_.template($("#"+this.templateNames.comment_item).html(),{items:o.items,canComment:this.config.canComment,readonly:this.config.readonly});$(this.el).find(".jqCommentItems li:first").parent().prepend(a),this.initilizeAddCommentEventHandlers($(this.el).find(".jqCommentItems"));for(var f in o.items){var l=new i({el:$("#comment_"+o.items[f].id).find(".jqLikeContainer:first"),likersContainer:$("#comment_"+o.items[f].id).find(".jqLikers:first"),canLike:!0}),c={type:"comment",entity_id:o.items[f].id},h=null;u!==null&&typeof u!="undefined"&&(h=u[o.items[f].id]),h!==null&&h!=""&&(c=h),c.page_type=o.entityType,c.page_entity_id=o.entityId,l.renderLike(c)}}else Utils.alert(translate("comment_get_more_error_title"),translate("comment_get_more_error_body"))},this))},addComment:function(e,t,n,r){$.ajax(this.config.addCommentUrl,{type:"post",dataType:"json",data:{entityId:e,entityType:t,comment:n,pageEntityId:r}}).success(_.bind(function(e,t,n){e.success==1?this.refresh():Utils.alert(translate("comment_add_comment_error_title"),translate("comment_add_comment_error_body"))},this))},deleteComment:function(e,t,n){var r={commentId:e,entityId:t,entityType:n};Utils.confirm(translate("comment_delete_comment_title"),translate("comment_delete_comment_body"),_.bind(function(t){t=="yes"&&$.ajax(this.config.deleteCommentUrl,{type:"POST",dataType:"json",data:r}).success(_.bind(function(t){if(!t.success)Utils.alert(translate("comment_delete_error_title"),translate("comment_delete_error_body"));else{var n=this.getEntityContainer(),r=n.find("div.jqShowAll");r.length>0?this.refresh():$("#comment_"+e).fadeOut("slow",function(){$(this).remove()})}},this))},this))},approveComment:function(e,t){var n={commentId:e,entityType:t};Utils.confirm(translate("comment_approve_comment_title"),translate("comment_approve_comment_body"),_.bind(function(t){t=="yes"&&$.ajax(this.config.approveCommentUrl,{type:"POST",dataType:"json",data:n}).success(_.bind(function(t){t.success?($("#remove_comment_"+e).remove(),$("#approve_comment_"+e).remove()):Utils.alert(translate("comment_approve_error_title"),translate("comment_approve_error_body"))},this))},this))}});return s}),define("link.attachments",function(){}),define("file.attachments",function(){}),define("attachments",function(){}),define("text!library/templates.html",[],function(){return'<script type="text/template" id="site_my_library">\r\n    <div class="libraryFolderContainer libraryFolderContainerPadding" >\r\n        <div id="folder_action_buttons" class="libraryFolderActionButtons clearfix">\r\n            <% if(data.permissions.create){ %>\r\n            <button class="btn createFolder" id="create_folder" data-placement="bottom" \r\n                    data-original-title="<%= translate(\'help_add_folder\') %>"><span>&nbsp;</span></button>\r\n            <% } %>\r\n            <% if(data.permissions[\'delete\']){ %>\r\n            <button class="btn deleteFolder" id="delete_folder"\r\n                    data-placement="bottom"\r\n                    data-original-title="<%= translate(\'help_delete_folder\') %>"><span>&nbsp;</span></button>\r\n            <% } %>\r\n            <% if(data.permissions.rename){ %>\r\n            <button class="btn renameFolder" id="rename_folder"\r\n                    data-placement="bottom"\r\n                    data-original-title="<%= translate(\'help_rename_folder\') %>"><span>&nbsp;</span></button>\r\n            <% } %>\r\n        </div>\r\n        <div id="folders" class="libraryFolderStructure"></div>\r\n        <div id="storageStatus" class="storageStatus"></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/template" id="site_my_library_storage_status">\r\n    <div>\r\n        <% if(userRole == "STUDENT") { %>\r\n            <%= storage.used %>/<%= storage.max_size %> MB <%= translate(\'site_library_free\') %>\r\n        <% } else { %>\r\n            <%= storage.used %> MB <%= translate(\'site_library_used_space\') %>\r\n        <% } %>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/template" id="site_my_library_files_header">    \r\n    <div class="filterContainer">\r\n        <div class="clearfix">\r\n            <div  class="left">\r\n                <div class="left settingsAll">\r\n                    <% if(data.permissions.groupOperations){ %>\r\n                    <input type="checkbox" class="jqSelectAll left"/>\r\n                    <div class="settingsDetails"><div class="jqGroupOperations"></div></div>\r\n                    <% } %>\r\n                </div>\r\n                <% if(data.permissions.filter){ %>\r\n                <select id="filterBy" class="selectType left">\r\n                    <option value="all"><% print(_.escape(translate(\'global_all\'))) %></option>\r\n                    <% _.each(data.extensions,function(item,text){ %>\r\n                    <option value="<%= text %>"><%= text %></option>\r\n                    <% }); %>\r\n                    <option value="other"><% print(_.escape(translate(\'global_other\'))) %></option>\r\n                </select>\r\n                <% } %>\r\n                <% if(data.permissions.sort){ %>\r\n                <button id="sortBy" class="btn left"><% print(_.escape(translate(\'library_type_sort\'))) %></button>\r\n                <% } %>\r\n            </div>\r\n            <div id="upload_file" class="right">\r\n                <% if(data.permissions.share){ %>\r\n                <button class="btn userDefaultBtn" id="share_file_browse"><% print(_.escape(translate(\'site_library_share\'))) %></button>\r\n                <% } %>\r\n                <% if(data.permissions.upload){ %>\r\n                <button class="btn userDefaultBtn" id="upload_file_browse"><% print(_.escape(translate(\'global_upload\'))) %></button>\r\n                <% } %>\r\n            </div>\r\n        </div>\r\n        <div id="upload_file_list" class="libraryFileListContanier"></div>\r\n    </div>\r\n    <ul class="tabs libraryTabs">\r\n        <li class="active"><a data-toggle="tab" href="#icon_view" id="list_view"><% print(_.escape(translate(\'site_library_list_view\'))) %></a></li>\r\n<!--        <li><a  data-toggle="tab" href="#list_view" id="icon_view"><% print(_.escape(translate(\'site_library_icon_view\'))) %></a></li>-->\r\n    </ul>\r\n\r\n    <div class="tabsContainer" >\r\n        <div id="flash-message"></div>\r\n        <div class="tab-content"> \r\n            <div class="tab-pane active" id="list_view">\r\n                <div id="file_list_container"></div>     \r\n            </div>\r\n            <div class="tab-pane" id="icon_view">\r\n                <div id="file_list_container2"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!--  <button id="icon_view">icon view</button>\r\n        <button id="list_view">list view</button>\r\n       <div id="file_list_container"></div>-->\r\n</script>\r\n\r\n<script type="text/template" id="site_my_library_files_container">\r\n    <div class="fileList">\r\n    </div>\r\n    <iframe src="<%= iframeUrl %>" width=1 height=1 style="visibility:hidden;position:absolute" class="jq_downloadFile_form_iframe"></iframe>\r\n</script>\r\n\r\n<script type="text/template" id="site_my_library_files_list">\r\n    <% if(files && files.length > 0){ %>\r\n    <table class="libraryTable myLibraryTable">\r\n            <thead>\r\n                <tr>\r\n                    <% if(permissions.groupOperations){ %>\r\n                    <td class="checkboxCell">&nbsp;</td>\r\n                    <% } %>\r\n                    <td class="fileNameCell"><a id="jq_sort_name" href="javascript:void(0);"><%= translate(\'course_library_file_name\') %></a></td>\r\n                    <td class="fileDescriptionCell"><a id="jq_sort_description" href="javascript:void(0);"><%= translate(\'course_library_description\') %></a></td>\r\n                    <% if(not_all_columns == false){ %>\r\n                        <td class="fileDateCell"><a id="jq_sort_date" href="javascript:void(0);"><%= translate(\'course_library_date\') %></a></td>\r\n                        <td class="fileSmallCell"><a id="jq_sort_extension" href="javascript:void(0);"><%= translate(\'course_library_extension\') %></a></td>\r\n                        <td class="fileSmallCell"><a id="jq_sort_size" href="javascript:void(0);"><%= translate(\'course_library_size\') %></a></td>\r\n                        <td class="fileSmallCell"><%= translate(\'course_library_functions\') %></td>\r\n                     <% } %>\r\n                </tr>\r\n            </thead>\r\n            <tbody>	\r\n                <% _.each(files,function(item) {\r\n                    var rawIdFile = item.id.substr(0, item.id.indexOf(\'_\'));\r\n                    var getUrl = getFileUrl.replace(\'__FILE_ID__\', rawIdFile);\r\n                %>\r\n                <tr class="fileListItem clearfix jqFileItem <%= item[\'class\'] %>" id="<%= item.id %>">\r\n                    <% if(permissions.groupOperations){ %>\r\n                    <td><input type="checkbox" class="jqSelectFile left" name="file[]" value="<%= item.id %>" filename="<%= item.name %>"/></td>\r\n                    <% } %>\r\n                    <td>\r\n                        <div class="fileNameContainer left"></div>\r\n                        <p class="filename left" id="<%= item.id %>_filename"><%= item.name %></p>\r\n                    </td>\r\n                    <td>\r\n                        <p class="description <% if(_.isEmpty(item.description)){ %>jqWriteDescription <% } %>" id="<%= item.id %>_description"><%= item.description %></p>\r\n                    </td>\r\n                    <% if(not_all_columns == false){ %>\r\n                    <td>\r\n                        <p class="date"><%= Utils.formatDate(item.created,\'dd MMM yyyy\') %></p> \r\n                    </td>\r\n                    <td>\r\n                            <%= item.extension %>\r\n                    </td>\r\n                    <td><%= item.size %> MB</td>\r\n                    <td><div class="courseSectionDetails">\r\n                        <% print(_.template($(\'#site_library_file_operations\').html(), {permissions:permissions, getUrl:getUrl})) %>\r\n                    </div>\r\n                    </td>\r\n                     <% } %>    \r\n                </tr>\r\n                <% }) %>\r\n            </tbody>\r\n    </table>\r\n	\r\n    <% } else { %>\r\n    <div>&nbsp;</div>\r\n    <% } %>\r\n</script>\r\n\r\n<script type="text/template" id="site_my_library_files_icons">\r\n\r\n   <% if(files && files.length > 0){ %>\r\n    <ul class="clearfix">\r\n        <% _.each(files,function(item) {\r\n            var rawIdFile = item.id.substr(0, item.id.indexOf(\'_\'));\r\n            var getUrl = getFileUrl.replace(\'__FILE_ID__\', rawIdFile);\r\n        %>\r\n        <li  class="left fileIcon <%= item[\'class\'] %>" id="<%= item.id %>">\r\n\r\n            <div class="grayBg">\r\n				<div class="fileNameContainer left"></div>\r\n                <p class="filename left" id="<%= item.id %>_filename"><%= item.name %></p>\r\n            </div>\r\n            <% if(permissions.groupOperations){ %>\r\n            <input type="checkbox" class="jqSelectFile left" name="file[]" value="<%= item.id %>"/>\r\n            <% } %>\r\n            <div class="courseSectionDetails">\r\n                <% print(_.template($(\'#site_library_file_operations\').html(), {permissions:permissions, getUrl:getUrl})) %>\r\n            </div>\r\n        </li>\r\n        <% }) %>\r\n    </ul>\r\n    <span style="clear:both"></span>\r\n    <% } else { %>\r\n    <div>&nbsp;</div>\r\n    <% } %>\r\n</script>\r\n\r\n<script type="text/template" id="site_library_file_operations">\r\n    <% if(permissions.operationsAllowed){ %>\r\n    <div class="btn-group">\r\n        <button  class="dropdown-toggle courseSettingsDropdownToggle " data-toggle="dropdown"></button>\r\n        <ul class="dropdown-menu pull-right courseSettingsDropdownToggleBox">\r\n            <% if(permissions[\'delete\']){ %>\r\n            <li class="jq_deleteFile"><a href="#" class="delete-file"><i class="btnicon-remove"></i><% print(_.escape(translate(\'site_library_delete_file\'))) %></a></li>\r\n            <% }if(permissions.download){ %>\r\n            <li class="jq_downloadFile"><a href=<%= \'"\'+getUrl+\'"\' %> class="download-file"><i class="btnicon-download"></i><% print(_.escape(translate(\'site_library_download_file\'))) %></a></li>\r\n            <% }if(permissions.copy){ %>\r\n            <li class="jq_copyFile"><a href="#" class="copy-file"><i class="btnicon-copy"></i><% print(_.escape(translate(\'site_library_copy_file\'))) %></a></li>\r\n            <% }if(permissions.move){ %>\r\n            <li class="jq_moveFile"><a href="#" class="move-file"><i class="btnicon-move"></i><% print(_.escape(translate(\'site_library_move_file\'))) %></a></li>                    \r\n            <% } %>\r\n        </ul>\r\n    </div>\r\n    <% } %>\r\n</script>\r\n\r\n<script type="text/template" id="site_my_library_folders">\r\n    <div class="folderTree"></div>\r\n</script>\r\n\r\n<script type="text/template" id="site_library_share_popup">\r\n    <div class="jqFolderTree"></div>\r\n    <div class="jqFiles"></div>\r\n</script>\r\n\r\n<script type="text/template" id="site_my_library_popup_buttons">\r\n    <button href="#" class="btn userDefaultBtn" id="<%= dialogId %>-yesbtn"><%= ok %></button>\r\n    <button href="#" class="btn" id="<%= dialogId %>-nobtn"><%= cancel %></button>\r\n</script>\r\n\r\n'}),define("library/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("my_library_templates",n);return r}),define("library/views/folderCollection",["require","beyazpano","library/_templates","jstree"],function(e,t,n,r){var i=Backbone.View.extend({templateNames:{main:"site_my_library_folders",operations:"site_my_library_folder_operations",storage:"site_my_library_storage_status"},initialize:function(e){this.config={type:"user",ownerId:null,getUrl:BAppConfig.get("library","ajaxFolderGetUrl"),editUrl:BAppConfig.get("library","ajaxFolderEditUrl"),el:"#content_left",storageStatusElem:"#storageStatus",showRoot:!0,initialFolderId:"0"},e.config&&(this.config=_.extend(this.config,e.config)),this.el=this.config.el,this.folderTree=null},render:function(){var e=$(t.renderTemplate(this.templateNames.main,{}));e.hide(),$(this.el).html(e),this.folderTree=$(this.el).find("div.folderTree").jstree({json_data:{ajax:{url:this.config.getUrl,type:"post",data:_.bind(function(e){this.config.showRoot==0&&$(this.el).data("initial",!1);var t={id:e.attr?e.attr("id"):"0_"+this.config.ownerId+"_"+this.config.type,isInit:$(this.el).data("initial")==null?!0:""};return $(this.el).data("initial",!1),t},this),success:_.bind(function(e){return e.data.storage&&this.updateStorageStat(e.data.storage),e.data},this)}},ui:{initially_select:[this.config.initialFolderId+"_"+this.config.ownerId+"_"+this.config.type],select_multiple_modifier:!1},plugins:["themes","json_data","ui","crrm","sort"]}),e.fadeIn(400),this.initializeEventListeners()},updateStorageStat:function(e){var n=$(t.renderTemplate(this.templateNames.storage,e));$(this.config.storageStatusElem).html(n)},initializeEventListeners:function(){this.folderTree.bind("select_node.jstree",_.bind(function(e,t){this.trigger("folderSelected",{id:t.rslt.obj.attr("id")});var n=$("#folders").find(".jstree-clicked"),r=n.parents("li:first").hasClass("folderRoot");r?$("#list_view").text(translate("site_library_list_view")):$("#list_view").text($.trim(n.text()))},this)).bind("create.jstree",_.bind(function(e,t){$.post(this.config.editUrl,{operation:"create",id:this.config.showRoot===!1?"0_"+this.config.ownerId+"_"+this.config.type:t.rslt.parent.attr("id"),name:t.rslt.name},_.bind(function(e){e.success?($(t.rslt.obj).attr("id",e.data.id),$(t.rslt.obj).addClass("reduce_length"),$(".folderTree").jstree("deselect_all"),$(".folderTree").jstree("select_node","#"+e.data.id)):($.jstree.rollback(t.rlbk),this.trigger("folderCreationFailure",{}))},this))},this)).bind("remove.jstree",_.bind(function(e,t){var n=this.config.editUrl;t.rslt.obj.each(_.bind(function(e,r){$.ajax({async:!1,type:"POST",url:n,data:{operation:"remove",id:$(r).attr("id")},success:_.bind(function(e){e.success?this.trigger("folderRemoved",{}):($.jstree.rollback(t.rlbk),this.trigger("folderRemoveFailure",{id:$(r).attr("id")}))},this)})},this))},this)).bind("rename.jstree",_.bind(function(e,t){var n=this.config.editUrl;$.ajax({async:!1,type:"POST",url:n,data:{operation:"rename",id:t.rslt.obj.attr("id"),name:t.rslt.new_name},success:_.bind(function(e){e.success?this.trigger("folderRenamed",{folderName:t.rslt.new_name}):(Utils.alert(translate("site_library_rename_error_title"),translate("site_library_rename_error_body")),$.jstree.rollback(t.rlbk))},this)})},this))},addFolder:function(e){this.config.showRoot==0&&(e="0_"+this.config.ownerId+"_"+this.config.type);if(_.isUndefined(e)){var t=this.folderTree.jstree("get_selected");e=t.length!=0?t.attr("id"):"0_"+this.config.ownerId+"_"+this.config.type}this.folderTree.jstree("create","#"+e,!1,translate("site_library_new_folder"))},deleteFolder:function(e){_.isUndefined(e)&&(e=this.getSelectedFolderId()),e!=null&&($("#"+e).hasClass("folderRoot")?Utils.alert(translate("site_library_root_folder_delete_error_title"),translate("site_library_root_folder_delete_error")):Utils.confirm(translate("site_library_delete_folder_confirmation_title"),translate("site_library_delete_folder_confirmation_message"),_.bind(function(t){t=="yes"&&this.folderTree.jstree("remove","#"+e)},this)))},renameSelectedFolder:function(){var e=this.getSelectedFolderId();if(_.isNull(e)||/^0_.*/.test(e)){Utils.alert(translate("site_library_root_folder_rename_error_title"),translate("site_library_root_folder_rename_error_body"));return}this.folderTree.jstree("rename")},getSelectedFolderId:function(){var e=this.folderTree.jstree("get_selected");return e.length!=0?e.attr("id"):null}});return i}),define("library/views/fileList",["require","beyazpano","library/views/folderCollection","library/_templates","jquery.editinplace","jquery.textarea.counter"],function(e,t,n){var r=Backbone.View.extend({initialize:function(e){this.templateNames={main:"site_my_library_files_container",chooseFolder:"site_my_library_folders",popupButtons:"site_my_library_popup_buttons",fileList:"site_my_library_files_list",fileIcons:"site_my_library_files_icons"},this.config={type:"user",ownerId:null,getUrl:BAppConfig.get("library","ajaxGetFilesUrl"),editUrl:BAppConfig.get("library","ajaxEditFilesUrl"),el:"#content",maxChars:250,sortBy:"created_desc#extension_asc",filterBy:"all",view:"list"},this.not_all_columns=!1,this.permissions={operationsAllowed:!1,upload:!1,share:!1,sort:!1,filter:!1,"delete":!1,download:!1,copy:!1,move:!1,rename:!1},this.el=e.el,e.config&&(this.config=_.extend(this.config,e.config)),e.templateNames&&(this.templateNames=_.extend(this.templateNames,e.templateNames)),e.p&&(this.permissions=_.extend(this.permissions,e.p)),this.folderId=0,this.selectedFileId=null,this.sortBy=this.config.sortBy,this.filterBy=this.config.filterBy,this.initialiseEventHandlers(),e.not_all_columns&&(this.not_all_columns=e.not_all_columns),this.list={}},render:function(){var e=$(t.renderTemplate(this.templateNames.main,{iframeUrl:BAppConfig.get("library","downloadFileUrl")}));$(this.el).html(e)},initialiseEventHandlers:function(){$(this.el).find(".jqFileItem").live("click",_.bind(function(e){this.selectedFileId=$(e.currentTarget).attr("id"),$(this.el).find(".jqFileItem").removeClass("selectedFile"),$(e.currentTarget).addClass("selectedFile"),this.trigger("fileSelected",{id:this.selectedFileId})},this)),$(this.el).find(".jq_deleteFile").live("click",_.bind(function(e){var t=$(e.currentTarget).closest(".jqFileItem").attr("id");this.deleteFile(t)},this)),/iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase())||$(this.el).find(".jq_downloadFile").live("click",_.bind(function(e){var t=$(e.currentTarget).closest(".jqFileItem").attr("id");this.downloadFile(t)},this)),$(this.el).find(".jq_copyFile").live("click",_.bind(function(e){var t=$(e.currentTarget).closest(".jqFileItem").attr("id");this.copyOrMoveFile(t,"copy")},this)),$(this.el).find(".jq_moveFile").live("click",_.bind(function(e){var t=$(e.currentTarget).closest(".jqFileItem").attr("id");this.copyOrMoveFile(t,"move")},this))},getFiles:function(e){this.folderId=e,e!=undefined&&$.ajax(this.config.getUrl,{type:"post",dataType:"json",data:{id:"0_"+e,operation:"getList",sortBy:this.sortBy,filterBy:this.filterBy}}).success(_.bind(function(t,n,r){if(t!=undefined&&t.success==1){this.updateList(t.data),this.trigger("updatedFileList",e);var i={storage:t.storage,userRole:t.userRole};_.isUndefined(t.storage)||this.trigger("updateStorageStat",i)}},this))},updateList:function(e){this.list=e,this.selectedFileId=null;var n=$(this.el).find(".fileList:first");if(!_.isEmpty(e)){var r=this.view=="icon"?this.templateNames.fileIcons:this.templateNames.fileList,i=$(t.renderTemplate(r,{files:e,permissions:this.permissions,not_all_columns:this.not_all_columns,getFileUrl:BAppConfig.get("library","getDownloadFile")}));n.html(i),this.permissions.rename&&n.find(".filename,.description").each(_.bind(function(e,t){var n=$(t).hasClass("filename")?"filename":"description";$(t).editInPlace({textarea_cols:10,textarea_rows:3,save_if_nothing_changed:!0,field_type:$(t).hasClass("filename")?"text":"textarea",default_text:translate("click_here_to_add_text"),callback:_.bind(function(e,r,i){if(r===""&&(i===""||i===translate("click_here_to_add_text"))||r===translate("click_here_to_add_text"))s=translate("click_here_to_add_text");else{var s="";$.ajax(this.config.editUrl,{type:"POST",data:{operation:"rename",id:e,renameType:n,update:r},dataType:"json",async:!1}).success(function(r){r.success?r.data==""||r.data==null?($(t).addClass("jqWriteDescription"),s=translate("click_here_to_add_text")):($(t).removeClass("jqWriteDescription"),s=r.data):(s=i,this.trigger("fileRenameFailed",{type:n,elem:$(e)}))})}return s},this),delegate:{didOpenEditInPlace:_.bind(function(e){e.find("textarea").textareaCount({maxCharacterSize:this.config.maxChars,displayFormat:"#left"})},this)}})},this))}else{var r=this.view=="icon"?this.templateNames.fileIcons:this.templateNames.fileList,i=$(t.renderTemplate(r,{files:e,permissions:this.permissions}));n.html(i)}},refresh:function(){this.getFiles(this.folderId)},addFile:function(e,t){$.ajax(this.config.editUrl,{type:"POST",dataType:"json",data:{operation:"add",id:t+"_"+e+"_"+this.config.ownerId+"_"+this.config.type}}).success(_.bind(function(e){e.success?this.refresh():Utils.alert(translate("error_title"),e.msg)},this))},deleteFile:function(e,t){var n=this.config.editUrl,r={id:e};_.isUndefined(t)||(n=t.url,r={ids:t.ids}),Utils.confirm(translate("site_library_delete_file_confirmation_title"),translate("site_library_delete_file_confirmation_message"),_.bind(function(t){t=="yes"&&$.ajax(n,{type:"post",dataType:"json",data:_.extend({operation:"delete"},r)}).success(_.bind(function(t,n,r){t!=undefined&&t.success==1?(this.refresh(),this.trigger("fileDeleted",{fileId:e})):(Utils.alert(translate("error_title"),translate("error_message")),this.trigger("fileDeleteFailed",{fileId:e}))},this))},this))},downloadFile:function(e){var t=$(this.el).find(".jq_downloadFile_form_iframe");t.contents().find("input[name=id]").val(e),t.contents().find(".jq_downloadFile_form").submit()},copyOrMoveFile:function(e,r,i){var s={id:e},o=this.config.editUrl;_.isUndefined(i)||(o=i.url,s={ids:i.ids});var u="dialog_copy_move_file";if(r=="copy")var a=s.ids&&s.ids.length>1?translate("site_my_library_copy_file_plural"):translate("site_my_library_copy_file");else var a=s.ids&&s.ids.length>1?translate("site_my_library_move_file_plural"):translate("site_my_library_move_file");var f=t.renderTemplate(this.templateNames.chooseFolder,{}),l=_.template($("#generic-dialog").html(),{dialog_id:u,title:a,body:f,footer:t.renderTemplate(this.templateNames.popupButtons,{dialogId:u,ok:translate("ok"),cancel:translate("global_cancel")})}),c=$(l);c.find("#"+u+"-yesbtn").on("click",_.bind(function(){c.modal("hide"),$.ajax(o,{type:"post",dataType:"json",data:_.extend({operation:r,newFolder:h.getSelectedFolderId()},s)}).success(_.bind(function(e,t,n){e!=undefined&&e.success==1?(r=="copy"?Utils.alert(translate("site_library_operation_to_library_success_title"),translate("site_library_copy_to_library_success_message")):Utils.alert(translate("site_library_operation_to_library_success_title"),translate("site_library_move_to_library_success_message")),this.refresh()):Utils.alert(translate("error_title"),translate("error_message"))},this))},this)),c.find("#"+u+"-nobtn").on("click",_.bind(function(){c.modal("hide")},this)),$("#"+u).remove(),$("body").append(c),$("#"+u).modal({show:!0,backdrop:"static"}),$("#"+u).modal("show");var h=new n({config:{ownerId:this.config.ownerId,el:"#"+u+" .folderTree:first"}});h.render()},changeSort:function(e){this.sortBy=e,this.refresh()},changeFilterType:function(e){this.filterBy=e,this.refresh()},changeView:function(e){this.view=e,this.updateList(this.list)},getSelectedFileId:function(){return this.selectedFileId},getSelectedFileIds:function(){var e=[];return $(this.el).find(".jqSelectFile:checked").each(function(t,n){e.push($(n).val())}),e}});return r}),define("library/views/shareFiles",["require","beyazpano","./folderCollection","./fileList","library/_templates"],function(e,t,n,r){var i=Backbone.View.extend({templateNames:{chooseFolder:"site_library_share_popup",popupButtons:"site_my_library_popup_buttons"},config:{ownerId:null,libraryType:null,type:"fileSelection"},selectedFileIds:null,selectedFolder:null,initialize:function(e){this.selectedFilesData=null,_.isUndefined(e.shareLibraryOwnerId)||(this.config.ownerId=e.shareLibraryOwnerId),_.isUndefined(e.shareLibraryType)||(this.config.libraryType=e.shareLibraryType),_.isUndefined(e.type)||(this.config.type=e.type)},showPopup:function(){var e=_.uniqueId("dialog_share_file_"),n=translate("site_library_share_file_title"),r=t.renderTemplate(this.templateNames.chooseFolder,{}),i=_.template($("#generic-dialog").html(),{dialog_id:e,title:n,body:r,footer:t.renderTemplate(this.templateNames.popupButtons,{dialogId:e,ok:translate("ok"),cancel:translate("global_cancel")})}),s=$(i);s.find("#"+e+"-yesbtn").on("click",_.bind(function(){function e(e){$("#_dialog_alert").live("hide",function(){Utils.unblock("#"+e)})}this.config.type=="folderSelection"?_.isNull(this.selectedFolder)?(Utils.block("#"+s.attr("id")),Utils.alert(translate("site_library_select_file_title"),translate("site_library_select_file_message"),e(s.attr("id")))):(s.modal("hide"),this.trigger("share_selected_folder",this.selectedFolder)):_.isEmpty(this.selectedFileIds)?(Utils.block("#"+s.attr("id")),Utils.alert(translate("site_library_select_file_title"),translate("site_library_select_file_message"),e(s.attr("id")))):(s.modal("hide"),this.trigger("share_selected_files",this.selectedFileIds,this.selectedFilesData))},this)),s.find("#"+e+"-nobtn").on("click",_.bind(function(){s.modal("hide")},this)),$("#"+e).remove(),$("body").append(s),$("#"+e).modal({show:!0,backdrop:"static"}),this.renderLibrary(e),$("#"+e).modal("show")},renderLibrary:function(e){var t=new n({config:{ownerId:this.config.ownerId,type:this.config.libraryType,el:"#"+e+" .jqFolderTree:first"}});t.render();if(this.config.type!=="folderSelection"){var i=new r({el:"#"+e+" .jqFiles:first",config:{ownerId:this.config.ownerId,type:this.config.libraryType},p:{operationsAllowed:!1,rename:!1,groupOperations:!0},not_all_columns:!0});i.on("fileSelected",_.bind(function(t){this.selectedFileIds=[],this.selectedFilesData={},$("#"+e+" .jqFiles:first input:checked").each(_.bind(function(e,t){this.selectedFileIds.push($(t).val()),this.selectedFilesData[$(t).val()]={name:$(t).attr("filename"),id:$(t).val().split("_")[0],type:"file"}},this))},this)),i.render()}t.on("folderSelected",_.bind(function(e){this.config.type!=="folderSelection"&&i.getFiles(e.id),this.selectedFolder=e.id},this))}});return i}),define("attachment/views/component",["require","beyazpano","non-app/_templates","order!plupload","order!plupload.html4","order!plupload.html5","order!plupload.flash","link.attachments","file.attachments","attachments","library/views/shareFiles"],function(e,t,n,r,i,s,o,u,a,f,l){var c=Backbone.View.extend({getShareInitHandler:function(){var e=function(e){$(e.container).live("click",_.bind(function(){var t=new l({shareLibraryType:"user",shareLibraryOwnerId:BAppConfig.get("mydata","id")});t.on("share_selected_files",_.bind(function(t,n){var r=[];for(var i=0;i<t.length;i++){var s=n[t[i]];r.push(s)}e.attachmentsComponent.addFileAttachments(r)},this)),t.showPopup()},this))};return e}});return new c}),define("text!autocomplete/templates.html",[],function(){return'<script type="text/template" id="wallBrowserDialog">\n	<div class="modal fade modal-narrow" id="<%= dialog_id %>" data-backdrop="static">\n		<div class="modal-header">\n			<div class="modalHeaderContainer">\n				<a class="close" data-dismiss="modal"></a>\n\n				<h3 id="<%= dialog_id %>-title">\n                                <% (wallType === \'group\') ? print(translate(\'updates_choose_wall_group\')) : print(translate(\'updates_choose_wall\'));%>\n                                </h3>\n			</div>\n		</div>\n		<div class="modal-body" id="<%= dialog_id %>-body">\n			<div class="modalList modalContent">\n				<form method="POST" id="<%= dialog_id %>-walls-form">\n					<ul class="walls clearfrix">\n						<% if(typeof walls.courses != \'undefined\' && walls.courses != \'\') { %>\n						<li class="wall clearfix">\n							<h2><%print(translate(\'global_courses\'))%></h2>\n							<ul>\n								<% for(var i in walls.courses){ %>\n								<li class="course clearfix">\n									<div class="mainSection clearfix">\n										<input type="checkbox" class="course-cb"\n											   id="course-cb-<%= walls.courses[i].id%>">\n\n										<h3><%- walls.courses[i].name %></h3>\n									</div>\n									<ul id="sections-<%= walls.courses[i].id%>">\n										<%for(var j in walls.courses[i].sections){%>\n										<li class="section clearfix">\n											<label><%- walls.courses[i].sections[j].name %></label>\n											<input type="checkbox" name="selectedWalls" class="section-cb"\n												   id="section-cb-<%= walls.courses[i].id%>-<%=j%>" value="3_<%=j%>"\n											<%if($.inArray(\'3_\' + j, selectedWalls) != -1){%>checked<%}%>>\n										</li>\n										<%}%>\n									</ul>\n								</li>\n								<%}%>\n							</ul>\n						</li>\n						<% } else if ((typeof walls.groups != \'undefined\' && walls.groups != \'\')) { %>\n                                                    <li class="wall clearfix">\n                                                        <ul>\n                                                            <h2><%print(translate(\'global_groups\'))%></h2>\n                                                            <li class="course clearfix">\n                                                                <%for(var j in walls.groups){%>\n                                                                    <li class="course clearfix">\n                                                                        <div class="mainSection clearfix">\n                                                                        <input type="checkbox" name="selectedWalls" class="section-cb"\n                                                                               id="section-cb-<%= walls.groups[j].id%>-<%=j%>" value="2_<%=walls.groups[j].id%>"\n                                                                        <%if($.inArray(\'2_\' + j, selectedWalls) != -1){%>checked<%}%>>\n                                                                        <h3><%- walls.groups[j].name %></h3>\n                                                                        </div>\n                                                                    </li>\n                                                                <%}%>\n                                                            </li>\n                                                        </ul>\n                                                    </li>\n                                                    <% } else { %>\n                                                        <% if(wallType === \'group\'){ %>\n                                                            <h2><%print(translate(\'no_groups_found\'))%></h2>\n                                                        <% } else { %>\n                                                            <h2><%print(translate(\'no_classes_found\'))%></h2>\n                                                        <% } %>\n                                                    <% }%>\n						<% if(typeof walls.profile != \'undefined\') { %>\n						<li class="wall">\n							<h2><%print(translate(\'global_profile\'))%></h2>\n							<ul>\n								<li class="browseProfile">\n									<label><%print(translate(\'global_profile\'))%></label>\n									<input type="checkbox" name="selectedWalls[]" value="1_<%=walls.profile%>" <%\n									if($.inArray(\'1_\' + walls.profile, selectedWalls) != -1){%>checked<%}%>>\n								</li>\n							</ul>\n						</li>\n						<% } %>\n					</ul>\n				</form>\n			</div>\n		</div>\n		<div class="modal-footer" id="<%= dialog_id %>-footer">\n			<div class="modalFooterContainer modalFooterContainerUser">\n				<div class="modalButtons">\n					<button href="#" class="btn userDefaultBtn" id="<%= dialog_id %>-okbtn"> <% print(translate(\'global_save\'))\n						%>\n					</button>\n					<button href="#" class="btn btn-primary" id="<%= dialog_id %>-cancelbtn"> <%\n						print(translate(\'global_cancel\')) %>\n					</button>\n				</div>\n			</div>\n		</div>\n	</div>\n</script>\n<script type="text/template" id="autocompleteComponents">\n	<div id="<%= id %>">\n		<% if(showTokenInput) { %>\n		<input type="text" id="<%= id %>_walls_autocomplete">\n		<%}%>\n		<%if(showWallSelector) {%>\n		<a href="javascript:void(0);" id="<%= id %>_browse_walls" data-placement="top" class="browseButtonHome"\n		   data-original-title="<% print(_.escape(browseButtonTitle)) %>"><% print(_.escape(translate(\'global_browse\')))\n			%></a>\n		<%}%>\n	</div>\n</script>'}),define("autocomplete/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var n=t.appendTemplate("autocomplete_templates",n);return n}),define("autocomplete/views/autocomplete",["require","beyazpano","order!bootstrap.tooltip","jquery.tokeninput","autocomplete/_templates"],function(e,t,n,r,i){var s=null,o=Backbone.View.extend({templateNames:{main:"autocompleteComponents",wall_browser_dialog:"wallBrowserDialog"},initialize:function(e){this.config={containerId:"#autocomplete",useWallBrowser:!0,useTokenInput:!0,tokenInputMethod:"POST",tokenInputJsonContainer:null,tokenInputSource:[],tokenInputPrepopulate:[],wallBrowserWallsSelected:[],wallBrowserWalls:[],wallType:"course",browseButtonTitle:translate("wall_post_message")},_.isUndefined(e.config)||(this.config=_.extend(this.config,e.config)),this.$el=$(this.config.containerId),this.elId=_.uniqueId("autocomplete_")},render:function(){var e={id:this.elId,showTokenInput:this.config.useTokenInput,showWallSelector:this.config.useWallBrowser,browseButtonTitle:this.config.browseButtonTitle},n=t.renderTemplate(this.templateNames.main,e);this.$el.html(n),this.config.useWallBrowser&&$("#"+this.elId+"_browse_walls").on("click",_.bind(function(){this.initBrowseWallsPopup()},this)),this.config.useTokenInput&&($("#"+this.elId+"_walls_autocomplete").tokenInput(this.config.tokenInputSource,{hintText:translate("type_search_term"),noResultsText:translate("no_results"),searchingText:translate("searching"),theme:"facebook",preventDuplicates:!0,prePopulate:this.config.tokenInputPrepopulate,method:this.config.tokenInputMethod,jsonContainer:this.config.tokenInputJsonContainer,onAdd:_.bind(this.onChangeTokenInput,this),onDelete:_.bind(this.onChangeTokenInput,this)}),this.config.useWallBrowser&&this.populateTokenInputWithSelectedWalls(this.config.wallBrowserWallsSelected)),$(".browseButtonHome").tooltip()},initBrowseWallsPopup:function(){function o(){$.each(i.find("li.course"),function(e,t){$(t).find(".section-cb").length==$(t).find(".section-cb:checked").length?$(t).find(".course-cb").attr("checked","checked"):$(t).find(".course-cb").attr("checked",!1)})}var e=this.elId+"_browse_walls_dialog_popup",n={dialog_id:e,walls:this.config.wallBrowserWalls,selectedWalls:this.config.wallBrowserWallsSelected,wallType:this.config.wallType},r=t.renderTemplate(this.templateNames.wall_browser_dialog,n),i=$(r);i.find("#"+e+"-okbtn").on("click",_.bind(function(){i.modal("hide");var t=$("#"+e+"-walls-form").serializeArray(),n=[];$.each(t,_.bind(function(e,t){n.push(t.value)},this)),this.config.useTokenInput?this.populateTokenInputWithSelectedWalls(n):(this.trigger("ListChanged",n),this.config.wallBrowserWallsSelected=n)},this)),i.find("li.course .course-cb").on("click",_.bind(function(e){var t=e.target.id.replace("course-cb-","");$("#sections-"+t).find(".section-cb").attr("checked",!1),e.target.checked&&$("#sections-"+t).find(".section-cb").attr("checked","checked")},this)),o(),i.find("li.course .section-cb").on("click",_.bind(function(e){o()},this)),i.find("#"+e+"-cancelbtn").on("click",_.bind(function(){i.modal("hide")},this)),s!=null&&$("#"+s).remove(),s=e,$("body").append(i),$("#"+e).modal({show:!0,backdrop:"static"});var u=$("#"+e);u.modal("show")},onChangeTokenInput:function(){var e=$("#"+this.elId+"_walls_autocomplete").tokenInput("get");if(!this.config.useWallBrowser){this.trigger("ListChanged",e);return}var t=[];$.each(e,_.bind(function(e,n){t.push(n.id)},this)),this.trigger("ListChanged",t),this.config.wallBrowserWallsSelected=t},populateTokenInputWithSelectedWalls:function(e){var t=$("#"+this.elId+"_walls_autocomplete");t.tokenInput("clear");var n=this.config.tokenInputSource;for(var r in n)for(var i in e)e[i]==n[r].id&&t.tokenInput("add",n[r])}});return o}),define("text!gradepopup/templates.html",[],function(){return'<script type="text/template" id="grade_popup_content">\n    <div class="dropboxDownloadContainer">\n        <% if(assignment != null && assignment.dropbox == \'1\') { %>\n        <ul class="tabs" id="submissions">\n            <li class="active">\n                <a href="#latest_dropbox" data-toggle="tab"><%= translate(\'latest_dropbox_version\')%></a>\n            </li>\n            <% if(dropbox != null && !_.isEmpty(dropbox.previous)) { %>\n            <li>\n                <a href="#previous_dropbox" data-toggle="tab"><%= translate(\'previous_dropbox_versions\')%></a>\n            </li>\n            <% } %>\n        </ul>\n        <% } %>\n        <div class="tab-content">\n        <div class="tab-pane active" id="latest_dropbox">\n        <div class="clearfix"> \n            <div class="leftDropbox">\n                <% if(dropbox != null) { %>    \n                    <% if(!_.isEmpty(dropbox)) {%>\n                    <% if( !isAdminOfSection && grading.published != 1 && assignment != null && assignment.dropbox == \'1\') {%>\n                        <% _.each(dropbox.latest.files, function(item) { %>\n                            <p class="clearfix">\n                                <a class="download-file" href="<% print(BAppConfig.get(\'site_sections\', \'dropboxDownloadUrl\').replace(\'__fileid__\', item.id)) %>" id="download-file"><%= item.name %></a>\n                                <% if(readonly == 0) { %>\n                                <span class="removeFile" id="<%= item.id %>">x</span>\n                                <% } %>\n                            </p>\n                        <% }) %>\n                    <% } else {%>\n                        <% _.each(dropbox.latest.files, function(item) { %>\n                            <p><a href="<% print(BAppConfig.get(\'site_sections\', \'dropboxDownloadUrl\').replace(\'__fileid__\', item.id)) %>" id="download-file"><%= item.name %></a></p>\n                        <% }) %>\n                    <% } %>\n                    <p><%= dropbox.latest.description %></p>\n                    <p class="dropboxCreateDate">\n                        <%= (Utils.formatTimestamp(Date.parseExact(dropbox.latest.created, \'yyyy-MM-dd HH:mm:ss\'))) %>\n                    </p>\n                    <% }%>\n                    <% } %>\n                    <% if( !isAdminOfSection && grading.published != 1 && assignment != null && assignment.dropbox == \'1\') { %>\n                    <div id="alert_submit_assignment"></div>\n                    <form name="uploadAssignmentForm" id="uploadAssignmentForm" action="" method="post">\n                        <ul class="modalForm">\n                            <li>\n                                <label><% print(translate(\'assignment_description\')) %>:</label>\n                                <textarea  name="data[description]" <% if (readonly == 1) { print(disabled="disabled");}%>><%= (!_.isEmpty(dropbox) ? dropbox.latest.description: \'\') %></textarea>\n                            </li>\n                            <% if(!isAdminOfSection && !_.isEmpty(dropbox) && typeof dropbox.latest.fileids !== \'undefined\') { %>\n                                <input name="data[fileids]" id="fileid-dropbox" type="hidden" value="<%= dropbox.latest.fileids %>">\n                            <% } else { %>\n                                <input name="data[fileids]" id="fileid-dropbox" type="hidden">\n                            <% } %>\n                            <input name="data[idassignment]" type="hidden" value="<%= assignment.id %>">\n                        </ul>\n                    </form>\n                    <div class="dropboxActions">\n                        <% if(readonly == 0) { %>\n                        <div id="upload_assignment" class="userMessageAttachment userPostAttachements assignmentFileUpload clearfix">\n                            <a id="upload_assignment_browse" href="#" class="btn userDefaultBtn"><% print(translate(\'global_upload\')); %></a>\n                            <div id="upload_assignment_list"></div>\n                        </div>\n                        <% if (!isAdminOfSection && grading.published != 1 && assignment != null){ %>\n                        <div class="dropboxActionButtons">\n                            <button  id="save-submit-assignment" href="#" class="btn uploadDisableBtn userDefaultBtn"><% print( ((!_.isEmpty(dropbox) && dropbox !== null) ? _.escape(translate(\'re_submit_changes\')):_.escape(translate(\'submit_assignment\'))) ) %></button>\n                            <button href="#" class="btn" data-dismiss="modal"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n                        </div>\n                        <% } %>\n                        <% } else { %>\n                        <p><% print(translate(\'no_submit_assignment_read_only\')) %></p>\n                        <% } %>\n                    </div>\n                    <% } %>    \n            </div>\n            \n            <% if( isAdminOfSection  && (grading.type != \'ungraded\')) { %>\n            <div class="rightDropbox">\n                <form id="gradeForm">\n                    <ul class="modalForm">\n                        <li class="clearfix">\n                            <label><% print(translate(\'global_grade\')) %>:</label>\n                            <input type="text" class="small" name="data[points]" id="points" value="<%= (grade.points !== null ? grade.points : \'\') %>" <% if(readonly == 1) { %> disabled="disabled" <% } %>/> / <%= grading.max_points %>\n                            <input type="hidden" name="idGrade" value="<%= grade.id %>">\n                        </li>\n                    </ul>\n                </form> \n                <% if(readonly == 0) {%>\n                <button href="#" class="btn right closeGradePop" data-dismiss="modal"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n                <button href="javascript:void(0);" id="saveGrade" data-gradeid="<%= grade.id %>" class="btn userDefaultBtn right" ><% print(_.escape(translate(\'global_save\'))) %></button>\n                <% } %>\n            </div>\n            <% } else { %>\n            <div class="rightDropbox">\n                <ul class="modalForm">\n                    <li class="clearfix">\n                        <% if(grading.published == \'1\' && grading.type != \'ungraded\') { %>\n                            <label><% print(translate(\'global_grade\')) %>:</label>\n                            <label><%= (grade.points !== null ? grade.points : \'\') %> / <%= grading.max_points %></label>\n                        <% } else { %>\n                            <% if(grading.type != \'ungraded\'){ %>\n                                <% if((!_.isEmpty(dropbox) && grading.type == \'assignment\') || (grading.type == \'test\') || (grading.type == \'quiz\') || (assignment.dropbox == \'0\')){%>\n                                <label class="waiting_grade"><% print(translate(\'waiting_for_grade\')) %></label>\n                                <% } else { %>\n                                <label class="waiting_grade"><% print(translate(\'not_submitted_yet\')) %></label>\n                                <% } %>\n                            <% } %>\n                        <% } %>\n                    </li>\n                </ul>\n            </div>\n            <% } %>\n            </div>\n        <div id="commentDropBoxContainer" class="clearfix"></div>\n         </div>\n         <% if(dropbox != null && !_.isEmpty(dropbox.previous)) { %>\n            <div class="tab-pane" id="previous_dropbox">\n                <% var total = dropbox.previous.length;\n                    _.each(dropbox.previous, function(prevItem) { %>\n                        <% if(total == 1) {%>\n                        <p class="revision"><%= translate(\'dropbox_original\')%></p>\n                        <% } else { %>\n                            <p class="revision"><%= translate(\'dropbox_revision\')%> <%= total%></p>\n                        <% } %>\n                        <% total--; %>\n                        \n                        <% _.each(prevItem.files, function(item) { %>\n                            <p><a href="<% print(BAppConfig.get(\'site_sections\', \'dropboxDownloadUrl\').replace(\'__fileid__\', item.id)) %>" id="download-file"><%= item.name %></a></p>\n                        <% }) %>\n                        <p><%= prevItem.description %></p>\n                        <p class="dropboxCreateDate">\n                            <%= (Utils.formatTimestamp(Date.parseExact(prevItem.created, \'yyyy-MM-dd HH:mm:ss\'))) %>\n                        </p>\n                <% }) %>\n            </div>\n        <% } %>\n        </div>\n        \n    </div>\n</script>\n<script type="text/template" id="grade_popup_footer">\n</script>\n'}),define("gradepopup/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("gradepopup_templates",n);return r}),define("gradepopup/views/gradepopup",["require","beyazpano","gradepopup/_templates","comment/views/comment","order!plupload","order!plupload.html4","order!plupload.html5","order!plupload.flash","order!file.attachments"],function(e,t,n,r){var i=Backbone.View.extend({templatesNames:{grade_popup_content:"grade_popup_content",grade_popup_footer:"grade_popup_footer"},additionalData:null,type:null,maxPoints:null,initialize:function(e){this.config={urlPopup:BAppConfig.get("site_assignment","ajaxUrlAssignmentsJson"),urlComment:BAppConfig.get("comment","getCommentsUrl"),urlGrade:BAppConfig.get("grading","ajaxUrlGradingJson"),urlMarkComment:BAppConfig.get("grading","siteMarkComment")},!_.isNull(e.type)&&!_.isUndefined(e.type)&&(this.type=e.type,this.initializeEventHandler(this))},initializeEventHandler:function(e){$("#saveGrade").live("click",_.bind(this.saveGrade,this)),$("#download-file").live("click",_.bind(this.downloadAssignment,this)),$("#save-submit-assignment").live("click",_.bind(this.saveDropboxAssignment,this)),$(".removeFile").live("click",_.bind(this.removeExistingFile,this)),$(".jqWriteComment").live("click",_.bind(this.scrollTo,this))},renderPopup:function(e){var t=e;if(typeof e.type=="undefined"||e.type=="")e.type=this.type;$.ajax({type:"POST",url:this.config.urlPopup+"/getdropbox",data:e,success:$.proxy(function(e){if(e.success){this.additionalData=e.data.grade,this.additionalData.isAdmin=e.data.isAdminOfSection,this.additionalData.publishStatus=e.data.grading.published;var n=$("#readonly").val();e.data.readonly=n;if(e.data.file){var i="";_.each(e.data.file,_.bind(function(e){i===""?i+=e.id:i=i+","+e.id},this)),e.data.fileIds=i,this.assignmentFileIds=i}var s=_.template($("#"+this.templatesNames.grade_popup_content).html(),e.data),o=_.template($("#"+this.templatesNames.grade_popup_footer).html(),e.data),u=translate("dropbox_title");this.type=="gradebook"&&(u=translate("grading_title")),Utils.popup(u,s,o),$("#_dialog_popup-footer").addClass("empty-footer"),$("#submissions a").click(function(e){e.preventDefault(),$(this).tab("show")}),e.data.grading.type!="ungraded"&&$("#gradeForm").validate(this.validateGrade),this.maxPoints=e.data.grading.max_points,e.data.isAdminOfSection||this.initFileAttachment();var a=e.data.grade.id,f=e.data.grading.idsection,l=$("#canCommentAssignment").val()==1?!0:!1,c=new r({el:"#commentDropBoxContainer",additionalData:{gradeId:a},showEmptyCommentBox:!0,canComment:l,readonly:n});$.ajax({type:"POST",url:this.config.urlComment,data:{entityId:a,entityType:"grading",todo:"refresh",additional:{gradeId:a},pageEntityId:f},success:$.proxy(function(e){var n={entityType:"grading",entityId:a,items:[],nrOfComments:0};_.isUndefined(e.data.comments[a])||(n=e.data.comments[a]),n.page_entity_id=f,c.renderComment(n,e.data.users,e.data.likes),l||$(".jqNewCommentContainer").hide();var r={gradeId:a,userRole:this.additionalData&&this.additionalData.isAdmin==1?"INSTRUCTOR":"STUDENT"};$.ajax({type:"POST",url:this.config.urlMarkComment,data:r,success:$.proxy(function(e){e.success==1&&(e.data.userRole=="STUDENT"?$("#"+t.idstudent).children("[aria-describedby='studentGradingTable_grading_"+t.idgrading+"']").children(".messagelink").removeClass("newMessage"):$("#"+t.idstudent).children("[aria-describedby='instructorGradingTable_grading_"+t.idgrading+"']").children(".editlink").removeClass("newMessageInstructor"))},this)},this)},this),dataType:"json"})}else document.location.href=e.data.url},this),dataType:"json"}).always(function(){Utils.unblock(".middleBar"),$("#dropbox-page").trigger("renderPopupFinished")})},validateGrade:{rules:{"data[points]":{maxlength:11}}},saveGrade:function(e){var t=$(e.currentTarget).attr("data-gradeid"),n=$("#points").val();isNaN(n)||$("#points").rules("add",{max:this.maxPoints});if($("#gradeForm").valid()){Utils.block("#_dialog_popup");var r=$("#gradeForm").serialize();$("#points").val()!=""&&this.additionalData&&this.additionalData.points!=$("#points").val()?$.ajax({type:"POST",url:this.config.urlGrade+"/updategrade",data:r,success:_.bind(function(e){e.success&&(Utils.unblock("#_dialog_popup"),$("#_dialog_popup").modal("hide"),this.type=="gradebook"&&($("#instructorGradingTable").trigger("reloadGrid"),$("#dropbox-page").trigger("reloadDropboxContainer")))},this),dataType:"json"}):(Utils.unblock("#_dialog_popup"),$("#_dialog_popup").modal("hide"))}},removeExistingFile:function(e){Utils.block("#_dialog_popup");var t=e.currentTarget;Utils.confirm(translate("site_library_delete_file"),translate("site_library_delete_file_confirmation_message"),function(e){if(e==="yes"){var n=$("#fileid-dropbox").val(),r=n.split(","),i=[],s=$(t).attr("id");for(var o in r)r[o]!=s&&i.push(r[o]);$("#fileid-dropbox").val(i.join(",")),$(t).parent().remove(),Utils.unblock("#_dialog_popup")}else Utils.unblock("#_dialog_popup")})},downloadAssignment:function(e){$("#downloadFileForm").submit()},initFileAttachment:function(){this.fileAttachment=new FileAttachments("#upload_assignment",{onFileAttached:_.bind(function(e,t){var n=$("#fileid-dropbox").val();n?$("#fileid-dropbox").val(n+","+e.fileId):$("#fileid-dropbox").val(e.fileId)},this),onFileRemoved:_.bind(function(e,t){var n=$("#fileid-dropbox").val(),r=n.split(","),i=[];for(var s in r)_.isNull(e)?i.push(r[s]):r[s]!==e.fileId&&i.push(r[s]);$("#fileid-dropbox").val(i.join(","))},this),clientUploader:BAppConfig.get("global","swfUploader"),uploaderUrl:BAppConfig.get("global","uploaderUrl"),fileSizeLimit:BAppConfig.get("global","max_file_size"),listContainer:"upload_assignment_list",blockContainer:!0,multiSelection:!0,blockButtonIdFileAttachment:"#save-submit-assignment"})},saveDropboxAssignment:function(e){if($("#fileid-dropbox").val()!==""||$.trim($("#uploadAssignmentForm textarea").val())!==""){$("#alert_submit_assignment div").remove(),Utils.block("#_dialog_popup");var t=$("#uploadAssignmentForm").serialize();$.ajax({type:"POST",url:this.config.urlPopup+"/sendassignment",data:t,success:$.proxy(function(e){if(!e.success){Utils.unblock("#_dialog_popup");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_submit_assignment")}else document.location.reload(!0)},this),dataType:"json"})}else Utils.flashMessage(Utils.FLASH_ERROR,"",translate("assignment_submission_warning"),"#alert_submit_assignment")},scrollTo:function(){var e=$("#_dialog_popup-body .modalContent");e.scrollTop(e.height())}});return i}),function($){var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},hasOwn=Object.prototype.hasOwnProperty;$.toJSON=typeof JSON=="object"&&JSON.stringify?JSON.stringify:function(e){if(e===null)return"null";var t,n,r,i,s=$.type(e);if(s==="undefined")return undefined;if(s==="number"||s==="boolean")return String(e);if(s==="string")return $.quoteString(e);if(typeof e.toJSON=="function")return $.toJSON(e.toJSON());if(s==="date"){var o=e.getUTCMonth()+1,u=e.getUTCDate(),a=e.getUTCFullYear(),f=e.getUTCHours(),l=e.getUTCMinutes(),c=e.getUTCSeconds(),h=e.getUTCMilliseconds();return o<10&&(o="0"+o),u<10&&(u="0"+u),f<10&&(f="0"+f),l<10&&(l="0"+l),c<10&&(c="0"+c),h<100&&(h="0"+h),h<10&&(h="0"+h),'"'+a+"-"+o+"-"+u+"T"+f+":"+l+":"+c+"."+h+'Z"'}t=[];if($.isArray(e)){for(n=0;n<e.length;n++)t.push($.toJSON(e[n])||"null");return"["+t.join(",")+"]"}if(typeof e=="object"){for(n in e)if(hasOwn.call(e,n)){s=typeof n;if(s==="number")r='"'+n+'"';else{if(s!=="string")continue;r=$.quoteString(n)}s=typeof e[n],s!=="function"&&s!=="undefined"&&(i=$.toJSON(e[n]),t.push(r+":"+i))}return"{"+t.join(",")+"}"}},$.evalJSON=typeof JSON=="object"&&JSON.parse?JSON.parse:function(str){return eval("("+str+")")},$.secureEvalJSON=typeof JSON=="object"&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+str+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(e){return e.match(escape)?'"'+e.replace(escape,function(e){var t=meta[e];return typeof t=="string"?t:(t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))})+'"':'"'+e+'"'}}(jQuery),define("jquery.json",function(){}),define("assignments/assignment",["require","beyazpano","assignments/_templates","default/views/siteHeader","default/views/siteLeftMenu","comment/views/comment","order!jquery.ui","order!jquery.ui.locale","order!jquery.validate","order!jquery.validate.messages_locale","attachment/views/component","autocomplete/views/autocomplete","gradepopup/views/gradepopup","order!jquery.timepicker","lightbox","jquery.json"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=function(){var e,n,o,u=!1,a,f="",p={popupassignment:"popup-assignment"},d={rules:{"data[points]":{required:!0,number:!0,max:100}}},v={rules:{"data[name]":{required:!0,minlength:2,maxlength:128},date:{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0},time:{required:!0,afterNow:!0},"data[points]":{required:!0,number:!0},"category[name]":{required:!0,minlength:2,maxlength:128},section_walls:{required:!0}},onfocusout:function(e){$(e).valid()},messages:{section_walls:{required:translate("home_mandatory_select_wall")}}},m={rules:{"data[description]":{required:!0}}};this.init=function(){e=BAppConfig.get("site_assignment","ajaxUrlAssignmentsJson"),n=BAppConfig.get("site_assignment","ajaxUrlAssignmentsHtml"),o=BAppConfig.get("comment","getCommentsUrl"),a=BAppConfig.get("global","currentLang"),a==="ar"&&(u=!0)},this.run=function(){this.init(),this.initComments(),this.initHandlers(),this.initGradepopup();var e=BAppConfig.get("site_sections","config").left_menu;_.each(e.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",$("#idsection").val())},this));var n=new i({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"assignments"});n.render(),r.render();var s=$(t.renderTemplate(p.popupassignment,{}));$("body").append(s)},this.initGradepopup=function(){this.gradePopup=new h({type:"gradebook"})},this.initHandlers=function(){$(".btn-group").button(),$(".add-assignment").live("click",_.bind(this.openPopupAddAssignmentClickHandler,this)),$(".edit-assignment").live("click",_.bind(this.openPopupEditAssignmentClickHandler,this)),$(".delete-assignment").live("click",_.bind(this.deleteAssignmentClickHandler,this)),$("#save-assignment").live("click",_.bind(this.saveAssignmentClickHandler,this)),$("#save-edit-assignment").live("click",_.bind(this.saveEditAssignmentClickHandler,this)),$("#ontime").live("click",_.bind(this.getDropboxAssignmentOntimeClickHandler,this)),$("#late").live("click",_.bind(this.getDropboxAssignmentLateClickHandler,this)),$("#received").live("click",_.bind(this.getDropboxAssignmentReceivedClickHandler,this)),$("#notsent").live("click",_.bind(this.getDropboxAssignmentNotSentClickHandler,this)),$('input[name="date"]').live("focusout",function(){$('input[name="time"]').trigger("focusout")}),$("#open-submit-assignment").live("click",_.bind(this.getDropboxDataStudent,this)),$(".dropbox-download").live("click",_.bind(this.getDropboxDataInstructor,this)),$(".empty-dropbox").live("click",_.bind(this.getStudentDataNoDropbox,this)),$("#dropbox-page").on("reloadDropboxContainer",_.bind(function(e,t){this.getDropboxAssignment(f)},this)),$(".att_lightbox").colorbox({transition:"none",width:"85%",height:"85%"})},this.initAttachments=function(){this.attachments=new Attachments("#attachments",{attachmentsContainer:"#attachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),canShare:!0,blockButtonId:"#save-assignment",initShareHandler:_.bind(l.getShareInitHandler(),this)})},this.initAttachmentsHome=function(){this.attachments=new Attachments("#attachmentsHome",{attachmentsContainer:"#attachmentsContainerHome",onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),canShare:!0,blockButtonId:"#post-assignment-btn",initShareHandler:_.bind(l.getShareInitHandler(),this)})},this.attachmentsChanged=function(){$('#addAssignmentForm input[name="attachments"]').val($.toJSON(this.attachments.getAttachments()))},this.initAttachmentsEdit=function(){var e=null;$("#prevattachments").val()&&(e=$.parseJSON($("#prevattachments").val())),this.attachments=new Attachments("#attachments",{attachmentsContainer:"#attachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsChangedEdit,this),onAttachmentRemoved:_.bind(this.attachmentsChangedEdit,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),attachments:e,canShare:!0,blockButtonId:"#save-edit-assignment",initShareHandler:_.bind(l.getShareInitHandler(),this)})},this.attachmentsChangedEdit=function(){$('#editAssignmentForm input[name="attachments"]').val($.toJSON(this.attachments.getAttachments()))},this.initFileAttachment=function(){this.fileAttachment=new FileAttachments("#upload_assignment",{onFileAttached:_.bind(function(e,t){$("#fileid-dropbox").val(e.fileId)},this),onFileRemoved:_.bind(function(e,t){},this),clientUploader:BAppConfig.get("global","swfUploader"),uploaderUrl:BAppConfig.get("global","uploaderUrl"),fileSizeLimit:BAppConfig.get("global","max_file_size"),listContainer:"upload_assignment_list",multiSelection:!1})},this.initialiseForm=function(e){var t=$(".datepicker-grading-period",e);t.datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",onSelect:function(){t.trigger("focusout")},yearRange:"1900:c+5",dateFormat:"dd-mm-yy",isRTL:u,minDate:new Date}),$(".timepicker").timeEntry({spinnerImage:"",show24Hours:!0}),$("#ungraded").is(":checked")&&$("#points-field").hide(),$('input[name="date"]').live("focusout",function(){$('input[name="time"]').trigger("focusout")}),$("#ungraded").click(function(){$("#ungraded").is(":checked")?($("#points-field").hide(),$("#warning").show()):($("#points-field").show(),$("#warning").hide())})},this.openPopupAddAssignmentClickHandler=function(e){Utils.block(".middleBar");var t=$(e.currentTarget).attr("id").replace("add-assignment-","");this.init(),$.ajax({type:"POST",url:n+"/addassignment",data:"idsection="+t,success:$.proxy(function(e){$("#popup_section").html(e),$("#popup_section").modal("show"),$(".questionTooltip").tooltip(),this.initialiseForm($("#popup_section")),$("#addAssignmentForm").validate(v),this.initAttachments();var t=$('#addAssignmentForm input[name="date"]'),n=$('#addAssignmentForm input[name="time"]');$.data(n[0],"dueDateSelect",t),$.data(t[0],"dueTimeSelect",n),$.data(n[0],"DueGlobal",{originalDueDateVal:"",originalDueTimeVal:""}),$.data(t[0],"DueGlobal",{originalDueDateVal:"",originalDueTimeVal:""})},this),dataType:"html"}).always(function(){Utils.unblock(".middleBar")})},this.saveAssignmentClickHandler=function(t){if($("#addAssignmentForm").valid()){Utils.block("#popup_section");var n=$("#addAssignmentForm").serialize();this.init(),$.ajax({type:"POST",url:e+"/saveassignment",data:n+"&idsection="+$("#idsection").val()+"&idcourse="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_section");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_assignment")}else document.location.reload(!0)},this),complete:function(e,t){t=="error"&&Utils.unblock("#popup_section")},dataType:"json"})}},this.postAssignment=function(t,n,r){t&&(this.init(),$.ajax({type:"POST",url:e+"/saveassignment",data:t,success:_.bind(function(e){typeof n=="function"&&n.apply(this,[e])},this),failure:_.bind(function(e){typeof r=="function"&&r.apply(this,[e])},this),dataType:"json"}))},this.saveEditAssignmentClickHandler=function(t){if($("#editAssignmentForm").valid()){Utils.block("#popup_section");var n=$("#editAssignmentForm").serialize();this.init(),$.ajax({type:"POST",url:e+"/saveassignment",data:n+"&idsection="+$("#idsection").val()+"&idcourse="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_section");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_edit_assignment")}else document.location.reload(!0)},this),dataType:"json"})}},this.deleteAssignmentClickHandler=function(t){this.init();var n=$(t.currentTarget).attr("id").replace("delete-assignment-",""),r=$(t.currentTarget).attr("data-ungraded");Utils.confirm(translate("delete_assignment"),r==1?translate("delete_ungraded_assignment"):translate("delete_assignment_content"),function(t){t=="yes"&&$.ajax({type:"POST",url:e+"/deleteassignment",data:{idassignment:n,idsection:$("#idsection").val()},success:$.proxy(function(e){e.success?document.location.href=e.data.url:Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"})})},this.initTriggerRenderPopupFinished=function(){$("#dropbox-page").on("renderPopupFinished",_.bind(function(){Utils.unblock("#dropbox-page")},this))},this.getDropboxDataStudent=function(e){Utils.block("#dropbox-page"),e.preventDefault();var t=$("#idsection").val(),n={idstudent:BAppConfig.get("mydata","id"),idgrading:$("#idgrading-dropbox").val(),gradingType:"assignment",sectionId:t};this.initTriggerRenderPopupFinished(),this.gradePopup.renderPopup(n)},this.getDropboxDataInstructor=function(e){Utils.block("#dropbox-page"),e.preventDefault();var t=$("#idsection").val(),n=$(e.target).attr("id").replace("id-student-",""),r={idStudent:n,type:"dropbox",idAssignment:assignmentId,gradingType:"assignment",sectionId:t};this.initTriggerRenderPopupFinished(),this.gradePopup.renderPopup(r)},this.getStudentDataNoDropbox=function(e){Utils.block("#dropbox-page"),e.preventDefault();var t=$("#idsection").val(),n=$(e.target).attr("id").replace("id-student-",""),r={idstudent:n,idAssignment:assignmentId,type:"dropboxnofile",gradingType:"assignment",sectionId:t};this.initTriggerRenderPopupFinished(),this.gradePopup.renderPopup(r)},this.openPopupEditAssignmentClickHandler=function(e){Utils.block(".middleBar");var t=$(e.currentTarget).attr("id").replace("edit-assignment-","");this.init(),$.ajax({type:"POST",url:n+"/editassignment",data:"idassignment="+t,success:$.proxy(function(e){if(e.success!==!1){$("#popup_section").html(e),$("#popup_section").modal("show"),$(".questionTooltip").tooltip(),this.initialiseForm($("#popup_section")),$("#editAssignmentForm").validate(v),this.initAttachmentsEdit();var t=$('#editAssignmentForm input[name="date"]'),n=$('#editAssignmentForm input[name="time"]');$.data(n[0],"dueDateSelect",t),$.data(t[0],"dueTimeSelect",n),$.data(n[0],"DueGlobal",{originalDueDateVal:t.val(),originalDueTimeVal:n.val()}),$.data(t[0],"DueGlobal",{originalDueDateVal:t.val(),originalDueTimeVal:n.val()})}},this),dataType:"html"}).always(function(){Utils.unblock(".middleBar")})},this.resetCodeAccessClickHandler=function(t){var n=$(t.target).attr("data-sectionid");Utils.confirm(translate("reset_access_code_title"),translate("reset_access_code_question"),function(t){t=="yes"&&(this.init(),$.ajax({type:"POST",url:e+"/resetaccesscode",data:"idaccesscode="+n,success:$.proxy(function(e){e.success?document.location.reload(!0):Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"}))})},this.saveDropboxAssignmentClickHandler=function(t){var n=$("#uploadAssignmentForm").serialize();this.init(),$.ajax({type:"POST",url:e+"/sendassignment",data:n,success:$.proxy(function(e){if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_submit_assignment");else document.location.reload(!0)},this),dataType:"json"})},this.getDropboxAssignmentLateClickHandler=function(e){this.getDropboxAssignment(1)},this.getDropboxAssignmentOntimeClickHandler=function(e){this.getDropboxAssignment(0)},this.getDropboxAssignmentNotSentClickHandler=function(e){this.getDropboxAssignment(2)},this.getDropboxAssignmentReceivedClickHandler=function(e){this.getDropboxAssignment("")},this.getDropboxAssignment=function(t){this.init(),f=t,$.ajax({type:"POST",url:e+"/getdropboxassignment",data:"idsection="+$("#idsection").val()+"&idassignment="+$("#idassignment").val()+"&status="+t,success:$.proxy(function(e){$("#dropbox-page").html(e.data.html);switch(t){case 1:$("#status_dropbox").html(translate("global_late"));break;case 0:$("#status_dropbox").html(translate("global_on_time"));break;case 2:$("#status_dropbox").html(translate("global_not_sent"));break;case"":$("#status_dropbox").html(translate("global_all"))}},this),dataType:"json"})},this.initComments=function(){if($("#idassignment").val()){this.init();var e=$("#idassignment").val(),t=$("#canCommentAssignment").val()==1?!0:!1,n=new s({el:"#commentFormContainer",additionalData:{assignmentId:e},showEmptyCommentBox:!0,canComment:t});$.ajax({type:"POST",url:o,data:{entityId:e,entityType:"assignment",todo:"refresh",additional:{assignmentId:e},pageEntityId:e},success:$.proxy(function(r){var i={entityType:"assignment",entityId:e,items:[],nrOfComments:0};_.isUndefined(r.data.comments[e])||(i=r.data.comments[e]),i.page_entity_id=e,n.renderComment(i,r.data.users,r.data.likes),t||$(".jqNewCommentContainer").hide()},this),dataType:"json"})}},this.setupAssignmentEventForm=function(){this.initialiseForm();if($("#addAssignmentForm").length>0){var e=$("#addAssignmentForm").validate(v);e.resetForm()}this.initAttachmentsHome(),this.initBrowse()},this.initBrowse=function(){BAppConfig.get("mydata","role")=="INSTRUCTOR"&&($("#event_type").val()==0&&$("#section_walls").val("1_"+BAppConfig.get("mydata","id")),this.autocomplete=new c({config:{containerId:"#autocomplete_event_walls_assignment",useWallBrowser:!0,useTokenInput:!0,wallBrowserWallsSelected:!0,wallBrowserWalls:{courses:jsCoursesInfo.user_admin_courses_data},browseButtonTitle:translate("wall_post_assignment_message"),wallType:"course",tokenInputSource:this.getWallListForTokenInput()}}),this.autocomplete.render(),this.autocomplete.on("ListChanged",_.bind(function(e){var t=e;$("#section_walls_assignment").val(t.join(",")),$("#addAssignmentForm").validate().element("#section_walls_assignment")},this)))},this.getWallListForTokenInput=function(){var e=[],t=jsCoursesInfo.user_admin_courses_data;for(var n in t){var r=t[n].name,i=t[n].sections;for(var s in i){var o=i[s].name,u=i[s].id;e.push({id:"3_"+u,name:r+":"+o})}}return e}};return p}),define("calendar/main",["require","beyazpano","jquery.calendar","order!jquery.ui","order!jquery.ui.locale","default/views/siteHeader","default/views/siteLeftMenu"],function(e,t,n,r,i,s,o){var u=function(){var e=!1,t;this.run=function(){t=BAppConfig.get("global","currentLang"),t==="ar"&&(e=!0),this.initMenus(),this.initCalendar()},this.initMenus=function(){s.render();var e=new o({el:"#content_left",config:BAppConfig.get("site_general","left_menu_general")});e.render()},this.initCalendar=function(){var t=$("#calendar");t.fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},timeFormat:"H:mm",axisFormat:"H:mm",allDayText:translate("all_day"),defaultView:$("#defaultMode").val(),monthNames:[translate("month_jan_long"),translate("month_feb_long"),translate("month_mar_long"),translate("month_apr_long"),translate("month_may_long"),translate("month_jun_long"),translate("month_jul_long"),translate("month_aug_long"),translate("month_sep_long"),translate("month_oct_long"),translate("month_nov_long"),translate("month_dec_long")],monthNamesShort:[translate("month_jan_short"),translate("month_feb_short"),translate("month_mar_short"),translate("month_apr_short"),translate("month_may_short"),translate("month_jun_short"),translate("month_jul_short"),translate("month_aug_short"),translate("month_sep_short"),translate("month_oct_short"),translate("month_nov_short"),translate("month_dec_short")],dayNames:[translate("day_sun_long"),translate("day_mon_long"),translate("day_tue_long"),translate("day_wed_long"),translate("day_thu_long"),translate("day_fri_long"),translate("day_sat_long")],dayNamesShort:[translate("day_sun_short"),translate("day_mon_short"),translate("day_tue_short"),translate("day_wed_short"),translate("day_thu_short"),translate("day_fri_short"),translate("day_sat_short")],buttonText:{today:translate("global_today"),month:translate("global_month"),week:translate("global_week"),day:translate("global_day")},firstDay:1,allDayDefault:!1,isRTL:e,eventSources:[{events:function(e,t,n){$.ajax({url:BAppConfig.get("site_calendar","ajaxAllListUrl"),dataType:"json",type:"POST",data:{start:Math.round(e.getTime()/1e3),end:Math.round(t.getTime()/1e3)},success:function(e){var t=[];if(e.success){var r=e.data.events,i=e.data.assignments,s=e.data.quizzes;for(var o in r){var u=r[o];switch(u.rsvp){case"0":u.color="#0099D5",u.textColor="#FFFFFF";break;case"1":u.color="#E83A3B",u.textColor="#FFFFFF";break;case"2":u.color="#52C23B",u.textColor="#FFFFFF";break;case"3":u.color="#E83A3B",u.textColor="#FFFFFF";break;case"4":u.color="#52C23B",u.textColor="#FFFFFF"}}for(var o in i){var a=i[o];a.color="#e87722",a.textColor="#FFFFFF"}for(var o in s){var f=s[o];f.color="#464BA5",f.textColor="#FFFFFF"}t=t.concat(r,i,s)}n(t)}})}}],viewDisplay:function(n){$('#calendar-navigation input[type="text"]').datepicker("destroy"),$("#calendar-navigation").remove();if(n.name=="agendaDay"||n.name=="agendaWeek"||n.name=="month"){$("#calendar .fc-header-left").append('<span style="margin-left:10px;" id="calendar-navigation" class="dateImputContainer"><input  style="position: relative; z-index: 1000;" type="text"></span>'),$('#calendar-navigation input[type="text"]').datepicker({dateFormat:"dd-mm-yy",isRTL:e,onSelect:_.bind(function(e,n){var r=$('#calendar-navigation input[type="text"]').datepicker("getDate");t.fullCalendar("gotoDate",r)},this)});var r=t.fullCalendar("getDate");$('#calendar-navigation input[type="text"]').datepicker("setDate",r)}}}),t.fullCalendar("gotoDate",new Date(parseInt($("#defaultDate").val())*1e3)),t.fullCalendar("getView").name=="basicDay"&&t.fullCalendar("changeView","agendaDay")}};return u}),define("calendar/smallCalendar",["require","beyazpano","order!jquery.ui","order!jquery.ui.locale"],function(e,t,n){var r=function(e){var t=!1,n;this.run=function(){BAppConfig.get("mydata","role")=="STUDENT"&&this.initEventCalendar()},this.initEventCalendar=function(){var r=BAppConfig.get("site_calendar","calendarDayUrl");n=BAppConfig.get("global","currentLang"),n==="ar"&&(t=!0),!_.isUndefined(e)&&!_.isEmpty(e)&&(this.unavailable=function(t){var n=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2);return $.inArray(n,e)<0?[!0,"",""]:[!0,"event",""]}),$("#datepicker-events").datepicker({dateFormat:"dd-mm-yy",isRTL:t,beforeShowDay:this.unavailable,onSelect:function(e){var t=r.replace("__date__",e);window.location.href=t}}),$("#open-calendar-events").live("click",function(){$("#datepicker-events").toggle()})}};return r}),define("text!course-library/templates.html",[],function(){return'<script type="text/template" id="site_course_library_container">  \n    <h3 class="blueTxt clearfix">\n        <a class="breakWord clearfix" href="<%= data.siteSectionUrl %>"> <%= data.siteSectionName %></a>\n    </h3>\n    <h2 class="contentHeadline clearfix" id="courseLibraryTitle"><%= translate(\'course_library_title\') %></h2>\n    <div class="filterContainer clearfix">\n        <div class="clearfix">\n            <div  class="left">\n                <div class="left settingsAll courseLibrarySettingsAll">\n                    <% if(data.permissions.groupOperations){ %>\n                    <input type="checkbox" class="jqSelectAll left"/>\n                    <div class="settingsDetails left">\n                        <div class="jqGroupOperations"></div>\n                    </div>\n                    <% } %>\n                    <% if(data.permissions[\'delete\']){ %>\n                    <button class="btn userDefaultBtn left" id="remove_course_files"><% print(_.escape(translate(\'site_library_remove_files\'))) %></button>\n                    <% } %>\n                    <% if(data.permissions.filter){ %>\n                    <select id="filterBy" class="selectType left">\n                        <option value="all"><% print(_.escape(translate(\'global_all\'))) %></option>\n                        <% _.each(data.extensions,function(item,text){ %>\n                        <option value="<%= text %>"><%= text %></option>\n                        <% }); %>\n                        <option value="other"><% print(_.escape(translate(\'global_other\'))) %></option>\n                    </select>\n                    <% } %>\n                </div>\n            </div>\n            <div class="right">\n                <div id="upload_file" class="right uploadFile">\n                    <% if(data.permissions.upload && data.readOnly == 0){ %>\n                    <button class="btn userDefaultBtn" id="upload_file_browse"><% print(_.escape(translate(\'global_upload\'))) %></button>\n                    <% } %>\n                </div>\n                <% if(data.permissions.share && data.readOnly == 0){ %>\n                <button class="btn userDefaultBtn" id="share_file_browse"><% print(_.escape(translate(\'site_library_share\'))) %></button>\n                <% } %>\n\n            </div>\n        </div>   \n        <div id="upload_file_list" class="libraryFileListContanier"></div>\n    </div>\n    <div id="file_list_container"></div>     \n</script>\n\n<script type="text/template" id="site_course_library_file_list">\n    <% if(files && files.length > 0){ %>\n    <table class="libraryTable">\n        <thead>\n            <tr>\n                <% if(permissions.groupOperations){ %>\n                <td class="checkboxCell">&nbsp;</td>\n                <% } %>\n                <td class="fileNameCell"><a id="jq_sort_name" href="javascript:void(0);"><%= translate(\'course_library_file_name\') %></a></td>\n                <% if(permissions.groupOperations){ %>\n                <td class="fileDescriptionCell"><a id="jq_sort_description" href="javascript:void(0);"><%= translate(\'course_library_description\') %></a></td>\n                <% }  else { %>\n                <td class="fileDescriptionCellS"><a id="jq_sort_description" href="javascript:void(0);"><%= translate(\'course_library_description\') %></a></td>\n                <% } %>\n                <td class="fileDateCell"><a id="jq_sort_date" href="javascript:void(0);"><%= translate(\'course_library_date\') %></a></td>\n                <td class="fileSmallCell"><a id="jq_sort_extension" href="javascript:void(0);"><%= translate(\'course_library_extension\') %></a></td>\n                <td class="fileSmallCell"><a id="jq_sort_size" href="javascript:void(0);"><%= translate(\'course_library_size\') %></a></td>\n                <td class="fileSmallCell"><%= translate(\'course_library_functions\') %></td>\n            </tr>\n        </thead>\n        <% _.each(files,function(item) {\n            var rawIdFile = item.id.substr(0, item.id.indexOf(\'_\'));\n            var getUrl = getFileUrl.replace(\'__FILE_ID__\', rawIdFile);\n        %>\n\n        <tr class="fileListItem clearfix jqFileItem <%= item[\'class\'] %>" id="<%= item.id %>">\n            <% if(permissions.groupOperations){ %>\n            <td class="libraryCheckbox"> <input type="checkbox" class="jqSelectFile" name="file[]" value="<%= item.id %>"/></td>\n            <% } %>\n            <td><div class="fileNameContainer left"></div><p class="filename left" id="<%= item.id %>_filename"><%= item.name %></p></td>\n            <% if(permissions.groupOperations){ %>\n            <td> <p class="description <% if(_.isEmpty(item.description)){ %>jqWriteDescription <% } %> " id="<%= item.id %>_description"><%= item.description %></p></td>\n            <% }  else { %>\n            <td> <p class="descriptionS <% if(_.isEmpty(item.description)){ %>jqWriteDescription <% } %>" id="<%= item.id %>_description"><%= item.description %></p></td>\n            <% } %>\n            <td><p class="date"><%= Utils.formatDate(item.created,\'dd MMM yyyy\') %></p></td> \n            <td><%= item.extension %></td>\n            <td><%= item.size %> MB</td>\n            <td class="courseSectionDetails"><%= _.template($(\'#site_course_library_file_operations\').html(), {permissions:permissions, getUrl:getUrl}) %></td>\n        </tr>\n        <% }) %>\n    </table>\n    <% } else{ %>\n    <div>\n        <%= translate(\'course_library_no_files\') %>\n    </div>\n    <% } %>\n</script>\n\n<script type="text/template" id="site_course_library_file_operations">\n    <% if(permissions.operationsAllowed){ %>\n    <div class="btn-group">\n        <button  class="dropdown-toggle courseSettingsDropdownToggle " data-toggle="dropdown"></button>\n        <ul class="dropdown-menu pull-right courseSettingsDropdownToggleBox">\n            <% if(permissions.download){ %>\n            <li class="jq_downloadFile"><a href=<%= \'"\'+getUrl+\'"\' %> class="download-file"><i class="btnicon-download"></i><% print(_.escape(translate(\'site_library_download_file\'))) %></a></li>\n            <% }if(permissions.copy){ %>\n            <li class="jq_copyCourseFile"><a href="#" class="copy-file"><i class="btnicon-copy"></i><% print(_.escape(translate(\'site_library_copy_file\'))) %></a></li>\n            <% } %>\n            <% if(permissions[\'delete\']){ %>\n            <li class="jq_deleteFile"><a href="#" class="delete-file"><i class="btnicon-delete"></i><% print(_.escape(translate(\'site_library_delete_file\'))) %></a></li>\n            <% } %>\n        </ul>\n    </div>\n    <% } %>\n</script>\n\n<script type="text/template" id="site_course_library_folder">\n    <div class="libraryFolderContainer <% if (data.permissions.create || data.permissions[\'delete\'] || data.permissions.rename) {%>\n                    <%= \'libraryFolderContainerPadding\' %> <%} %>" >\n        <%  if(data.permissions.create || data.permissions[\'delete\'] || data.permissions.rename){ %>\n            <div id="folder_action_buttons" class="libraryFolderActionButtons clearfix">\n                <% if(data.permissions.create && data.readOnly == 0){ %>\n                <button class="btn createFolder" id="create_folder" data-placement="bottom" \n                        data-original-title="<%= translate(\'help_add_folder\') %>"><span>&nbsp;</span></button>\n                <% } %>\n                <% if(data.permissions[\'delete\'] && data.readOnly == 0){ %>\n                <button class="btn deleteFolderDisabled" id="delete_folder"\n                        data-placement="bottom"\n                        data-original-title="<%= translate(\'help_delete_folder\') %>"><span>&nbsp;</span></button>\n                <% } %>\n                <% if(data.permissions.rename && data.readOnly == \'0\'){ %>\n                <button class="btn renameFolderDisabled" id="rename_folder"\n                        data-placement="bottom"\n                        data-original-title="<%= translate(\'help_rename_folder\') %>"><span>&nbsp;</span></button>\n                <% } %>\n            </div>\n        <% } %>    \n        <div id="folders" class="libraryFolderStructure"></div>\n       \n    </div>\n</script>\n'}),define("course-library/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("course_library_templates",n);return r}),define("course-library/views/courseLibrary",["require","beyazpano","../_templates","library/views/fileList","library/views/folderCollection","default/views/siteLeftMenu","library/views/shareFiles","order!plupload","order!plupload.html4","order!plupload.html5","order!plupload.flash","order!file.attachments","order!utils"],function(e,t,n,r,i,s,o){var u=Backbone.View.extend({templateNames:{main:"site_course_library_container",fileList:"site_course_library_file_list",folderList:"site_course_library_folder"},initialize:function(e){var t=$("#readOnly").val();this.config={ownerId:null,sectionId:null,type:"course",folderId:"",foldersContainer:"#folder-list",filesListContainer:"#file_list_container",filesContainer:"#file_list_container",shareUrl:BAppConfig.get("site_course_library","shareFile"),uploadUrl:BAppConfig.get("site_course_library","uploadFile"),groupUrl:BAppConfig.get("library","groupOperation"),readOnly:t},this.el="#content",this.filePermissions={operationsAllowed:!1,share:!1,sort:!1,filter:!0,"delete":!1,download:!1,copy:!1,rename:!1,groupOperations:!1,upload:!1},this.folderPermissions={create:!1,"delete":!1},this.sortBy=null,this.sortOrder="asc",e.config&&(this.config=_.extend(this.config,e.config)),e.filePermissions&&(this.filePermissions=_.extend(this.filePermissions,e.filePermissions)),e.folderPermissions&&(this.folderPermissions=_.extend(this.folderPermissions,e.folderPermissions));if(_.isEmpty(this.config.sectionId))var n=BAppConfig.get("site_course_library","config").left_menu;else{var n=BAppConfig.get("site_sections","config").left_menu;_.each(n.items,_.bind(function(e,t,n){e.id!="courselibrary"?e.url=e.url.replace("__SECTION_ID__",this.config.sectionId):e.url=""},this))}var o=new s({el:"#content_left",config:n,userid:BAppConfig.get("mydata","id"),selected_item:"courselibrary",insertMethod:"prepend"});o.render(),this.folders=new i({config:{ownerId:this.config.ownerId,el:"#folders",type:"course",showRoot:!1,initialFolderId:this.config.folderId!=""?this.config.folderId:"0"}}),this.files=new r({el:"#file_list_container",config:{ownerId:this.config.ownerId,type:this.config.type},templateNames:{fileList:this.templateNames.fileList},p:this.filePermissions}),$(this.config.foldersContainer).on("startUpload",_.bind(function(){Utils.block(this.config.foldersContainer),Utils.block(this.config.filesListContainer)},this)),$(this.config.foldersContainer).on("uploadFinished",_.bind(function(){Utils.unblock(this.config.foldersContainer),Utils.unblock(this.config.filesListContainer)},this))},render:function(){var e=BAppConfig.get("site_sections","sectionUrl");e=e.replace("__sectionid__",$("#sectionId").val());var n=$("#courseName").val(),r=$("#sectionName").val();_.isEmpty(r)&&(e="#"),_.isEmpty(r)||(n="<span>"+n+":</span>"+r);var i=$(t.renderTemplate(this.templateNames.main,{data:{permissions:this.filePermissions,siteSectionUrl:e,siteSectionName:n,extensions:BAppConfig.get("library","config").extensions,readOnly:this.config.readOnly}}));$(this.el).html(i),this.getSubfolders(),this.files.render(),this.config.folderId==""&&this.files.getFiles("0_"+this.config.ownerId+"_course"),this.initializeEventListeners(),this.filePermissions.share&&this.initializeShareFile(),this.filePermissions.upload&&this.initializeUploadFile()},getSubfolders:function(){var e=$(t.renderTemplate(this.templateNames.folderList,{data:{permissions:this.folderPermissions,readOnly:this.config.readOnly}}));$(this.config.foldersContainer).html(e),this.folders.render(),this.folders.on("folderSelected",_.bind(this.onFolderSelected,this)),$("#create_folder").click(_.bind(this.addFolder,this)),$("#delete_folder").click(_.bind(this.removeFolder,this)),$("#rename_folder").click(_.bind(this.renameFolder,this)),$("#create_folder,#delete_folder,#rename_folder").tooltip(),$("#content_left ul>li[class *= courselibraryMIcon]").click(_.bind(function(e){e.preventDefault(),this.getRootFiles()},this))},getRootFiles:function(){this.folders=new i({config:{ownerId:this.config.ownerId,el:"#folders",type:"course",showRoot:!1}}),this.folders.render(),this.folders.on("folderSelected",_.bind(this.onFolderSelected,this)),this.files.render(),this.files.getFiles("0_"+this.config.ownerId+"_course"),$("#delete_folder").removeClass("deleteFolder").addClass("deleteFolderDisabled"),$("#rename_folder").removeClass("renameFolder").addClass("renameFolderDisabled")},initializeEventListeners:function(){$(".plupload").live("hover",function(e){e.type=="mouseenter"&&($("#upload_file_browse").hasClass("backgroundBtnHover")||$("#upload_file_browse").addClass("backgroundBtnHover")),e.type=="mouseleave"&&$("#upload_file_browse").hasClass("backgroundBtnHover")&&$("#upload_file_browse").removeClass("backgroundBtnHover")}),$("#filterBy").change(_.bind(function(){this.files.changeFilterType($("#filterBy").val())},this)),$("#jq_sort_date,#jq_sort_extension,#jq_sort_name,#jq_sort_description,#jq_sort_size").live("click",_.bind(function(e){var t=$(e.currentTarget);switch(t.attr("id")){case"jq_sort_date":this.sortBy="created";break;case"jq_sort_extension":this.sortBy="extension";break;case"jq_sort_name":this.sortBy="name";break;case"jq_sort_description":this.sortBy="description";break;case"jq_sort_size":this.sortBy="size"}this.sortOrder=="desc"?this.sortOrder="asc":this.sortOrder="desc",this.files.changeSort(this.sortBy+"_"+this.sortOrder)},this));var e=$(this.config.filesContainer);$(this.el).find(".jqSelectAll").click(function(){$(this).is(":checked")?e.find(".jqSelectFile").attr("checked","checked"):e.find(".jqSelectFile").removeAttr("checked")}),this.files.on("updatedFileList",_.bind(function(e){$(this.el).find(".jqSelectAll").removeAttr("checked"),Utils.setZIndex("#file_list_container")},this)),$("#remove_course_files").on("click",_.bind(function(){var e=this.files.getSelectedFileIds();_.isEmpty(e)?Utils.alert(translate("site_course_library_remove_no_file_seleted_error_title"),translate("site_course_library_remove_no_file_seleted_error_message")):this.files.deleteFile(e,{url:this.config.groupUrl,ids:e})},this)),$(this.config.filesContainer).find(".jq_copyCourseFile").live("click",_.bind(function(e){var t=$(e.currentTarget).closest(".jqFileItem").attr("id"),n=new o({shareLibraryType:"user",shareLibraryOwnerId:BAppConfig.get("mydata","id"),type:"folderSelection"});n.on("share_selected_folder",_.bind(function(e){$.ajax(this.config.groupUrl,{type:"post",dataType:"json",data:{operation:"copyToOtherCollection",ids:[t],newFolder:e}}).success(_.bind(function(e,t,n){e!=undefined&&e.success==1?Utils.alert(translate("site_course_library_copy_to_library_success_title"),translate("site_course_library_copy_to_library_success_message")):Utils.alert(translate("error_title"),translate("error_message"))},this))},this)),n.showPopup()},this))},initializeShareFile:function(){$("#share_file_browse").live("click",_.bind(function(){var e=new o({shareLibraryType:"user",shareLibraryOwnerId:BAppConfig.get("mydata","id"),type:"fileSelection"}),t;try{t=this.folders.getSelectedFolderId(),t==null&&(t="0_"+this.config.ownerId+"_course")}catch(n){t="0_"+this.config.ownerId+"_course"}var r=t.split("_");e.on("share_selected_files",_.bind(function(e){$.ajax(this.config.shareUrl,{type:"post",dataType:"json",data:{ids:e,ownerId:this.config.ownerId,sectionId:this.config.sectionId,currentFolder:r[0]}}).success(_.bind(function(e,t,n){e!=undefined&&e.success==1?this.files.refresh():Utils.alert(translate("error_title"),translate("error_message"))},this))},this)),e.showPopup()},this))},initializeUploadFile:function(){var e=new FileAttachments("#upload_file",{onFileAttached:_.bind(function(e,t){var n;try{n=this.folders.getSelectedFolderId(),n==null&&(n="0_"+this.config.ownerId+"_course")}catch(r){n="0_"+this.config.ownerId+"_course"}var i=n.split("_");$.ajax(this.config.uploadUrl,{type:"post",dataType:"json",data:{id:e.fileId,ownerId:this.config.ownerId,sectionId:this.config.sectionId,folderId:i[0]}}).success(_.bind(function(e,t,n){e!=undefined&&e.success==1?this.files.refresh():Utils.alert(translate("error_title"),translate("error_message"))},this))},this),onFileRemoved:_.bind(function(e,t){},this),clientUploader:BAppConfig.get("global","swfUploader"),uploaderUrl:BAppConfig.get("global","uploaderUrl"),fileSizeLimit:BAppConfig.get("global","max_file_size"),removeCompleted:!0,removeTimeout:5,listContainer:"upload_file_list",blockButtonId:this.config.foldersContainer})},addFolder:function(){this.folders.addFolder()},removeFolder:function(){$("#delete_folder").hasClass("deleteFolder")&&(this.folders.on("folderRemoveFailure",function(){Utils.alert(translate("error_title"),translate("site_my_library_remove_folder_error"))}),this.folders.on("folderRemoved",_.bind(this.onFolderRemoved,this)),this.folders.deleteFolder())},renameFolder:function(){$("#rename_folder").hasClass("renameFolder")&&this.folders.renameSelectedFolder()},onFolderSelected:function(e){$("#delete_folder").removeClass("deleteFolderDisabled").addClass("deleteFolder"),$("#rename_folder").removeClass("renameFolderDisabled").addClass("renameFolder"),this.files.getFiles(e.id)},onFolderRemoved:function(){this.getRootFiles()}});return u}),define("course-library/main",["require","beyazpano","default/views/siteHeader","course-library/views/courseLibrary"],function(e,t,n,r){var i=function(){this.run=function(){n.render();var e=$("#courseId").val(),t=$("#sectionId").val(),i=$("#folderId").val(),s=$("#folderPermissions").val(),o=$("#filePermissions").val();o=$.parseJSON(o),s=$.parseJSON(s);var u=new r({config:{ownerId:t,sectionId:t,url:"",courseId:e,folderId:i},filePermissions:o,folderPermissions:s});u.render()}};return i}),define("text!courses/templates.html",[],function(){return'<script type="text/template" id="popup-course">\n    <section id="popup_edit_course" class="modal fade hide" data-backdrop="static"></section>\n\n    <section id="popup_edit_members" class="modal fade hide" data-backdrop="static">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3><%= translate(\'edit_members_section\') %></h3>\n            </div>\n        </div>\n        <div id="edit-members-content" class="modal-body editMembersPopup">\n\n        </div>\n        <div class="modal-footer editMembersFooter empty-footer">\n        <div class="modalFooterContainer modalFooterContainerUser">\n                <div class="modalButtons">         \n                </div>\n        </div>\n        </div>\n    </section>\n    \n    <section id="popup_add_course" class="modal fade hide" data-backdrop="static">\n\n    <div class="modal-header ">\n        <div class="modalHeaderContainer">\n            <a class="close" data-dismiss="modal"></a>\n            <h3><%= translate(\'create_course\') %></h3>\n        </div>\n    </div>\n    <div class="modal-body">\n		<div class="modalContent">\n			<div id="alert_course" ></div>\n			<form name="addCourseForm" id="addCourseForm" method="POST" action="">\n				<ul class="modalForm">\n					<li class="clearfix">\n						<label><%= translate(\'course_name\') %>:</label>\n						<input type="text"  name="course[name]" id="name"/>\n					</li>\n					\n					<li class="clearfix">\n						<label><%= translate(\'section_name\') %>:</label>\n						<input type="text"  name="section[name]" id="section"/>\n					</li>\n                                        <li class="clearfix">\n                                            <label><% print(_.escape(translate(\'education_level\'))) %>:</label>\n                                            <select name="section[education_level]">\n                                                <option value=""><%= translate(\'global_select\') %></option>\n                                                <option value="1"><%= translate(\'primary_school_1\') %></option>\n                                                <option value="2"><%= translate(\'primary_school_2\') %></option>\n                                                <option value="3"><%= translate(\'primary_school_3\') %></option>\n                                                <option value="4"><%= translate(\'primary_school_4\') %></option>\n                                                <option value="5"><%= translate(\'primary_school_prep\') %></option>\n                                                <option value="6"><%= translate(\'elementary_school_1\') %></option>\n                                                <option value="7"><%= translate(\'elementary_school_2\') %></option>\n                                                <option value="8"><%= translate(\'elementary_school_3\') %></option>\n                                                <option value="9"><%= translate(\'elementary_school_4\') %></option>\n                                                <option value="10"><%= translate(\'high_school_prep\') %></option>\n                                                <option value="11"><%= translate(\'high_school_1\') %></option>\n                                                <option value="12"><%= translate(\'high_school_2\') %></option>\n                                                <option value="13"><%= translate(\'high_school_3\') %></option>\n                                                <option value="14"><%= translate(\'high_school_4\') %></option>\n                                                <option value="15"><%= translate(\'undergraduated_university\') %></option>\n                                                <option value="16"><%= translate(\'postgraduated_university\') %></option>\n                                                <option value="17"><%= translate(\'other_educational_institutions\') %></option>\n                                            </select>\n                                        </li>\n					<!--don\'t delete code below because it will be used in future to grading periods-->\n<!--					<li>\n					    <label><?php echo $this->translate(\'grading_period_select\'); ?>:</label>\n					    <select name="gradingPeriod" class="gradingPeriod" >\n						<?php if(!empty($this->gradingPeriods )){?>\n						    <?php foreach($this->gradingPeriods as $gradingPeriod){?>\n							<option value="<?php echo date(\'Y-m-d\',strtotime($gradingPeriod[\'start_date\'])).\'#\'.date(\'Y-m-d\',strtotime($gradingPeriod[\'end_date\']));?>">\n							    <?php echo $this->formatDate($gradingPeriod[\'start_date\']).\' - \'.$this->formatDate($gradingPeriod[\'end_date\']);?>\n							</option>\n						    <?php }?>\n						<?php }else{?>\n							<option value=""><?php echo $this->translate(\'no_grading_periods\');?></option>\n					        <?php }?>\n					    </select>\n					</li>-->\n\n<!--					<li class="grading-period-list dateImputContainer clearfix">\n						<label><?php echo $this->translate(\'grading_period\'); ?>:</label>\n						<ul class="addGradingPeriod dateInputlist" id="grading-period-all0">\n								<li><input type="text" class="datepicker-grading-period-start" name="section[start_date]" id="start_date_section" placeholder="<?php echo $this->translate(\'global_start\'); ?>"/></li>\n								<li><input type="text"  class="datepicker-grading-period-end" name="section[end_date]"  id="end_date_section" placeholder="<?php echo $this->translate(\'global_end\'); ?>"/></li>\n							</ul>\n					</li>-->\n					<li>\n						<p class="gradingPeriodError"></p>\n					</li>\n					<li>\n                                            <!--don\'t delete code below because it will be used in future-->\n						<p class="checkBoxContainer"><input type="checkbox"  name="course[moderation]" id="moderation" value="1"/><label for="moderation"><%= translate(\'course_enable_moderation\') %></label><a class="question" href="javascript:void(0);" data-placement="top" data-original-title="<%- translate(\'help_info_courses\') %>"> ?</a></p>\n\n						<p class="checkBoxContainer"><input type="checkbox"  name="course[membership]" id="membership" value="1"/><label for="membership"><%= translate(\'course_membership\') %></label><a class="question" href="javascript:void(0);" data-placement="top" data-original-title="<%- translate(\'course_membership_info\') %>"> ?</a></p>\n                        \n					</li>\n<!--					<p class="generalError" style="display: none">Please enter a valid date.</p>-->\n					<input type="hidden" name="section[privacy]"  value="0">\n				</ul>\n			</form>\n		</div>\n    </div>\n    <div class="modal-footer">\n        <div class="modalFooterContainer modalFooterContainerUser">\n            <div class="modalButtons">\n                <button  id="save-course" href="#" class="btn userDefaultBtn" id="_dialog_confirm-yesbtn"><% print(_.escape(translate(\'save\'))) %></button>\n                <button href="#" class="btn" data-dismiss="modal"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n            </div>\n        </div>\n    </div>\n</section>\n    \n</script>\n\n<script type="text/template" id="site_user_courses">\n    <ul class="courses" id="<%= id %>">\n        <li><h2>Your Courses</h2></li>\n        <li>\n            <h3>Saturday, April 21, 2012</h3>\n            <ul>\n                <li><a href="#">Design Class (Beginners)</a></li>\n                <li><a href="#">Design Class (Masters)</a></li>\n            </ul>\n        </li>\n        <li>\n            <h3>Friday, April 27, 2012t</h3>\n            <ul>\n                <li><a href="#">SEO Class (Beginners)</a></li>\n                <li><a href="#">SEO Class (Masters)</a></li>\n            </ul>\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="grading-period-content">\n    <li class="addGradingPeriod" id="grading-period-all<%= id %>">\n        <input type="text" class="required" name="newgradingperiod[title][<%= id %>]"  placeholder="<% print(_.escape(translate(\'title_grading_period_placeholder\'))) %>"/>\n        <input type="text" class="datepicker-grading-period required" name="newgradingperiod[start_date][<%= id %>]"  placeholder="<% print(_.escape(translate(\'global_start\'))) %>"/>\n        <input type="text" class="datepicker-grading-period required" name="newgradingperiod[end_date][<%= id %>]"  placeholder="<% print(_.escape(translate(\'global_end\'))) %>"/>\n        <button class="hide-grading-period close" id="grading-period-hide<%= id %>">×</button>\n    </li>\n</script>\n'}),define("courses/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("courses_templates",n);return r}),define("courses/views/userCourses",["require","beyazpano","courses/_templates"],function(e,t,n,r,i){var s=Backbone.View.extend({templateNames:{main:"site_user_courses"},config:{},initialize:function(e){e.config&&(this.courses=e.courses),_.isUndefined(e.userid)?this.config.userid=BAppConfig.get("mydata","id"):this.userid=e.userid},render:function(){var e={id:$(this.el).attr("id")+"_user_courses"},n=$(t.renderTemplate(this.templateNames.main,e));n.hide(),$(this.el).find("#"+e.id).length==0?$(this.el).html(n.innerHTML):$(this.el).find("#"+e.id).replaceWith(n),n.fadeIn(400)}});return s}),define("courses/main",["require","beyazpano","courses/views/userCourses"],function(e,t,n){var r=function(){this.run=function(){$("#add-course").click(function(){$("#popup_add_course").modal("show")})}};return r}),define("text!section/templates.html",[],function(){return'<script type="text/template" id="section_updates">\n    <div id="post_updates_container" class="postUpdatesContainer"></div>\n    <div id="updates_list_container"></div>\n</script>\n\n<script type="text/template" id="join_section">\n    <div id="popup_join_course" class="modal fade hide" data-backdrop="static">\n	<div class="modal-header">\n	    <div class="modalHeaderContainer">\n		<a class="close" data-dismiss="modal"></a>\n		<h3><%= translate(\'join_course_access_code\') %></h3>\n	    </div>\n	</div>\n	<div class="modal-body">\n	    <div id="join_course">\n		<div class="modalContent">\n		    <div id="alert_access_code"></div>\n		    <form name="access-code-form-course" id="access-code-form-course" action="" method="post">\n			<ul class="modalForm">\n			    <li>\n				<label><%= translate(\'join_access_code\') %>:</label>\n				<input type="text" class="required" name="accesscode" id="access-code" />\n				<input type="hidden" id="joinSectionSectionId" name="sectionid" value="<%= sectionId %>"/>\n\n			    </li>\n			</ul>\n		    </form>\n		</div>\n	    </div>\n	</div>\n	<div class="modal-footer">\n	    <div class="modalFooterContainer modalFooterContainerUser">\n		<div class="modalButtons">\n		    <button  id="access-code-button-course" href="#" class="btn userDefaultBtn" id="_dialog_confirm-yesbtn"><%= translate(\'student_access_code_continue\') %></button>\n		    <button href="#" class="btn" data-dismiss="modal"><%= translate(\'global_cancel\') %></button>\n		</div>\n	    </div>\n	</div>\n    </div>\n</script>'}),define("section/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("section_templates",n);return r}),define("section/views/joinSection",["require","beyazpano","section/_templates","order!jquery.ui","order!jquery.validate","order!jquery.validate.messages_locale"],function(e,t,n){var r=Backbone.View.extend({ajaxUrlCourses:BAppConfig.get("site_courses","ajaxUrlCourses"),validateJoinCourse:{rules:{accesscode:{required:!0}}},initialize:function(e){this.onSuccess=_.isUndefined(e.onSuccess)?null:e.onSuccess},run:function(){},showPopup:function(e){_.isUndefined(e)&&(e="");var n=$(t.renderTemplate("join_section",{sectionId:e})),r=n.find("#access-code-form-course");r.get(0).reset();var i=r.validate(this.validateJoinCourse);i.resetForm(),this.initEventHandlers(n),(navigator.appName=="Opera"||navigator.appVersion.indexOf("MSIE 10")!=-1)&&n.attr("class","modal hide"),n.modal("show")},initEventHandlers:function(e){e.find("#access-code-button-course").click(_.bind(function(){var t=e.find("#access-code-form-course");if(t.valid()){Utils.block("#popup_join_course");var n=t.serialize();$.ajax({type:"POST",url:this.ajaxUrlCourses+"/joincourse",data:n,success:$.proxy(function(t){if(!t.success)for(var n in t.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",t.msg[n],e.find("#alert_access_code"),"",!0);else _.isFunction(this.onSuccess)&&(this.onSuccess({accessCode:e.find("#access-code").val(),sectionId:e.find("#joinSectionSectionId").val(),idSection:t.data.sectionId,courseMembership:t.data.courseMembership}),e.modal("hide"))},this),complete:function(){Utils.unblock("#popup_join_course")},dataType:"json"})}},this))}});return r}),define("text!section-members/templates.html",[],function(){return'<script type="text/template" id="sectionMembers">\r\n    <div id="edit_course" >\r\n        <div id="error_message_members"></div>\r\n        <div class="modalContent">\r\n            <ul class="nav nav-tabs clearfix tabs" id="tabs_sufm">\r\n                <li id="all_tab" <% if(tab == \'all_tab\'){ %> class="active" <% } %>><a href="#all" data-toggle="tab"><%= translate(\'label_all\') %></a></li>\r\n                <li id="members_tab" <% if(tab == \'members_tab\'){ %> class="active" <% } %>><a href="#members" data-toggle="tab"><%= translate(\'label_members\') %></a></li>\r\n                <li id="admins_tab" <% if(tab == \'admins_tab\'){ %> class="active" <% } %>><a href="#admins" data-toggle="tab"><%= translate(\'label_admins\') %></a></li>\r\n            </ul>\r\n            \r\n            <div id="myTabContent" class="tab-content">\r\n            <% if(tab == \'all_tab\') { %>\r\n                <div class="tab-pane fade active in"  id="all">\r\n            <% } else { %>    \r\n                <div class="tab-pane fade"  id="all">\r\n            <% } %>\r\n                </div>\r\n                \r\n            <% if(tab == \'members_tab\') { %>                \r\n                <div class="tab-pane fade active in" id="members" >\r\n            <% } else { %>     \r\n                <div class="tab-pane fade" id="members" >\r\n            <% } %>                \r\n                </div>\r\n            \r\n            <% if(tab == \'admins_tab\') { %>  \r\n                <div class="tab-pane fade active in" id="admins">\r\n            <% } else { %> \r\n                <div class="tab-pane fade" id="admins">\r\n            <% } %>    \r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>  \r\n\r\n<input type="hidden" name="idEntity" id="idEntity" value="<%= data.idEntity %>">\r\n</script>\r\n\r\n\r\n\r\n<script type="text/template" id="allMembers">\r\n<% if (_.isUndefined(data.allMembers) !== true) { %>\r\n<ul>\r\n<% _.each(data.allMembers, function(member) { %>\r\n        <li class="memberList clearfix">\r\n            <img src="<%= (_.isUndefined(member.avatarUrl) == true ? member.avatar:member.avatarUrl)%>" class="thumb_members"/>\r\n            <h4 ><a class="left" href="<%= userProfileLink + member.id %>"><%= member.first_name + \' \' + member.last_name %></a>\r\n                <% if (member.isadmin == true) { %>\r\n                    <i class="adminIcon"></i>\r\n                <% } else if (member.role == "INSTRUCTOR") { %>\r\n                    <i class="instructorIcon"></i>\r\n                <% } else if (member.role == "STUDENT") { %>\r\n                    <i class="studentIcon"></i>\r\n                <% } %>\r\n            </h4>\r\n            <% if (member.id != data.currentUserId) { %>\r\n            <%  if (_.isEmpty(member.permission) !== true) { %> \r\n                <div class="settingsDetails">\r\n                    <div class="btn-group">\r\n                        <button  class="dropdown-toggle courseSettingsDropdownToggle " data-toggle="dropdown"></button>\r\n                        <ul class="dropdown-menu pull-right courseSettingsDropdownToggleBox" >\r\n                            <% if (member.permission.messaging) { %>\r\n                                <li><a href="<%= sendMessageLink + member.id %>"><i class="btnicon-sendMessage"></i><%= translate(\'send_message_member\') %></a></li>\r\n                            <% } %>\r\n                            <% if (member.permission.makeadmin && data.readOnly == 0) { %>\r\n                                <li><a class="make-admin" id="make-admin-<%= member.id %>"  href="#" ><i class="btnicon-make-admin"></i><%= translate(\'make_admin\') %></a></li>\r\n                            <% } %>\r\n                            <% if (member.permission.removeadmin && data.readOnly == 0) { %>\r\n                                <li><a class="remove-admin" id="remove-admin-<%= member.id %>"  href="#" ><i class="btnicon-remove"></i><%= translate(\'remove_admin\') %></a></li>    \r\n                            <% } %>\r\n                            <% if (member.permission.remove && data.readOnly == 0) { %>\r\n                                <li><a class="remove-member" id="remove-member-<%= member.id %>"  href="#" ><i class="btnicon-remove"></i><%= (data.entityType == \'section\' ? translate(\'remove_member\'):translate(\'remove_member_group\')) %></a></li>\r\n                            <% } %>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            <% } %>                                    \r\n            <% } %>                                    \r\n         </li>\r\n<% }) %>\r\n</ul>\r\n    <% if (data.noOfMembersPages != 1) { %>\r\n        <div class="modalFooterContainer">\r\n            <div class="pagination">\r\n                <ul><%\r\n                    var i = 1;\r\n                    while (i <= data.noOfMembersPages) {\r\n                        if (data.noOfMembersPages != 1) { %>\r\n                            <li <%= (data.currentPage == (i)) ? \'class="active"\':\'\' %>>\r\n                                <a class="next-page-members" data-entity="1"  id="next-page-<%= (i) %>" href="#"><%= i %></a>\r\n                            </li>\r\n                            <%\r\n                        }\r\n                        i++;\r\n                    }\r\n                    %>\r\n                </ul>\r\n            </div>\r\n\r\n        </div>\r\n    <% } else { %>\r\n        <input type="hidden" class="next-page-members" class="active" id="next-page-0" name="next-page-members">\r\n    <% } %>                        \r\n<% } %>    \r\n</script>\r\n\r\n<script type="text/template" id="paginationMembers">\r\n<% if (_.isUndefined(data.students) !== true) { %>\r\n    <ul>\r\n        <% _.each(data.students, function(student) { %>\r\n            <li class="memberList clearfix" id="student">\r\n            <img src="<%= (_.isUndefined(student.avatarUrl) == true ? student.avatar:student.avatarUrl)%>" class="thumb_members"/>\r\n                <h4>\r\n                    <a href="<%= userProfileLink + student.id %>"><%= student.first_name + \' \' + student.last_name %></a>\r\n                    <% if (student.role == "INSTRUCTOR") { %>\r\n                        <i class="instructorIcon"></i>\r\n                    <% } else if (student.role == "STUDENT") { %>\r\n                        <i class="studentIcon"></i>\r\n                    <% } %>\r\n                </h4>\r\n                <% if (student.id != data.currentUserId) { %>\r\n                <%  if (_.isEmpty(student.permission) !== true) { %> \r\n                    <div class="settingsDetails">\r\n                        <div class="btn-group">\r\n                            <button  class="dropdown-toggle courseSettingsDropdownToggle " data-toggle="dropdown"></button>\r\n                            <ul class="dropdown-menu pull-right courseSettingsDropdownToggleBox" >\r\n                                <% if (student.permission.messaging) { %>\r\n                                    <li><a href="<%= sendMessageLink + student.id %>"><i class="btnicon-sendMessage"></i><%= translate(\'send_message_member\') %></a></li>\r\n                                <% } %>\r\n                                <% if (student.permission.makeadmin && data.readOnly == 0) { %>\r\n                                    <li><a class="make-admin" id="make-admin-<%= student.id %>"  href="#" ><i class="btnicon-make-admin"></i><%= translate(\'make_admin\') %></a></li>\r\n                                <% } %>\r\n                                <% if (student.permission.removeadmin && data.readOnly == 0) { %>\r\n                                    <li><a class="remove-admin" id="remove-admin-<%= student.id %>"  href="#" ><i class="btnicon-remove"></i><%= translate(\'remove_admin\') %></a></li>    \r\n                                <% } %>\r\n                                <% if (student.permission.remove && data.readOnly == 0) { %>\r\n                                    <li><a class="remove-member" id="remove-member-<%= student.id %>"  href="#" ><i class="btnicon-remove"></i><%= (data.entityType == \'section\' ? translate(\'remove_member\'):translate(\'remove_member_group\')) %></a></li>\r\n                                <% } %>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                <% } %>\r\n                <% } %>\r\n            </li>\r\n        <% }) %>\r\n    </ul>\r\n        <% if (data.noOfStudentsPages != 1) { %>\r\n            <div class="modalFooterContainer">\r\n                <div class="pagination">\r\n                    <ul><%\r\n                        var i = 1;\r\n                        while (i <= data.noOfStudentsPages) {\r\n                            if (data.noOfStudentsPages != 1) { %>\r\n                                <li <%= (data.currentPage == (i)) ? \'class="active"\':\'\' %>>\r\n                                    <a class="next-page-members"  data-entity="2" id="next-page-<%= (i) %>" href="#"><%= i %></a>\r\n                                </li>\r\n                                <%\r\n                            }\r\n                            i++;\r\n                        }\r\n                        %>\r\n                    </ul>\r\n                </div>\r\n\r\n            </div>\r\n        <% } else { %>\r\n            <input type="hidden" class="next-page-members"  id="next-page-0" name="next-page-members">\r\n        <% } %>                          \r\n<% } %>    \r\n</script>\r\n\r\n<script type="text/template" id="paginationAdmins">\r\n<% if (_.isUndefined(data.admins) !== true) { %>\r\n    <ul>\r\n        <% _.each(data.admins, function(admin) { %>\r\n            <li class="memberList clearfix">\r\n                <img src="<%= (_.isUndefined(admin.avatarUrl) == true ? admin.avatar:admin.avatarUrl)%>" class="thumb_members"/>\r\n                <h4><a href="<%= userProfileLink + admin.id %>"><%= admin.first_name + \' \' + admin.last_name %></a>\r\n                    <i class="adminIcon"></i>\r\n                </h4>\r\n\r\n                <% if (admin.id != data.currentUserId) { %>\r\n                    <%  if (_.isEmpty(admin.permission) !== true) { %> \r\n                    <div class="settingsDetails">\r\n                        <div class="btn-group">\r\n                            <button  class="dropdown-toggle courseSettingsDropdownToggle " data-toggle="dropdown"></button>\r\n                            <ul class="dropdown-menu pull-right courseSettingsDropdownToggleBox" >\r\n                                <% if (admin.permission.messaging) { %>\r\n                                    <li><a href="<%= sendMessageLink + admin.id %>"><i class="btnicon-sendMessage"></i><%= translate(\'send_message_member\') %></a></li>\r\n                                <% } %>\r\n                                <% if (admin.permission.makeadmin && data.readOnly == 0) { %>\r\n                                    <li><a class="make-admin" id="make-admin-<%= admin.id %>"  href="#" ><i class="btnicon-make-admin"></i><%= translate(\'make_admin\') %></a></li>\r\n                                <% } %>\r\n                                <% if (admin.permission.removeadmin && data.readOnly == 0) { %>\r\n                                    <li><a class="remove-admin" id="remove-admin-<%= admin.id %>"  href="#" ><i class="btnicon-remove"></i><%= translate(\'remove_admin\') %></a></li>    \r\n                                <% } %>\r\n                                <% if (admin.permission.remove && data.readOnly == 0) { %>\r\n                                    <li><a class="remove-member" id="remove-member-<%= admin.id %>"  href="#" ><i class="btnicon-remove"></i><%= (data.entityType == \'section\' ? translate(\'remove_member\'):translate(\'remove_member_group\')) %></a></li>\r\n                                <% } %>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                <% } %>\r\n                <% } %>\r\n            </li>\r\n        <% }) %>\r\n    </ul>\r\n        <% if (data.noOfAdminPages != 1) { %>\r\n            <div class="modalFooterContainer">\r\n                <div class="pagination">\r\n                    <ul><%\r\n                        var i = 1;\r\n                        while (i <= data.noOfAdminPages) {\r\n                            if (data.noOfAdminPages != 1) { %>\r\n                                <li <%= (data.currentPage == (i)) ? \'class="active"\':\'\' %>>\r\n                                    <a class="next-page-members" data-entity="3" id="next-page-<%= (i) %>" href="#"><%= i %></a>\r\n                                </li>\r\n                                <%\r\n                            }\r\n                            i++;\r\n                        }\r\n                        %>\r\n                    </ul>\r\n                </div>\r\n\r\n            </div>\r\n        <% } else { %>\r\n            <input type="hidden" class="next-page-members"  id="next-page-0" name="next-page-members">\r\n        <% } %>                           \r\n<% } %>    \r\n</script>\r\n   '}),define("section-members/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("section-members_templates",n);return r}),define("section-members/views/sectionMembersView",["require","beyazpano","section-members/_templates"],function(e,t,n){var r=Backbone.View.extend({templateNames:{main:"sectionMembers",template_all_members:"allMembers",template_members:"paginationMembers",template_admins:"paginationAdmins",input_hidden_ids:"courseSectionIds"},initialize:function(e){if(_.isUndefined(e)===!1){var t=$(".tab-content").siblings(".nav.nav-tabs").children(".active"),n=t.attr("id");_.isUndefined(n)===!1&&(e.tab=n),this.config={userProfileLink:BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",""),sendMessageLink:BAppConfig.get("site_messages","compose_for_user").replace("__id__",""),idEntity:e.idEntity,offset:e.offset,tab:_.isUndefined(n)===!1?n:e.tab,ajaxUrl:e.ajaxUrl,limit:e.limit,siteSectionUrl:BAppConfig.get("site_courses","coursesListUrl"),siteGroupUrl:BAppConfig.get("site_groups","ajaxUrlGroups")}}},updateView:function(e){var t=$(".tab-content").siblings(".nav.nav-tabs").children(".active"),n=t.attr("id");_.isUndefined(n)===!1&&(e.tab=n),this.config={userProfileLink:BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",""),sendMessageLink:BAppConfig.get("site_messages","compose_for_user").replace("__id__",""),idEntity:e.idEntity,offset:e.offset,limit:e.limit,tab:_.isUndefined(n)===!1?n:e.tab,ajaxUrl:e.ajaxUrl},this.render(!1)},render:function(e){_.isUndefined(e)===!0&&this.initHandlers();var n={entityId:this.config.idEntity,offset:this.config.offset,limit:this.config.limit};$.ajax({url:this.config.ajaxUrl,type:"POST",data:n,success:$.proxy(function(e){if(e.success==1){e.userProfileLink=this.config.userProfileLink,e.sendMessageLink=this.config.sendMessageLink,e.tab=this.config.tab;var n=t.renderTemplate(this.templateNames.main,e),r=t.renderTemplate(this.templateNames.template_all_members,e),i=t.renderTemplate(this.templateNames.template_members,e),s=t.renderTemplate(this.templateNames.template_admins,e);$("#edit-members-content").html(n),$("#all").html(r),$("#members").html(i),$("#admins").html(s)}else e.entityType=="section"?document.location=this.config.siteSectionUrl:document.location=this.config.siteGroupUrl},this)})},initHandlers:function(){$(".next-page-members").live("click",_.bind(this.pagination,this)),$(".remove-member").live("click",_.bind(function(e){this.trigger("removeMemberFromGroup",e)},this)),$(".remove-admin").live("click",_.bind(function(e){this.trigger("removeAdmin",e)},this)),$(".make-admin").live("click",_.bind(function(e){this.trigger("makeAdmin",e)},this))},pagination:function(e){var n=$(e.currentTarget).data("entity"),r=$("#idEntity").val();if($(".next-page-members").attr("id"))var i=$(e.currentTarget).attr("id").replace("next-page-","");else var i=0;var s={entityId:r,offset:i,entityType:n,limit:10};$.ajax({url:this.config.ajaxUrl,type:"POST",data:s,success:$.proxy(function(e){e.offset=i,e.userProfileLink=this.config.userProfileLink,e.sendMessageLink=this.config.sendMessageLink;switch(n){case 1:var r=t.renderTemplate(this.templateNames.template_all_members,e);$("#all").html(r);break;case 2:var s=t.renderTemplate(this.templateNames.template_members,e);$("#members").html(s);break;case 3:var o=t.renderTemplate(this.templateNames.template_admins,e);$("#admins").html(o)}},this)})}});return r}),define("courses/membersManagement",["require","beyazpano","section-members/views/sectionMembersView"],function(e,t,n){var r=BAppConfig.get("site_courses","ajaxUrlCourses"),i=function(){this.removeMember=function(e,t){var n=$(e.target),i=n.parents(".tab-content").siblings(".nav.nav-tabs").children(".active"),s=i.attr("id"),o=$(e.currentTarget).attr("id").replace("remove-member-",""),u=$("#idEntity").val();Utils.confirm(translate("remove_member_title"),translate("remove_member_question"),$.proxy(function(e){if(e=="yes"){var n=$("#idEntity").val();$.ajax({type:"POST",url:r+"/removemember",data:"iduser="+o+"&idsection="+n,success:function(e){if(!e.success)Utils.alert(e.msg.title,e.msg.message,function(){});else{var r={idEntity:n,offset:0,tab:"all_tab",ajaxUrl:BAppConfig.get("allsectionmembers","ajaxUrlAllSectionMembersJson"),limit:10};t.updateView(r)}},dataType:"json"})}},this))},this.removeAdmin=function(e,t){var n=$(e.currentTarget).attr("id").replace("remove-admin-",""),i=$("#idEntity").val();Utils.confirm(translate("remove_admin_member_title"),translate("remove_admin_member_question"),$.proxy(function(e){if(e=="yes"){var i=$("#idEntity").val();$.ajax({type:"POST",url:r+"/makeadmin",data:{iduser:n,idsection:i,type:0},success:function(e){if(!e.success)Utils.alert(e.msg.title,e.msg.message,function(){});else{var n={idEntity:i,offset:0,tab:"all_tab",ajaxUrl:BAppConfig.get("allsectionmembers","ajaxUrlAllSectionMembersJson"),limit:10};t.updateView(n)}},dataType:"json"})}},this))},this.makeAdmin=function(e,t){var n=$(e.currentTarget).attr("id").replace("make-admin-",""),i=$("#idEntity").val();Utils.confirm(translate("make_admin_member_title"),translate("make_admin_member_question"),$.proxy(function(e){if(e=="yes"){var i=$("#idEntity").val();$.ajax({type:"POST",url:r+"/makeadmin",data:{iduser:n,idsection:i,type:1},success:function(e){if(!e.success)Utils.alert(e.msg.title,e.msg.message,function(){});else{var n={idEntity:i,offset:0,tab:"all_tab",ajaxUrl:BAppConfig.get("allsectionmembers","ajaxUrlAllSectionMembersJson"),limit:10};t.updateView(n)}},dataType:"json"})}},this))}};return i}),define("courses/course",["require","beyazpano","order!bootstrap.tooltip","courses/_templates","default/views/siteHeader","default/views/siteLeftMenu","add-members/main","section/views/joinSection","order!jquery.ui","order!jquery.ui.locale","order!jquery.validate","order!jquery.validate.messages_locale","section-members/views/sectionMembersView","courses/membersManagement","order!utils"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d,v,m=function(){var e={ALL:1,MEMBERS:2,ADMINS:3},n,r,a=!1,f,l={main:"grading-period-content",popupcourse:"popup-course"},c={rules:{"course[name]":{required:!0,minlength:2,maxlength:128},"course[identifier]":{required:!0,minlength:2,maxlength:128},"section[identifier]":{required:!0,minlength:2,maxlength:128},"section[name]":{required:!0,minlength:2,maxlength:128},"section[start_date]":{date:!0},"section[end_date]":{date:!0},"section[education_level]":{required:!0}}},m={rules:{"course[name]":{required:!0,minlength:2,maxlength:128},"section[identifier]":{required:!0,minlength:2,maxlength:128},"section[name]":{required:!0,minlength:2,maxlength:128},"section[start_date]":{date:!0},"section[end_date]":{date:!0},"section[education_level]":{required:!0}}},g={rules:{accesscode:{required:!0}}};this.init=function(){n=BAppConfig.get("site_courses","ajaxUrlCourses"),r=BAppConfig.get("site_courses","ajaxUrlCoursesHtml"),sectionUrl=BAppConfig.get("site_sections","sectionUrl"),f=BAppConfig.get("global","currentLang"),f==="ar"&&(a=!0),d=new p},this.run=function(){this.init(),this.addmembers=new o,this.addmembers.init(),this.joinSection=new u({onSuccess:function(e){e.courseMembership==0?(sectionUrl=sectionUrl.replace("__sectionid__",e.idSection),window.location=sectionUrl):document.location.reload(!0)}}),this.initHandlers();var e=new s({el:"#content_left",config:BAppConfig.get("site_general","left_menu_general"),userid:BAppConfig.get("mydata","id")}),n=$(t.renderTemplate(l.popupcourse,{}));$("body").append(n),$(".question").tooltip(),e.render(),i.render()},this.initHandlers=function(){$(".btn-group").button(),$("#add-course").live("click",_.bind(this.openPopupAddCourseClickHandler,this)),$("#join-course").live("click",_.bind(function(){this.joinSection.showPopup()},this)),$(".add-section").live("click",_.bind(this.openPopupAddSectionClickHandler,this)),$(".edit-course").live("click",_.bind(this.openPopupEditCourseClickHandler,this)),$(".edit-section").live("click",_.bind(this.openPopupEditSectionClickHandler,this)),$(".edit-member").live("click",_.bind(this.openPopupEditMemberClickHandler,this)),$("#save-edit-course").live("click",_.bind(this.updateCourseClickHandler,this)),$("#save-edit-section").live("click",_.bind(this.updateSectionClickHandler,this)),$("#save-course").live("click",_.bind(this.saveCourseClickHandler,this)),$("#advanced_course,#advanced_section,#advanced_section_identifier").live("click",function(){$("#"+$(this).attr("id")+"_field").toggle()}),$("#access-code-form-course").validate(g),$("#addCourseForm").validate(c),$("#addCourseForm").live("keypress",_.bind(this.enterKeyEvent,this)),$(".delete-section").live("click",_.bind(this.deleteSectionClickHandler,this)),$("#inactiveCourse").toggle(function(e){$("#inactiveCourse").text(translate("hide_expired")),$(".inactiveCourse").show()},function(e){$("#inactiveCourse").text(translate("show_expired")),$(".inactiveCourse").hide()})},this.initialiseForm=function(e){var n=function(e){$(".datepicker-grading-period-start",e).datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"yy-mm-dd",yearRange:"1900:c+5",dateFormat:"yy-mm-dd",isRTL:a,minDate:new Date,onSelect:function(e){$(".datepicker-grading-period-end").datepicker("option","minDate",e)}}),$(".datepicker-grading-period-end",e).datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"yy-mm-dd",yearRange:"1900:c+5",dateFormat:"yy-mm-dd",isRTL:a,minDate:new Date}),$(".hide-grading-period",e).click(function(){var e=$(this).attr("id").replace("grading-period-hide","");$("#grading-period-all"+e).remove()})};n(e);var r=0;$(".add-another-grading",e).click(function(){r++;var i={id:r},s=$(t.renderTemplate(l.main,i));$(".grading-period-list",e).append(s),n(e)}),$(".gradingPeriod").change(function(e){var t=$(e.target).val().split("#");$(".datepicker-grading-period-start").val(t[0]),$(".datepicker-grading-period-end").val(t[1])})},this.validateGradingPeriod=function(e){var t=!1;return $(".addGradingPeriod",e).each(function(e,n){t=t||($(n).find("input[name*='newgradingperiod[title]']").length&&$(n).find("input[name*='newgradingperiod[start_date]']").val()!=""&&$(n).find("input[name*='newgradingperiod[end_date]']").val()!=""?!0:!1)}),$("input[name='selectedgradingperiod[]']",e).length!=0&&(t=$("input[name='selectedgradingperiod[]']:checked",e).length!=0||t),t?$(".gradingPeriodError",e).empty():$(".gradingPeriodError",e).addClass("error").html(translate("select_please_grading_period")),t},this.openPopupAddCourseClickHandler=function(e){$("#addCourseForm").get(0).reset();var t=$("#addCourseForm").validate(c);t.resetForm(),$("#popup_add_course").modal("show"),this.initialiseForm($("#popup_add_course"))},this.openPopupEditCourseClickHandler=function(e){var t=$(e.currentTarget).attr("id").replace("edit-course-","");$.ajax({type:"POST",url:r+"/editcourse",data:"idcourse="+t,success:$.proxy(function(e){$("#popup_edit_course").html(e),$(".question").tooltip(),$("#popup_edit_course").modal("show")},this),dataType:"html"})},this.openPopupAddSectionClickHandler=function(e){var t=$(e.currentTarget).attr("id").replace("add-section-","");$.ajax({type:"POST",url:r+"/addsection",data:"idcourse="+t,success:$.proxy(function(e){$("#popup_edit_course").html(e);var t=$("#editSectionForm").validate(c);$("#popup_edit_course").modal("show"),$("#editSectionForm").validate(),this.initialiseForm($("#popup_edit_course"))},this),dataType:"html"})},this.openPopupEditSectionClickHandler=function(e){var t=$(e.currentTarget).attr("id").replace("edit-section-","");$.ajax({type:"POST",url:r+"/editsection",data:"idsection="+t,success:$.proxy(function(e){$("#popup_edit_course").html(e);var t=$("#editSectionForm").validate(m);$("#popup_edit_course").modal("show"),this.initialiseForm($("#popup_edit_course"))},this),dataType:"html"})},this.saveCourseClickHandler=function(e){$("#alert_course").empty();if($("#addCourseForm").valid()){Utils.block("#popup_add_course");var t=$("#addCourseForm").serialize();$.ajax({type:"POST",url:n+"/save",data:t,success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_add_course");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_course")}else{var n=BAppConfig.get("site_sections","sectionUrl");document.location=n.replace("__sectionid__",e.data.sectionId)}},this),complete:function(e,t){t=="error"&&Utils.unblock("#popup_add_course")},dataType:"json"})}},this.enterKeyEvent=function(e){var t=e.keyCode?e.keyCode:e.which;t=="13"&&this.saveCourseClickHandler(e)},this.updateCourseClickHandler=function(e){var t=$("#editCourseForm").serialize();$.ajax({type:"POST",url:n+"/updatecourse",data:t,success:$.proxy(function(e){if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_edit_course");else document.location.reload(!0)},this),dataType:"json"})},this.updateSectionClickHandler=function(e){$("#alert_edit_section").empty();if($("#editSectionForm").valid()){Utils.block("#popup_edit_course");var t=$("#editSectionForm").serialize();$.ajax({type:"POST",url:n+"/updatesection",data:t,success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_edit_course");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_edit_section")}else if(e.data.action=="edit")document.location.reload(!0);else{var n=BAppConfig.get("site_sections","sectionUrl");document.location=n.replace("__sectionid__",e.data.sectionId)}},this),complete:function(e,t){t=="error"&&Utils.unblock("#popup_edit_course")},dataType:"json"})}},this.deleteSectionClickHandler=function(e){var t="";$(e.currentTarget).attr("numbersections")==1&&(t=translate("delete_course"));var r=$(e.currentTarget).attr("id").replace("delete-section-","");Utils.confirm(translate("delete_section_course"),translate("delete_section_content")+" "+t,function(e){e=="yes"&&$.ajax({type:"POST",url:n+"/deletesection",data:"idsection="+r,success:$.proxy(function(e){e.success?document.location.reload(!0):Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"})})},this.openPopupEditMemberClickHandler=function(e){this.init();var t=$(e.currentTarget).attr("id").replace("edit-member-","");if($(".next-page-members").attr("id"))var n=$(".next-page-members").attr("id").replace("next-page-","");else var n=0;var r={idEntity:t,offset:n,entity_type:0,tab:"all_tab",ajaxUrl:BAppConfig.get("allsectionmembers","ajaxUrlAllSectionMembersJson"),limit:10};v=new h(r),v.render(),v.on("removeMemberFromGroup",_.bind(function(e){this.removeMember(e,v)},this)),v.on("removeAdmin",_.bind(function(e){this.removeAdmin(e,v)},this)),v.on("makeAdmin",_.bind(function(e){this.makeAdmin(e,v)},this)),$("#popup_edit_members").modal("show")},this.removeMember=function(e,t){d.removeMember(e,t)},this.removeAdmin=function(e,t){d.removeAdmin(e,t)},this.makeAdmin=function(e,t){d.makeAdmin(e,t)},this.getContentEditMembers=function(t,n,r){var i=$("#idEntity").val();if($(".next-page-members").attr("id"))var n=$(".next-page-members").attr("id").replace("next-page-","");else var n=0;var s="all_tab";switch(t){case e.ADMINS:s="all_tab";break;case e.ALL:s="admins_tab";break;case e.MEMBERS:s="members_tab"}var o={idEntity:i,offset:n,entity_type:0,tab:s,ajaxUrl:BAppConfig.get("allsectionmembers","ajaxUrlAllSectionMembersJson"),limit:10};v=new h(o),v.render(),this.init()},this.openPopupMembersTabClickHandler=function(t){this.getContentEditMembers(e.MEMBERS,null,function(){})},this.openPopupEditAllTabClickHandler=function(t){this.getContentEditMembers(e.ALL,null,function(){})},this.openPopupEditAdminsTabClickHandler=function(t){this.getContentEditMembers(e.ADMINS,null,function(){})},this.refreshContentEditMembers=function(t,n,r){switch(t){case"admins":this.getContentEditMembers(e.ADMINS,n,function(e){e&&_.isFunction(r)&&r(!0)});break;case"all":this.getContentEditMembers(e.ALL,n,function(e){e&&_.isFunction(r)&&r(!0)});break;case"members":this.getContentEditMembers(e.MEMBERS,n,function(e){_.isFunction(r)&&r(!0)})}},this.nextPageMembersClickHandler=function(e){var t=$(e.target).attr("id").replace("next-page-",""),n=$("#tabs_sufm").children(".active").attr("id").replace("_tab","");this.refreshContentEditMembers(n,t)}};return m}),define("text!discussions/templates.html",[],function(){return'<script type="text/template" id="send-message">\n    <div class="disscussionForm">\n        <form method="POST" action="<%= url%>"class="postForm clearfix">\n            <ul>\n                <li>\n                    <textarea name="message[body]" id="<%= prefix %>_body"  />\n                </li>\n            </ul>\n            <%if(reply){%>\n            <input type="hidden" name="message[reply]" value="<%= reply %>">\n            <%}%>\n            <input type="hidden" name="message[attachments]" value="" />\n            <input type="hidden" name="message[discussion_id]" value="<%= discussionId %>">\n\n        </form>\n        <div class="attachementsBox">\n            <div id="send_discussion_message_attachemnts" class="userMessageAttachment userPostAttachements clearfix"></div>\n            <button id="submit-message" class="btn primary  right userPostButton"><% print(_.escape(translate(\'site_send\'))) %></button>\n        </div>\n    </div>\n</script>\n<script type="text/template" id="reply-message">\n    <div class="disscussionForm">\n        <form method="POST" action="<%= url%>" >\n            <textarea name="message[body]" id="<%= prefix %>_body"  />\n            <%if(reply){%>\n            <input type="hidden" name="message[reply]" value="<%= reply %>">\n            <%}%>\n            <input type="hidden" name="message[attachments]" value="" />\n            <input type="hidden" name="message[discussion_id]" value="<%= discussionId %>">\n\n        </form>\n        <div class="attachementsBox">\n            <div id="reply_discussion_message_attachemnts" class="userMessageAttachment userPostAttachements clearfix"></div>\n            <a href="javascript:void(0);" id="reply-message" class="btn primary  right userPostButton"> <% print(_.escape(translate(\'site_send\'))) %></a>\n        </div>\n    </div>\n</script>\n<script type="text/template" id="create-discussion-form">\n    <div class="modal fade modal-narrow" id="create-discussion-dialog" data-backdrop="static">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3><% print(_.escape(translate(\'discussion_create_dialog_title\'))) %></h3>\n            </div>\n        </div>\n        <div class="modal-body">\n            <div class="modalContent">\n                <form method="POST">\n                    <input type="hidden" name="discussion[section_id]" value="<% if(data.section_id) print(data.section_id) %>">\n                    <% if(data.id) {%>\n                    <input type="hidden" name="discussion[id]" value="<%= data.id %>">\n                    <%}%>\n                    <input type="hidden" name="discussion[attachments]" value="" />\n                    <ul class="modalForm">\n                        <li class="clearfix">\n                            <label><% print(_.escape(translate(\'global_title\'))) %></label>\n                            <input type="text" name="discussion[title]" class="required"  value="<% if(data.title) print(_.escape(data.title)) %>" >\n                        </li>\n                        <li class="clearfix">\n                            <label><% print(_.escape(translate(\'discussion_description\'))) %></label>\n                            <textarea name="discussion[description]" ><% if(data.description) print(_.escape(data.description)) %></textarea>\n                        </li>\n                        <li>\n                            <% if(data.role == \'INSTRUCTOR\') { %>\n                            <label><% print(_.escape(translate(\'discussion_privacy\'))) %></label>\n                            <p class="checkBoxContainer">\n                                <input type="radio" class="required" name="discussion[privacy]" value="COURSE" <% if(data.privacy == \'COURSE\') { %>checked<%}%> >\n                                       <label><% print(_.escape(translate(\'discussion_privacy_course\'))) %></label>\n                            </p>\n                            <p class="checkBoxContainer">\n                                <input type="radio" name="discussion[privacy]" value="SECTION" <% if(data.privacy == \'SECTION\' || (data.privacy != \'COURSE\' && data.privacy != \'SECTION\')) { %>checked<%}%> >\n                                       <label><% print(_.escape(translate(\'discussion_privacy_section\'))) %></label>\n                            </p>\n                            <% } else { %>\n                            <input type="hidden" name="discussion[privacy]" value="<% if(!_.isEmpty(data.privacy)) { print(_.escape(data.privacy)) } else {%>SECTION<%}%>"/>\n                            <% } %>\n                        </li>\n                    </ul>\n                </form>\n                <div id="discussion_attachemnts" class="userMessageAttachment userPostAttachements clearfix"></div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <div class="modalFooterContainer modalFooterContainerUser">\n                <div class="modalButtons">\n                    <button href="#" id="save-discussion-btn" class="btn userDefaultBtn save"><% print(_.escape(translate(\'global_save\'))) %></button>\n                    <button href="#" class="btn cancel"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n'}),define("discussions/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("discussion_templates",n);return r}),define("discussions/views/createDiscussion",["require","beyazpano","order!jquery.form","order!jquery.validate","order!jquery.validate.messages_locale","discussions/_templates","attachment/views/component","jquery.json"],function(e,t,n,r,i,s,o,u){var a=Backbone.View.extend({templateNames:{main:"create-discussion-form"},el:null,url:null,submitCallback:null,data:null,initialize:function(e){this.url=e.url,this.submitCallback=e.submitCallback,this.data=e.data,this.render()},render:function(){$("#create-discussion-dialog").remove();var e=t.renderTemplate(this.templateNames.main,{url:this.url,data:this.data});$("body").append(e),$("#create-discussion-dialog").modal({show:!0,backdrop:"static"}),$("#create-discussion-dialog").modal("show").on("hidden",function(){$(this).remove()});var n=null;this.data.attachments&&(n=this.data.attachments),this.attachments=new Attachments("#discussion_attachemnts",{onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),clientUploader:BAppConfig.get("global","swfUploader"),attachments:n,canShare:!0,blockButtonId:"#save-discussion-btn",initShareHandler:_.bind(o.getShareInitHandler(),this)}),this.initHandlers()},attachmentsChanged:function(){$('#create-discussion-dialog input[name="discussion[attachments]"]').val($.toJSON(this.attachments.getAttachments()))},initHandlers:function(){var e=$("#create-discussion-dialog").find("form");e.validate({submitHandler:_.bind(function(t){Utils.block("#create-discussion-dialog");var n=$("#create-discussion-dialog").find(".save");n.attr("disabled","disabled"),e.ajaxSubmit({url:this.url,format:"json",success:$.proxy(function(e){_.isFunction(this.submitCallback)&&this.submitCallback.apply(this,[e]),$("#create-discussion-dialog").modal("hide"),Utils.unblock("#create-discussion-dialog"),n.removeAttr("disabled")},this)})},this)}),$("#create-discussion-dialog").find(".save").on("click",_.bind(function(){e.submit()},this)),$("#create-discussion-dialog").find(".cancel").on("click",_.bind(function(){$("#create-discussion-dialog").modal("hide")},this))}});return a}),define("paginator",function(){}),define("discussions/discussion_list",["require","beyazpano","discussions/views/createDiscussion","default/views/siteLeftMenu","paginator","order!jquery.validate","order!jquery.validate.messages_locale","utils","default/views/siteHeader","default/views/siteLeftMenu"],function(e,t,n,r,i,s,o,u,a,r){var f=function(){this.run=function(){this.LIST_CONTAINER_ID="discussions",this.initPaginator(),a.render();var e=BAppConfig.get("site_sections","config").left_menu;_.each(e.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",this.getSectionId()),e.url=e.url.replace("__COURSE_ID__",$("#idcourse").val())},this));var t=new r({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"discussions"});t.render()},this.initHandlers=function(){$("#create-discussion").off("click").on("click",_.bind(function(){var e=new n({data:{section_id:this.getSectionId(),role:BAppConfig.get("mydata","role")},url:BAppConfig.get("site_courses","ajaxUrlSaveDiscussion"),submitCallback:_.bind(function(e){$.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_created"),"#flash-message",3e3)},this)})},this)),$(".approve-discussion").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("approve-discussion-","");Utils.confirm(translate("discussion_approve_confirm_title"),translate("discussion_approve_confirm_message"),_.bind(function(e){e=="yes"&&this.approveDiscussion(t)},this))},this)),$(".edit-discussion").on("click",_.bind(function(e){Utils.block(".middleBar");var t=$(e.currentTarget).attr("id").replace("edit-discussion-",""),r=BAppConfig.get("site_courses","ajaxUrlGetDiscussion");$.ajax({type:"POST",url:r,data:{id:t},success:$.proxy(function(e){if(e.success)var t=new n({sectionId:e.data.discussion.section_id,data:e.data.discussion,url:BAppConfig.get("site_courses","ajaxUrlSaveDiscussion"),submitCallback:_.bind(function(e){e.success?(this.paginator.setTotalPages($.cookie(this.PAGES_COOKIE_NAME)),this.paginator.goToPage($.cookie(this.PAGE_COOKIE_NAME)),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_updated"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this)});else Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"}).always(function(){Utils.unblock(".middleBar")})},this)),$(".delete-discussion").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("delete-discussion-","");Utils.confirm(translate("discussion_remove_confirm_title"),translate("discussion_remove_confirm_message"),_.bind(function(e){e=="yes"&&this.removeDiscussion(t)},this))},this)),$(".privacy-discussion").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("privacy-discussion-","");this.toggleDiscussionPrivacy(t)},this))},this.removeDiscussion=function(e){var t=BAppConfig.get("site_courses","ajaxUrlRemoveDiscussion");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(e){e.success?($.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_deleted"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.approveDiscussion=function(e){var t=BAppConfig.get("site_courses","ajaxUrlApproveDiscussion");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(e){e.success?($.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_approved"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.toggleDiscussionPrivacy=function(e){var t=BAppConfig.get("site_courses","ajaxUrlTogglePrivacyDiscussion");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(e){e.success?(this.paginator.setTotalPages($.cookie(this.PAGES_COOKIE_NAME)),this.paginator.goToPage($.cookie(this.PAGE_COOKIE_NAME)),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_updated"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.initPaginator=function(){this.PAGES_COOKIE_NAME="sd_"+this.getSectionId()+"_pages",this.PAGE_COOKIE_NAME="sd_"+this.getSectionId()+"_page",this.paginator=new AppPaginator("#paginator",{page:1,pages:1,onPageSelected:_.bind(this.onPageChanged,this),render:!1});var e=parseInt($.cookie(this.PAGES_COOKIE_NAME))>0?parseInt($.cookie(this.PAGES_COOKIE_NAME)):1,t=parseInt($.cookie(this.PAGE_COOKIE_NAME))>0?parseInt($.cookie(this.PAGE_COOKIE_NAME)):1;this.paginator.setTotalPages(e),this.paginator.goToPage(t)},this.onPageChanged=function(e){this.loadListContent(e,10,_.bind(function(e){this.paginator.setTotalPages(e.data.totalPages),this.paginator.setCurrentPage(e.data.page),$("."+this.LIST_CONTAINER_ID).html(e.data.listHtml),$.cookie(this.PAGE_COOKIE_NAME,e.data.page),$.cookie(this.PAGES_COOKIE_NAME,e.data.totalPages),e.data.totalPages>1?this.paginator.render():this.paginator.hide(),this.initHandlers(),Utils.setZIndex()},this))},this.loadListContent=function(e,t,n){var r=BAppConfig.get("site_courses","ajaxUrlDiscussionList");$.ajax({type:"POST",url:r,data:{page:e,rows:t,id:this.getSectionId()},success:$.proxy(function(e){e.success?_.isFunction(n)&&n.apply(this,[e]):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.getSectionId=function(){var e=$("."+this.LIST_CONTAINER_ID).attr("id").replace("discussions-","");return e}};return f}),define("discussions/views/sendMessage",["require","beyazpano","order!jquery.form","attachment/views/component","order!jquery.validate","order!jquery.validate.messages_locale","discussions/_templates","jquery.textarea.autosize","jquery.json"],function(e,t,n,r){var i=Backbone.View.extend({templateNames:{main:"send-message"},el:null,discussionId:null,reply:null,url:null,submitCallback:null,initialize:function(e){e.templateNames!=""&&typeof e.templateNames!="undefined"&&(this.templateNames=e.templateNames),this.discussionId=e.discussionId,this.reply=e.reply,this.url=e.url,this.el=$("#"+e.formContainerId),this.submitCallback=e.submitCallback},render:function(){var e=_.uniqueId("disc_send_message"),n=t.renderTemplate(this.templateNames.main,{reply:this.reply,discussionId:this.discussionId,url:this.url,prefix:e});this.el.html(n),this.el.find("form").validate({rules:{"message[body]":{required:!0}},messages:{"message[body]":{required:translate("post_update_body_required")}}}),$("#"+e+"_body").autosize(),this.reply||(this.attachments=new Attachments("#send_discussion_message_attachemnts",{onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),clientUploader:BAppConfig.get("global","swfUploader"),canShare:!0,blockButtonId:"#submit-message",initShareHandler:_.bind(r.getShareInitHandler(),this)})),this.initHandlers()},attachmentsChanged:function(){this.el.find("form").find('input[name="message[attachments]"]').val($.toJSON(this.attachments.getAttachments()))},initHandlers:function(){var e=this.el.find("form");$("#submit-message",this.el).on("click",$.proxy(function(t){e.valid()&&(Utils.block(this.el),$.ajax(e.attr("action"),{type:"POST",dataType:"json",data:e.serialize()}).success($.proxy(function(e){_.isFunction(this.submitCallback)&&this.submitCallback.apply(this,[e]),this.render()},this)).complete(function(){Utils.unblock(this.el)},this))},this)),$("#reply-message").on("click",$.proxy(function(t){e.valid()&&(Utils.block(this.el),$.ajax(e.attr("action"),{type:"POST",dataType:"json",data:e.serialize()}).success($.proxy(function(e){_.isFunction(this.submitCallback)&&this.submitCallback.apply(this,[e]),this.render()},this)).complete(function(){Utils.unblock(this.el)},this))},this))}});return i}),define("discussions/message_list",["require","beyazpano","discussions/views/createDiscussion","discussions/views/sendMessage","paginator","utils","default/views/siteHeader","default/views/siteLeftMenu","lightbox"],function(e,t,n,r,i,s,o,u){var a=function(){this.run=function(){this.LIST_CONTAINER_ID="messages",this.initPaginator(),o.render();var e=parseInt($("#isAdminOfSectionDiscussion").val()),t=parseInt($("#courseReadOnlyDiscussion").val());if(t!=1){var n=new r({discussionId:this.getDiscussionId(),formContainerId:"new-message",url:BAppConfig.get("site_courses","ajaxUrlSendMessage"),submitCallback:_.bind(this.messageSubmitHandler,this)});n.render()}this.initDiscussionHandlers();var i=BAppConfig.get("site_sections","config").left_menu;_.each(i.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",$("#section-id-discusion").val()),e.url=e.url.replace("__COURSE_ID__",$("#idcourse").val())},this));var s=new u({el:"#content_left",config:i,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"discussions"});s.render(),this.reloadDiscussion(this.getDiscussionId())},this.initDiscussionHandlers=function(){$(".edit-discussion").on("click",_.bind(function(e){Utils.block(".middleBar");var t=$(e.currentTarget).attr("id").replace("edit-discussion-","");this.getDiscussion(t)},this)),$(".delete-discussion").on("click",_.bind(function(e){Utils.confirm(translate("discussion_remove_confirm_title"),translate("discussion_remove_confirm_message"),_.bind(function(t){if(t=="yes"){var n=$(e.currentTarget).attr("id").replace("delete-discussion-","");this.removeDiscussion(n)}},this))},this)),$(".privacy-discussion").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("privacy-discussion-","");this.toggleDiscussionPrivacy(t)},this)),$(".att_lightbox").colorbox({transition:"none",width:"85%",height:"85%"})},this.initMessageHandlers=function(){$(".reply-message").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("reply-message-","");$(".reply-message-container").html("");var n=new r({templateNames:{main:"reply-message"},discussionId:this.getDiscussionId(),formContainerId:"reply-message-container-"+t,reply:t,url:BAppConfig.get("site_courses","ajaxUrlSendMessage"),submitCallback:_.bind(this.messageReplySubmitHandler,this)});n.render()},this)),$(".remove-message").on("click",_.bind(function(e){Utils.confirm(translate("discussion_remove_message_confirm_title"),translate("discussion_remove_message_confirm_message"),_.bind(function(t){if(t=="yes"){var n=$(e.currentTarget).attr("id").replace("remove-message-","");this.removeMessage(n)}},this))},this)),$(".approve-message").on("click",_.bind(function(e){Utils.confirm(translate("discussion_approve_message_confirm_title"),translate("discussion_approve_message_confirm_message"),_.bind(function(t){if(t=="yes"){var n=$(e.currentTarget).attr("id").replace("approve-message-","");this.approveMessage(n)}},this))},this)),$(".att_lightbox").colorbox({transition:"none",width:"85%",height:"85%"})},this.initPaginator=function(){this.PAGES_COOKIE_NAME="dml_"+this.getDiscussionId()+"_pages",this.PAGE_COOKIE_NAME="dml_"+this.getDiscussionId()+"_page",this.paginator=new AppPaginator("#paginator",{page:1,pages:1,onPageSelected:_.bind(this.onPageChanged,this),render:!1});var e=parseInt($.cookie(this.PAGES_COOKIE_NAME))>0?parseInt($.cookie(this.PAGES_COOKIE_NAME)):1,t=parseInt($.cookie(this.PAGE_COOKIE_NAME))>0?parseInt($.cookie(this.PAGE_COOKIE_NAME)):1;this.paginator.setTotalPages(e),this.paginator.goToPage(t)},this.onPageChanged=function(e){this.loadListContent(e,10,_.bind(function(e){this.paginator.setTotalPages(e.data.totalPages),this.paginator.setCurrentPage(e.data.page),$("."+this.LIST_CONTAINER_ID).html(e.data.listHtml),$.cookie(this.PAGE_COOKIE_NAME,e.data.page),$.cookie(this.PAGES_COOKIE_NAME,e.data.totalPages),e.data.totalPages>1?this.paginator.render():this.paginator.hide(),this.initMessageHandlers()},this))},this.loadListContent=function(e,t,n){var r=BAppConfig.get("site_courses","ajaxUrlMessageList");$.ajax({type:"POST",url:r,data:{page:e,rows:t,id:this.getDiscussionId()},success:$.proxy(function(e){e.success?_.isFunction(n)&&n.apply(this,[e]):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.removeMessage=function(e){var t=BAppConfig.get("site_courses","ajaxUrlRemoveMessage");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(e){e.success?($.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_message_deleted"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.approveMessage=function(e){var t=BAppConfig.get("site_courses","ajaxUrlApproveMessage");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(e){e.success?($.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_message_approved"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.removeDiscussion=function(e){var t=BAppConfig.get("site_courses","ajaxUrlRemoveDiscussion");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(e){e.success?(Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_deleted"),"#flash-message",2e3),setTimeout(_.bind(function(){document.location.href=BAppConfig.get("site_courses","discussionsPageUrl").replace("__SECTION_ID__",this.getSectionId())},this),3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"})},this.toggleDiscussionPrivacy=function(e){var t=BAppConfig.get("site_courses","ajaxUrlTogglePrivacyDiscussion");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(t){t.success?(this.reloadDiscussion(e),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_updated"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",t.msg,"#flash-message",3e3)},this),dataType:"json"})},this.getDiscussion=function(e){var t=BAppConfig.get("site_courses","ajaxUrlGetDiscussion");$.ajax({type:"POST",url:t,data:{id:e},success:$.proxy(function(t){if(t.success)var r=new n({sectionId:t.data.discussion.section_id,data:t.data.discussion,url:BAppConfig.get("site_courses","ajaxUrlSaveDiscussion"),submitCallback:_.bind(function(t){t.success?(this.reloadDiscussion(e),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_updated"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",t.msg,"#flash-message",3e3)},this)});else Utils.flashMessage(Utils.FLASH_ERROR,"",t.msg,"#flash-message",3e3)},this),dataType:"json"}).always(function(){Utils.unblock(".middleBar")})},this.reloadDiscussion=function(e){var t=BAppConfig.get("site_courses","ajaxUrlGetDiscussion");$.ajax({type:"POST",url:t,data:{id:e,renderHtml:1,sectionId:$("#section-id-discusion").val()},success:$.proxy(function(e){e.success&&($("#section-"+$("#section-id-discusion").val()).html(e.data.markup),this.initDiscussionHandlers())},this),dataType:"json"})},this.messageSubmitHandler=function(e){e.success?($.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_message_created"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this.messageReplySubmitHandler=function(e){e.success?(this.paginator.setTotalPages($.cookie(this.PAGES_COOKIE_NAME)),this.paginator.goToPage($.cookie(this.PAGE_COOKIE_NAME)),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_message_created"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this.getDiscussionId=function(){var e=$("."+this.LIST_CONTAINER_ID).attr("id").replace("messages-","");return e},this.getSectionId=function(){var e=$(".sections").attr("id").replace("section-","");return e}};return a}),define("text!event/templates.html",[],function(){return'<script type="text/template" id="popup-event">\r\n    <div id="popup_join_event" class="modal fade hide">\r\n    </div>\r\n</script>\r\n'}),define("event/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("event_templates",n);return r}),define("event/event",["require","beyazpano","event/_templates","default/views/siteHeader","default/views/siteLeftMenu","comment/views/comment","paginator","attachment/views/component","order!jquery.ui","order!jquery.ui.locale","order!jquery.timepicker","order!jquery.textarea.autosize","lightbox","jquery.json"],function(e,t,n,r,i,s,o,u){var a=function(){var e,n,o,a,f,l=!1,c,h={popupevent:"popup-event"};this.init=function(){e=BAppConfig.get("site_event","ajaxUrlEventHtml"),n=BAppConfig.get("site_event","ajaxUrlEventJson"),o=BAppConfig.get("comment","getCommentsUrl"),a=[],c=BAppConfig.get("global","currentLang"),c==="ar"&&(l=!0),f={rules:{"data[title]":{required:!0,minlength:2,maxlength:128},start_date:{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0},start_time:{required:!0,afterNow:!0},end_date:{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0,equalOrBiggerThanStartDate:!0},end_time:{required:!0,afterNow:!0,equalOrBiggerThanStartTime:!0}},onfocusout:function(e){$(e).valid()}}},this.run=function(){this.init(),this.initHandlers(),this.initComments(),this.initPaginator();var e=null;$("#idsection").length>0?(e=BAppConfig.get("site_sections","config").left_menu,_.each(e.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",$("#idsection").val())},this))):e=BAppConfig.get("site_general","left_menu_general");var n=$(t.renderTemplate(h.popupevent,{}));$("body").append(n);var s=new i({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:""});s.render(),r.render()},this.initHandlers=function(){$(".btn-group").button(),$(".open-popup-response-event").live("click",_.bind(this.openpPopUpResponseEventClickHandler,this)),$("#save-response-event").live("click",_.bind(this.saveResponseEventClickHandler,this)),$(".edit-event").live("click",_.bind(this.editEventPopUpClickHandler,this)),$("#save-add-event").live("click",_.bind(this.saveEditEventClickHandler,this)),$(".delete-event").live("click",_.bind(this.deleteEventClickHandler,this)),$("#open-popup-invite-event").live("click",_.bind(this.openPopupInviteMembersClickHandler,this)),$("#userConnections").live("click",_.bind(this.getUserConnectionsClickHandler,this)),$("#userColleagues").live("click",_.bind(this.getUserColleaguesClickHandler,this)),$("#content_invite_event").on("click",".user-guest",_.bind(this.addGuests,this)),$("#invite-guests").on("click",_.bind(this.inviteGuests,this)),$("body").on("eventAccepted",_.bind(function(e,t){var n=$("#idevent").val();n!="undefined"&&n!=null&&n==t&&this.getMembersInvitedEvent($("#idevent").val())},this)),$(".att_lightbox").colorbox({transition:"none",width:"85%",height:"85%"})},this.initPopup=function(){for(var e in a)$("#user-guest-"+a[e]).addClass("selected");$("#numberGuestsInvited").html(a.length)},this.getMembersInvitedEvent=function(e){$.ajax({type:"POST",url:n+"/membersinvited",data:{id:e},success:$.proxy(function(e){$("#membersInvitedEvent").html(e.data)},this),dataType:"json"})},this.addGuests=function(e){var t=$(e.currentTarget).attr("id").replace("user-guest-","");$(e.currentTarget).hasClass("selected")?($(e.currentTarget).removeClass("selected"),a=_.without(a,t)):($(e.currentTarget).addClass("selected"),a.push(t)),a=_.uniq(a),$("#invite-guests-ids").val(a),$("#numberGuestsInvited").html(a.length)},this.inviteGuests=function(e){var t=$("#invite-guests-ids").val(),r=$("#idevent").val();t!=""&&(Utils.block("#popup_invite_guests_event"),$.ajax({type:"POST",url:n+"/inviteguests",data:{idsguests:t,idevent:r},success:$.proxy(function(e){e.success?document.location.reload(!0):(Utils.unblock("#popup_invite_guests_event"),Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#alert_event_invite"))},this),complete:function(e,t){t=="error"&&Utils.unblock("#popup_invite_guests_event")},dataType:"json"}))},this.initComments=function(){var e=$("#idevent").val(),t=$("#readOnly").val()==0?!0:!1,n=new s({el:"#commentFormContainerEvent",additionalData:{eventId:e},showEmptyCommentBox:!0,canComment:t});$.ajax({type:"POST",url:o,data:{entityId:e,entityType:"event",todo:"refresh",additional:{eventId:e},pageEntityId:e},success:$.proxy(function(t){if(t.success==1){var r={entityType:"event",entityId:e,items:[],nrOfComments:0};!_.isUndefined(t)&&!_.isUndefined(t.data)&&!_.isUndefined(t.data.comments)&&!_.isUndefined(t.data.comments[e])&&(r=t.data.comments[e]),r.page_entity_id=e,n.renderComment(r,t.data.users,t.data.likes)}else Utils.flashMessage(Utils.FLASH_ERROR,"",translate("event_comments_error"),"#flashmessages")},this),dataType:"json"})},this.initAttachments=function(){var e=null;$("#prevattachments").val()&&(e=$.parseJSON($("#prevattachments").val())),this.attachments=new Attachments("#attachments",{attachmentsContainer:"#attachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),attachments:e,canShare:!0,blockButtonId:"#save-add-event",initShareHandler:_.bind(u.getShareInitHandler(),this)})},this.attachmentsChanged=function(){$('#editEventForm input[name="attachments"]').val($.toJSON(this.attachments.getAttachments()))},this.initialiseForm=function(){$(".datepicker-grading-period-start").datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:c+5",dateFormat:"dd-mm-yy",isRTL:l,minDate:new Date,onClose:function(e){$(".datepicker-grading-period-end").datepicker("option","minDate",e),$(".datepicker-grading-period-start").trigger("focusout")}}),$(".datepicker-grading-period-end").datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:c+5",dateFormat:"dd-mm-yy",isRTL:l,minDate:$(".datepicker-grading-period-start").datepicker("getDate"),onSelect:function(){$(".datepicker-grading-period-end").trigger("focusout")}}),$(".timeentry").timeEntry({spinnerImage:"",show24Hours:!0,beforeShow:this.customRange});var e=$("#status_end_time").val();$("#add_end_time").die("click").live("click",function(){e++,$("#end_date_event").toggle();if(e%2==0)$("#add_end_time").html(translate("event_add_end_time")),$("#status_end_time").val("0");else{$("#add_end_time").html(translate("event_remove_end_time")),$("#status_end_time").val("1");var t=$(".datepicker-grading-period-start").datepicker("getDate");$(".datepicker-grading-period-end").datepicker("option","minDate",t)}}),$("#event_type").on("change",_.bind(function(){$("#event_type").val()==0?($("#section_walls").val()||$("#section_walls").val("1_"+BAppConfig.get("mydata","id")),$("#autocomplete_event_walls").hide()):$("#autocomplete_event_walls").show()},this)),$('input[name="start_date"]').live("focusout",function(){$('input[name="start_time"]').trigger("focusout"),$('input[name="end_date"]').trigger("focusout")}),$('input[name="end_date"], input[name="start_time"]').live("focusout",function(){$('input[name="end_time"]').trigger("focusout")}),$("#event_type").change()},this.customRange=function(e){return{minTime:e.id=="timepicker-end"&&$(".datepicker-grading-period-end").val()==$(".datepicker-grading-period-start").val()?$("#timepicker-start").timeEntry("getTime"):null,maxTime:e.id=="timepicker-start"&&$(".datepicker-grading-period-end").val()==$(".datepicker-grading-period-start").val()?$("#timepicker-end").timeEntry("getTime"):null}},this.openpPopUpResponseEventClickHandler=function(e){var t=$(e.currentTarget).attr("id").replace("open-popup-response-event-","");$.ajax({type:"POST",url:n+"/responsepopup",data:{idevent:t},success:$.proxy(function(e){e.success?($("#popup_join_event").html(e.data.html),$("#popup_join_event").modal("show")):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#alert_join_event")},this),dataType:"json"})},this.saveResponseEventClickHandler=function(e){var t=$("#eventResponseForm").serialize();$.ajax({type:"POST",url:n+"/responserequest",data:t,success:$.proxy(function(e){e.success?document.location.reload(!0):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#alert_join_event")},this),dataType:"json"})},this.editEventPopUpClickHandler=function(e){var t=$(e.currentTarget).attr("id").replace("edit-event-",""),r=$("#idsection").val(),i={idevent:t,sectionId:r};$.ajax({type:"POST",url:n+"/editevent",data:i,success:$.proxy(function(e){Utils.popup(translate("edit_event"),e.data.body,e.data.footer),this.initialiseForm();var t=$('#editEventForm input[name="start_date"]'),n=$('#editEventForm input[name="start_time"]');$.data(n[0],"DueGlobal",{originalDueDateVal:t.val(),originalDueTimeVal:n.val()}),$.data(t[0],"DueGlobal",{originalDueDateVal:t.val(),originalDueTimeVal:n.val()}),$.data(n[0],"dueDateSelect",t),$.data(n[0],"startDate",t),$.data(t[0],"dueTimeSelect",n);var r=$('#editEventForm input[name="end_date"]'),i=$('#editEventForm input[name="end_time"]');$.data(i[0],"DueGlobal",{originalDueDateVal:r.val(),originalDueTimeVal:i.val()}),$.data(r[0],"DueGlobal",{originalDueDateVal:r.val(),originalDueTimeVal:i.val()}),$.data(i[0],"dueDateSelect",r),$.data(i[0],"startTime",n),$.data(i[0],"startDate",t),$.data(r[0],"startDate",t),$.data(r[0],"dueTimeSelect",i),$("#editEventForm").validate(f),this.initAttachments()},this),dataType:"json"})},this.saveEditEventClickHandler=function(e){if($("#editEventForm").valid()){Utils.block("#_dialog_popup");var t=$("#editEventForm").serialize();$.ajax({type:"POST",url:n+"/saveeditevent",data:t,success:$.proxy(function(e){if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_edit_event");else document.location.reload(!0)},this),complete:function(){Utils.unblock("#_dialog_popup")},dataType:"json"})}},this.deleteEventClickHandler=function(e){var t=$(e.currentTarget).attr("id").replace("delete-event-",""),r={idevent:t};_.isUndefined($("#idsection").val())===!1&&(r.sectionId=$("#idsection").val()),Utils.confirm(translate("delete_event"),translate("delete_event_content"),function(e){e=="yes"&&$.ajax({type:"POST",url:n+"/deleteevent",data:r,success:$.proxy(function(e){e.success?document.location.href=e.msg.url:Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"})})},this.initPaginator=function(){this.paginator=new AppPaginator("#paginator",{page:1,pages:1,onPageSelected:_.bind(this.onPageChanged,this),render:!1});var e=1,t=1;this.paginator.setTotalPages(e),this.paginator.goToPage(t)},this.onPageChanged=function(e){this.getMembersToInvite(e,10,$.cookie(this.TYPE_MEMBERS),function(e){})},this.openPopupInviteMembersClickHandler=function(e){this.TYPE_MEMBERS="type_members",$.cookie(this.TYPE_MEMBERS,1),this.getMembersToInvite(1,10,$.cookie(this.TYPE_MEMBERS),function(e){e&&$("#popup_invite_guests_event").modal("show")})},this.getMembersToInvite=function(e,t,r,i){var s=$("#idevent").val();$.ajax({type:"POST",url:n+"/userconnections",data:{page:e,pagesize:t,type:r,idevent:s},success:$.proxy(function(e){this.paginator.setTotalPages(e.data.totalPages),this.paginator.setCurrentPage(e.data.page),$("#content_invite_event").html(e.data.html),this.initPopup(),e.data.totalPages>1?this.paginator.render():this.paginator.hide(),r==1?$("#status_invite_user").html(translate("event_connections")):r==0&&$("#status_invite_user").html(translate("event_my_students")),_.isFunction(i)&&i.apply(this,[!0])},this),dataType:"json"})},this.getUserColleaguesClickHandler=function(){$.cookie(this.TYPE_MEMBERS,0),this.getMembersToInvite(1,10,$.cookie(this.TYPE_MEMBERS),function(){})},this.getUserConnectionsClickHandler=function(){$.cookie(this.TYPE_MEMBERS,1),this.getMembersToInvite(1,10,$.cookie(this.TYPE_MEMBERS),function(){})}};return a}),define("event/main",["require","beyazpano","order!jquery.ui","order!jquery.ui.locale","autocomplete/views/autocomplete","library/views/shareFiles","order!jquery.timepicker","attachment/views/component","order!jquery.textarea.autosize","jquery.json"],function(e,t,n,r,i,s,o,u){var a=function(){var e,t=[],n={},r,s=new Array("0"),o=new Array("1","2"),a=new Array("3","4"),f=0,l=!1,c,h,p;r={rules:{"data[title]":{required:!0,minlength:2,maxlength:128},start_date:{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0},start_time:{required:!0,afterNow:!0},end_date:{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0,equalOrBiggerThanStartDate:!0},end_time:{required:!0,afterNow:!0,equalOrBiggerThanStartTime:!0},section_walls:{required:!0}},onfocusout:function(e){$(e).valid()},messages:{section_walls:{required:translate("home_mandatory_select_wall")}}},this.init=function(){e=BAppConfig.get("site_event","ajaxUrlEventJson"),c=BAppConfig.get("global","currentLang"),c==="ar"&&(l=!0)},this.run=function(e){this.init(),this.initTrigger(),this.initHandlers(),this.initConstructParams(e),$(".add-event").length&&$(".add-event").attr("id")&&this.setWall($(".add-event").attr("id").replace("add-event-",""))},this.setEventType=function(e){this.eventType=0,$.inArray(e,s)!=-1?this.eventType="private":$.inArray(e,o)!=-1?this.eventType="course":$.inArray(e,a)!=-1&&(this.eventType="group")},this.setWall=function(e){this.entityWall=0,typeof this.initParams.is_group!="undefined"&&this.initParams.is_group==1?this.entityWall="2_"+e:typeof this.initParams.is_course!="undefined"&&this.initParams.is_course==1&&(this.entityWall="3_"+e)},this.initTrigger=function(){$(".add-event").live("click",_.bind(this.openPopupAddEventClickHandler,this))},this.initHandlers=function(){$('input[name="start_date"]').live("focusout",function(){$('input[name="start_time"]').trigger("focusout"),$('input[name="end_date"]').trigger("focusout")}),$('input[name="end_date"], input[name="start_time"]').live("focusout",function(){$('input[name="end_time"]').trigger("focusout")}),$("#save-add-event").live("click",_.bind(this.saveEventClickHandler,this)),$("#add_end_time").live("click",function(){$("#end_date_event").toggle(),$("#end_date_event").is(":hidden")?$("#add_end_time").html(translate("event_add_end_time")):$("#add_end_time").html(translate("event_remove_end_time"))})},this.initConstructParams=function(e){this.initParams={};if(typeof e!="undefined"&&e.length!=0){var t=this;$.each(e,function(e,n){t.initParams[e]=n})}},this.initBrowse=function(){BAppConfig.get("mydata","role")=="INSTRUCTOR"?($("#event_type").val()==0&&$("#section_walls").val("1_"+BAppConfig.get("mydata","id")),this.autocomplete=new i({config:{containerId:"#autocomplete_event_walls",useWallBrowser:!0,useTokenInput:!0,wallBrowserWallsSelected:!0,wallBrowserWalls:{courses:this.eventType==="course"?jsCoursesInfo.courses_data:"",groups:this.eventType==="group"?jsGroupInfo.group_data:""},wallType:this.eventType,browseButtonTitle:this.eventType==="course"?translate("wall_post_event_message"):translate("wall_post_group_event_message"),tokenInputSource:this.getWallListForTokenInput()}}),this.autocomplete.render(),this.autocomplete.on("ListChanged",_.bind(function(e){var t=e;$("#section_walls").val(t.join(",")),$("#addEventForm").validate().element("#section_walls")},this))):$("#section_walls").val("1_"+BAppConfig.get("mydata","id"))},this.getWallListForTokenInput=function(){var e=[],t=BAppConfig.get("mydata","id"),n=BAppConfig.get("mydata","first_name")+" "+BAppConfig.get("mydata","last_name");if(this.eventType=="course"){var r=jsCoursesInfo.user_admin_courses_data;for(var i in r){var s=r[i].name,o=r[i].sections;for(var u in o){var a=o[u].name,f=o[u].id;e.push({id:"3_"+f,name:s+":"+a})}}}else{var l=jsGroupInfo.group_data;for(var u in l){var c=l[u].name,h=l[u].id;e.push({id:"2_"+h,name:c})}}return e},this.initAttachments=function(e){this.attachments=new Attachments("#attachments",{attachmentsContainer:"#attachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),canShare:!0,blockButtonId:e==1?"#save-add-event":"#post-event-btn",initShareHandler:_.bind(u.getShareInitHandler(),this)})},this.attachmentsChanged=function(){$('#addEventForm input[name="attachments"]').val($.toJSON(this.attachments.getAttachments()))},this.initialiseForm=function(){$(".datepicker-grading-period-start").datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:c+5",dateFormat:"dd-mm-yy",isRTL:l,minDate:new Date,onClose:function(e){$(".datepicker-grading-period-end").datepicker("option","minDate",e),$(".datepicker-grading-period-start").trigger("focusout")}}),$(".datepicker-grading-period-end").datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:c+5",isRTL:l,dateFormat:"dd-mm-yy",onSelect:function(){$(".datepicker-grading-period-end").trigger("focusout")}}),$(".timeentry").timeEntry({spinnerImage:"",show24Hours:!0,beforeShow:this.customRange}),$("#event_type").on("change",_.bind(function(){this.setEventType($("#event_type").val());if(typeof this.entityWall!="undefined"&&this.entityWall!=0&&this.entityWall.length>2)$("#section_walls").val(this.entityWall),$("#autocomplete_event_walls").hide();else if(this.eventType==="private")$("#section_walls").val("1_"+BAppConfig.get("mydata","id")),$("#autocomplete_event_walls").hide();else{var e=$("#section_walls").val().split("_");$("#section_walls").val(""),this.initBrowse(),$("#autocomplete_event_walls").show()}},this)),$("#event_type").change()},this.customRange=function(e){return{minTime:e.id=="timepicker-end"&&$(".datepicker-grading-period-end").val()==$(".datepicker-grading-period-start").val()?$("#timepicker-start").timeEntry("getTime"):null,maxTime:e.id=="timepicker-start"&&$(".datepicker-grading-period-end").val()==$(".datepicker-grading-period-start").val()?$("#timepicker-end").timeEntry("getTime"):null}},this.openPopupAddEventClickHandler=function(e){$(".add-event").die("click");var t=$(e.currentTarget).attr("id").replace("add-event-","");this.fetchAddEventForm(t,_.bind(function(e,t,n){Utils.popup(translate("create_event"),e,t),this.setupAddEventForm(n,!0)},this))},this.setupAddEventForm=function(e,t){this.initialiseForm(),this.initTrigger();if($("#addEventForm").length>0){var n=$("#addEventForm").validate(r);n.resetForm();var i=$('#addEventForm input[name="start_date"]'),s=$('#addEventForm input[name="start_time"]');$.data(s[0],"dueDateSelect",i);var o=$('#addEventForm input[name="end_date"]'),u=$('#addEventForm input[name="end_time"]');$.data(u[0],"dueDateSelect",o),$.data(o[0],"startDate",i),$.data(u[0],"startTime",s),$.data(u[0],"startDate",i)}$("#addEventForm textarea").autosize(),e||this.initBrowse(),t==1?this.initAttachments(!0):this.initAttachments()},this.fetchAddEventForm=function(t,n){this.init();var r=0,i=0;typeof this.initParams.is_group!="undefined"&&this.initParams.is_group==1&&(r=1),typeof this.initParams.is_all!="undefined"&&this.initParams.is_all==1&&(i=1),$.ajax({type:"POST",url:e+"/addevent",data:{identity:t,is_group:r,is_all:i},success:_.bind(function(e){typeof n=="function"&&n.apply(this,[e.data.body,e.data.footer,e.data.section])},this),dataType:"json"})},this.saveEventClickHandler=function(e){if($("#addEventForm").valid()){Utils.block("#_dialog_popup");var t=$("#addEventForm").serialize();this.postEvent(t,$.proxy(function(e){if(!e.success){Utils.unblock("#_dialog_popup");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_add_event")}else window.location.href=BAppConfig.get("site_event","config").eventPageLink.replace("__idevent__",e.data.idevent)},this),$.proxy(function(e){Utils.unblock("#_dialog_popup");for(var t in e.msg)for(var n in e.msg[t])Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t][n],"#flash-message")},this))}},this.postEvent=function(t,n,r){t&&(this.init(),$.ajax({type:"POST",url:e+"/saveevent",dataType:"json",data:t,success:_.bind(function(e){typeof n=="function"&&n.apply(this,[e])},this),error:_.bind(function(e,t,n){typeof r=="function"&&r.apply(this,[$.evalJSON(e.responseText)])},this)}))}};return a}),define("text!home/templates.html",[],function(){return'<script type="text/template" id="home_main">\n    <h2 class="middleZoneTitle clearfix"><%- title_name %></h2>\n    <div id="flash-message"></div>\n    <% if(user_role == \'INSTRUCTOR\') { %>\n        <div id="postNewDataMenu" class="postNewDataMenu">\n            <ul class="homePostOptions clearfix">\n                <li class="post"><span><% print(_.escape(translate(\'site_home_post\'))) %>:</span></li>\n                <li class="homeUpdates">\n                    <div class="clearfix">\n                        <i></i>\n                        <a class="action" id="updates" href="#_action_post_updates"><% print(_.escape(translate(\'site_home_post_update\'))) %></a>\n                    </div>\n                </li>\n                <li class="homeEvent">\n                    <div class="clearfix">\n                        <i></i>\n                        <a class="action" id="event" href="#_action_post_event"><% print(_.escape(translate(\'site_home_post_event\'))) %></a>\n                    </div>\n                </li>\n                <li class="homeAssignment">\n                    <div class="clearfix">\n                        <i></i>\n                        <a class="action" id="assignment" href="#_action_post_assignment"><% print(_.escape(translate(\'site_home_post_assignment\'))) %></a>\n                    </div>\n                </li>\n            </ul>\n            <div id="_action_post_updates" class="actContainer noVisible" >\n                <a class="closeAction close" href="javascript:void(0)" title="Close">&times;</a>\n                <div id="postUpdate" class="postUpdatesContainer"></div>\n            </div>\n            <div id="_action_post_event" class="actContainer noVisible" >\n                <a class="closeAction close" href="javascript:void(0)" title="Close">&times;</a>\n                <div id="postEvent" class="postEventsContainer">\n                    <div id="postEvent_form"></div>\n                    <button id="post-event-btn" href="#" class="btn userDefaultBtn uploadDisableBtn"><% print(_.escape(translate(\'event_submit\'))) %></button>\n                </div>\n            </div>\n            <div id="_action_post_assignment" class="actContainer noVisible" >\n                <a class="closeAction close" href="javascript:void(0)" title="Close">&times;</a>\n                <div id="postAssignment" class="postAssignmentContainer">\n                    <div id="postAssignment_form"></div>\n                    <button id="post-assignment-btn" href="#" class="btn userDefaultBtn uploadDisableBtn"><% print(_.escape(translate(\'event_submit\'))) %></button>\n                </div>\n            </div>\n        </div>\n    <% } %>\n    <div id="homeUpdateListContainer"></div>\n</script>\n\n<script type="text/template" id="home_feed">\n    <div id="feed_list_container"></div>\n</script>\n'}),define("home/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("home_templates",n);return r}),define("text!attachment/templates.html",[],function(){return'<script type="text/template" id="site_attachments_list">\n    <div id="<%= id %>_att_links"></div>\n    <div id="<%= id %>_att_photos" class="attachementsPhotosContainer clearfix"></div>\n    <div id="<%= id %>_att_files" class="attachementsFilesContainer clearfix"></div>\n    <div id="<%= id %>_att_videos" class="attachementsVideosContainer clearfix"></div>\n</script>\n\n<script type="text/template" id="site_attachments_list_image">\n    <div id="att_<%= id %>" class="attachementsImage">\n        <a href="<% print( url ) %>" class="att_<%= attGroup %>" title="<%- name %>">\n			<img src="<% print( (thumb ? thumb: url)) %>" alt="<%- name %>" class="image-attachment thumbnail120" width="120" height="90"/>\n		</a>\n    </div>\n</script>\n<script type="text/template" id="site_attachments_list_file">\n    <div id="att_<%= id %>">\n        <div class="file-attachment <%= iconCss %>">\n            <a href="<%= downloadUrl %>" target="_blank" title="<%- name %>"><span class="file-name"><%- name %></span></a>\n            <span class="file-size"><% print(_.escape(Utils.bytesToSize(size))) %></span>\n        </div>\n    </div>\n</script>\n<script type="text/template" id="site_attachments_list_link">\n    <div id="att_<%= id %>">\n        <div class="linkAttachment">\n            <a href="<%= url %>" target="_blank" title="<%- title %>"><% if(title.length > 0) { print(_.escape(title)) } else { print(_.escape(url)) } %></a>\n            <span><%- url %></span>\n        </div>\n    </div>\n</script>\n<script type="text/template" id="site_attachments_list_video">\n    <div id="att_video_<%= id %>">\n        <div class="videoAttachment">\n                <div class = "emVideoTitle"><% if(!_.isEmpty(title)){ print(title) }%></div>\n                <div class = "emVideoImage">\n                    <% if (!_.isEmpty(thumbnail_url)){ %>\n                        <i class="playVideo"></i>\n                        <a href="#" class = "videoThumbnail"><img  width ="<%= width %>"  src="<% if(thumbnail_url) { print(_.escape(thumbnail_url)); } %>"/></a>\n                        <input type="hidden" value ="<%= html %>"/>\n                    <% } else { %>\n                        <div><%= html%></div>\n                    <% } %>\n                </div>  \n        </div>\n    </div>\n</script>'}),define("attachment/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("attachment_templates",n);return r}),define("attachment/views/list",["require","beyazpano","lightbox","attachment/_templates","order!base64"],function(e,t){var n=Backbone.View.extend({templateNames:{main:"site_attachments_list",image_attachment:"site_attachments_list_image",file_attachment:"site_attachments_list_file",link_attachment:"site_attachments_list_link",video_attachment:"site_attachments_list_video"},initialize:function(e){this.config={},this.attachments=null,this.postid=null,e.config&&(this.config=_.extend(this.config,e.config)),e.attachments&&(this.attachments=e.attachments),e.postid&&(this.postid=e.postid),_.isUndefined(e.userid)?this.config.userid=BAppConfig.get("mydata","id"):this.userid=e.userid},render:function(){var e={id:$(this.el).attr("id")},n=$(t.renderTemplate(this.templateNames.main,e));$(this.el).html(n);var r=$(this.el).attr("id")+"_att_links",i=$(this.el).attr("id")+"_att_photos",s=$(this.el).attr("id")+"_att_files",o=$(this.el).attr("id")+"_att_videos";if(this.attachments.file){var u=0;for(var a in this.attachments.file)if(this.attachments.file.hasOwnProperty(a)){var f=this.attachments.file[a];if(f.id>0){var e={url:""};_.extend(e,f),e.id=this.postid+"_"+f.id,e.attGroup=this.postid;if($.inArray(f.fileType,BAppConfig.get("global","imageMimeTypes"))>-1){var n=$(t.renderTemplate(this.templateNames.image_attachment,e));$("#"+i).append(n)}else{var l=BAppConfig.get("global","fileTypeIconsMap"),c=BAppConfig.get("global","fileDownloadTemplateUrl");e.iconCss="",_.isUndefined(l[f.fileType])?e.iconCss=BAppConfig.get("global","genericFileTypeIcon"):e.iconCss=l[f.fileType],e.downloadUrl=c.replace("__fileid__",f.id);var n=$(t.renderTemplate(this.templateNames.file_attachment,e));$("#"+s).append(n)}}}$(".att_"+this.postid).colorbox({rel:"att_"+this.postid,transition:"none",width:"85%",height:"85%"})}this.attachments.link&&_.each(this.attachments.link,_.bind(function(e,n){var i={id:this.postid+"_"+n};_.extend(i,e);var s=$(t.renderTemplate(this.templateNames.link_attachment,i));$("#"+r).append(s)},this)),this.attachments.video&&_.each(this.attachments.video,_.bind(function(e,n){var r={id:this.postid+"_"+n};_.extend(r,e);var i=$(t.renderTemplate(this.templateNames.video_attachment,r));$("#"+o).append(i),$("#att_video_"+r.id).find(".videoThumbnail, .playVideo").on("click",function(e){e.preventDefault();var t=Base64.decode($(e.currentTarget).siblings("input").val());$(e.currentTarget).parent("div.emVideoImage").html(t)})},this))}});return n}),define("text!feed/templates.html",[],function(){return'<script type="text/template" id="site_feed_list">\n	<div id="<%= id %>" class="updatesContainer">\n		<% if(activities_lits && activities_lits.length > 0) { %>\n		<div id="<%= id %>_list" class="updatesList"></div>\n		<% } else if(isInstructor){ %>\n		<h3 class="noActivityMsg"><% print(_.escape(translate(\'welcome_first_login\'))) %></h3>\n		<% } %>\n	</div>\n</script>\n\n<script type="text/template" id="site_feed_list_item">\n	<ul class="postContainer <% if(isAnnouncement){ %>announcement<% } %> clearfix" id="activity_<%= type %>_<%= itemId %>">\n		<li class="postContainerLeft">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>">\n				<img src="<%= actor_avatarUrl %>" width="50" height="50" title="<%- actor_name %>"/>\n			</a>\n		</li>\n		<li class="postContainerright">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>" class="postedBy"><%- actor_name %></a>\n			<% if(canDelete) { %>\n			<a class="close" id="remove_post_<%= type %>_<%= itemId %>" href="javascript:void(0)"\n			   title="<% print(_.escape(translate(\'site_posts_remove_post\'))) %>">×</a>\n			<% } %>\n			<p class="postContent"><%= body %></p>\n\n			<div id="<%= id %>_i_<%= type %>_<%= itemId %>_attachments_container"\n				 class="userAttachementsContainer"></div>\n			<ul class="userPostDetails clearfix">\n				<li><span><% print(Utils.formatTimestamp(timestamp)) %></span></li>\n				<% if(canComment && canLike) { %>\n				<li>\n					<a href="javascript:void(0)" class="jqAddComment"><% print(_.escape(translate(\'global_comment\')))\n						%></a>\n				</li>\n				<li>\n					<div class="jqLikeContainer"></div>\n				</li>\n				<% } %>\n				<li><a href="javascript:void(0)"><% print(_.escape(translate(\'global_report\'))) %></a></li>\n			</ul>\n			<div class="jqCommentContainer"></div>\n		</li>\n	</ul>\n</script>\n\n<script type="text/template" id="site_feed_list_item_post">\n	<ul class="postContainer <% if(isAnnouncement){ %>announcement<% } %> clearfix" id="post_<%= type %>_<%= itemId %>_<%= wallType %>">\n		<li class="postContainerLeft">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>">\n				<img src="<%= actor_avatarUrl %>" width="50" height="50" title="<%- actor_name %>" />\n			</a>\n		</li>\n		<li class="postContainerright">\n			<%= content %>\n			<% if(canDelete) { %>\n			<a class="close" id="remove_post_<%= type %>_<%= itemId %>_<%= wallType %>" href="javascript:void(0)" title="<% print(_.escape(translate(\'site_posts_remove_post\'))) %>">×</a>\n			<% } %>\n			<p class="postContent"><%= body %></p>\n			<div id="<%= id %>_i_<%= type %>_<%= itemId %>_attachments_container" class="userAttachementsContainer"></div>\n			<ul class="userPostDetails clearfix">\n				<li><span><% print(Utils.formatTimestamp(timestamp)) %></span></li>\n				<% if(canComment) { %>\n				<li>\n					<a href="javascript:void(0)" class="jqAddComment"><% print(_.escape(translate(\'global_comment\'))) %></a>\n				</li>\n				<% } %>\n				<% if(canLike) { %>\n				<li>\n					<div class="jqLikeContainer"></div>\n				</li>\n				<% } %>\n				<li class="fnone"><a href="javascript:void(0)" class="report" id="report-<%= itemId %>"><% print(_.escape(translate(\'global_report\'))) %></a></li>\n				<li class="fnone" ><div class="jqLikers"></div></li>\n			</ul>\n			<div class="jqLikers"></div>\n			<div class="jqCommentContainer"></div>\n		</li>\n	</ul>\n</script>\n\n<script type="text/template" id="site_feed_list_item_discussion">\n	<ul class="postContainer clearfix" id="discussion_<%= itemId %>">\n		<li class="postContainerLeft">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>">\n				<img src="<%= actor_avatarUrl %>" width="50" height="50" title="<%- actor_name %>" />\n			</a>\n		</li>\n		<li class="postContainerright">\n			<%= content %>\n			<p class="postContent"><%= description %></p>\n			<ul class="userPostDetails clearfix">\n				<li><span><% print(Utils.formatTimestamp(timestamp)) %></span></li>\n			</ul>\n		</li>\n	</ul>\n</script>\n\n<script type="text/template" id="site_feed_list_item_section">\n	<ul class="postContainer clearfix" id="section_<%= itemId %>">\n		<li class="postContainerLeft">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>">\n				<img src="<%= actor_avatarUrl %>" width="50" height="50" title="<%- actor_name %>" />\n			</a>\n		</li>\n		<li class="postContainerright">\n			<%= content %>\n			<ul class="userPostDetails clearfix">\n				<li><span><% print(Utils.formatTimestamp(timestamp)) %></span></li>\n			</ul>\n		</li>\n	</ul>\n</script>\n\n<script type="text/template" id="site_feed_list_item_became_friends">\n	<ul class="postContainer clearfix">\n		<li class="postContainerLeft">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>">\n				<img src="<%= actor_avatarUrl %>" width="50" height="50" title="<%- actor_name %>" />\n			</a>\n		</li>\n		<li class="postContainerright">\n			<%= content %>\n			<ul class="userPostDetails clearfix">\n				<li><span><% print(Utils.formatTimestamp(timestamp)) %></span></li>\n			</ul>\n		</li>\n	</ul>\n</script>\n\n<script type="text/template" id="site_feed_list_item_comment">\n	<ul class="postContainer clearfix">\n		<li class="postContainerLeft">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>">\n				<img src="<%= actor_avatarUrl %>" width="50" height="50" title="<%- actor_name %>" />\n			</a>\n		</li>\n		<li class="postContainerright">\n			<%= content %>\n			<p class="postContent"><%= comment %></p>\n			<% if(hasAttachments) { %>\n			<div id="comment_<%= type %>_<%= targetId %>_<%= objectId %>_attachments_container" class="userAttachementsContainer"></div>\n			<% } %>\n			<ul class="userPostDetails clearfix">\n				<li><span><% print(Utils.formatTimestamp(timestamp)) %></span></li>\n                                <% if(typeof canLike != \'undefined\' && canLike) { %>\n				<li>\n					<div class="jqLikeContainer"></div>\n				</li>\n                                <% } %>\n                                <li class="clear fnone"></li>\n                                <% if(typeof canLike != \'undefined\') { %>\n				<li class="fnone"><div class="jqLikers"></div></li>\n                                <% } %>\n			</ul>\n                        <div class="jqLikers"></div>\n		</li>\n	</ul>\n</script>\n\n<script type="text/template" id="site_feed_list_item_joined">\n	<ul class="postContainer clearfix">\n		<li class="postContainerLeft">\n			<a href="<%= actor_profileUrl %>" title="<%- actor_name %>">\n				<img src="<%= actor_avatarUrl %>" width="50" height="50" title="<%- actor_name %>" />\n			</a>\n		</li>\n		<li class="postContainerright">\n			<%= content %>\n			<ul class="userPostDetails clearfix">\n				<li><span><% print(Utils.formatTimestamp(timestamp)) %></span></li>\n			</ul>\n		</li>\n	</ul>\n</script>\n\n<script type="text/template" id="site_feed_list_view_more">\n	<div class="alert-message success viewMorePosts" id="<%= id %>_view_more">\n		<button class="btn" id="<%= id %>_view_more_link">\n			<img id="<%= id %>_view_more_loading" src="<%- img %>" class="hide"/>&nbsp;\n			<% print(translate(\'updates_view_more\')) %>\n		</button>\n	</div>\n</script>'}),define("feed/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var n=t.appendTemplate("feed_templates",n);return n}),define("feed/views/feedList",["require","beyazpano","attachment/views/list","like/views/like","comment/views/comment","order!date","order!jquery.editinplace","feed/_templates"],function(e,t,n,r,i){var s=Backbone.View.extend({templateNames:{main:"site_feed_list",list_item:"site_feed_list_item",view_more:"site_feed_list_view_more",post_item_template:"site_feed_list_item_post",discussion_item_template:"site_feed_list_item_discussion",section_item_template:"site_feed_list_item_section",became_friends:"site_feed_list_item_became_friends",comment:"site_feed_list_item_comment",item_joined:"site_feed_list_item_joined"},initialize:function(e){this.initHandlers(),this.config={},this.collection=null,this.userId=BAppConfig.get("mydata","id"),e.config&&(this.config=_.extend(this.config,e.config)),this.onCollectionReset=_.bind(this.onCollectionReset,this),e.collection&&(this.collection=e.collection,this.collection.off("reset"),this.collection.on("reset",this.onCollectionReset),this.collection.on("feedDataAdded",_.bind(function(e){this.renderFeed(e)},this))),this.elId=_.uniqueId("feed_list_")},onCollectionReset:function(){this.render()},render:function(){var e=this.collection.toJSON(),n={activities_lits:e,id:this.elId,isInstructor:BAppConfig.get("mydata","role")=="INSTRUCTOR"},r=$(t.renderTemplate(this.templateNames.main,n));$(this.el).html(r),this.renderFeed(e)},renderFeed:function(e){e.length>0&&_.each(e,_.bind(function(e){this.renderActivityItem(e,"#"+this.elId+"_list")},this))},renderActivityItem:function(e,t){var n=BAppConfig.get("mydata","id"),r=BAppConfig.get("site_feed","config").activity,i={},s="";e.object_type==r.objectTypes["post"]&&this.renderWallPost(e,t),e.object_type==r.objectTypes["profile"]&&this.renderBecameFriends(e,t),e.object_type==r.objectTypes["discussion"]&&this.renderCreateDiscussionActivity(e,t),e.object_type==r.objectTypes["section"]&&this.renderCreateSectionActivity(e,t),e.object_type==r.objectTypes["comment"]&&this.renderComment(e,t),e.object_type==r.objectTypes["user"]&&this.renderUserActivity(e,t),this.renderViewMoreUpdatesButton()},renderUserActivity:function(e,n){var r={},i=BAppConfig.get("site_feed","config").activity,s=!1;if(e.verb==i.verbs["join"])if(e.target_type==i.targetTypes["group"]){var o=this.collection.getGroupData(e.target_id);if(o){r.title=o.name;var u=BAppConfig.get("site_groups","groupUrl");r.group_url=u.replace("__groupid__",o.id)}else s=!0}else{var a=this.collection.getSectionData(e.target_id);if(a){r.title=a.full_name;var f=BAppConfig.get("site_sections","sectionUrl");r.section_url=f.replace("__sectionid__",a.id)}else s=!0}if(s==0){r.timestamp=Date.parseExact(e.created,"yyyy-MM-dd HH:mm:ss");var l=this.collection.getUserData(e.object_id);l!==null?(r.actor_name=l.first_name+" "+l.last_name,r.actor_avatarUrl=l.avatar):(r.actor_name="",r.actor_avatarUrl=""),r.actor_profileUrl=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.actor_id);var c='<a href="'+r.actor_profileUrl+'" title="'+_.escape(r.actor_name)+'" class="postedBy">'+_.escape(r.actor_name)+"</a>";if(e.target_type==i.targetTypes["group"]){var h='<a href="'+r.group_url+'" title="'+_.escape(r.title)+'" class="postedBy">'+_.escape(r.title)+"</a>";r.content=translate("feed_user_joined_group","M",[c,h])}else{var p='<a href="'+r.section_url+'" title="'+_.escape(r.title)+'" class="postedBy">'+_.escape(r.title)+"</a>";r.content=Utils.formatString(_.escape(translate("feed_user_joined_section")),c,p)}var d=$(t.renderTemplate(this.templateNames.item_joined,r));d.hide(),$(n).append(d),d.fadeIn("slow")}},renderComment:function(e,i){var s={},o=BAppConfig.get("site_feed","config").activity,u=null;s.target={},s.comment="";var a=!1,f=!1,l="comment",c,h=null;if(e.target_type==o.targetTypes["assignment"]){var p=this.collection.getAssignmentData(e.target_id);if(p){var d=this.collection.getAssignmentCommentData(e.object_id);d?(s.target.name=p.name,s.target.url=BAppConfig.get("site_assignment","assignment_info").replace("__ASSIGNMENT_ID__",e.target_id),s.comment=d.body.replace(/\n/g,"<br />"),f=!0,l="assignment",c=d.id,s.canLike=p.readonly=="0"?!0:!1,h=this.collection.getAssignmentCommentLikeData(c)):a=!0}else a=!0}else if(e.target_type==o.targetTypes["quiz"]){var v=this.collection.getQuizData(e.target_id);if(!_.isNull(v)){var m=this.collection.getQuizCommentData(e.object_id);m?(s.target.name=v.name,s.target.url=BAppConfig.get("site_quiz","quizInfo").replace("__QUIZ_ID__",e.target_id).replace("__TAB__","comments"),s.comment=m.body.replace(/\n/g,"<br />"),f=!0,l="quiz",c=m.id,s.canLike=v.readonly=="0"?!0:!1,h=this.collection.getQuizCommentLikeData(c)):a=!0}else a=!0}else if(e.target_type==o.targetTypes["discussion"]){var g=this.collection.getDiscussionData(e.target_id);if(g){var y=this.collection.getDiscussionMessageData(e.object_id);y?(s.target.name=g.title,s.target.url=BAppConfig.get("site_sections","discussionUrl").replace("__SECTIONID__",g.section_id).replace("__DISCUSSIONID__",g.id),s.comment=y.body.replace(/\n/g,"<br />"),u=y.attachments):a=!0}else a=!0}else if(e.target_type==o.targetTypes["event"]){var b=this.collection.getEventData(e.target_id),w=this.collection.getEventCommentData(e.object_id);b&&w?(s.target.name=b.title,s.target.url=BAppConfig.get("site_event","config").eventPageLink.replace("__idevent__",b.id),s.comment=w.body.replace(/\n/g,"<br />"),l="event",f=!0,c=w.id,s.canLike=b.readonly=="0"?!0:!1,h=this.collection.getEventCommentLikeData(c)):a=!0}if(a==0){s.timestamp=Date.parseExact(e.created,"yyyy-MM-dd HH:mm:ss");var E=this.collection.getUserData(e.actor_id);E!==null?(s.actor_name=E.first_name+" "+E.last_name,s.actor_avatarUrl=E.avatar):(s.actor_name="",s.actor_avatarUrl=""),s.actor_profileUrl=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.actor_id),u?(s.hasAttachments=!0,s.type=e.target_type,s.targetId=e.target_id,s.objectId=e.object_id):s.hasAttachments=!1;var S='<a href="'+s.actor_profileUrl+'" title="'+_.escape(s.actor_name)+'" class="postedBy">'+_.escape(s.actor_name)+"</a>",x='<a href="'+s.target.url+'" title="'+_.escape(s.target.name)+'" class="postedBy">'+_.escape(s.target.name)+"</a>";e.target_type==o.targetTypes["event"]?s.content=Utils.formatString(_.escape(translate("feed_user_commented_on_event")),S,x):e.target_type==o.targetTypes["assignment"]?s.content=Utils.formatString(_.escape(translate("feed_user_commented_on_assignemnt")),S,x):e.target_type==o.targetTypes["quiz"]?s.content=translate("feed_user_commented_on_quiz","M",[S,x]):e.target_type==o.targetTypes["discussion"]&&(s.content=Utils.formatString(_.escape(translate("feed_user_commented_on_discussion")),S,x));var T=$(t.renderTemplate(this.templateNames.comment,s));T.hide(),$(i).append(T);var N=[e.target_type,e.target_id,e.object_id].join("_");if(u&&_.isObject(u)&&(u.file||u.link)){var C=new n({el:"#comment_"+N+"_attachments_container",config:{},attachments:u,postid:N});C.render()}if(f===!0){var k=new r({el:T.find(".jqLikeContainer:first"),likersContainer:T.find(".jqLikers:first"),canLike:s.canLike}),L={};h!==null?L=h:(L.entity_id=c,L.type=l),L.page_type=l,L.page_entity_id=e.target_id,k.renderLike(L)}T.fadeIn("slow")}},renderCreateSectionActivity:function(e,n){var r=BAppConfig.get("mydata","id"),i=BAppConfig.get("site_feed","config").activity,s={},o=this.templateNames.section_item_template,u=this.collection.getSectionData(e.object_id);if(u){s.itemId=parseInt(u.id),s.timestamp=Date.parseExact(e.created,"yyyy-MM-dd HH:mm:ss"),s.title=u.full_name;var a=BAppConfig.get("site_sections","sectionUrl");s.section_url=a.replace("__sectionid__",u.id);var f=this.collection.getUserData(e.actor_id);f!==null?(s.actor_name=f.first_name+" "+f.last_name,s.actor_avatarUrl=f.avatar):s.actor_name=item.author,s.actor_profileUrl=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.actor_id);var l='<a href="'+s.section_url+'" title="'+_.escape(s.title)+'" class="postedBy">'+_.escape(s.title)+"</a>",c='<a href="'+s.actor_profileUrl+'" title="'+_.escape(s.actor_name)+'" class="postedBy">'+_.escape(s.actor_name)+"</a>";s.content=Utils.formatString(_.escape(translate("user_created_section")),c,l);var h=$(t.renderTemplate(o,s));h.hide(),$(n).append(h),h.fadeIn("slow")}},renderCreateDiscussionActivity:function(e,n){var r=BAppConfig.get("mydata","id"),i=BAppConfig.get("site_feed","config").activity,s={},o=this.templateNames.discussion_item_template,u=this.collection.getDiscussionData(e.object_id),a=this.collection.getSectionData(e.target_id);if(u&&a){s.itemId=parseInt(u.id),s.timestamp=Date.parseExact(e.created,"yyyy-MM-dd HH:mm:ss"),s.description=_.escape(u.description).replace(/\n/g,"<br />"),s.title=u.title;var f=this.collection.getUserData(e.actor_id);f!==null?(s.actor_name=f.first_name+" "+f.last_name,s.actor_avatarUrl=f.avatar):s.actor_name=item.author,s.actor_profileUrl=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.actor_id);if(a){var l=BAppConfig.get("site_sections","sectionUrl");s.target={name:a.full_name,url:l.replace("__sectionid__",a.id)}}s.discussion_url=BAppConfig.get("site_sections","discussionUrl").replace("__SECTIONID__",a.id).replace("__DISCUSSIONID__",u.id);var c='<a href="'+s.actor_profileUrl+'" title="'+_.escape(s.actor_name)+'" class="postedBy">'+_.escape(s.actor_name)+"</a>",h='<a href="'+s.target.url+'" title="'+_.escape(s.target.name)+'" class="postedBy">'+_.escape(s.target.name)+"</a>",p='<a href="'+s.discussion_url+'" title="'+_.escape(s.title)+'" class="postedBy" >'+_.escape(s.title)+"</a>";s.content=Utils.formatString(_.escape(translate("user_created_discussion")),c,p,h);var d=$(t.renderTemplate(o,s));d.hide(),$(n).append(d),d.fadeIn("slow")}},renderWallPost:function(e,s){var o=BAppConfig.get("mydata","id"),u=BAppConfig.get("site_feed","config").activity,a={},f="";a.id=this.elId;var l=this.collection.getPostData(e.object_id);if(l){a.type=1,a.itemId=parseInt(l.id),a.canDelete=l.canDelete,a.canEdit=l.canEdit,a.isAnnouncement=parseInt(l.is_announcement)==1,a.timestamp=Date.parseExact(l.timestamp,"yyyy-MM-dd HH:mm:ss"),a.body=_.escape(l.body).replace(/\n/g,"<br />"),a.canComment=l.canLike,a.canLike=l.canLike;var c=this.collection.getUserData(e.actor_id);c!==null?(a.actor_name=c.first_name+" "+c.last_name,a.actor_avatarUrl=c.avatar):a.actor_name=l.author,a.actor_profileUrl=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.actor_id);var h={},p="",d="",v=null,m="",g="",y="",b=!1;if(e.target_type==u.targetTypes.sectionWall){var w=this.collection.getSectionData(e.target_id);if(w){w.readonly==1&&(a.canComment=l.canComment=!1,a.canLike=l.canLike=!1);var E=BAppConfig.get("site_sections","sectionUrl");a.wallType=3,a.target={name:w.full_name,url:E.replace("__sectionid__",w.id)},h.sectionId=w.id,p="section_post",d="section_post_like",v=e.target_id,m=_.escape(translate("user_created_section_post"))}else b=!0}else if(e.target_type==u.targetTypes.userWall){var S=this.collection.getUserData(e.target_id);S?(a.target={name:S.first_name+" "+S.last_name,url:BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.target_id)},a.wallType=1,h.userId=c.id,p="profile_post",d="profile_post_like",v=e.target_id,S.gender=="M"?m=_.escape(translate("user_added_wall_post_single")):m=_.escape(translate("user_added_wall_post_single","F"))):b=!0}else if(e.target_type==u.targetTypes.groupWall){var x=this.collection.getGroupData(e.target_id);if(x){x.readonly==1&&(a.canComment=l.canComment=!1,a.canLike=l.canLike=!1);var E=BAppConfig.get("site_groups","groupUrl");a.wallType=2,a.target={name:x.name,url:E.replace("__groupid__",x.id)},h.groupId=x.id,p="group_post",d="group_post_like",v=e.target_id,g='<a href="'+a.actor_profileUrl+'" title="'+_.escape(a.actor_name)+'" class="postedBy">'+_.escape(a.actor_name)+"</a>",y='<a href="'+a.target.url+'" title="'+_.escape(a.target.name)+'" class="postedBy">'+_.escape(a.target.name)+"</a>",m=translate("user_created_group_post","M",[g,y])}else b=!0}else if(e.target_type==u.targetTypes.groupDiscussionWall){var T=this.collection.getGroupDiscussionData(e.target_id);if(T){if(T.approved!=1||T.group_readonly==1)a.canComment=l.canComment=!1,a.canLike=l.canLike=!1;var E=BAppConfig.get("group_discussions","groupDiscussionUpdates");a.wallType=4,a.target={name:T.title,url:E.replace("__discussionid__",T.id).replace("__groupid__",T.group_id)},h.groupDiscussionId=T.id,p="group_discussion_post",d="group_discussion_post_like",v=e.target_id,g='<a href="'+a.actor_profileUrl+'" title="'+_.escape(a.actor_name)+'" class="postedBy">'+_.escape(a.actor_name)+"</a>",y='<a href="'+a.target.url+'" title="'+_.escape(a.target.name)+'" class="postedBy">'+_.escape(a.target.name)+"</a>",m=translate("user_created_group_discussion_post","M",[g,y])}else b=!0}if(b==0){var g='<a href="'+a.actor_profileUrl+'" title="'+_.escape(a.actor_name)+'" class="postedBy">'+_.escape(a.actor_name)+"</a>",y='<a href="'+a.target.url+'" title="'+_.escape(a.target.name)+'" class="postedBy">'+_.escape(a.target.name)+"</a>";a.content=Utils.formatString(m,g,y),f=this.templateNames.post_item_template;var N=$(t.renderTemplate(f,a));N.hide(),$(s).append(N);var C=new r({el:N.find(".jqLikeContainer:first"),likersContainer:N.find(".jqLikers:first"),canLike:l.canLike}),k={type:"post",entity_id:l.id,page_type:d,page_entity_id:v},L=this.collection.getLikeData(l.id);L!==null&&(k=L),C.renderLike(k);var A=new i({el:N.find(".jqCommentContainer:first"),additionalData:h,addCommentLink:N.find(".jqCommentContainer:first").parent().find(".jqAddComment:first"),canComment:l.canComment,canLike:l.canLike}),O={entityType:p,entityId:l.id,items:[],nrOfComments:0,page_entity_id:e.target_id},M=null,D=this.collection.getCommentsData(l.id,p);D!==null&&D.items&&(O.items=D.items,O.nrOfComments=D.nrOfComments,O.likes=D.likes,M=this.collection.getUsers(this.collection.getUserIdsByCommentsType(p))),A.renderComment(O,M,O.likes);var P=this.elId+"_i_1_"+l.id;if(l.attachments&&_.isObject(l.attachments)&&(l.attachments.file||l.attachments.link||l.attachments.video)){var H=new n({el:"#"+P+"_attachments_container",config:{},attachments:l.attachments,postid:l.id});H.render()}N.find(".close").on("click",_.bind(function(e){var t=e.target.id.replace("remove_post_",""),n={postType:t.split("_")[0],postId:t.split("_")[1],wallType:t.split("_")[2]};Utils.confirm(translate("delete_post"),translate("delete_post_text"),function(e){e=="yes"&&$.ajax({type:"POST",url:BAppConfig.get("site_post","deletePostUrl"),data:n,success:_.bind(function(e){e.success?$("#post_"+t).fadeOut("slow",function(){$(this).remove()}):Utils.alert(translate("error_title"),translate("error_delete_post"))},this),dataType:"json"})})},this)),N.find(".report").on("click",_.bind(function(e){var t=e.target.id.replace("report-","");$.ajax({type:"POST",url:BAppConfig.get("admin_complaints","ajarUrlComplaintsJson")+"/opencreate",data:{postKey:t},success:_.bind(function(e){var t=Utils.popup(translate("global_report"),e.data.body,e.data.footer)},this),dataType:"json"})},this)),N.fadeIn("slow")}}},renderBecameFriends:function(e,n){var r={};r.id=this.elId,r.timestamp=Date.parseExact(e.created,"yyyy-MM-dd HH:mm:ss");var i=this.collection.getUserData(e.actor_id),s=this.collection.getUserData(e.object_id);i!==null?(r.actor_name=i.first_name+" "+i.last_name,r.actor_avatarUrl=i.avatar):r.actor_name=e.author,r.actor_profileUrl=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.actor_id);if(s!==null)var o=s.first_name+" "+s.last_name;else var o="";var u=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.object_id),a='<a href="'+u+'" title="'+_.escape(o)+'" class="postedBy">'+_.escape(o)+"</a>",f='<a href="'+r.actor_profileUrl+'" title="'+_.escape(r.actor_name)+'" class="postedBy">'+_.escape(r.actor_name)+"</a>";r.content=Utils.formatString(_.escape(translate("user_became_friend")),f,a);var l=$(t.renderTemplate(this.templateNames.became_friends,r));l.hide(),$(n).append(l),l.fadeIn("slow")},initHandlers:function(){$("#add-report").live("click",_.bind(function(e){if($("#addReportForm").valid()){$("#_dialog_popup").modal("hide");var t=$("#addReportForm").serialize();$.ajax({type:"POST",url:BAppConfig.get("admin_complaints","ajarUrlComplaintsJson")+"/create",data:t,success:_.bind(function(e){if(e.success)Utils.alert(translate("global_report"),translate("report_message_sent"));else for(var t in e.msg)Admin.flashMessage(Admin.FLASH_ERROR,"",e.msg[t],"#alert_add_report")},this),dataType:"json"})}}))},renderViewMoreUpdatesButton:function(){$("#"+this.elId+"_view_more").remove();var e=this.collection.getPaginationData();if(e.page>0&&e.pages>e.page){var n=t.renderTemplate(this.templateNames.view_more,{id:this.elId,img:BAppConfig.get("global","ajaxLoadingImg")});$(this.el).append(n),$("#"+this.elId+"_view_more_link").on("click",_.bind(function(){$("#"+this.elId+"_view_more_loading").removeClass("hide"),$("#"+this.elId+"_view_more_link").attr("disabled","disabled"),this.trigger("viewMoreActivities")},this))}}});return s}),define("feed/model/activity",["beyazpano"],function(e){var t=Backbone.Model.extend({initialize:function(){}});return t}),define("feed/collection/feedData",["feed/model/activity"],function(e){var t=Backbone.Collection.extend({initialize:function(e){this.details={page:0,pages:0,limit:20,total:0},this.activitesData={},_.isEmpty(e)||this.parse(e)},model:e,parse:function(e){if(!_.isEmpty(e)&&!_.isEmpty(e.data)){var t=e.data;this.details.page=_.isEmpty(""+t.page)?0:t.page,this.details.pages=_.isEmpty(""+t.pages)?0:t.pages,this.details.limit=_.isEmpty(""+t.limit)?20:t.limit,this.details.total=_.isEmpty(""+t.total)?0:t.total,this.activitesData=_.isEmpty(t.feed.data)?{}:t.feed.data}return _.isEmpty(e.data.feed.activities)?null:e.data.feed.activities},getPaginationData:function(){return this.details},getUsers:function(e){var t={};for(var n=0;n<e.length;n++){var r=this.getUserData(e[n]);r!==null&&(t[r.id]=r)}return t},getUserData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.users)&&!_.isUndefined(this.activitesData.users[e])&&(t=_.extend({actor_avatarUrl:""},this.activitesData.users[e])),t},getPostData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.post)&&!_.isUndefined(this.activitesData.post[e])&&(t=this.activitesData.post[e]),t},getSectionData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.section)&&!_.isUndefined(this.activitesData.section[e])&&(t=this.activitesData.section[e]),t},getLikeData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.likes)&&!_.isUndefined(this.activitesData.likes[e])&&(t=this.activitesData.likes[e]),t},loadMoreActivities:function(e){var t=_.clone(this.details);t.page=t.page+1,this.fetch({data:t,add:!e,success:_.bind(function(t,n){e||t.trigger("feedDataAdded",n.data.feed.activities,t)},this)})},getUserIdsByCommentsType:function(e){var t=this.getDataSectionByType(e),n=[];return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData[t])&&!_.isUndefined(this.activitesData[t].users)&&(n=this.activitesData[t].users),n},getDataSectionByType:function(e){var t="";switch(e){case"profile_post":t="profile_post_comment";break;case"section_post":t="section_post_comment";break;case"group_post":t="group_post_comment";break;case"group_discussion_post":t="group_discussion_post_comment"}return t},getDiscussionData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.discussion)&&!_.isUndefined(this.activitesData.discussion[e])&&(t=this.activitesData.discussion[e]),t},getCommentsData:function(e,t){var n=null,r=this.getDataSectionByType(t);return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData[r])&&!_.isUndefined(this.activitesData[r].comments)&&!_.isUndefined(this.activitesData[r].comments[e])&&(n=this.activitesData[r].comments[e]),n},getAssignmentData:function(e){var t=null;return!_.isEmpty(this.activitesData.assignment)&&!_.isEmpty(this.activitesData.assignment[e])&&(t=this.activitesData.assignment[e]),t},getAssignmentCommentData:function(e){var t=null;return!_.isEmpty(this.activitesData.assignment_comment)&&!_.isEmpty(this.activitesData.assignment_comment.comments)&&!_.isEmpty(this.activitesData.assignment_comment.comments[e])&&(t=this.activitesData.assignment_comment.comments[e]),t},getAssignmentCommentLikeData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.assignment_comment)&&!_.isUndefined(this.activitesData.assignment_comment.likes)&&!_.isUndefined(this.activitesData.assignment_comment.likes[e])&&(t=this.activitesData.assignment_comment.likes[e]),t},getQuizData:function(e){var t=null;return!_.isEmpty(this.activitesData.quiz)&&!_.isEmpty(this.activitesData.quiz[e])&&(t=this.activitesData.quiz[e]),t},getQuizCommentData:function(e){var t=null;return!_.isEmpty(this.activitesData.quiz_comment)&&!_.isEmpty(this.activitesData.quiz_comment.comments)&&!_.isEmpty(this.activitesData.quiz_comment.comments[e])&&(t=this.activitesData.quiz_comment.comments[e]),t},getQuizCommentLikeData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.quiz_comment)&&!_.isUndefined(this.activitesData.quiz_comment.likes)&&!_.isUndefined(this.activitesData.quiz_comment.likes[e])&&(t=this.activitesData.quiz_comment.likes[e]),t},getDiscussionMessageData:function(e){var t=null;return!_.isEmpty(this.activitesData.discussion_message)&&!_.isEmpty(this.activitesData.discussion_message[e])&&(t=this.activitesData.discussion_message[e]),t},getEventData:function(e){var t=null;return!_.isEmpty(this.activitesData.event)&&!_.isEmpty(this.activitesData.event[e])&&(t=this.activitesData.event[e]),t},getEventCommentData:function(e){var t=null;return!_.isEmpty(this.activitesData.event_comment)&&!_.isEmpty(this.activitesData.event_comment.comments)&&!_.isEmpty(this.activitesData.event_comment.comments[e])&&(t=this.activitesData.event_comment.comments[e]),t},getEventCommentLikeData:function(e){var t=null;return!_.isUndefined(this.activitesData)&&!_.isUndefined(this.activitesData.event_comment)&&!_.isUndefined(this.activitesData.event_comment.likes)&&!_.isUndefined(this.activitesData.event_comment.likes[e])&&(t=this.activitesData.event_comment.likes[e]),t},getGroupData:function(e){var t=null;return!_.isEmpty(this.activitesData.group)&&!_.isEmpty(this.activitesData.group[e])&&(t=this.activitesData.group[e]),t},getGroupDiscussionData:function(e){var t=null;return!_.isEmpty(this.activitesData.group_discussion)&&!_.isEmpty(this.activitesData.group_discussion[e])&&(t=this.activitesData.group_discussion[e]),t}});return t}),define("home/views/feed",["require","beyazpano","feed/views/feedList","feed/collection/feedData"],function(e,t,n,r){var i=Backbone.View.extend({templateNames:{main:"home_feed"},initialize:function(e){this.$el=$(this.el),this.postUpdateView=null,this.feedDataCollection=new r,this.feedDataCollection.url=BAppConfig.get("site_feed","config").feedAjaxBaseUrl},getFeedDataCollection:function(){return this.feedDataCollection},render:function(){var e=t.renderTemplate(this.templateNames.main,{});this.$el.html(e),this.feedList=new n({el:"#feed_list_container",collection:this.feedDataCollection}),this.feedDataCollection.fetch(this.feedDataCollection.details),this.feedList.on("viewMoreActivities",_.bind(function(){this.feedDataCollection.loadMoreActivities(!1)},this))}});return i}),define("text!updates/templates.html",[],function(){return'<script type="text/template" id="site_post_update">\n    <div class="updateBox" id="<%= id %>">\n        <form id="<%= id %>_form" class="postForm">\n            <ul>\n                <li>\n                    <textarea name="body" id="<%= id %>_body" class="required" placeholder="<% print(translate(\'profile_write_update\')) %>"></textarea>\n                </li>\n            </ul>\n            <input type="hidden" id="<%= id %>_attachments" name="attachments" value="" />\n            <% if(canBeAnnouncement) { %>\n            <input type="checkbox" name="is_announcement" id="<%= id %>_is_announcement" value="1" />\n            <label class="anouncementLabel" for="<%= id %>_is_announcement"><% print(_.escape(translate(\'post_anouncement\'))) %></label>\n            <% } else { %>\n            <input type="hidden" name="is_announcement" value="0" />\n            <% } %>\n            <%if(addAutocompleteContainer){%>\n            <div id="autocomplete"></div>\n            <%}%>\n            <ul><li>\n                    <input type ="hidden" id="<%= id %>_walls" name="walls" class="required" value="" />\n            </li></ul>    \n        </form>\n        <div class="clear"></div>\n        <ul id="<%= id %>_videos" class ="ul_post_video"></ul> \n        <div id="<%= id %>_attachemnts" class="userMessageAttachment userPostAttachements"></div>\n        <button id="<%= id %>_post" class="btn primary  right userPostButton uploadDisableBtn"><% print(_.escape(translate(\'global_post\'))) %></button>\n    </div>\n</script>\n\n<script type="text/template" id="site_updates_list">\n    <div id="<%= id %>" class="updatesContainer">\n        <div id="<%= id %>_loading">\n            <im>\n        </div>\n        <% if(updates_list && updates_list.length > 0 && hasAccess) { %>\n        <div id="<%= id %>_list" class="updatesList"></div>\n        <% } else if(hasAccess){ %>\n        <h3 class="noActivityMsg"><% print(_.escape(translate(\'there_are_no_updates\'))) %></h3>\n        <% } else { %>\n        <h3 class="noActivityMsg"><% print(_.escape(translate(\'updates_no_access\'))) %></h3>\n        <% } %>\n    </div>\n</script>\n<script type="text/template" id="site_updates_list_item">\n    <ul class="postContainer <% if(isAnnouncement){ %>announcement<% } %> <% if(needsApproval){ %>approval<% } %> clearfix" id="post_<%= type %>_<%= itemId %>">\n        <li class="postContainerLeft">\n            <a href="<%= profileUrl %>" title="<%- author_name %>">\n                <img src="<%= avatarUrl %>" width="50" height="50" title="<%- author_name %>" />\n            </a>\n        </li>\n        <li class="postContainerright">\n            <a href="<%= profileUrl %>" title="<%- author_name %>" class="postedBy"><%- author_name %></a>\n            <% if(canDelete) { %>\n            <a class="close" id="remove_post_<%= type %>_<%= itemId %>" href="javascript:void(0)" title="<% print(_.escape(translate(\'site_posts_remove_post\'))) %>">×</a>\n            <% } %>\n            <p class="postContent"><%= body %></p>\n            <% if(pendingApproval && !needsApproval){%>\n                <span class="greenTxt"><% print(_.escape(translate(\'need_instructor_approval_post\'))) %></span>\n            <% } %>\n            \n            <div id="<%= id %>_i_<%= type %>_<%= itemId %>_attachments_container" class="userAttachementsContainer"></div>\n            <ul class="userPostDetails clearfix">\n                <% if(d = Utils.formatTimestamp(timestamp)) { %>\n                <li ><span class="postFeedTime"><% print(d) %></span></li>\n                <% } %>\n                <% if(canComment) { %>\n                <li>\n                    <a href="javascript:void(0)" class="jqAddComment"><% print(_.escape(translate(\'global_comment\'))) %></a>\n                </li>\n                <% } %>\n                <% if(canLike) { %>\n                <li>\n                    <div class="jqLikeContainer"></div>\n                </li>\n                <% } %>\n                <li class="fnone" >\n                    <a href="javascript:void(0)" class="report" id="report-<%= itemId %>"><% print(_.escape(translate(\'global_report\'))) %></a>\n                    <% if(needsApproval){ %>\n                    <% if(canComment) { %>\n                    <a href="javascript:void(0)" class="reject_post right btn" id="reject_post_<%= type %>_<%= itemId %>"><% print(_.escape(translate(\'global_delete\'))) %></a>\n                    <a href="javascript:void(0)" class="approve_post right btn userDefaultBtn" id="approve_post_<%= type %>_<%= itemId %>"><% print(_.escape(translate(\'global_approve\'))) %></a>\n                    <% } else {%>\n                    <p class="greenTxt"><% print(_.escape(translate(\'post_not_moderated\'))) %></p>\n                    <% } %>\n                    <% } %>\n\n                </li>\n                <li class="clear"></li>\n                <li class="fnone" ><div class="jqLikers"></div></li>\n            </ul>\n\n            <div class="jqLikers"></div>\n            <div class="jqCommentContainer"></div>\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="site_updates_list_view_more">\n    <div class="alert-message success viewMorePosts" id="<%= id %>_view_more">\n        <button class="btn" id="<%= id %>_view_more_link">\n            <img id="<%= id %>_view_more_loading" src="<%- img %>" class="hide"/>&nbsp;\n            <% print(translate(\'updates_view_more\')) %>\n        </button>\n    </div>\n</script>\n\n\n<!--START ASSIGNMENT-->\n<script type="text/template" id="site_home_assignments">\n<div id="edit_course" class="createAssignmentPopup addAssignWallContainer">\n    <div class="modalContent">\n       <div id="flash-message"></div>\n        <form name="addAssignmentForm" id="addAssignmentForm" action="" method="post" class="addAssignForm">\n            <ul class="modalForm">\n                <li class="clearfix">\n                    <label><% print(_.escape(translate(\'assignment_name\'))) %>:</label>\n                    <input type="text" class="required" name="data[name]"  />\n                </li>\n                <li class="clearfix">\n                    <label><% print(_.escape(translate(\'assignment_description\'))) %>:</label>\n                    <textarea name="data[description]"  class="autosizable" ></textarea>\n                </li>\n                <li class="clearfix">\n                    <label><% print(_.escape(translate(\'assignment_dropbox\'))) %>:</label>\n                    <input type="checkbox" name="data[dropbox]" value="1" checked="checked"/>\n                </li>\n                <li class="clearfix">\n                    <label><% print(_.escape(translate(\'assignment_ungraded\'))) %>:</label>\n                    <input type="checkbox" id="ungraded" name="data[ungraded]" value="1" />\n                </li>\n                <li class="clearfix" id="points-field">\n                    <label><% print(_.escape(translate(\'assignment_points\'))) %>:</label>\n                    <input type="text" name="data[points]"  value="100"/>\n                </li>\n                <li class="dateImputContainer clearfix">\n                    <label><% print(_.escape(translate(\'assignment_duedate\'))) %>:</label>\n                    <input type="text" class="required datepicker-grading-period" name="date" />\n					\n                    <input type="text" class="required timepicker" name="time" />\n                </li>\n                <li>\n                    <div id="autocomplete_event_walls_assignment" class="clearfix"></div>\n                    <div class="errorContainer clearfix">\n                        <input type="text" id="section_walls_assignment"  class="required" name="section_walls" />\n                    </div>\n                </li>\n            </ul>\n            <input name="attachments" type="hidden" >\n        </form>\n        <div id="attachmentsHome" class="userMessageAttachment userPostAttachements clearfix"></div>\n        <div id="attachmentsContainerHome" class="userMessageLinkright"></div>\n    </div>\n</div>\n</script>\n<!--END ASSIGNMENT-->\n\n<!--START EVENT-->\n<script type="text/template" id="site_home_events">\n<div class="addEventContainer">\n    <div id="flash-message"></div>\n    <form name="addEventForm" id="addEventForm" action="" method="post" class="clearfix">\n        <ul class="modalForm">\n            <li class="dateImputContainer clearfix">\n                <label><% print(_.escape(translate(\'event_when\'))) %>:</label>\n                <ul class="dateInputlist">\n                    <li>\n                        <input type="text" class="required datepicker-grading-period-start" name="start_date"/>\n                    </li>\n                    <li>\n                        <input type="text" id="timepicker-start" class="required timepicker" name="start_time"/>\n                    </li>\n                </ul>\n\n            </li>\n            <li class="clearfix">\n                <label>&nbsp</label>\n                <a href="#" id="add_end_time" class="btn"><% print(_.escape(translate(\'event_add_end_time\'))) %></a>\n            </li>\n            <li class="dateImputContainer clearfix" id="end_date_event" style="display:none;">\n                <label><% print(_.escape(translate(\'event_end_time\'))) %>:</label>\n                <ul class="dateInputlist">\n                    <li><input type="text" class="required datepicker-grading-period-end" name="end_date"/></li>\n                    <li><input type="text" id="timepicker-end" class="required timeentry" name="end_time"/></li>\n                </ul>\n\n\n            </li>\n            <li class="eventTitleContainer clearfix">\n                <label><% print(_.escape(translate(\'event_title\'))) %>:</label>\n                <input class="required" type="text" name="data[title]"/>\n            </li>\n            <li class="clearfix">\n                <label><% print(_.escape(translate(\'event_description\'))) %>:</label>\n                <textarea name="data[description]"></textarea>\n            </li>\n             <% if(BAppConfig.get(\'mydata\',\'role\') == \'INSTRUCTOR\') { %>\n           \n                <li>\n                    <label><% print(_.escape(translate(\'event_type\'))) %>:</label>\n                    <select name="data[rsvp]" id="event_type">\n                        <option value="0"><% print(_.escape(translate(\'event_type_private\'))) %></option>\n                        <option value="1"><% print(_.escape(translate(\'event_type_exam\'))) %></option>\n                        <option value="2"><% print(_.escape(translate(\'event_type_public\'))) %></option>\n                        <option value="3"><% print(_.escape(translate(\'group_event_mandatory\'))) %></option>\n                        <option value="4"><% print(_.escape(translate(\'group_event_optional\'))) %></option>\n                    </select>\n                </li>\n                 <% } else { %>\n           \n                <input type="hidden" name="data[rsvp]" value="0" />\n             <% } %>\n            <li>\n                <label><% print(_.escape(translate(\'event_enable_cooments\'))) %></label>\n                <input type="checkbox" name="data[comments]" value="1" checked="checked"/>\n            </li>\n            <li>\n                <div id="autocomplete_event_walls" class="clearfix"></div>\n                <div class="errorContainer clearfix">\n                    <input type="text" id="section_walls"  class="required" name="section_walls" value=""/>\n                </div>\n            </li>\n            <li class="attachementsBox clearfix">\n\n                \n                <input name="attachments" type="hidden">\n            </li>\n\n        </ul>\n    </form>\n    <div id="attachments" class="userMessageAttachment userPostAttachements clearfix"></div>\n    <div id="attachmentsContainer" class="userMessageLinkright"></div>\n</div>\n</script>\n<!--END EVENT-->\n'}),define("updates/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var n=t.appendTemplate("updates_templates",n);return n}),define("videoProcessor",function(){}),define("video.attachments",function(){}),define("updates/views/postUpdate",["require","beyazpano","autocomplete/views/autocomplete","library/views/shareFiles","non-app/_templates","jquery.json","attachment/views/component","jquery.tokeninput","updates/_templates","jquery.textarea.counter","jquery.textarea.autosize","order!placeholder","order!videoProcessor","order!video.attachments"],function(e,t,n,r,i){var s=Backbone.View.extend({templateNames:{main:"site_post_update"},initialize:function(e){this.config={walls:[],savePostUrl:null,maxChars:400,canBeAnnouncement:!1,canShareFiles:!0,useWallBrowser:!1,useTokenInput:!1},e.config&&(this.config=_.extend(this.config,e.config)),this.elId=_.uniqueId("post_update_")},render:function(){var e={id:this.elId,canBeAnnouncement:this.config.canBeAnnouncement,addAutocompleteContainer:this.config.useWallBrowser||this.config.useTokenInput},i=t.renderTemplate(this.templateNames.main,e);$(this.el).html(i),$("input, textarea").placeholder(),$("#"+this.elId+"_body").autosize(),$("#"+this.elId+"_form").validate({messages:{walls:{required:translate("post_update_course_required")},body:{required:translate("post_update_body_required")}},ignore:""}),_.isUndefined(this.config.walls)||$("#"+this.elId+"_walls").val(this.config.walls.join(",")),this.attachments=new Attachments("#"+this.elId+"_attachemnts",{uploaderUrl:BAppConfig.get("global","uploaderUrl"),clientUploader:BAppConfig.get("global","swfUploader"),initShareHandler:_.bind(function(e){$(e.container).live("click",_.bind(function(){var e=new r({shareLibraryType:"user",shareLibraryOwnerId:BAppConfig.get("mydata","id")});e.on("share_selected_files",_.bind(function(e,t){var n=[];for(var r=0;r<e.length;r++){var i=t[e[r]];n.push(i)}this.attachments.addFileAttachments(n)},this)),e.showPopup()},this))},this),canShare:this.config.canShareFiles,blockButtonId:"#"+this.elId+"_post"});var s=new VideoAttachments($("#"+this.elId+"_body"),{onVideoAttached:_.bind(function(e,t){this.attachments.addAttachments(e)},this),onVideoRemoved:_.bind(function(e,t){this.attachments.deleteAttachments(e)},this),listContainer:$("#"+this.elId+"_videos")});$("#"+this.elId+"_post").on("click",_.bind(function(){if($("#"+this.elId+"_form").valid()){var e=this.config.savePostUrl,t=this.attachments.getAttachments();$("#"+this.elId+"_attachments").val($.toJSON(t)),Utils.block(this.el),$.ajax({type:"POST",url:e,data:$("#"+this.elId+"_form").serialize(),success:_.bind(function(e){e.success?(this.render(),this.trigger("postSaved",e.data)):Utils.alert(translate("error_title"),"There was an error while trying to add your post")},this),complete:_.bind(function(){Utils.unblock(this.el)},this),dataType:"json"})}},this));if(this.config.useWallBrowser||this.config.useTokenInput)this.autocomplete=new n({config:{useWallBrowser:this.config.useWallBrowser,useTokenInput:this.config.useTokenInput,wallBrowserWallsSelected:this.config.walls,wallBrowserWalls:{courses:jsCoursesInfo.courses_data},wallType:"course",tokenInputSource:this.getWallListForTokenInput()}}),this.autocomplete.render(),this.autocomplete.on("ListChanged",_.bind(function(e){this.config.walls=e,$("#"+this.elId+"_walls").val(this.config.walls.join(",")),$("#"+this.elId+"_form").validate().element("#"+this.elId+"_walls")},this))},getWallListForTokenInput:function(){var e=[],t=jsCoursesInfo.courses_data,n=BAppConfig.get("mydata","id"),r=BAppConfig.get("mydata","first_name")+" "+BAppConfig.get("mydata","last_name");for(var i in t){var s=t[i].name,o=t[i].sections;for(var u in o){var a=o[u].name,f=o[u].id;e.push({id:"3_"+f,name:s+":"+a})}}return e}});return s}),define("home/views/showCourses",["require","beyazpano"],function(e,t){var n=Backbone.View.extend({initialize:function(e){$("#show_remaining").on("click",function(e){e.preventDefault(),$(".remaining_courses").removeClass("hide"),$("#show_remaining").remove()})}});return n}),define("home/views/showGroups",["require","beyazpano"],function(e,t){var n=Backbone.View.extend({initialize:function(e){$("#show_remaining_groups").on("click",function(e){e.preventDefault(),$(".remaining_groups").removeClass("hide"),$("#show_remaining_groups").remove()})}});return n}),define("home/views/main",["require","beyazpano","home/_templates","default/views/siteHeader","default/views/siteLeftMenu","home/views/feed","updates/views/postUpdate","event/main","assignments/assignment","home/views/showCourses","home/views/showGroups","reminder/views/reminder","non-app/_templates"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=Backbone.View.extend({templateNames:{main:"home_main",assignment:"site_home_assignments",event:"site_home_events"},el:$("#content"),render:function(){r.render();var e=new i({el:"#content_left",config:BAppConfig.get("site_home","config").left_menu,insertMethod:"prepend"});e.render();var n=t.renderTemplate(this.templateNames.main,{title_name:translate("site_home_recent_activity"),user_role:BAppConfig.get("mydata","role")});this.$el.html(n),BAppConfig.get("mydata","role")=="INSTRUCTOR"&&(this.postUpdateView=new o({el:"#postUpdate",config:{useWallBrowser:!0,useTokenInput:!0,savePostUrl:BAppConfig.get("site_post","savePostUrl")}}),this.postUpdateView.on("postSaved",_.bind(function(){Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("post_saved"),"#flash-message",3e3),$("#postNewDataMenu .actContainer").removeClass("visible"),$("#postNewDataMenu .actContainer").addClass("noVisible"),this.feedView.getFeedDataCollection().fetch()},this)),this.postUpdateView.render(),new c);var h=new u,p=$("#"+this.templateNames.event),d=_.template(p.html(),{});$("#postEvent_form").html(d),p.remove(),h.initHandlers(),h.setupAddEventForm(),$("#post-event-btn").on("click",_.bind(function(){if($("#addEventForm").valid()){var e=$("#addEventForm").serialize();Utils.block("#postEvent"),h.postEvent(e,_.bind(function(e){if(!e.success){Utils.unblock("#postEvent");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_add_event")}else window.location.href=BAppConfig.get("site_event","config").eventPageLink.replace("__idevent__",e.data.idevent)},this),$.proxy(function(e){Utils.unblock("#postEvent");for(var t in e.msg)for(var n in e.msg[t])Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t][n],"#flash-message")},this))}},this));var v=new a,m=$("#"+this.templateNames.assignment),g=_.template(m.html(),{});$("#postAssignment_form").html(g),m.remove(),v.setupAssignmentEventForm(),$("#post-assignment-btn").on("click",_.bind(function(){if($("#addAssignmentForm").valid()){Utils.block("#postAssignment");var e=$("#addAssignmentForm").serialize();v.postAssignment(e,_.bind(function(e){if(!e.success){Utils.unblock("#postAssignment");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#flashmessages")}else document.location.reload(!0)},this))}},this)),this.initUpdatesMenu(),this.feedView=new s({el:"#homeUpdateListContainer"}),this.feedView.render(),new f,new l},initUpdatesMenu:function(){$("#postNewDataMenu").length>0&&($("#postNewDataMenu .action").on("click",_.bind(function(e){e.preventDefault();var t=$(e.target).attr("id");if(t=="updates")$("#postNewDataMenu #_action_post_updates").addClass("visible"),$("#postNewDataMenu #_action_post_event").removeClass("visible"),$("#postNewDataMenu #_action_post_assignment").removeClass("visible");else if(t=="event")$("#postNewDataMenu #_action_post_event").addClass("visible"),$("#postNewDataMenu #_action_post_updates").removeClass("visible"),$("#postNewDataMenu #_action_post_assignment").removeClass("visible");else{var n=$('#addAssignmentForm input[name="date"]'),r=$('#addAssignmentForm input[name="time"]');$.data(r[0],"dueDateSelect",n),$("#postNewDataMenu #_action_post_assignment").addClass("visible"),$("#postNewDataMenu #_action_post_event").removeClass("visible"),$("#postNewDataMenu #_action_post_updates").removeClass("visible")}},this)),$("#postNewDataMenu .closeAction").on("click",_.bind(function(e){$(e.target.parentElement).removeClass("visible")},this)))}});return new h}),define("home/main",["require","beyazpano","home/views/main"],function(e,t,n){var r=function(){this.run=function(){n.render()}};return r}),define("invite-friends/main",["require","beyazpano"],function(e,t){var n=function(){var e={rules:{emails:{required:!0}}};this.run=function(){this.initHandlers()},this.initHandlers=function(){$("body").append('<div id="popup_invite_friends" class="modal fade hide" data-backdrop="static"></div>'),$("#invite-friends").live("click",_.bind(this.openPopupInviteFriendsClickHandler,this)),$("#send-email-members").live("click",_.bind(this.sendEmailsFriendsClickHandler))},this.openPopupInviteFriendsClickHandler=function(t){var n=BAppConfig.get("site_profile","config").userInfoDataUrlHtml;$.ajax({type:"POST",url:n+"/invitefriends",success:$.proxy(function(t){$("#popup_invite_friends").html(t),$("#sendEmailForm").validate(e),$("#popup_invite_friends").modal("show")},this),dataType:"html"})},this.sendEmailsFriendsClickHandler=function(e){var t=BAppConfig.get("site_profile","config").userInfoDataUrl;if($("#sendEmailForm").valid()){var n=$("#sendEmailForm").serialize();Utils.block("#popup_invite_friends"),$.ajax({type:"POST",url:t+"/sendmailfriends",data:n,success:$.proxy(function(e){Utils.unblock("#popup_invite_friends");if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_add_friends");else document.location.reload(!0)},this),dataType:"json"})}}};return n}),define("messages/model/message",["beyazpano"],function(e){var t=Backbone.Model.extend({defaults:{id:"",conversation_id:"",user_id:"",text:"",created:""},initialize:function(){}});return t}),define("messages/collection/messages",["messages/model/message"],function(e){var t=Backbone.Collection.extend({url:function(){return BAppConfig.configs.site_messages.messagesUrl},initialize:function(){this.details={conversation_id:null,participants_too:!1,offset:0,limit:10,last_msg_id:null,new_messages:!1},this.participants=new Array,this.addParticipantsUrl=BAppConfig.configs.site_messages.addParticipantsUrl,this.postMessageUrl=BAppConfig.configs.site_messages.postMessageUrl,this.getParticipantsUrl=BAppConfig.configs.site_messages.getParticipantsUrl,this.profileUrl=BAppConfig.configs.site_profile.config.userProfileUpdatesLink,this.totalLoadedMessages=0,this.lastMsgId=null,this.canRefreshMessages=!0},model:e,parse:function(e){return this.details.conversation_id=e.data.conversation_id,this.details.offset=parseInt(this.details.offset)+parseInt(this.details.limit),e.data.messages},getPaginationData:function(){return this.details},loadMoreMessages:function(e,t){var n=this.getFetchParams(e,!1,!1);this.fetch({data:n,reset:t,success:_.bind(function(e,t){this.setTotalLoadedMessages(),e.trigger("moreMessagesLoaded",t,e)},this),error:_.bind(function(e){this.canRefreshMessages=!0,Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_loading_more_msg"),".messages_errors",3e3)},this)})},getMessages:function(e,t){var n=this.getFetchParams(e,t,!0);this.fetch({data:n,reset:!0,success:_.bind(function(e,t){this.setTotalLoadedMessages(),this.participants=t.data.participants,e.trigger("messagesReceived",t,e)},this),error:_.bind(function(e){Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3)},this)})},getFetchParams:function(e,t,n){var r=_.clone(this.details);return r.conversation_id=e,r.participants_too=t,r.new_messages=n,r},getMessagesAfterLastId:function(e,t){var n=this.getFetchParams(e,!1,!0);n.last_msg_id=t;var r=n.offset,i=n.limit;n.offset=0,this.fetch({data:n,reset:!0,success:_.bind(function(e,t){this.details.offset=r,this.details.limit=i,e.trigger("updateMessages",t,e)},this),error:_.bind(function(e){this.details.offset=r,this.details.limit=i,this.canRefreshMessages=!0,Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3),Utils.unblock("#newMessageForm"),$("#post-new-message img").addClass("hide"),$("#post-new-message").attr("disabled",null)},this)})},setTotalLoadedMessages:function(){var e=this.toJSON().length;this.totalLoadedMessages=this.totalLoadedMessages+e},getTotalLoadedMessages:function(){return this.totalLoadedMessages},reloadMessages:function(e){var t=this.getFetchParams(e,!1,!1),n=t.offset,r=t.limit;t.offset=0,t.limit=n+r,this.fetch({data:t,reset:!0,success:_.bind(function(e,t){this.details.limit=r,this.totalLoadedMessages=0,this.setTotalLoadedMessages(),e.trigger("messagesReloaded",t,e)},this),error:_.bind(function(e){this.details.offset=n,this.details.limit=r,this.canRefreshMessages=!0,Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3)},this)})}});return t}),define("text!messages/templates.html",[],function(){return'<script type="text/template" id="create_conversation">\n    <a class=\'create_conv\' href=\'#\'><%- translate(\'create_conversation\') %></a>\n    <div id="conversationsContent"></div>\n</script>\n\n<script type="text/template" id="conversations_list">\n    <% if(!_.isEmpty(conversations_list.conversationsInfo)) { %>\n        <ul class="conversationsList">\n            <% _.each(conversations_list.conversationsInfo, _.bind(function(item) {%>\n                <%\n                    var message = conversations_list.messages[item.latest_message_id];\n                    var newMessages = conversations_list.newMessages[item.id];\n                    var classNewMessages = \'\';\n                    if(newMessages == 1) {\n                        classNewMessages = \'newMessages\';\n                    }\n                if(!_.isUndefined(message)) {    \n                %>\n                <li class="conversationsItem clearfix <%- classNewMessages %>" id="<%- item.id %>_conv">\n                    <div class="convHeader clearfix">\n                        <span class=\'convSubject\'><%- item.subject %></span>\n                        <span id="delete-btn-<%- item.id %>" class="delete-btn right"> </span>\n                    </div>\n                    <div class=\'conversationMessage clearfix\'>\n                        <img class=\'userMediumIcon\' src=\'<%- conversations_list.usersImages[message.user_id] %>\'>\n\n                        <div class=\'convLastMessage\'><%- message.message %></div>\n                        <div class=\'dateLastMessage\'><%= Utils.formatDate(message.created,\'dd MMM yyyy HH:mm tt\') %></div>\n                    </div>\n                </li>\n            <% }\n            }, this)) %>\n        </ul>\n    <% } else { %>\n        <ul class="conversationsList">\n            <li class="messageItem clearfix">\n                <span class="noResultMsg"><% print(translate(\'no_conversations\')) %></span>\n            </li>\n        </ul>\n    <% } %>\n</script>\n\n<script type="text/template" id="messages_container">\n<div class="messages_errors"></div>\n<div id="messagesHeader">\n    <div id="conversationSub">\n        <h2><%- conversationSubject %></h2>\n    </div>\n</div>\n<div class="messagesScroll">\n    <div id="messagesContent"></div>\n</div>\n</script>\n\n<script type="text/template" id="messages_list_wrapper">\n    <% if(!_.isEmpty(messages)) { %>\n        <div id="loadMoreMessages" class="clearfix"></div>\n        <ul id="messagesList"></ul>\n    <% } else { %>\n        <ul id="messagesList">\n            <li class="messageItem clearfix">\n                <span class="noResultMsg"><% print(translate(\'no_messages\')) %></span>\n            </li>\n        </ul>\n    <% } %>\n</script>\n\n<script type="text/template" id="conversations_list_view_more">\n    <div id="loadingMoreConv">\n        <img src="<%- img %>">\n        <span><% print(translate(\'loading_conversations\')) %>...</span>\n    </div>\n</script>\n\n<script type="text/template" id="messages_list">\n    <% _.each(messages, _.bind(function(message_item) {%>\n        <li class="messageItem clearfix" id="msg_item_<%- message_item.id %>">\n            <div class="messageAvatar left">\n                <img src="<%= participants[message_item.user_id].avatarUrl %>">\n            </div>\n            <div class="messageDetails right">\n                <div class="messageAuthor clearfix">\n                    <a href="<%- profile_url.replace(\'__userid__\', message_item.user_id) %>">\n                        <span class="messageAuthorName left">\n                        <%- participants[message_item.user_id].first_name + " " + participants[message_item.user_id].last_name %>\n                        </span>\n                    </a>\n                    <span class="messageCreated right">\n                        <%= Utils.formatDate(message_item.created,\'dd MMM yyyy HH:mm tt\') %>\n                    </span>\n                </div>\n                <div class="messageBody clearfix">\n                    <%= Utils.nl2br(_.escape(message_item.text)) %>\n                </div>\n                <div class="clearfix replyAttachments" id="msg_attachments_<%- message_item.id %>"></div>\n            </div>\n        </li>\n    <% }, this)) %>\n</script>\n\n<script type="text/template" id="add_new_message">\n    <div id="postNewMessage" class="clearfix">\n        <form id="newMessageForm" action="" method="post">\n            <div class="replyMsg">\n                <textarea id="replyMessage" placeholder="<% print(translate(\'write_a_reply\')) %>" name="text"></textarea>\n            </div>\n            <div class="newMsgDet">\n                <input id="conv_msg_attachments" name="attachments" type="hidden">\n                <div id="attachments" class="userMessageAttachment userPostAttachements clearfix"></div>\n                <div id="attachmentsContainer" class="userMessageLinkright"></div>\n                    <button class="btn primary right uploadDisableBtn" id="post-new-message">\n                        <img src="<%= img %>" class="hide"/>&nbsp;\n                        <span><% print(translate(\'site_send\')) %></span>\n                    </button>\n            </div>\n        </form>\n    </div>\n</script>\n\n<script type="text/template" id="create_new_conversation">\n    <div class="messages_errors"></div>\n    <h2 id="newConversationTitle"><% print(translate(\'new_conversation\')) %></h2>\n    <form id="createConversationForm" action="" method="post">\n        <div class="convParticipants clearfix">\n            <span class="left"><% print(translate(\'site_messages_recipients\')) %></span>\n            <div id="autocomplete" class="right"></div>\n            <input id="recipients" type="hidden" name="participants">\n        </div>\n        <div class="convSubj clearfix">\n            <span class="left"><% print(translate(\'site_messages_subject\')) %></span>\n            <input class="right" id="subject" type="text" placeholder="<% print(translate(\'type_conversation_subject\')) %>" name="subject">\n        </div>\n        <div class="convMessage clearfix">\n            <span class="left"><% print(translate(\'site_messages_body\')) %></span>\n            <textarea class="right" id="convMsg" placeholder="<% print(translate(\'type_conversation_message\')) %>" name="text"></textarea>\n        </div>\n        <div class="clearfix">\n            <input id="conv_msg_attachments" name="attachments" type="hidden">\n            <div id="attachments" class="userMessageAttachment userPostAttachements clearfix"></div>\n            <div id="attachmentsContainer" class="userMessageLinkright"></div>\n            <button class="btn primary right uploadDisableBtn" id="createConversation">\n                <img src="<%= img %>" class="hide"/>&nbsp;\n                <span><% print(translate(\'create_conversation\')) %></span>\n            </button>\n        </div>\n    </form>\n\n</script>\n\n<script type="text/template" id="participants_data">\n    <div id="addNewParticipants" class="clearfix">\n        <form id="addParticipants" action="" method="post" class="clearfix">\n            <div id="autocomplete"></div>\n            <div class="recipients_wrapper clearfix">\n                <input id="recipients" type="hidden" name="recipients">\n            </div>\n            <button class="btn primary left" id="addUsersToConversation">\n                <img src="<%- img %>" class="hide"/>&nbsp;\n                <span><% print(translate(\'add_user_to_conversation\')) %></span>\n            </button>\n        </form>\n    </div>\n    <% if(!_.isEmpty(participants)) { %>\n        <ul id="participantsList">\n        <% _.each(participants, _.bind(function(participant) {%>\n            <li class="participant clearfix">\n                <div class="participantAvatar">\n                    <img class=\'userMediumIcon\' src="<%= participant.avatarUrl %>">\n                </div>\n                <div class="participantName">\n                    <a href="<%= profile_url.replace(\'__userid__\', participant.id) %>">\n                        <%= participant.first_name + " " + participant.last_name %>\n                    </a>\n                </div>\n            </li>\n        <% }, this)) %>\n        </ul>\n    <% } else { %>\n        <ul id="messagesList">\n            <li class="messageItem clearfix">\n                <span class="noResultMsg"><% print(translate(\'no_participants\')) %></span>\n            </li>\n        </ul>\n    <% } %>\n</script>\n\n<script type="text/template" id="loading_more_messages">\n    <div id="loadingMoreMsg">\n        <img src="<%- img %>">\n        <span><% print(translate(\'loading_more_messages\')) %>...</span>\n    </div>\n</script>\n'}),define("messages/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("messages_templates",n);return r}),define("messages/views/messagesListView",["require","beyazpano","order!jquery.validate","order!jquery.validate.messages_locale","attachment/views/component","autocomplete/views/autocomplete","attachment/views/list","messages/collection/messages","messages/_templates","jquery.textarea.autosize","lightbox","jquery.slimscroll","utils","jquery.json"],function(e,t,n,r,i,s,o,u){var a=Backbone.View.extend({el:"#content",templateNames:{main:"messages_container",msg_wrapper:"messages_list_wrapper",msg_list:"messages_list",add_new_message:"add_new_message",create_conversation:"create_new_conversation",participants_data:"participants_data",loading_msg:"loading_more_messages"},initialize:function(){this.config={messagesUrl:BAppConfig.configs.site_messages.messagesUrl},this.conversationId=null,this.conversationSubject="",this.participantsToo=!1,this.collection=new u,this.collection.url=this.config.messagesUrl,this.conversationParticipants=new Array,this.attachments=null,this.possibleParticipants=new Array,this.autocomplete=null,this.mimeTypeIconsMap=BAppConfig.configs.global.fileTypeIconsMap,this.updateMessagesInterval=null,this.newMessages=!1,this.messagesLoaded=!0,this.oldScrollHeight=0,this.allMessagesReceived=!1,this.containers={messages_list:"#messagesList",load_more_msg:"#loadMoreMessages",attachments_container:"#new_message_attachments",msgContent:"#messagesContent",participantsContent:"#content_right",messages_header:"#messagesHeader",loading_more_msg:"#loadingMoreMsg"},this.collection.on("messagesReceived",_.bind(function(e){this.renderMessages(),this.renderParticipants()},this)),this.collection.on("moreMessagesLoaded",_.bind(function(e){this.renderMoreMessages()},this)),this.collection.on("updateMessages",_.bind(function(e){this.updateMessages()},this)),this.collection.on("messagesReloaded",_.bind(function(e){$(this.containers.messages_list).html("");var t=_.last(this.collection.toJSON());this.setLastMsgId(t.id),this.allMessagesReceived=!1,this.renderMoreMessages()},this)),this.validateAddParticipants={rules:{recipients:{required:!0}},ignore:"",errorPlacement:function(e,t){return $(".token-input-list-facebook").addClass("error"),$(t).after(e),!0}},this.validateReplyMessage={rules:{text:{required:!0,minlength:1,maxlength:5e5}},ignore:"",errorPlacement:function(e,t){return $("#replyMessage").addClass("error"),$(t).after(e),!0}},this.initHandlers()},render:function(){this.getMessages()},getMessages:function(){this.collection.getMessages(this.conversationId,this.participantsToo)},renderMessages:function(){var e=this.collection;this.conversationParticipants=e.participants,this.participantsToo=!1;var t={conversationSubject:this.conversationSubject,messages:e.toJSON(),participants:this.conversationParticipants,mimeTypeIcons:this.mimeTypeIconsMap,profile_url:this.collection.profileUrl,img:BAppConfig.get("global","ajaxLoadingImg")},n=this.collection.getPaginationData();_.size(t.messages)<n.limit?this.allMessagesReceived=!0:this.allMessagesReceived=!1;var r=_.last(t.messages);this.setLastMsgId(r.id),this.renderMainTemplate(t),$(".messagesScroll").addClass("arScroll"),this.renderNewMessageForm(),this.renderMessagesData(t,!1),this.setScroll($("#messagesContent")),this.initMsgScrollHandler(),Utils.unblock("#"+this.conversationId+"_conv");if(this.newMessages==1){var i=$("#main_navigation .inbox span");if(i){var s=parseInt(i.text())-1;s>0?i.text(s):i.remove()}}this.oldScrollHeight=0},renderMainTemplate:function(e){var n=$(t.renderTemplate(this.templateNames.main,e));$(this.el).html(n);var r=$(t.renderTemplate(this.templateNames.msg_wrapper,e));$(this.containers.msgContent).html(r),$("#messagesHeader").fadeIn()},renderMessagesData:function(e,n){if(e.messages.length>0){var r=$(t.renderTemplate(this.templateNames.msg_list,e));n==1?$(this.containers.messages_list).append(r):$(this.containers.messages_list).prepend(r)}$.each(e.messages,function(t,n){if(!_.isEmpty(e.messages[t].attachments)){var r=new o({el:"#msg_attachments_"+e.messages[t].id,config:{},attachments:e.messages[t].attachments.attachments,postid:e.messages[t].id});r.render()}}),$(".messageItem").fadeIn()},loadMoreMessages:function(){var e=$("#messages_view_more_link");this.buttonLoadingState(!0,e),this.collection.canRefreshMessages=!1;var t=this;this.renderLoadingMsg(),t.collection.loadMoreMessages(t.conversationId,!0)},renderMoreMessages:function(){var e={messages:this.collection.toJSON(),participants:this.conversationParticipants,mimeTypeIcons:this.mimeTypeIconsMap,profile_url:this.collection.profileUrl},t=$("#messagesContent"),n=t.get(0).scrollHeight,r=t.scrollTop(),i=this.collection.getPaginationData();_.size(e.messages)<i.limit&&(this.allMessagesReceived=!0),this.renderMessagesData(e,!1),this.collection.canRefreshMessages=!0,$(this.containers.load_more_msg).html("");var s=t.get(0).scrollHeight,o=s-n+r;o>0&&t.slimScroll({scrollTo:o+"px"}),this.messagesLoaded=!0},renderNewMessageForm:function(){var e={id:"post_new_msg",img:BAppConfig.get("global","ajaxLoadingImg")},n=$(t.renderTemplate(this.templateNames.add_new_message,e));$(this.el).append(n),this.initAttachments(),$("#newMessageForm").validate(this.validateReplyMessage),$("#newMessageForm #replyMessage").autosize(),$("#postNewMessage").fadeIn()},initAttachments:function(e){this.attachments=new Attachments("#attachments",{attachmentsContainer:"#attachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),canShare:!0,blockButtonId:e==1?"#createConversation":"#post-new-message",initShareHandler:_.bind(i.getShareInitHandler(),this)})},attachmentsChanged:function(){$("#conv_msg_attachments").val($.toJSON(this.attachments.getAttachments()))},renderCreateConversation:function(e,n){_.isUndefined(e)&&(e=null),_.isUndefined(n)&&(n=!1);var r={img:BAppConfig.get("global","ajaxLoadingImg")},i=$(t.renderTemplate(this.templateNames.create_conversation,r));$(this.el).html("").append(i),n==1&&Utils.flashMessage(Utils.FLASH_ERROR,"",translate("new_conv_error"),".messages_errors",3e3),$("#content_right").empty(),this.initAutocomplete(e),this.initAttachments(!0),$("#createConversationForm #convMsg").autosize(),$("div.token-input-dropdown-facebook").addClass("arabicAutocompleteFix"),$("#newConversationTitle, #createConversationForm").fadeIn()},initAutocomplete:function(e){_.isUndefined(e)&&(e=null);var t=[],n=[],r=this.possibleParticipants;e!=null&&(t=[e]),_.isEmpty(r)||$.each(r,_.bind(function(e,t){(this.conversationId==null||this.conversationParticipants[t.id]===undefined)&&n.push({id:t.id,name:t.first_name+" "+t.last_name})},this)),this.autocomplete=new s({config:{useWallBrowser:!1,useTokenInput:!0,tokenInputPrepopulate:t,tokenInputSource:n}}),this.autocomplete.on("ListChanged",_.bind(function(e){var t=[];$.each(e,_.bind(function(e,n){t.push(n.id),$(".token-input-list-facebook").removeClass("error"),$("#recipients").removeClass("error"),$("#recipients").addClass("valid"),$("#recipients").next().hide()},this)),$("#recipients").val(t.join(","))},this)),e!=null&&$("#recipients").val(e.id),this.autocomplete.render()},addUsersToConversation:function(e){e.preventDefault();if($(".blockUI").length>0)return Utils.flashMessage(Utils.FLASH_WARNING,"",translate("global_please_wait"),".messages_errors",3e3),!1;var t=$("#addUsersToConversation"),n=this;n.buttonLoadingState(!0,t);var r=$("#recipients").val().split(",");Utils.blockSmall("#addParticipants"),$.ajax({url:this.collection.addParticipantsUrl,type:"POST",dataType:"json",data:{conversation_id:this.conversationId,user_ids:r}}).done(function(e){Utils.unblock("#addParticipants"),n.buttonLoadingState(!1,t),$("#addParticipants #recipients").val(""),n.getParticipantsList(n.conversationId)}).fail(function(e,r){Utils.unblock("#addParticipants"),n.buttonLoadingState(!1,t),Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3)})},replyMessage:function(e){e.preventDefault();if($(".blockUI").length>0)return Utils.flashMessage(Utils.FLASH_WARNING,"",translate("global_please_wait"),".messages_errors",3e3),!1;var t=$("#post-new-message"),n=this;n.buttonLoadingState(!0,t),Utils.block("#newMessageForm"),this.collection.canRefreshMessages=!1,$.ajax({url:this.collection.postMessageUrl,type:"POST",dataType:"json",data:{conversation_id:this.conversationId,text:$("#replyMessage").val(),attachments:$('#newMessageForm input[name="attachments"]').val()}}).done(function(e){n.updateMessagesList(n.getLastMsgId())}).fail(function(e,r){Utils.unblock("#newMessageForm"),n.buttonLoadingState(!1,t),Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3),this.collection.canRefreshMessages=!0})},buttonLoadingState:function(e,t){var n=t.find("img");e==1?(n.removeClass("hide"),t.attr("disabled","disabled")):(n.addClass("hide"),t.attr("disabled",null))},renderParticipants:function(){var e={participants:this.conversationParticipants,profile_url:this.collection.profileUrl,img:BAppConfig.get("global","ajaxLoadingImg")},n=$(t.renderTemplate(this.templateNames.participants_data,e));$(this.containers.participantsContent).html(n),$("#addParticipants").validate(this.validateAddParticipants);var r=$("#participantsList");r.fadeIn(),this.setParticipantsScroll(r,r.height()),this.initAutocomplete()},updateMessagesList:function(e){this.collection.getMessagesAfterLastId(this.conversationId,e)},getLastMsgId:function(){return this.collection.lastMsgId},setLastMsgId:function(e){this.collection.lastMsgId=e},updateMessages:function(){var e={messages:this.collection.toJSON(),participants:this.conversationParticipants,mimeTypeIcons:this.mimeTypeIconsMap,profile_url:this.collection.profileUrl},t=e.messages.length,n=this.collection.getTotalLoadedMessages();if(t>0){this.renderMessagesData(e,!0);var r=this.collection.getPaginationData(),i=parseInt(r.offset),s=t+n;if(s>i){var o=$(".messageItem"),u=s-i,a=0;while(a<u)o.eq(a).remove(),a++}else this.collection.setTotalLoadedMessages();var f=_.last(e.messages);this.setLastMsgId(f.id);var l=$("#messagesContent"),c=l.get(0).scrollHeight;c>=500?(s>i&&(this.allMessagesReceived=!1),this.oldScrollHeight<500&&(this.setScroll(l),this.initMsgScrollHandler(),this.oldScrollHeight=c),l.slimScroll({scrollTo:c+"px"})):this.oldScrollHeight=c}this.collection.canRefreshMessages=!0,Utils.unblock("#newMessageForm"),this.buttonLoadingState(!1,$("#post-new-message")),$("#newMessageForm #replyMessage").val(""),$('#newMessageForm input[name="attachments"]').val(""),this.initAttachments()},checkLastMsgAdded:function(e,t){var n={conversation_id:e,last_msg_id:t,offset:0,limit:1},r=$.ajax({url:this.collection.url+"/list",type:"POST",dataType:"json",data:n});return r},refreshParticipantsList:function(){this.conversationParticipants=this.collection.participants,this.renderParticipants(),this.initAutocomplete()},getParticipantsList:function(e){var t=this;$.ajax({url:this.collection.getParticipantsUrl,type:"POST",dataType:"json",data:{conversation_id:this.conversationId}}).done(function(e){t.collection.participants=e.data,t.refreshParticipantsList()}).fail(function(e,t){Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3)})},updateMessagesInt:function(){this.collection.canRefreshMessages==1&&this.updateMessagesList(this.getLastMsgId())},setScroll:function(e){var t=BAppConfig.get("global","currentLang"),n=e.height();n>500&&e.slimScroll({start:"bottom",height:"500px",alwaysVisible:!1,railVisible:!0,size:"5px",position:t==="ar"?"left":"right",allowPageScroll:!0,wheelStep:20})},setParticipantsScroll:function(e,t){var n=BAppConfig.get("global","currentLang"),r=869;t>r&&e.slimScroll({start:"top",height:r+"px",position:n==="ar"?"left":"right",alwaysVisible:!1,railVisible:!0,size:"5px",scrollTo:"0px"})},renderLoadingMsg:function(){var e={img:BAppConfig.get("global","ajaxLoadingImg")},n=$(t.renderTemplate(this.templateNames.loading_msg,e));$(this.containers.load_more_msg).prepend(n)},initHandlers:function(){$("#addUsersToConversation").live("click",function(e){e.preventDefault(),$("#addParticipants").submit()}),$("#addParticipants").live("submit",_.bind(this.addUsersToConversation,this)),$("#post-new-message").live("click",function(e){e.preventDefault(),$("#newMessageForm").submit()}),$("#newMessageForm").live("submit",_.bind(this.replyMessage,this))},initMsgScrollHandler:function(){$("#messagesContent").scroll(_.bind(function(){var e=$("#messagesContent").scrollTop();e===0&&this.allMessagesReceived===!1&&this.messagesLoaded===!0&&(this.loadMoreMessages(),this.messagesLoaded=!1)},this))}});return a}),define("messages/model/conversation",["beyazpano"],function(e){var t=Backbone.Model.extend({initialize:function(){}});return t}),define("messages/collection/conversations",["messages/model/conversation"],function(e){var t=Backbone.Collection.extend({model:e,url:function(){return BAppConfig.configs.site_messages.conversationsUrl},initialize:function(){this.details={offset:0,limit:15,getLastMessage:!0,lastPageConvNr:0,search:"",possible_participants:!1,lastConvId:"",lastConvData:"",userId:$(".autopopulate .userId").val()},this.possibleParticipants=new Array,this.deleteUrl=BAppConfig.configs.site_messages.deleteConversation,this.addConversationUrl=BAppConfig.configs.site_messages.addConversationUrl},parse:function(e){return e.data.conversations!=null&&(this.details.lastPageConvNr=e.data.conversations.conversationsInfo.length),e.data.conversations},getPaginationData:function(){return this.details},getConversations:function(e){this.details.offset=0;var t=this.getFetchParams();t.possible_participants=e,this.fetch({data:t,success:_.bind(function(t,n){if(e==1){this.possibleParticipants=n.data.possible_participants;if(n.data.conversations!=null){var r=_.first(n.data.conversations.conversationsInfo);this.details.lastConvId=r.id,this.details.lastConvData=r.modified}}t.trigger("conversationsReceived",n,t)},this)})},getFetchParams:function(){var e=_.clone(this.details);return e.getLastMessage=!0,e},loadMoreConversations:function(e,t,n){_.isUndefined(t)&&(t=!1),_.isUndefined(n)&&(n=null),this.details.offset=parseInt(this.details.offset)+parseInt(this.details.limit);if(t==1){var r=this.details.offset,i=this.details.limit;n=="loadMore"?(this.details.limit=parseInt(this.details.offset)+parseInt(this.details.limit),this.details.offset=0):n=="remove"&&(this.details.limit=parseInt(this.details.offset),this.details.offset=0)}this.fetch({data:this.details,reset:e,success:_.bind(function(s,o){e||(t==1?(this.details.limit=i,this.details.offset=r,n=="remove"&&(this.details.offset=this.details.offset-this.details.limit),s.trigger("reloadConvList",o.data,s)):s.trigger("moreConversationsReceived",o.data,s))},this)})},getPossibleParticipants:function(){return this.possibleParticipants},checkLastConversation:function(e,t){_.isUndefined(t)&&(t=null);var n=this.details,r=n.offset,i=n.limit;n.offset=0,n.limit=1,this.fetch({data:this.details,reset:!1,success:_.bind(function(s,o){this.details.offset=r,this.details.limit=i;if(o.data.conversations!=null){var u=_.first(o.data.conversations.conversationsInfo);u.id==n.lastConvId&&u.modified==n.lastConvData?e=="loadMore"?this.loadMoreConversations(!1):e=="remove"&&this.loadOneConversation(!1,t):(this.details.lastConvId=u.id,this.details.lastConvData=u.modified,e=="loadMore"?this.loadMoreConversations(!1,!0,e):e=="remove"&&this.loadMoreConversations(!1,!0,e))}else s.trigger("conversationsReceived",o.data,{})},this),error:_.bind(function(e){n.offset=r,n.limit=i},this)})},loadOneConversation:function(e,t){var n=this.details,r=n.offset,i=n.limit;n.offset=parseInt(n.limit)+parseInt(n.offset)-1,n.limit=1,this.fetch({data:n,reset:e,success:_.bind(function(s,o){e||(s.trigger("removeOneConversation",t,{convId:t}),n.offset=r,n.limit=i,o.data.conversations!=null&&(o.data.conversations.conversationsInfo.length==0?o.data.lastPageConvNr=i-1:o.data.lastPageConvNr=i,this.details.lastPageConvNr=o.data.lastPageConvNr,s.trigger("moreConversationsReceived",o.data,s)))},this),error:_.bind(function(e){n.offset=r,n.limit=i,e.trigger("unblockConv",t,{})},this)})}});return t}),define("messages/views/conversationsListView",["require","beyazpano","order!jquery.validate","order!jquery.validate.messages_locale","messages/views/messagesListView","messages/collection/conversations","utils","jquery.json","jquery.slimscroll","messages/_templates"],function(e,t,n,r,i,s){var o=Backbone.View.extend({templateNames:{create_conv:"create_conversation",main:"conversations_list",view_more:"conversations_list_view_more"},initialize:function(e){this.config={conversationsUrl:BAppConfig.configs.site_messages.conversationsUrl},this.collection=new s,this.collection.url=this.config.conversationsUrl,this.messagesList=new i,this.containers={convContent:"#conversationsContent"},this.validateCreateConversation={rules:{subject:{required:!0,minlength:2},text:{required:!0,minlength:2,maxlength:5e5},participants:{required:!0}},ignore:"",errorPlacement:function(e,t){return t.is("#recipients")?($(".token-input-list-facebook").addClass("error"),$(t).after(e)):$(t).after(e),!0}},this.conversationLoaded=!0,this.initHandlers()},render:function(){this.getConversations()},initHandlers:function(){this.collection.on("conversationsReceived",_.bind(function(e){this.renderConversations()},this)),this.collection.on("moreConversationsReceived",_.bind(function(e){this.renderConversationsData()},this)),this.collection.on("removeOneConversation",_.bind(function(e){this.removeOneConversation(e)},this)),this.collection.on("unblockConv",_.bind(function(e){this.unblockConv(e)},this)),this.collection.on("reloadConvList",_.bind(function(e){this.renderConversationsData(!0)},this)),$(".delete-btn").live("click",_.bind(this.deleteButton,this)),$(".create_conv").live("click",_.bind(function(e){return e.preventDefault(),$(".blockUI").length>0?(Utils.flashMessage(Utils.FLASH_WARNING,"",translate("global_please_wait"),".messages_errors",3e3),!1):(this.disabledButtons("disabled"),this.messagesList.conversationId=null,this.messagesList.renderCreateConversation(),$("#createConversationForm").validate(this.validateCreateConversation),$(".conversationsItem").removeClass("selected"),!1)},this)),$("#createConversation").live("click",function(e){e.preventDefault(),$("#createConversationForm").submit()}),$("#createConversationForm").live("submit",_.bind(this.saveConversation,this)),$(".conversationsItem").live("click",_.bind(function(e){e.preventDefault();if($(".blockUI").length>0)return Utils.flashMessage(Utils.FLASH_WARNING,"",translate("global_please_wait"),".messages_errors",3e3),!1;this.disabledButtons("disabled");var t=e.currentTarget.id.replace("_conv","");if(!(t>0))return Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3),!1;var n=$("#"+t+"_conv .convSubject").text();Utils.blockSmall("#"+t+"_conv"),this.renderConversationMessages(t,n),$(window).scrollTop(0)},this))},disabledButtons:function(e){var t="#post-new-message, #messages_view_more_link, #addUsersToConversation, #createConversation";e!==""?$(t).attr("disabled",e):$(t).removeAttr("disabled")},getConversations:function(){this.collection.getConversations(!0)},renderConversations:function(){$("#content_left").empty();var e=$(t.renderTemplate(this.templateNames.create_conv,{}));$(this.el).append(e);var n=$(".autopopulate .userId").val();if(n!==""){this.messagesList.conversationId=null,this.messagesList.possibleParticipants=this.collection.getPossibleParticipants();var r=!1;$.each(this.messagesList.possibleParticipants,function(e,t){if(t.id==n)return r=!0,!1});if(r===!0){var i={id:n,name:$(".autopopulate .userName").val()};this.messagesList.renderCreateConversation(i),$("#createConversationForm").validate(this.validateCreateConversation)}else this.messagesList.renderCreateConversation(null,!0),$("#createConversationForm").validate(this.validateCreateConversation)}else if(_.first(this.collection.toJSON())!==undefined){var s=_.first(this.collection.toJSON()),o=_.first(s.conversationsInfo);this.renderConversationMessages(o.id,o.subject)}else Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3);this.renderConversationsData(),n===""&&_.first(this.collection.toJSON())!==undefined?($("#"+o.id+"_conv").addClass("selected"),this.messagesList.newMessages=!1,$("#"+o.id+"_conv").hasClass("newMessages")===!0&&($("#"+o.id+"_conv").removeClass("newMessages"),this.messagesList.newMessages=!0)):n===""&&_.first(this.collection.toJSON())===undefined&&(this.messagesList.conversationId=null,this.messagesList.possibleParticipants=this.collection.getPossibleParticipants(),this.messagesList.renderCreateConversation(),$("#createConversationForm").validate(this.validateCreateConversation)),this.setScroll($(this.containers.convContent))},setScroll:function(e){var t=this,n=BAppConfig.get("global","currentLang");e.slimScroll({start:"top",height:"826px",position:n==="ar"?"left":"right",alwaysVisible:!1,railVisible:!0,size:"5px",scrollTo:"0px"}).scroll(function(n){if(e.outerHeight()==e.get(0).scrollHeight-e.scrollTop()&&t.conversationLoaded==1){t.conversationLoaded=!1;var r=t.collection.getPaginationData();r.lastPageConvNr>=r.limit&&($(".loadingMoreConv").addClass("hide"),t.collection.checkLastConversation("loadMore"))}})},renderConversationsData:function(e){_.isUndefined(e)&&(e=!1);var n=this.collection.toJSON();if(_.first(n)!==undefined){var r={conversations_list:_.first(n)};r.conversations_list.usersImages[0]!==undefined&&(r.conversations_list.usersImages[0]=BAppConfig.configs.site_messages.convDefaultPhoto)}else var r={};var i=$(t.renderTemplate(this.templateNames.main,r));if(e===!0){var s=_.first(r.conversations_list.conversationsInfo);$(".conversationsList").remove(),this.renderConversationMessages(s.id,s.subject)}$("#loadingMoreConv").remove(),$(this.containers.convContent).append(i),this.renderViewMoreConversationsButton(),e===!0&&(this.messagesList.newMessages=!1,$("#"+s.id+"_conv").hasClass("newMessages")===!0&&($("#"+s.id+"_conv").removeClass("newMessages"),this.messagesList.newMessages=!0),$("#"+s.id+"_conv").addClass("selected").removeClass("newMessages")),this.disabledButtons(""),this.conversationLoaded=!0},deleteButton:function(e){e.preventDefault();var t=this;t.disabledButtons("disabled");var n=e.target.id.replace("delete-btn-","");Utils.confirm(translate("delete_conversation"),translate("delete_conversation_content"),function(e){if(e==="yes")return $("#"+n+"_conv .blockUI").length>0?!1:(Utils.blockSmall("#"+n+"_conv"),t.removeConversation(n),!1)})},removeOneConversation:function(e){var t=$("#"+e+"_conv").hasClass("selected");$("#"+e+"_conv").remove();if(t===!0){var n=_.first($(".conversationsItem")).id.replace("_conv","");$("#"+n+"_conv").addClass("selected");var r=_.first($(".conversationsItem .convSubject")).innerHTML;this.renderConversationMessages(n,r)}this.disabledButtons("")},unblockConv:function(e){Utils.unblock("#"+e+"_conv")},renderViewMoreConversationsButton:function(){var e=this.collection.getPaginationData();if(e.lastPageConvNr>0&&e.lastPageConvNr>=e.limit){var n=t.renderTemplate(this.templateNames.view_more,{id:this.el.id,img:BAppConfig.get("global","ajaxLoadingImg")});$(this.containers.convContent).append(n)}},renderConversationMessages:function(e,t){$(".conversationsItem").removeClass("selected"),this.messagesList.newMessages=!1,$("#"+e+"_conv").hasClass("newMessages")===!0&&($("#"+e+"_conv").removeClass("newMessages"),this.messagesList.newMessages=!0),$("#"+e+"_conv").addClass("selected"),$("div.token-input-dropdown-facebook").removeClass("arabicAutocompleteFix"),this.messagesList.collection.totalLoadedMessages=0,this.messagesList.collection.details.offset=0,this.messagesList.conversationId=e,this.messagesList.participantsToo=!0,this.messagesList.conversationSubject=t,this.messagesList.possibleParticipants=this.collection.getPossibleParticipants(),this.messagesList.collection.canRefreshMessages=!0,this.messagesList.updateMessagesInterval!==null&&(clearInterval(this.messagesList.updateMessagesInterval),this.messagesList.updateMessagesInterval=null),this.messagesList.render()},removeConversation:function(e){$.ajax({type:"POST",url:this.collection.deleteUrl,data:{conversationId:e},success:$.proxy(function(t){t.success?(this.collection.checkLastConversation("remove",e),this.disabledButtons("")):Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3)},this),dataType:"json"})},saveConversation:function(e){e.preventDefault();if($(".blockUI").length>0)return Utils.flashMessage(Utils.FLASH_WARNING,"",translate("global_please_wait"),".messages_errors",3e3),!1;Utils.block("#createConversationForm"),this.disabledButtons("disabled");var t={participants:$("#recipients").val().split(","),subject:$("#subject").val(),text:$("#convMsg").val(),attachments:$('#createConversationForm input[name="attachments"]').val()};return $.ajax({type:"POST",url:this.collection.addConversationUrl,data:t,success:$.proxy(function(e){e.success?($("#content_left").empty(),this.collection.getConversations(!0),$(".autopopulate .userId").val()!=""&&$(".autopopulate .userId").val("")):(Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_occured"),".messages_errors",3e3),Utils.unblock("#createConversationForm"),this.disabledButtons(""))},this),dataType:"json"}),!1},loadMoreConv:function(e){$(".loadingMoreConv").addClass("hide"),this.collection.checkLastConversation("loadMore")}});return o}),define("messages/main",["require","beyazpano","default/views/siteHeader","messages/views/conversationsListView"],function(e,t,n,r){var i=function(){this.run=function(){n.render();var e=new r({el:"#content_left"});e.render()}};return i}),define("library/views/baseLibrary",["require","beyazpano","library/_templates","library/views/folderCollection","library/views/fileList","order!plupload","order!plupload.html4","order!plupload.html5","order!plupload.flash","order!file.attachments","order!bootstrap.tooltip"],function(e,t,n,r,i){var s=Backbone.View.extend({templateNames:{main:"site_my_library",file_list_header:"site_my_library_files_header",fileOperations:"site_library_file_operations"},folderPermissions:{create:!1,"delete":!1},filePermissions:{operationsAllowed:!1,upload:!1,share:!1,sort:!1,filter:!1,"delete":!1,download:!1,copy:!1,move:!1,rename:!1,groupOperations:!1},initialize:function(){this.initConfig()},initConfig:function(){this.config={ownerId:null,foldersContainer:"#content_left",filesContainer:"#content",type:"user",shareUrl:BAppConfig.get("site_course_library","shareFile"),groupUrl:BAppConfig.get("library","groupOperation"),foldersContainer:"#folder-list",fileListContainer:"#file_list_container",folderTabName:"#list_view"}},setup:function(e){this.config||this.initConfig(),_.isUndefined(this.myconfig)||(this.config=_.extend(this.config,this.myconfig)),e.config&&(this.config=_.extend(this.config,e.config));if(_.isUndefined(e.config)||_.isUndefined(e.config.ownerId)||_.isNull(e.config.ownerId))this.config.ownerId=BAppConfig.get("mydata","id");e.folderPermissions&&(this.folderPermissions=_.extend(this.folderPermissions,e.folderPermissions)),e.filePermissions&&(this.filePermissions=_.extend(this.filePermissions,e.filePermissions)),this.folders=new r({config:{ownerId:this.config.ownerId,el:"#folders",type:this.config.type}}),this.files=new i({el:"#file_list_container",config:{ownerId:this.config.ownerId,type:this.config.type},p:this.filePermissions}),$(this.config.foldersContainer).on("startUpload",_.bind(function(){Utils.block(this.config.fileListContainer),Utils.block(this.config.foldersContainer)},this)),$(this.config.foldersContainer).on("uploadFinished",_.bind(function(){Utils.unblock(this.config.fileListContainer),Utils.unblock(this.config.foldersContainer)},this)),this.folders.on("folderRenamed",_.bind(function(e){$(this.config.folderTabName).html(e.folderName)},this))},render:function(){var e=$(t.renderTemplate(this.templateNames.main,{data:{permissions:this.folderPermissions}}));$(this.el).html(e),e=$(t.renderTemplate(this.templateNames.file_list_header,{data:{permissions:this.filePermissions,extensions:BAppConfig.get("library","config").extensions}})),$(this.config.filesContainer).html(e),this.folders.render(),this.files.render(),this.filePermissions.groupOperations&&(e=$(t.renderTemplate(this.templateNames.fileOperations,{permissions:_.extend(this.filePermissions,{download:!1}),getUrl:"#"})),$(this.config.filesContainer).find(".jqGroupOperations").html(e)),$("#create_folder,#delete_folder,#rename_folder").tooltip(),this.initializeEventListeners()},initializeEventListeners:function(){this.folders.on("folderSelected",_.bind(this.onFolderSelected,this)),$("#create_folder").click(_.bind(this.addFolder,this)),$("#delete_folder").click(_.bind(this.removeFolder,this)),$("#rename_folder").click(_.bind(this.renameFolder,this));var e=new FileAttachments("#upload_file",{onFileAttached:_.bind(function(e,t){this.files.addFile(this.folders.getSelectedFolderId(),e.fileId)},this),onFileRemoved:_.bind(function(e,t){},this),clientUploader:BAppConfig.get("global","swfUploader"),uploaderUrl:BAppConfig.get("global","uploaderUrl"),fileSizeLimit:BAppConfig.get("global","max_file_size"),removeCompleted:!0,removeTimeout:5,listContainer:"upload_file_list",blockButtonId:this.config.foldersContainer});$("#filterBy").change(_.bind(function(){this.files.changeFilterType($("#filterBy").val())},this)),$("#sortBy").click(_.bind(function(){var e=$("#sortBy"),t="extension_desc";e.data("sortBy")==t?t="extension_asc":t="extension_desc",e.data("sortBy",t),this.files.changeSort(t)},this)),$("#icon_view").click(_.bind(function(){this.files.changeView("icon")},this)),$("#list_view").click(_.bind(function(){this.files.changeView("list")},this));var t=$(this.config.filesContainer);$(this.config.filesContainer).find(".jqSelectAll").click(function(){$(this).is(":checked")?t.find(".jqSelectFile").attr("checked","checked"):t.find(".jqSelectFile").removeAttr("checked")}),$(this.config.filesContainer).find(".jqGroupOperations .jq_deleteFile").click(_.bind(function(){this.onGroupOperation("delete")},this)),$(this.config.filesContainer).find(".jqGroupOperations .jq_copyFile").click(_.bind(function(){this.onGroupOperation("copy")},this)),$(this.config.filesContainer).find(".jqGroupOperations .jq_moveFile").click(_.bind(function(){this.onGroupOperation("move")},this)),this.files.on("updateStorageStat",_.bind(function(e){this.folders.updateStorageStat(e)},this)),$("#jq_sort_date,#jq_sort_extension,#jq_sort_name,#jq_sort_description,#jq_sort_size").live("click",_.bind(function(e){var t=$(e.currentTarget);switch(t.attr("id")){case"jq_sort_date":this.sortBy="created";break;case"jq_sort_extension":this.sortBy="extension";break;case"jq_sort_name":this.sortBy="name";break;case"jq_sort_description":this.sortBy="description";break;case"jq_sort_size":this.sortBy="size"}this.sortOrder=="desc"?this.sortOrder="asc":this.sortOrder="desc",this.files.changeSort(this.sortBy+"_"+this.sortOrder)},this))},addFolder:function(){this.folders.addFolder()},removeFolder:function(){this.folders.on("folderRemoveFailure",function(){Utils.alert(translate("error_title"),translate("site_my_library_remove_folder_error"))}),this.folders.deleteFolder()},renameFolder:function(){this.folders.renameSelectedFolder()},onFolderSelected:function(e){this.files.getFiles(e.id)},onGroupOperation:function(e,t){var n=this.files.getSelectedFileIds();if(_.isEmpty(n))Utils.alert(translate("error"),translate("site_library_select_a_file"));else switch(e){case"delete":this.files.deleteFile(null,{ids:n,url:this.config.groupUrl});break;case"copy":case"move":this.files.copyOrMoveFile(null,e,{ids:n,url:this.config.groupUrl})}}});return s}),define("my-library/views/myLibrary",["require","beyazpano","library/views/baseLibrary","library/views/folderCollection","library/views/fileList"],function(e,t,n,r,i){var s=n.extend({myconfig:{foldersContainer:"#content_left",filesContainer:"#content",type:"user"},initialize:function(e){this.el="#content_left",this.setup(e)}});return s}),define("my-library/main",["require","beyazpano","default/views/siteHeader","my-library/views/myLibrary"],function(e,t,n,r){var i=function(){this.run=function(){n.render();var e=new r({config:{userId:0,url:""},filePermissions:{operationsAllowed:!0,upload:!0,sort:!0,filter:!0,"delete":!0,download:!0,copy:!0,move:!0,rename:!0,groupOperations:!0},folderPermissions:{create:!0,"delete":!0,rename:!0}});e.render()}};return i}),define("notifications/main",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","paginator"],function(e,t,n,r,i){var s=function(){this.LIST_CONTAINER_ID="notification-list",this.PAGES_COOKIE_NAME="sm_notifications_pages",this.PAGE_COOKIE_NAME="sm_notifications_page",this.run=function(){var e=new r({el:"#content_left",config:BAppConfig.get("site_home","config").left_menu,userid:BAppConfig.get("mydata","id")});e.render(),n.render(),this.initPaginator(),this.initEventHandlers()},this.initEventHandlers=function(){$("#notificationsList button.jq_dismiss_notification").live("click",function(e){e.preventDefault();var t=$(this).attr("id").replace("dismiss_",""),n=BAppConfig.get("site_notifications","dismissNotification");Utils.block("#notification-list"),$.ajax({type:"POST",url:n,data:{userNotificationId:t},success:$.proxy(function(e){e.success?($("#dismiss_"+t).hide(),e.data.notDismissedNotifications==0&&$("#dismissAll").hide()):Utils.alert(translate("error"),translate("error_occured"))},this),complete:function(){Utils.unblock("#notification-list")},dataType:"json"})})},this.initPaginator=function(){this.paginator=new AppPaginator("#paginator",{page:1,pages:1,onPageSelected:_.bind(this.onPageChanged,this),render:!1});var e=parseInt($.cookie(this.PAGES_COOKIE_NAME))>0?parseInt($.cookie(this.PAGES_COOKIE_NAME)):1,t=parseInt($.cookie(this.PAGE_COOKIE_NAME))>0?parseInt($.cookie(this.PAGE_COOKIE_NAME)):1;this.paginator.setTotalPages(e),this.paginator.goToPage(t)},this.onPageChanged=function(e){this.loadListContent(e,10,_.bind(function(e){this.paginator.setTotalPages(e.data.totalPages),this.paginator.setCurrentPage(e.data.page),$("#"+this.LIST_CONTAINER_ID).html(e.data.listHtml),$.cookie(this.PAGE_COOKIE_NAME,e.data.page),$.cookie(this.PAGES_COOKIE_NAME,e.data.totalPages),e.data.totalPages>1?this.paginator.render():this.paginator.hide()},this))},this.loadListContent=function(e,t,n){var r=BAppConfig.get("site_notifications","getNotificationsList");$.ajax({type:"POST",url:r,data:{page:e,rows:t},success:$.proxy(function(e){e.success?_.isFunction(n)&&n.apply(this,[e]):Utils.alert(translate("error"),translate("error_occured"))},this),dataType:"json"})}};return s}),define("profile/account_settings",["require","beyazpano","order!bootstrap.tooltip","order!jquery.ui","order!jquery.ui.locale","order!jquery.validate","order!jquery.validate.messages_locale","utils","default/views/siteHeader","default/views/siteLeftMenu"],function(e,t,n,r,i,s,o,u,a,f){$.validator.addMethod("customDate",function(e,t){var n=!0;return _.isEmpty(e)||(n=_.isDate(Date.parseExact(e,"dd-mm-yyyy"))),n});var l=function(){var e=!1,t;this.run=function(){t=BAppConfig.get("global","currentLang"),t==="ar"&&(e=!0),this.initHandlers()},this.initHandlers=function(){$(".tooltip-info").tooltip(),$.validator.addMethod("checkIdCity",function(e,t){return $("#institution").val()==""||$("#idcity").val()!=""&&typeof $("#idcity").val()!="undefined"?!0:!1},translate("enter_a_city")),$.validator.addMethod("checkCountry",function(e,t){return $("#city").val()==""||$("#country option:selected").val()!=""&&typeof $("#country option:selected").val()!="undefined"&&$("#country option:selected").val()!=0?!0:!1},translate("profile_select_country")),$("#birthdate").val()=="00-00-0000"&&$("#birthdate").val(""),$("#edit-profile").validate({rules:{"userdata[first_name]":{required:!0,minlength:2,maxlength:128},"userdata[middle_name]":{required:!1,minlength:1,maxlength:128},"userdata[last_name]":{required:!0,minlength:2,maxlength:128},"userdata[country]":{required:!0},"userdata[education_level]":{required:!0},institution:{minlength:3,checkIdCity:!0},city:{minlength:3,checkCountry:!0},"userdata[gender]":{required:!0},"userdata[birthdate]":{customDate:!0}}}),$("#birthdate").datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:+0",maxDate:"-1d",isRTL:e,dateFormat:"dd-mm-yy"}),$("#birthdate").on("Focus",function(){$(this).validate()}),$("#data-country").change($.proxy(function(){Utils.loadSubSelect([{field:"country",el:"#data-country"}],"#data-city","",BAppConfig.get("global","citiesDataSourcesUrl"),translate("global_select_city"))},this)),$("#data-city,#data-education-level").change($.proxy(function(){Utils.loadSubSelect([{field:"city",el:"#data-city"},{field:"country",el:"#data-city"},{field:"education_level",el:"#data-education-level"}],"#data-institution","",BAppConfig.get("global","institutionsDataSourcesUrl"),translate("global_select_institution"))},this)),$("#city").change(function(){if($("#city").val()==""||typeof $("#city").val()=="undefined")$("#idcity").val(""),$("#institution").val(""),$("#idinstitution").val("")}),$("#country").change(function(){$("#city").val(""),$("#city").trigger("focusout"),$("#idcity").val(""),$("#institution").val(""),$("#institution").trigger("focusout"),$("#idinstitution").val("")});var t=[];$("#city").autocomplete({minLength:3,source:function(e,n){$.ajax({type:"POST",url:BAppConfig.get("site_profile","config").userInfoDataUrl+"/getcities",data:{search:e.term,country:$("#country option:selected").val()},success:$.proxy(function(e){var r=[];$.each(e.data,function(e,n){r.push(n),t.push(e+"###"+n)}),n(r)},this),dataType:"json"})},select:function(e,n){$.each(t,function(e,t){var r=t.split("###");n.item.value==r[1]&&$("#idcity").val(r[0])})}}),$("#city").keyup(function(){$("#idcity").val($("#city").val()),$("#idinstitution").val(""),$("#institution").val("")});var n=[];$("#institution").autocomplete({minLength:3,source:function(e,t){$("#idcity").val()!=""&&typeof $("#idcity").val()!="undefined"&&$.ajax({type:"POST",url:BAppConfig.get("site_profile","config").userInfoDataUrl+"/getschools",data:{search:e.term,country:$("#country option:selected").val(),city:$("#idcity").val()},success:$.proxy(function(e){var r=[];$("#idcity").val(e.data.cityId),$.each(e.data,function(e,t){e!="cityId"&&(r.push(t),n.push(e+"###"+t))}),t(r)},this),dataType:"json"})},select:function(e,t){$.each(n,function(e,n){var r=n.split("###");t.item.value==r[1]&&$("#idinstitution").val(r[0])})}}),$("#institution").keyup(function(){$("#idinstitution").val($("#institution").val())})}};return l}),define("profile/changepassword",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","order!jquery.ui","order!jquery.ui.locale","order!jquery.validate","order!jquery.validate.messages_locale"],function(e,t,n,r){var i=function(){var e={rules:{"data[email]":{required:!0,email:!0},"data[current_password]":{required:!0,minlength:6},"data[new_password]":{minlength:6},"data[confirm_password]":{minlength:6,equalTo:"#new_password"}}};this.run=function(){n.render();var e=new r({el:"#content_left",config:BAppConfig.get("site_settings","config").left_menu,userid:BAppConfig.get("mydata","id"),selected_item:"account"});e.render(),this.initHandlers()},this.initHandlers=function(){$("#change_password").validate(e),$("#saveBtn").on("click",function(){$("#change_password").valid()&&(Utils.block("#change_password"),$("#change_password").submit())})}};return i}),define("profile/friend_request",[],function(){var e=function(){this.init=function(){},this.sendFriendRequest=function(e,t){$.ajax({type:"POST",data:{id:e},url:BAppConfig.get("site_requests","userRequestsUrlSend"),success:t,dataType:"json"})},this.cancelFriendRequest=function(e,t){$.ajax({type:"POST",data:{requestId:e},url:BAppConfig.get("site_requests","userRequestsUrlCancel"),success:t,dataType:"json"})},this.getSentFriendRequests=function(e,t){$.ajax({type:"POST",data:{friendId:e},url:BAppConfig.get("site_requests","getSentFriendRequests"),success:t,dataType:"json"})},this.removeConnection=function(e,t){$.ajax({type:"POST",data:{id:e},url:BAppConfig.get("site_requests","removeConnection"),success:t,dataType:"json"})},this.getConnectionList=function(e,t,n){$.ajax({type:"POST",data:{page:e,rows:t},url:BAppConfig.get("site_requests","getConnections"),success:n,dataType:"json"})}};return e}),define("profile/connection_list",["require","beyazpano","paginator","profile/friend_request","utils","default/views/siteHeader","default/views/siteLeftMenu","order!jquery.ui"],function(e,t,n,r,i,s,o){var u=function(){this.LIST_CONTAINER_ID="user-connections",this.run=function(){this.friendRequestObj=new r,s.render(),this.initPaginator();var e=new o({el:"#content_left",config:BAppConfig.get("site_general","left_menu_general"),selected_item:"people",insertMethod:"prepend"});e.render(),$("#requests-dropdown").on("externalAcceptedFromDropdown",_.bind(function(){$.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("friend_request_accepted"),"#flash-message")},this));var t=[];$("#search_conn").autocomplete({source:function(e,n){$.ajax({type:"POST",url:BAppConfig.get("site_requests","searchConnections"),data:{search:e.term},success:$.proxy(function(e){var r=[];$.each(e.data,function(e,n){r.push(n.first_name+" "+n.last_name),t.push(e+"###"+n.first_name+" "+n.last_name)}),n(r)},this),dataType:"json"})},select:function(e,n){$.each(t,function(e,t){var r=t.split("###");n.item.value==r[1]&&(document.location.href=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",r[0]))})}})},this.initHandlers=function(){$(".unfriend-btn").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("unfriend-btn-","");Utils.confirm(translate("user_connection_remove_confirm_title"),translate("user_connection_remove_confirm_body"),_.bind(function(e){e=="yes"&&this.friendRequestObj.removeConnection(t,_.bind(function(e){e.success&&($.cookie(this.PAGE_COOKIE_NAME,null),$.cookie(this.PAGES_COOKIE_NAME,null),this.paginator.setTotalPages(1),this.paginator.goToPage(1),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("user_connection_removed"),"#flash-message"))},this))},this))},this))},this.initPaginator=function(){this.PAGES_COOKIE_NAME="conn_pages",this.PAGE_COOKIE_NAME="conn_page",this.paginator=new AppPaginator("#paginator",{page:1,pages:1,onPageSelected:_.bind(this.onPageChanged,this),render:!1});var e=parseInt($.cookie(this.PAGES_COOKIE_NAME))>0?parseInt($.cookie(this.PAGES_COOKIE_NAME)):1,t=parseInt($.cookie(this.PAGE_COOKIE_NAME))>0?parseInt($.cookie(this.PAGE_COOKIE_NAME)):1;this.paginator.setTotalPages(e),this.paginator.goToPage(t)},this.onPageChanged=function(e){this.loadListContent(e,10,_.bind(function(e){this.paginator.setTotalPages(e.data.totalPages),this.paginator.setCurrentPage(e.data.page),$("#"+this.LIST_CONTAINER_ID).html(e.data.html),this.initHandlers(),$.cookie(this.PAGE_COOKIE_NAME,e.data.page),$.cookie(this.PAGES_COOKIE_NAME,e.data.totalPages),e.data.totalPages>1?this.paginator.render():this.paginator.hide(),Utils.setZIndex()},this))},this.loadListContent=function(e,t,n){this.friendRequestObj.getConnectionList(e,t,_.bind(function(e){!e.success||_.isFunction(n)&&n.apply(this,[e])},this))}};return u}),define("text!connections/templates.html",[],function(){return'<script type="text/template" id="connections_container">\r\n    <%  if(!_.isEmpty(data)){  %>\r\n    <ul id="inviteMembersEvent" class="inviteMemberList">\r\n        <% _.each(data,function(item){%>\r\n        <li class="user-guest guestList clearfix" id="user-guest-<%= item.id %>">\r\n            <a href="<% print(BAppConfig.get(\'site_profile\', \'config\').userProfileUpdatesLink.replace(\'__userid__\', item.id)) %>">\r\n            <img src="<%= item.avatar %>" width="30" height="30" />\r\n            <span><%= item.first_name + \' \' + item.last_name %></span>\r\n            </a>\r\n        </li>\r\n        <% })%>\r\n    </ul>\r\n    <% }else{ %>\r\n    <ul id="inviteMembersEvent" class="inviteMemberList">\r\n        <li class="user-guest guestList clearfix">\r\n            <span class="noResultMsg"><% print(translate(\'no_connections\')) %>\r\n        </li>\r\n    </ul>\r\n    <% } %>\r\n</script>\r\n<script type="text/template" id="connections_popup">\r\n    <div id="connections_list"></div>\r\n    <div id="connections_paginator"></div>\r\n</script>\r\n\r\n<script type="text/template" id="users_connections">\r\n	<h2 class="rightTitle"><% print(translate(title)) %><span class="nrUsers"><% print(\' (\'+numberOfConnections+\') \')%> </span> </h2>\r\n	<% if(!_.isUndefined(connections)){ %>\r\n		<% _.each(connections,function(item){ %>\r\n		<a href="<% print(profileUrl.replace(\'__userid__\',item.id)) %>" class="imgList">\r\n			<img width="40" height="40" src="<% print(item.avatar) %>" title="<% print(item.first_name+\' \'+item.last_name) %>">\r\n		</a>\r\n	<% })} if(numberOfConnections && numberOfConnections > limit){ %>\r\n		<p class="clearfix"><a id="show-all-<% print(type) %>" class="show-all" href="javascript:void(0);"><% print(translate(\'global_show_all\')) %></a></p>\r\n    <% } %>\r\n</script>'}),define("connections/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("connections_templates",n);return r}),define("connections/views/connections",["require","beyazpano","paginator","connections/_templates"],function(e,t,n,r){var i=Backbone.View.extend({templateNames:{main:"connections_container",popup_connections:"connections_popup",connections_list:"users_connections"},userId:null,popupType:null,initialize:function(){this.el="#content_right",this.$el=$(this.el),this.userId=$("#__profile-userid").val(),setTimeout(_.bind(function(){this.getConnections()},this),1e3)},render:function(e,n){var r={type:"connections",title:"profile_connections",profileUrl:BAppConfig.get("site_profile","config").userProfileUpdatesLink,limit:n};if(!_.isUndefined(e.connections)){r.numberOfConnections=e.connections.numberOfConnections,r.connections=e.connections.connections;var i=t.renderTemplate(this.templateNames.connections_list,r);this.$el.append(i)}return!_.isUndefined(userData)&&userData.role==="STUDENT"?(r=_.extend(r,{type:"instructors",numberOfConnections:!_.isUndefined(e.instructors)&&!_.isUndefined(e.instructors.numberOfInstructors)?e.instructors.numberOfInstructors:0,title:"profile_teachers",connections:!_.isUndefined(e.instructors)&&!_.isUndefined(e.instructors.instructors)?e.instructors.instructors:{}}),i=t.renderTemplate(this.templateNames.connections_list,r),this.$el.append(i)):!_.isUndefined(userData)&&userData.role==="INSTRUCTOR"&&(r=_.extend(r,{type:"students",numberOfConnections:!_.isUndefined(e.students)&&!_.isUndefined(e.students.numberOfStudents)?e.students.numberOfStudents:0,title:"profile_students",connections:!_.isUndefined(e.students)&&!_.isUndefined(e.students.students)?e.students.students:{}}),i=t.renderTemplate(this.templateNames.connections_list,r),this.$el.append(i)),this.initHandlers(),this},getConnections:function(){var e=BAppConfig.get("site_profile","config").userInfoDataUrl,t=10;$.ajax({type:"POST",url:e+"/get-random-connections",dataType:"json",data:{userId:this.userId,limit:t},success:$.proxy(function(e){e.success&&this.render(e.data,t)},this)})},initHandlers:function(){$("#show-all-connections,#show-all-students,#show-all-instructors").on("click",_.bind(function(e){var n=t.renderTemplate(this.templateNames.popup_connections,{}),r="";switch($(e.currentTarget).attr("id")){case"show-all-connections":this.popupType="connections",r="profile_connections";break;case"show-all-students":this.popupType="students",r="profile_students";break;case"show-all-instructors":this.popupType="instructors",r="profile_teachers"}Utils.popup(translate(r),n),this.initPaginator()},this))},loadListContent:function(e,t,n){var r=BAppConfig.get("site_profile","config").userInfoDataUrl,i=BAppConfig.get("global","ajaxLoadingImg");$("#students_list").html('<img src="'+i+'">'),$.ajax({type:"POST",url:r+"/getconnections",dataType:"json",data:{userid:this.userId,page:e,pages:t,type:this.popupType},success:$.proxy(function(e){_.isFunction(n)&&n.apply(this,[e])},this)})},initPaginator:function(){var e=1,t=1;this.paginator=new AppPaginator("#connections_paginator",{page:t,pages:e,onPageSelected:_.bind(this.onPageChanged,this),render:!1}),this.paginator.setTotalPages(e),this.paginator.goToPage(t)},onPageChanged:function(e){this.loadListContent(e,10,_.bind(function(e){this.paginator.setTotalPages(e.totalPages),this.paginator.setCurrentPage(e.page);var n=t.renderTemplate(this.templateNames.main,{data:e.data});$("#connections_list").html(n),e.totalPages>1?this.paginator.render():this.paginator.hide()},this))}});return i}),define("connections/main",["require","beyazpano","connections/views/connections"],function(e,t,n){var r=function(){this.run=function(){var e=new n}};return r}),function(e){e.fn.filestyle=function(t){var n={width:250};return t&&e.extend(n,t),this.each(function(){var t=this,r=e("<div>").addClass(n.classes).addClass(n.divClass),i=e('<input class="file">').addClass(e(t).attr("class")).css({display:"inline",width:n.width+"px"});e(t).before(i),e(t).wrap(r),n.label!=""&&n.label!=null&&e("."+n.divClass).append(n.label),e(t).css({width:"70px",display:"inline",cursor:"pointer",opacity:"0.0",position:"absolute",left:"0",top:"0","z-index":"2",zoom:"1"}),e.browser.mozilla&&/Win/.test(navigator.platform),e(t).bind("change",function(){i.val(e(t).val())})})}}(jQuery),define("jquery.filestyle",function(){}),define("profile/edit",["require","beyazpano","attachments","order!jquery.form","order!jquery.jcrop","order!jquery.textarea.autosize","utils","default/views/siteHeader","default/views/siteLeftMenu","jquery.filestyle","./_templates","order!plupload","order!plupload.html4","order!plupload.html5","order!plupload.flash","order!file.attachments"],function(e,t,n,r,i,s,o,u,a,f,l){var c=function(){this.FORM_ID="edit-profile",this.AVATAR_IMAGE_ID="avatar",this.AVATAR_IMAGE_RESIZED_ID="avatar-resized",this.AVATAR_IMAGE_EDIT="avatar-edit-image",this.AVATAR_IMAGE_EDIT_BTN="avatar-edit",this.AVATAR_REMOVE_CONTAINER="remove-avatar-container",this.jcrop_api,this.AVATAR_CONFIG,this.AVATAR_URL,this.UPLOADED_IMAGE,this.SAVED_IMAGE,this.TEMP_IMAGE_URL,this.run=function(){this.AVATAR_CONFIG=BAppConfig.get("site_profile","config").avatar,this.AVATAR_URL=BAppConfig.get("site_profile","config").avatarUrls,this.TEMP_IMAGE_URL=BAppConfig.get("site_profile","config").avatarUrls.avatar.tmpAvatar,this.initHandlers(),u.render();var e=new a({el:"#content_left",config:BAppConfig.get("site_profile","config").left_menu,userid:BAppConfig.get("mydata","id"),selected_item:"info"});e.render();var t=$("#active").val();t?$('#profileTabs a[href="'+t+'"]').tab("show"):$("#profileTabs a:first").tab("show"),$("#fileProfile").filestyle({width:220,label:'<div class="uploadBtn">'+translate("global_upload")+"</div>",classes:"btn userDefaultBtn",divClass:"uploadButton"}),$("textarea.autosizable").autosize();var n=this,r=new FileAttachments("#upload_avatar",{onFileAttached:_.bind(function(e,t){n.UPLOADED_IMAGE=e.title,$("#newavatar").val(n.UPLOADED_IMAGE),$("#changeavatar").val(1),n.SAVED_IMAGE=$("#avatar").attr("src"),$("#avatar").attr("src",n.TEMP_IMAGE_URL+n.UPLOADED_IMAGE),$("#avatar-resized").attr("src",n.TEMP_IMAGE_URL+n.UPLOADED_IMAGE),$("#avatar-resized, #avatar-edit").show()},this),onFileRemoved:_.bind(function(e,t){$("#avatar").attr("src",n.SAVED_IMAGE),$("#avatar-resized").attr("src",n.SAVED_IMAGE),n.UPLOADED_IMAGE=""},this),clientUploader:BAppConfig.get("global","swfUploader"),uploaderUrl:BAppConfig.get("site_profile","config").userInfoDataUrl+"/uploadavatar",fileSizeLimit:BAppConfig.get("global","max_file_size"),listContainer:"upload_list",multiSelection:!1,blockButtonIdFileAttachment:"#save-profile-user",confirmMessage:{title:translate("profile_image_confirm_remove_title"),message:translate("profile_image_confirm_remove"),uploadNew:translate("remove_profile_image_to_upload_new")}});$("#edit-profile").find(".tabs").live("click",function(){$("#edit-profile").find(".tabs").find('a[href *="picture"]').parent("li:first").hasClass("active")?$("#uploadOnTab").removeClass("hide"):$("#uploadOnTab").addClass("hide")}),$("#edit-profile").find(".tabs").click(),$("#profileTabs").on("click","a",function(){$("#active").val($(this).attr("href"))}),$(".plupload").live("hover",function(e){e.type=="mouseenter"&&($("#upload_file_browse").hasClass("backgroundBtnHover")||$("#upload_file_browse").addClass("backgroundBtnHover")),e.type=="mouseleave"&&$("#upload_file_browse").hasClass("backgroundBtnHover")&&$("#upload_file_browse").removeClass("backgroundBtnHover")})},this.attachmentsChanged=function(){$('#addEventForm input[name="attachments"]').val($.toJSON(this.attachments.getAttachments()))},this.initHandlers=function(){$("#"+this.AVATAR_IMAGE_EDIT_BTN).on("click",_.bind(this.openAvatarEditDialog,this)),$(".predefined-avatar").on("click",_.bind(this.setPredefinedAvatar,this)),$("#"+this.FORM_ID+' input[name^="avatar[file]"]').live("change",_.bind(function(e){$(e.target).val()!=""&&$("#"+this.FORM_ID+' input[name^="avatar[predefined]"]').val("")},this)),$("#"+this.FORM_ID+" button[type=submit]").live("click",_.bind(function(e){e.preventDefault(),$("#"+this.FORM_ID).submit()},this))},this.updateAvatarData=function(e){$("#"+this.FORM_ID+' input[name^="avatar"]').removeAttr("checked").val(""),$("#"+this.AVATAR_IMAGE_ID+","+"#"+this.AVATAR_IMAGE_RESIZED_ID).removeAttr("src").hide(),$("#"+this.AVATAR_IMAGE_EDIT_BTN+","+"#"+this.AVATAR_REMOVE_CONTAINER).hide();if(e)$("#"+this.AVATAR_REMOVE_CONTAINER).show(),e.predefined==0?($("#"+this.AVATAR_IMAGE_EDIT_BTN).show(),$("#"+this.AVATAR_IMAGE_ID).attr("src",this.AVATAR_URL.avatar.big+e.avatar).show(),$("#"+this.AVATAR_IMAGE_RESIZED_ID).attr("src",this.AVATAR_URL.avatar.small.url+e.avatar+"?"+Math.random()).show()):$("#"+this.AVATAR_IMAGE_ID).attr("src",this.AVATAR_URL.predefined.big+e.avatar).show(),$("#"+this.FORM_ID+' input[name*="avatar[avatar]"]').val(e.avatar),$("#"+this.FORM_ID+' input[name*="avatar[x]"]').val(e.x),$("#"+this.FORM_ID+' input[name*="avatar[y]"]').val(e.y),$("#"+this.FORM_ID+' input[name*="avatar[predefined]"]').val(e.predefined);else{var t=BAppConfig.get("mydata","gender");t=="M"?$("#"+this.AVATAR_IMAGE_ID).attr("src",this.AVATAR_URL.predefined.big+this.AVATAR_CONFIG.nophoto.male).show():$("#"+this.AVATAR_IMAGE_ID).attr("src",this.AVATAR_URL.predefined.big+this.AVATAR_CONFIG.nophoto.female).show()}},this.openAvatarEditDialog=function(e){var t="_dialog_avatar_change",n="";_.isEmpty(this.UPLOADED_IMAGE)?n=this.AVATAR_URL.avatar.big+$("#"+this.FORM_ID+' input[name*="avatar[avatar]"]').val():n=this.TEMP_IMAGE_URL+this.UPLOADED_IMAGE;var r=_.template($("#avatar-edit-dialog").html(),{dialog_id:t,title:translate("profile_edit_avatar"),image:n,footer:'<button href="#" class="btn btn-primary" id="'+t+'-okbtn">Ok</button>'}),i=$(r);i.find("#"+t+"-okbtn").on("click",_.bind(function(){i.modal("hide"),$("#avatar-edit-image-x").val()&&$("#"+this.FORM_ID+' input[name*="avatar[x]"]').val($("#avatar-edit-image-x").val()),$("#avatar-edit-image-y").val()&&$("#"+this.FORM_ID+' input[name*="avatar[y]"]').val($("#avatar-edit-image-y").val()),this.jcrop_api.data("Jcrop").destroy()},this)),$("#"+t).remove(),$("body").append(i),$("#"+t).modal({show:!0,backdrop:"static"}),$("#"+t).modal("show");var s=$("#avatar").width()<$("#avatar").height()?$("#avatar").width():$("#avatar").height();this.jcrop_api=$("#"+this.AVATAR_IMAGE_EDIT).Jcrop({setSelect:[parseInt($("#"+this.FORM_ID+' input[name*="avatar[x]"]').val()),parseInt($("#"+this.FORM_ID+' input[name*="avatar[y]"]').val()),parseInt($("#"+this.FORM_ID+' input[name*="avatar[x]"]').val())+s,parseInt($("#"+this.FORM_ID+' input[name*="avatar[y]"]').val())+s],aspectRatio:1,minSize:[s,s],maxSize:[s,s],allowResize:!1,onSelect:function(e){$("#avatar-edit-image-x").val(e.x),$("#avatar-edit-image-y").val(e.y)}})},this.setPredefinedAvatar=function(e){var t=$(e.target).attr("rel"),n={avatar:t,predefined:1,x:0,y:0};this.updateAvatarData(n)}};return c}),define("profile/model/profileInfo",["beyazpano"],function(e){var t=Backbone.Model.extend({initialize:function(){this.url=BAppConfig.get("site_profile","config").userInfoDataUrl},parse:function(e){return e.success?e.data:null}});return t}),define("profile/views/friendRequest",["require","beyazpano","profile/friend_request","profile/_templates"],function(e,t,n){var r=Backbone.View.extend({templateNames:{main:"friend_request_btn"},btnLabel:translate("global_send_friend_request"),friendRequestClass:"send-friend-request",userid:null,requestId:null,friendRequestObj:null,showDecline:null,initialize:function(e){this.userid=e.userid,this.renderContent(),$("#requests-dropdown").on("externalAcceptedFromDropdown externalAcceptFromDropdownFailed externalDeclinedFromDropdown externalDeclineFromDropdownFailed",_.bind(function(){this.renderContent()},this))},renderContent:function(e){this.friendRequestObj=new n,this.friendRequestObj.getSentFriendRequests(this.userid,_.bind(function(t){if(t.success){var n=t.data.sentFriendRequests,r=t.data.receivedFriendRequests,i=t.data.userConnections;_.isEmpty(r)?_.isEmpty(n)?_.isEmpty(i)?this.enableSendState():this.enableUnfriendState():(this.requestId=_.first(_.keys(n)),this.enableCancelState()):(this.requestId=r[0].requestId,this.enableAcceptState()),_.isFunction(e)&&e.apply(this,[]),this.render()}},this))},enableSendState:function(){this.btnLabel=translate("global_send_friend_request"),this.friendRequestClass="send-friend-request",this.showDecline=0},enableCancelState:function(){this.btnLabel=translate("global_cancel_friend_request"),this.friendRequestClass="cancel-friend-request",this.showDecline=0},enableAcceptState:function(){this.btnLabel=translate("friend_request_accept_label"),this.friendRequestClass="accept-friend-request",this.showDecline=1},enableUnfriendState:function(){this.btnLabel=translate("global_unfriend"),this.friendRequestClass="unfriend-btn",this.showDecline=0},render:function(){var e={friend_request_userid:_.isNull(this.requestId)?this.userid:this.requestId,friend_request_label:this.btnLabel,friend_request_class:this.friendRequestClass,show_decline:this.showDecline},n=$(t.renderTemplate(this.templateNames.main,e));n.hide(),$("#friend-request-btn").html(n),this.initHandlers(),n.fadeIn(400)},initHandlers:function(){$(".send-friend-request").on("click",_.bind(function(){this.friendRequestObj.sendFriendRequest(this.userid,_.bind(function(e){e.success&&Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("friend_request_sent"),"#flashmessages","2000"),this.renderContent()},this))},this)),$(".cancel-friend-request").on("click",_.bind(function(){this.friendRequestObj.cancelFriendRequest(this.requestId,_.bind(function(e){e.success&&Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("friend_request_cancel"),"#flashmessages","2000"),this.renderContent()},this))},this)),$(".unfriend-btn").on("click",_.bind(function(){Utils.confirm(translate("user_connection_remove_confirm_title"),translate("user_connection_remove_confirm_body"),_.bind(function(e){e=="yes"&&this.friendRequestObj.removeConnection(this.userid,_.bind(function(e){this.renderContent()},this))},this))},this)),$(".accept-friend-request").on("click",_.bind(function(e){$("#requests-dropdown").trigger("externalAcceptRequest",e)},this)),$(".decline-friend-request").on("click",_.bind(function(e){$("#requests-dropdown").trigger("externalDeclineRequest",e)},this))}});return r}),define("profile/views/avatar",["require","beyazpano","profile/_templates","lightbox"],function(e,t,n){var r=Backbone.View.extend({templateNames:{main:"profile_avatar"},initialize:function(e){this.userid=null,this.avatarUrl="",this.userName="",this.originalAvatar="",e&&(e.userid&&(this.userid=e.userid),e.avatarUrl&&(this.avatarUrl=e.avatarUrl),e.originalAvatar&&(this.originalAvatar=e.originalAvatar),e.userName&&(this.userName=e.userName))},render:function(){var e=BAppConfig.get("mydata","id"),n={avatarUrl:this.avatarUrl,userName:this.userName,originalUrl:this.originalAvatar},r=t.renderTemplate(this.templateNames.main,n);$(this.el).html(r);var i;if(e==this.userid){var s=BAppConfig.get("global","baseUrl");i='<a href="'+s+'profile/edit/edit/picture">'+translate("edit_picture")+"</a>"}else i="";$("#avatar_lightbox").colorbox({transition:"none",width:"85%",height:"85%",title:i}),$("#colorbox").addClass("avatarColorbox")}});return r}),define("updates/views/updatesList",["require","beyazpano","attachment/views/list","like/views/like","comment/views/comment","order!date","order!jquery.editinplace","updates/_templates"],function(e,t,n,r,i){var s=Backbone.View.extend({templateNames:{main:"site_updates_list",list_item:"site_updates_list_item",view_more:"site_updates_list_view_more",attachments:"site_updates_list_attachments"},initialize:function(e){this.initHandlers(),this.config={},this.popup={},this.collection=null,this.wallType=null,this.wallOwner=null,this.updateType=null,e.config&&(this.config=_.extend(this.config,e.config)),this.onCollectionReset=_.bind(this.onCollectionReset,this),e.collection&&(this.collection=e.collection,this.collection.off("reset"),this.collection.on("reset",this.onCollectionReset),this.collection.on("updatesAdded",_.bind(function(e){this.renderUpdates(e)},this))),e.wallType&&(this.wallType=e.wallType),e.wallOwner&&(this.wallOwner=e.wallOwner),e.updateType&&(this.updateType=e.updateType),this.elId=_.uniqueId("updates_list_")},onCollectionReset:function(){this.render()},render:function(){var e=this.collection.toJSON(),n={updates_list:e,hasAccess:this.collection.hasAccess,id:this.elId},r=$(t.renderTemplate(this.templateNames.main,n));$(this.el).html(r),this.renderUpdates(e)},renderUpdates:function(e){e.length>0&&_.each(e,_.bind(function(e){this.renderUpdateItem(e,"#"+this.elId+"_list")},this))},renderUpdateItem:function(e,s){var o=BAppConfig.get("mydata","id"),u={id:this.elId,avatarUrl:"",type:e.type,itemId:e.id,canDelete:e.canDelete,canEdit:e.canEdit,isAnnouncement:e.isAnnouncement},a=this.collection.getUserData(e.author);a!==null?(u.author_name=a.first_name+" "+a.last_name,u.avatarUrl=a.avatar):u.author_name=e.author,u.profileUrl=BAppConfig.get("site_profile","config").userProfileUpdatesLink.replace("__userid__",e.author),u.timestamp=Date.parseExact(e.timestamp,"yyyy-MM-dd HH:mm:ss"),u.body=_.escape(e.body).replace(/\n/g,"<br />"),u.canComment=e.canComment,u.canLike=e.canLike,u.needsApproval=typeof e.approvedPost!="undefined"?e.approvedPost===!0?!1:!0:!1,u.pendingApproval=typeof e.approved!="undefined"?e.approved===!0?!1:!0:!1;var f=$(t.renderTemplate(this.templateNames.list_item,u));f.hide(),$(s).append(f);var l=new r({el:f.find(".jqLikeContainer:first"),likersContainer:f.find(".jqLikers:first"),canLike:e.canLike}),c={type:"post",entity_id:e.id},h=this.collection.getLikeData(e.id);h!==null&&(c=h),c.page_type=this.collection.getPageType(),c.page_entity_id=this.collection.getPageEntityId(),l.renderLike(c);var p=new i({el:f.find(".jqCommentContainer:first"),additionalData:this.collection.getCommentAdditionalData(),addCommentLink:f.find(".jqCommentContainer:first").parent().find(".jqAddComment:first"),canComment:e.canComment}),d={entityType:this.updateType,entityId:e.id,items:[],nrOfComments:0},v=null;h=this.collection.getCommentData(e.id);var m=this.collection.getCommentLikesData();h!=null&&(d=h,v=this.collection.getCommentUsers()),d.page_entity_id=this.collection.getPageEntityId(),p.renderComment(d,v,m);var g=this.elId+"_i_"+e.type+"_"+e.id;if(e.attachments&&_.isObject(e.attachments)&&(e.attachments.file||e.attachments.link||e.attachments.video)){var y=new n({el:"#"+g+"_attachments_container",config:{},attachments:e.attachments,postid:e.id});y.render()}f.find(".close, .reject_post").on("click",_.bind(function(e){var t="";$(e.target).hasClass("close")?t=e.target.id.replace("remove_post_",""):t=e.target.id.replace("reject_post_","");var n={postType:t.split("_")[0],postId:t.split("_")[1],wallType:this.wallType,wallOwner:this.wallOwner},r=this;Utils.confirm(translate("delete_post"),translate("delete_post_text"),function(e){e=="yes"&&$.ajax({type:"POST",url:BAppConfig.get("site_post","deletePostUrl"),data:n,success:_.bind(function(e){e.success?($("#post_"+t).fadeOut("slow",function(){$(this).remove()}),r.trigger("increment_decreaseOffsset")):Utils.alert(translate("error_title"),translate("error_delete_post"))},this),dataType:"json"})})},this)),f.find(".approve_post").on("click",_.bind(function(e){var t=e.target.id.replace("approve_post_",""),n={postType:t.split("_")[0],postId:t.split("_")[1],wallType:this.wallType,wallOwner:this.wallOwner},r=$("#approve_post_"+t).parents("ul.postContainer:first");Utils.confirm(translate("approve_post"),translate("approve_post_message"),function(e){Utils.block(r),e=="yes"?$.ajax({type:"POST",url:BAppConfig.get("site_post","approvePostUrl"),data:n,success:_.bind(function(e){Utils.unblock(r),e.success?($("#post_"+t).removeClass("approval"),$("#approve_post_"+t).remove(),$("#reject_post_"+t).remove()):Utils.alert(translate("global_error"),translate("error_approve_post"))},this),dataType:"json"}):Utils.unblock(r)})},this)),f.find(".report").on("click",_.bind(function(e){var t=e.target.id.replace("report-","");$.ajax({type:"POST",url:BAppConfig.get("admin_complaints","ajarUrlComplaintsJson")+"/opencreate",data:{postKey:t},success:_.bind(function(e){var t=Utils.popup(translate("global_report"),e.data.body,e.data.footer)},this),dataType:"json"})},this)),f.fadeIn("slow"),this.renderViewMoreUpdatesButton()},initHandlers:function(){$("#add-report").live("click",_.bind(function(e){if($("#addReportForm").valid()){$("#_dialog_popup").modal("hide");var t=$("#addReportForm").serialize();$.ajax({type:"POST",url:BAppConfig.get("admin_complaints","ajarUrlComplaintsJson")+"/create",data:t,success:_.bind(function(e){if(e.success)Utils.alert(translate("global_report"),translate("report_message_sent"));else for(var t in e.msg)Admin.flashMessage(Admin.FLASH_ERROR,"",e.msg[t],"#alert_add_report")},this),dataType:"json"})}}))},renderViewMoreUpdatesButton:function(){$("#"+this.elId+"_view_more").remove();var e=this.collection.getPaginationData();if(e.page>0&&e.pages>e.page){var n=t.renderTemplate(this.templateNames.view_more,{id:this.elId,img:BAppConfig.get("global","ajaxLoadingImg")});$(this.el).append(n),$("#"+this.elId+"_view_more_link").on("click",_.bind(function(){$("#"+this.elId+"_view_more_loading").removeClass("hide"),$("#"+this.elId+"_view_more_link").attr("disabled","disabled"),this.trigger("viewMoreUpdates")},this))}}});return s}),define("updates/model/update",["beyazpano"],function(e){var t=Backbone.Model.extend({initialize:function(){}});return t}),define("updates/collection/updates",["updates/model/update"],function(e){var t=Backbone.Collection.extend({initialize:function(){this.details={page:0,pages:0,limit:20,total:0,decreaseOffset:0},this.userData={},this.likesData={}},model:e,parse:function(e){return this.hasAccess=e.data.hasAccess,this.details.page=e.data.page,this.details.pages=e.data.pages,this.details.limit=e.data.limit,this.details.total=e.data.total,this.details.decreaseOffset=e.data.decreaseOffset,this.userData=e.data.users,this.likesData=e.data.likes.data,this.pageType=e.data.likes.page_type,this.pageEntityId=e.data.likes.page_entity_id,this.commentsData=e.data.comments.data,this.commentPageType=e.data.comments.page_type,e.data.updates},getPaginationData:function(){return this.details},getUserData:function(e){var t=null;return!_.isUndefined(this.userData)&&!_.isUndefined(this.userData[e])&&(t=this.userData[e]),t},getLikeData:function(e){var t=null;return!_.isUndefined(this.likesData)&&!_.isUndefined(this.likesData[e])&&(t=this.likesData[e]),t},getPageType:function(){return this.pageType},getPageEntityId:function(){var e=null;return _.isUndefined(this.pageEntityId)||(e=this.pageEntityId),e},getCommentData:function(e){var t=null;return!_.isNull(this.commentsData)&&!_.isUndefined(this.commentsData)&&!_.isUndefined(this.commentsData.comments)&&!_.isUndefined(this.commentsData.comments[e])&&(t=this.commentsData.comments[e]),t},getCommentPageType:function(){return this.commentPageType},getCommentUsers:function(){var e=null;return!_.isUndefined(this.commentsData)&&!_.isUndefined(this.commentsData.users)&&(e=this.commentsData.users),e},getCommentAdditionalData:function(){var e=null;return!_.isUndefined(this.commentsData)&&!_.isUndefined(this.commentsData.additional)&&(e=this.commentsData.additional),e},getCommentLikesData:function(){var e=null;return!_.isUndefined(this.commentsData)&&!_.isUndefined(this.commentsData.likes)&&(e=this.commentsData.likes),e},loadMoreUpdates:function(e){var t=_.clone(this.details);t.page=t.page+1,this.fetch({data:t,add:!e,success:_.bind(function(t,n){e||t.trigger("updatesAdded",n.data.updates,t)},this)})},incrementDecreaseOffsset:function(){this.details.decreaseOffset++}});return t}),define("profile/views/updates",["require","beyazpano","profile/main","profile/views/friendRequest","profile/_templates","profile/model/profileInfo","profile/views/avatar","default/views/siteHeader","default/views/siteLeftMenu","updates/views/postUpdate","updates/views/updatesList","updates/collection/updates","home/views/showCourses"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=Backbone.View.extend({userid:null,templateNames:{main:"profile_updates",rigthColumnLayout:"profile_updates_right_column",avatarContainer:"profile_avatar_container"},initialize:function(){this.profileInfoModel=new s;var e=typeof userData=="undefined"?{}:userData;this.profileInfoModel.set(e,{silent:!0}),this.el="#content",this.$el=$(this.el),this.postUpdateView=null,this.updatesCollection=new c},setUserId:function(e){this.userid=e,this.updatesCollection.url=BAppConfig.get("site_profile","config").updatesAjaxBaseUrl.replace("__userid__",this.userid),this.profileInfoModel.set("id",this.userid,{silent:!0})},render:function(){this.userid===null&&this.setUserId(BAppConfig.get("mydata","id")),u.render();var e=BAppConfig.get("site_profile","config").left_menu,n={items:[]};this.hasAccesUpdate=$("#hasAccessUpdate").val()=="0"?"0":"1";for(var r in e.items)(this.hasAccesUpdate!="1"&&e.items[r].id!="updates"||this.hasAccesUpdate=="1")&&n.items.push(e.items[r]);var i=new a({el:"#content_left",config:n,userid:this.userid,selected_item:"updates",insertMethod:"prepend"});i.render();var s=t.renderTemplate(this.templateNames.avatarContainer,{});$("#content_left").prepend(s),this.renderContent(),this.hasAccesUpdate==="1"&&this.updatesCollection.fetch(this.updatesCollection.details);var o=new h;o.initialize()},renderContent:function(){var e={userinfo:this.profileInfoModel.toJSON(),editProfileLink:"javascript:void(0)"},n=new o({el:"#avatar_container",userid:parseInt(this.userid),avatarUrl:this.profileInfoModel.get("avatarUrl"),originalAvatar:this.profileInfoModel.get("originalAvatar"),userName:this.profileInfoModel.get("first_name")+" "+this.profileInfoModel.get("last_name")});n.render(),e.access=!0,this.userid!=BAppConfig.get("mydata","id")&&(e.access=!1);var i=$(t.renderTemplate(this.templateNames.main,e));this.$el.html(i),BAppConfig.get("mydata","role")==e.userinfo.role&&this.userid!=BAppConfig.get("mydata","id")&&setTimeout(_.bind(function(){var e=new r({userid:this.userid})},this),100),this.hasAccesUpdate==="1"&&(this.updatesList=new l({el:"#updates_list_container",collection:this.updatesCollection,wallType:1,wallOwner:this.userid,updateType:"profile_post"}),this.updatesList.on("viewMoreUpdates",_.bind(function(){this.updatesCollection.loadMoreUpdates(!1)},this))),this.userid==BAppConfig.get("mydata","id")&&(this.postUpdateView=new f({el:"#post_updates_container",config:{walls:["1_"+this.userid],savePostUrl:BAppConfig.get("site_post","savePostUrl")}}),this.postUpdateView.on("postSaved",_.bind(function(){this.updatesCollection.fetch()},this)),this.postUpdateView.render())}});return new p}),define("profile/router",["require","beyazpano","profile/views/updates","profile/views/info"],function(e,t,n,r){var i=Backbone.Router.extend({routes:{"u/:userid/updates":"showUpdates","u/:userid/info":"showUserInfo","*actions":"defaultActions"},defaultActions:function(e){this.navigate("/u/"+BAppConfig.get("mydata","id")+"/updates",{trigger:!0})},showUpdates:function(e){n.setUserId(e),n.render()},showUserInfo:function(e){r.setUserId(e),r.render()}}),s=function(){var e=new i;Backbone.history.start()};return{initialize:s}}),define("profile/main",["require","beyazpano","./router","./_templates"],function(e,t,n,r){var i=function(){this.run=function(){}};return i}),define("text!groups/templates.html",[],function(){return'<script type="text/template" id="site_user_groups">\n    <ul class="groups" id="<%= id %>">\n        <li><h2>Your Groups</h2></li>\n        <li>\n            <h3>Saturday, April 21, 2012</h3>\n            <ul>\n                <li><a href="#">Design Class (Beginners)</a></li>\n                <li><a href="#">Design Class (Masters)</a></li>\n            </ul>\n        </li>\n        <li>\n            <h3>Friday, April 27, 2012t</h3>\n            <ul>\n                <li><a href="#">SEO Class (Beginners)</a></li>\n                <li><a href="#">SEO Class (Masters)</a></li>\n            </ul>\n        </li>\n    </ul>\n</script>\n<script type="text/template" id="popup-group">\n    <section id="popup_<%= popupSection %>" class="modal fade hide" data-backdrop="static">\n\n    <div class="modal-header ">\n        <div class="modalHeaderContainer">\n            <a class="close" data-dismiss="modal"></a>\n            <h3><% print(translate(popupSection)) %></h3>\n        </div>\n    </div>\n    <div class="modal-body">\n		<div class="modalContent">\n			<div id="alert_group" ></div>\n			<form name="<%= popupForm %>Form" id="<%= popupForm %>Form" method="POST" action="">\n				<ul class="modalForm">\n					<li class="clearfix">\n						<label><%= translate(\'group_name\') %>:</label>\n						<input type="text"  name="group[name]" id="name" \n                            <%  if(!_.isUndefined(groupName)){ %>\n                                value="<%= groupName %>"\n                            <% } %>\n                        />\n					</li>\n					\n					\n                   \n					<li>\n						<p class="checkBoxContainer"><input type="checkbox"  name="group[moderation]" id="moderation" value="1" <%  if(!_.isUndefined(moderation) && moderation == \'1\'){  %> checked="checked" <% } %> /><label for="moderation"><%= translate(\'enable_moderation\') %></label><a class="question" href="javascript:void(0);" data-placement="top" data-original-title="<%- translate(\'help_info_groups\') %>"> ?</a></p>\n\n						<p class="checkBoxContainer"><input type="checkbox"  name="group[membership]" id="membership" value="1"<%  if(!_.isUndefined(membership) && membership == \'1\'){  %> checked="checked" <% } %>/><label for="membership"><%= translate(\'membership\') %></label><a class="question" href="javascript:void(0);" data-placement="top" data-original-title="<%- translate(\'group_membership_info\') %>"> ?</a></p>\n                        \n                        <% if (popupSection == \'edit_group\') { %> \n						<p class="checkBoxContainer"><input type="checkbox"  name="group[readonly]" id="readonly" value="1" <%  if(!_.isUndefined(readonly) && readonly == \'1\'){  %> checked="checked" <% } %>/><label for="readonly"><%= translate(\'readonly\') %></label><a class="question" href="javascript:void(0);" data-placement="top" data-original-title="<%- translate(\'group_readonly_info\') %>"> ?</a></p>\n                        <% } %>  \n					</li>\n				</ul>\n                <% if (popupSection == \'edit_group\') { %> \n                    <input type="hidden" name="idgroup" \n                        <% if (!_.isEmpty(groupId)){ %>\n                        value="<%= groupId %>"\n                        <% } %>\n                    />\n                    <input type="hidden" name="oldGroupName" \n                        <% if (!_.isUndefined(groupName)){ %>\n                        value="<%= groupName %>"\n                        <% } %>\n                    />\n                    <input type="hidden" name="initialReadOnlyStatus" \n                        <% if (!_.isUndefined(readonly)){ %>\n                        value="<%= readonly %>"\n                        <% } %>\n                    />\n                <% } %>    \n			</form>\n		</div>\n    </div>\n    <div class="modal-footer">\n        <div class="modalFooterContainer modalFooterContainerUser">\n            <div class="modalButtons">\n                <button  id="<%= saveBtnId %>" href="#" class="btn userDefaultBtn" id="_dialog_confirm-yesbtn"><% print(_.escape(translate(\'save\'))) %></button>\n                <button href="#" class="btn" data-dismiss="modal"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n            </div>\n        </div>\n    </div>\n</section>\n\n</script>\n<script type="text/template" id="join_group">\n    <div id="popup_join_group" class="modal fade hide" data-backdrop="static">\n	<div class="modal-header">\n	    <div class="modalHeaderContainer">\n		<a class="close" data-dismiss="modal"></a>\n		<h3><%= translate(\'join_group_access_code\') %></h3>\n	    </div>\n	</div>\n	<div class="modal-body">\n	    <div id="join_group">\n		<div class="modalContent">\n		    <div id="alert_access_code"></div>\n		    <form name="access-code-form-group" id="access-code-form-group" action="" method="post">\n			<ul class="modalForm">\n			    <li>\n				<label><%= translate(\'join_access_code\') %>:</label>\n				<input type="text" class="required" name="accesscode" id="access-code" />\n				<input type="hidden" id="joinGroupGroupId" name="groupid" value="<%= groupId %>"/>\n\n			    </li>\n			</ul>\n		    </form>\n		</div>\n	    </div>\n	</div>\n	<div class="modal-footer">\n	    <div class="modalFooterContainer modalFooterContainerUser">\n		<div class="modalButtons">\n		    <button  id="access-code-button-group" href="#" class="btn userDefaultBtn" id="_dialog_confirm-yesbtn"><%= translate(\'student_access_code_continue\') %></button>\n		    <button href="#" class="btn" data-dismiss="modal"><%= translate(\'global_cancel\') %></button>\n		</div>\n	    </div>\n	</div>\n    </div>\n</script>\n\n<script type="text/template" id="edit-members-popup-group">\n    <section id="popup_edit_members" class="modal fade hide" data-backdrop="static">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3><%= translate(\'edit_members_section\') %></h3>\n            </div>\n        </div>\n        <div id="edit-members-content" class="modal-body editMembersPopup">\n\n        </div>\n        <div class="modal-footer editMembersFooter empty-footer">\n            <div class="modalFooterContainer modalFooterContainerUser">\n                <div class="modalButtons">         \n                </div>\n            </div>\n        </div>\n    </section>\n</script>    \n\n\n<script type="text/template" id="group_add_member_popup_container"> \n    <div class="modal-header">\n    <div class="modalHeaderContainer">\n	<a class="close" data-dismiss="modal"></a>\n	<h3><% print(_.escape(translate(\'invite_members_section\'))) %></h3>\n    </div>\n</div>\n<div class="modal-body">\n    <div class="modalContent">\n	<div id="alert_add_members"></div>\n	<form name="sendEmailForm" id="sendEmailForm" action="" method="post">\n	    <ul class="modalForm">\n		<li>\n		    <label><% print(_.escape(translate(\'add_members_text\'))) %></label>\n		    <textarea name="emails" ></textarea>\n		</li>\n		<input type="hidden" name="idEntity" value="<%= data.idEntity %>">\n	    </ul>\n	</form>\n    </div>\n</div>\n<div class="modal-footer ">\n    <div class="modalFooterContainer modalFooterContainerUser">\n	<div class="modalButtons">\n	    <img id="ajax-loading-members" src ="<%= data.loaderImg %>"  style="display:none"/>\n	    <button  id="send-email-members" href="#" class="btn userDefaultBtn" ><% print(_.escape(translate(\'global_invite\'))) %></button>\n	    <button href="#" class="btn" data-dismiss="modal"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n	</div>\n    </div>\n</div>\n</script>'}),define("groups/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("groups_templates",n);return r}),define("groups/views/userGroups",["require","beyazpano","groups/_templates"],function(e,t){var n=Backbone.View.extend({templateNames:{main:"site_user_groups"},initialize:function(e){e.config&&(this.groups=e.groups),_.isUndefined(e.userid)?this.config.userid=BAppConfig.get("mydata","id"):this.userid=e.userid},render:function(){var e={id:$(this.el).attr("id")+"_user_groups"},n=$(t.renderTemplate(this.templateNames.main,e));n.hide(),$(this.el).find("#"+e.id).length==0?$(this.el).html(n.innerHTML):$(this.el).find("#"+e.id).replaceWith(n),n.fadeIn(400)}});return n}),define("profile/views/info",["require","beyazpano","profile/model/profileInfo","profile/main","profile/views/friendRequest","profile/views/avatar","profile/_templates","default/views/siteHeader","default/views/siteLeftMenu","courses/views/userCourses","groups/views/userGroups","home/views/showCourses"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=Backbone.View.extend({initialize:function(){this.profileInfoModel=new n,this.el="#content",this.$el=$(this.el),this.profileInfoModel.on("change",_.bind(function(){this.renderContent()},this))},templateNames:{main:"profile_info",rigthColumnLayout:"profile_info_right_column",avatarContainer:"profile_avatar_container"},userid:null,connections:null,nrOfStudents:null,setUserId:function(e){this.userid=e,this.profileInfoModel.set("id",this.userid,{silent:!0})},setConnections:function(e){this.connections=e},setNrOfStudents:function(e){this.nrOfStudents=e},render:function(){this.userid===null&&this.setUserId(BAppConfig.get("mydata","id")),u.render();var e=BAppConfig.get("site_profile","config").left_menu,n={items:[]},r=$("#hasAccessUpdate").val()=="0"?"0":"1";for(var i in e.items)(r!="1"&&e.items[i].id!="updates"||r=="1")&&n.items.push(e.items[i]);var s=new a({el:"#content_left",config:n,userid:this.userid,selected_item:"info",insertMethod:"prepend"});s.render();var o=t.renderTemplate(this.templateNames.avatarContainer,{});$("#content_left").prepend(o);var h=new f({el:"#courses_container",userid:this.userid});h.render();var p=new l({el:"#groups_container",userid:this.userid});p.render(),this.profileInfoModel.clear({silent:!0}),this.profileInfoModel.set("id",this.userid,{silent:!0}),this.profileInfoModel.fetch();var d=new c;d.initialize()},renderContent:function(){var e=this.profileInfoModel.toJSON();if(!e.canView)Utils.flashMessage(Utils.FLASH_WARNING,"cannot view user","cannot view user",this.el,0,!0);else if(!!e.userExists){var n={userinfo:e,editProfileLink:"javascript:void(0)"};n.connections=this.connections,n.hasStudents=!1,e.role=="INSTRUCTOR"&&(n.hasStudents=!0,n.nrOfStudents=this.nrOfStudents),this.userid==BAppConfig.get("mydata","id")?(n.canEdit=!0,n.editProfileLink=BAppConfig.get("site_profile","config").editProfileLink):n.canEdit=!1;var r=$(t.renderTemplate(this.templateNames.main,n));r.hide(),this.$el.html(r),r.fadeIn(400);if(BAppConfig.get("mydata","role")==n.userinfo.role&&this.userid!=BAppConfig.get("mydata","id"))var o=new i({userid:this.userid});var u=new s({el:"#avatar_container",userid:parseInt(this.userid),avatarUrl:this.profileInfoModel.get("avatarUrl"),userName:this.profileInfoModel.get("first_name")+" "+this.profileInfoModel.get("last_name")});u.render()}}});return new h}),define("profile/info",["require","beyazpano","profile/views/info","./_templates"],function(e,t,n,r){var i=function(){this.run=function(){n.setUserId($("#__profile-userid").val()),n.setConnections($("#__nr_connections").val()),n.setNrOfStudents($("#__nr_of_students").val()),n.render()}};return i}),define("profile/views/limited_profile_access",["require","beyazpano","profile/main","profile/views/friendRequest","profile/_templates","profile/model/profileInfo","profile/views/avatar","default/views/siteHeader","updates/views/postUpdate","updates/views/updatesList","updates/collection/updates","home/views/showCourses"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=Backbone.View.extend({templateNames:{main:"profile_updates",rigthColumnLayout:"profile_updates_right_column",avatarContainer:"profile_avatar_container"},userid:null,initialize:function(){this.profileInfoModel=new s,this.el="#content",this.$el=$(this.el),this.profileInfoModel.on("change",_.bind(function(){this.renderContent()},this))},setUserId:function(e){this.userid=e,this.profileInfoModel.set("id",this.userid,{silent:!0})},render:function(){this.userid===null&&this.setUserId(BAppConfig.get("mydata","id")),u.render();var e=t.renderTemplate(this.templateNames.avatarContainer,{});$("#content_left").prepend(e),this.profileInfoModel.clear({silent:!0}),this.profileInfoModel.set("id",this.userid,{silent:!0}),this.profileInfoModel.fetch();if(hasCoursesAccess===!0){var n=new c;n.initialize()}},renderContent:function(){var e={userinfo:this.profileInfoModel.toJSON(),editProfileLink:"javascript:void(0)"};e.canEdit=!1;var n=new o({el:"#avatar_container",userid:parseInt(this.userid),avatarUrl:this.profileInfoModel.get("avatarUrl"),userName:this.profileInfoModel.get("first_name")+" "+this.profileInfoModel.get("last_name")});n.render(),e.access=!0,this.userid!=BAppConfig.get("mydata","id")&&BAppConfig.get("mydata","role")=="STUDENT"&&(e.access=!1);var i=$(t.renderTemplate(this.templateNames.main,e));this.$el.html(i);if(BAppConfig.get("mydata","role")==e.userinfo.role&&this.userid!=BAppConfig.get("mydata","id"))var s=new r({userid:this.userid})}});return new h}),define("profile/limited_profile_access",["require","beyazpano","profile/views/limited_profile_access","./_templates"],function(e,t,n,r){var i=function(){this.run=function(){n.setUserId($("#__profile-userid").val()),n.render()}};return i}),define("profile/updates",["require","beyazpano","profile/views/updates","./_templates"],function(e,t,n,r){var i=function(){this.run=function(){n.setUserId($("#__profile-userid").val()),n.render()}};return i}),define("text!search/templates.html",[],function(){return'<script type="text/template" id="search_result_container">\n    <div>\n        <% if(items.length){ %>\n        <ul id="search_result" class="contentList">\n            <% _.each(items,function(item){ %>\n            <li class="clearfix">\n                <% print(item); %>\n            </li>\n            <% }) %>\n        </ul>\n        <% } %>\n    </div>\n</script>\n\n<script type="text/template" id="search_result_user_type">\n    <div  class="jqUser">\n        <div class="searchResultContent">\n            <img src="<%= avatar %>" width="46" height="50" /> \n            <a href="<%= profile_link %>"><%= name %></a>\n            <p><%= translate(role) %></p>\n            <% if(school.length > 0) {%>\n                <p><%= school %></p>\n            <% }%>\n\n        </div>\n\n        <% if(permissions.connect == \'connect\' || permissions.send_message || permissions.connect == \'cancel\' || permissions.blocked ){%>\n        <div class="settingsDetails">  \n            <div  class="btn-group" role="button">\n                <span class="ui-button-text">\n                    <button data-toggle="dropdown" class="dropdown-toggle courseSettingsDropdownToggle "></button>\n                    <ul class="dropdown-menu pull-right courseSettingsDropdownToggleBox">	\n                        <% print(_.template($(\'#search_user_operations\').html(), {id:id,connect:permissions.connect,requestId:requestId})) %>\n                        <% if(permissions.send_message){ %>\n\n                        <li>\n                            <a  id="send_message_user_<%= id %>" class="jqUserSendMessage" href="#" >\n                                <%= translate(\'search_send_message\') %>\n                            </a>\n                        </li>\n                        <% } %>\n                        <li>\n                            <a class="block-user" data-type="<%= (permissions.blocked ? \'block\' : \'unblock\' ) %>" title="<%= (permissions.blocked ? translate(\'global_block_title\') : translate(\'global_unblock_title\') ) %>" data-iduser="<%= id %>" href="#" >\n                                <%= (permissions.blocked ? translate(\'global_block\') : translate(\'global_unblock\')) %>\n                            </a>\n                        </li>\n                    </ul>\n                </span>\n            </div>\n        </div>\n        <% } %>\n    </div>\n</script>\n\n<script type="text/template" id="search_user_operations">\n\n    <% if(connect == \'connect\') { %>\n    <li>\n        <a id="connect_user_<%= id %>" class="jqUserConnect" href="#" >\n            <%= translate(\'search_connect\') %>\n        </a>\n    </li>		\n    <% } else if(connect == \'disconnect\'){ %>\n    <li>\n        <a id="disconnect_user_<%= id %>" class="jqUserDisConnect" href="#" >\n            <%= translate(\'search_disconnect\') %>\n        </a>\n    </li>\n    <% } else if(connect == \'accept\'){ %>\n    <li>\n        <a id="accept_user_<%= id %>" data-request="<%= requestId %>" class="jqAcceptConnect" href="#" >\n            <%= translate(\'search_accept\') %>\n        </a>\n    </li>\n    <% } else if(connect == \'cancel\'){ %>\n    <li>\n        <a id="cancel_user_<%= id %>" data-request="<%= requestId %>" class="jqCancelFriendRequest" href="#" >\n            <%= translate(\'search_cancel\') %>\n        </a>\n    </li>			\n    <% } %>\n\n</script>\n\n<script type="text/template" id="search_result_section_type">\n    <div class="searchResultContent">\n        <img src="../<%= avatar %>" width="46" height="50"/> \n        <a href="<%= section_link %>"><%= name %></a>\n        <p><%= type %></p>\n    </div>\n    <% if(permissions.join){ %>\n    <div class="settingsDetails">  \n        <div  class="btn-group" role="button">\n            <span class="ui-button-text">\n                <button data-toggle="dropdown" class="dropdown-toggle courseSettingsDropdownToggle "></button>\n                <ul class="dropdown-menu pull-right courseSettingsDropdownToggleBox">\n                    <li>\n                        <a  id="join_section_<%= id %>" class="jqJoinSection" href="#" >\n                            <%= translate(\'search_join\') %>\n                        </a>\n                    </li>\n                </ul>\n            </span>\n        </div>\n    </div>\n    <% } %>\n\n</script>'}),define("search/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("search_templates",n);return r}),define("profile/block",["require","beyazpano"],function(e,t){var n=function(){var e={refresh:!1},t;this.init=function(){$(".block-user").on("click",_.bind(this.blockUnblock,this))},this.run=function(t){e=_.extend(e,t),this.init()},this.blockUnblock=function(n){var r=$(n.currentTarget).attr("data-type"),i=$(n.currentTarget).attr("data-iduser"),s=$(n.currentTarget);Utils.confirm(r=="block"?translate("blocked_user"):translate("unblocked_user"),r=="block"?translate("block_user_text"):translate("unblock_user_text"),function(n){n=="yes"&&(t=BAppConfig.get("site_profile","config").siteBlockUser,$.ajax({type:"POST",url:t,data:{type:r,id:i},success:$.proxy(function(t){t.success&&(r=="block"?(s.attr("data-type","unblock"),s.attr("title",translate("global_unblock_title")),s.html(translate("global_unblock")),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("user_has_been_blocked"),"#flashmessages","2000")):e.refresh?document.location.reload(!0):(s.html(translate("global_block")),s.attr("data-type","block"),s.attr("title",translate("global_block_title")),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("user_has_been_unblocked"),"#flashmessages","2000")))},this),dataType:"json"}))})}};return n}),define("search/views/pageSearchResult",["require","beyazpano","search/_templates","profile/friend_request","section/views/joinSection","profile/block"],function(e,t,n,r,i,s){var o,u,a=Backbone.View.extend({templateNames:{main:"search_result_container",user:"search_result_user_type",section:"search_result_section_type",user_operations:"search_user_operations"},initialize:function(e){this.el="#results",this.$el=$(this.el),this.friendRequestObj=new r,this.joinSection=new i({onSuccess:this.onJoinSuccess})},render:function(){var e=$(t.renderTemplate(this.templateNames.main,{}));this.$el.html(e)},renderContent:function(e){var n={},r=[];_.each(e.result,function(n){switch(n.type){case"1":if(!_.isNull(e.users)){var i=e.users[n.entityId];i&&r.push(t.renderTemplate(this.templateNames.user,i))}break;case"2":if(!_.isNull(e.sections)){var s=e.sections[n.entityId];s&&r.push(t.renderTemplate(this.templateNames.section,s))}}},this);var i=$(t.renderTemplate(this.templateNames.main,{items:r}));i.delegate(".jqUserConnect","click",_.bind(function(e){this.friendRequestOperation("connect",e,$(e.currentTarget),$(e.currentTarget).attr("id").replace("connect_user_",""),"")},this)),i.delegate(".jqUserDisConnect","click",_.bind(function(e){this.friendRequestOperation("disconnect",e,$(e.currentTarget),$(e.currentTarget).attr("id").replace("disconnect_user_",""),"")},this)),i.delegate(".jqCancelFriendRequest","click",_.bind(function(e){this.friendRequestOperation("cancel",e,$(e.currentTarget),$(e.currentTarget).attr("id").replace("cancel_user_",""),$(e.currentTarget).attr("data-request"))},this)),i.delegate(".jqAcceptConnect","click",_.bind(function(e){this.friendRequestOperation("accept",e,$(e.currentTarget),$(e.currentTarget).attr("id").replace("accept_user_",""),$(e.currentTarget).attr("data-request"))},this)),i.find(".jqUserSendMessage").on("click",_.bind(function(e){this.sendMessage($(e.currentTarget),$(e.currentTarget).attr("id").replace("send_message_user_",""))},this)),i.delegate(".jqJoinSection","click",_.bind(function(e){this.joinSection.showPopup($(e.currentTarget).attr("id").replace("join_section_",""))},this)),$("#requests-dropdown").off("externalAcceptedErrorFromDropdown").on("externalAcceptedErrorFromDropdown",_.bind(function(){Utils.alert(translate("search_friend_accept_error_title"),translate("search_friend_accept_error_body"))},this)),$("#requests-dropdown").off("externalAcceptedFromDropdown").on("externalAcceptedFromDropdown",_.bind(function(){var e=$(_.template($("#"+this.templateNames.user_operations).html(),{id:o,connect:"disconnect"}));u.replaceWith(e),u=e,Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("user_connection_request_accepted"),"#flashmessages",2e3)},this)),r.length?$("#noResults").hide():$("#noResults").show(),this.$el.html(i);var a=new s;a.run()},friendRequestOperation:function(e,t,n,r,i){u=n,n.attr("disabled","disabled"),n.attr("disabled","disabled"),o=r;switch(e){case"connect":this.friendRequestObj.sendFriendRequest(r,_.bind(function(e){if(e.success){var t=$(_.template($("#"+this.templateNames.user_operations).html(),{id:r,connect:"cancel",requestId:e.data}));n.replaceWith(t),n=t,Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("user_connection_request_sent"),"#flashmessages",2e3)}else Utils.alert(translate("search_friend_request_error_title"),translate("search_friend_request_error_body"))},this));break;case"disconnect":Utils.confirm(translate("user_connection_remove_confirm_title"),translate("user_connection_remove_confirm_body"),_.bind(function(e){e=="yes"&&this.friendRequestObj.removeConnection(r,_.bind(function(e){if(e.success){var t=$(_.template($("#"+this.templateNames.user_operations).html(),{id:r,connect:"connect"}));n.replaceWith(t),n=t,Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("user_connection_removed"),"#flashmessages",2e3)}else Utils.alert(translate("search_friend_disconnect_error_title"),translate("search_friend_disconnect_error_body"))},this))},this));break;case"cancel":this.friendRequestObj.cancelFriendRequest(i,_.bind(function(e){if(e.success){var t=$(_.template($("#"+this.templateNames.user_operations).html(),{id:r,connect:"connect"}));n.replaceWith(t),n=t,Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("user_connection_request_canceled"),"#flashmessages",2e3)}else Utils.alert(translate("search_friend_cancel_error_title"),translate("search_friend_cancel_error_body"))},this));break;case"accept":$("#requests-dropdown").trigger("externalAcceptRequest",t)}},sendMessage:function(e,t){var n=BAppConfig.get("site_messages","compose_for_user").replace("__id__",t);window.location.href=n},onJoinSuccess:function(e){$("#join_section_"+e.sectionId).remove()}});return a}),define("search/main",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","paginator","search/views/pageSearchResult"],function(e,t,n,r,i,s){var o=function(){this.config={getUrl:BAppConfig.get("site_search","ajaxSearchUrl")},this.run=function(){this.searchType="all",this.searchObject=$("#searchText"),this.paginator=null,this.resultList=new s,this.initMenus(),this.initPaginator(),this.initEventHandlers()},this.initMenus=function(){var e=BAppConfig.get("site_search","config").left_menu,t=new r({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"all",triggerEvents:!0});t.on("menuItemSelected",_.bind(this.onMenuItemSelected,this)),t.render(),n.render()},this.initPaginator=function(){var e="search_results";this.PAGES_COOKIE_NAME="sm_"+e+"_pages",this.PAGE_COOKIE_NAME="sm_"+e+"_page",this.paginator=new AppPaginator("#paginator",{page:1,pages:1,onPageSelected:_.bind(this.onPageChanged,this),render:!1});var t=parseInt($.cookie(this.PAGES_COOKIE_NAME))>0?parseInt($.cookie(this.PAGES_COOKIE_NAME)):1,n=this.getCurrentPageNumber();this.paginator.setTotalPages(t),this.paginator.goToPage(n)},this.fetchResult=function(){this.onPageChanged(1)},this.onPageChanged=function(e){this.loadListContent(e,10,_.bind(function(e){this.paginator.setTotalPages(e.data.totalPages),this.paginator.setCurrentPage(e.data.page),this.resultList.renderContent(e.data.lists),$.cookie(this.PAGE_COOKIE_NAME,e.data.page),$.cookie(this.PAGES_COOKIE_NAME,e.data.totalPages),this.paginator.render(),Utils.setZIndex()},this))},this.loadListContent=function(e,t,n){$("#"+this.paginator.getPaginatorId()).addClass("disabled"),$.ajax(this.config.getUrl,{type:"POST",data:{page:e,rows:t,type:this.searchType,searchText:this.searchObject.val()},dataType:"json"}).success($.proxy(function(e){$("#"+this.paginator.getPaginatorId()).removeClass("disabled"),e.success?_.isFunction(n)&&n.apply(this,[e]):Utils.alert(translate("site_search_load_failed_title"),translate("site_search_load_failed_body"))},this))},this.getCurrentPageNumber=function(){return parseInt($.cookie(this.PAGE_COOKIE_NAME))>0?parseInt($.cookie(this.PAGE_COOKIE_NAME)):1},this.onMenuItemSelected=function(e){var t=BAppConfig.get("site_search","config").left_menu.id,n=this.getCurrentPageNumber();this.searchType=e.id.replace(t+"_",""),this.onPageChanged(n)},this.initEventHandlers=function(){this.searchObject.on("keyup",_.bind(function(e){e.which==13&&this.fetchResult()},this)),$("#searchButton").on("click",_.bind(function(e){e.preventDefault(),this.fetchResult()},this))}};return o}),define("section/views/updates",["require","beyazpano","section/_templates","updates/views/postUpdate","updates/views/updatesList","updates/collection/updates"],function(e,t,n,r,i,s){var o=Backbone.View.extend({templateNames:{main:"section_updates"},initialize:function(e){this.el="#sectionPostContainer",this.$el=$(this.el),this.setSectionId(e.sectionId),this.postUpdateView=null,this.updatesCollection=new s,this.updatesCollection.url=BAppConfig.get("site_sections","config").updatesAjaxBaseUrl.replace("__sectionid__",this.sectionId),this.renderContent(),this.updatesCollection.fetch(this.updatesCollection.details)},render:function(){},sectionId:null,setSectionId:function(e){this.sectionId=e},renderContent:function(){var e={},n=$(t.renderTemplate(this.templateNames.main,e));this.$el.html(n);var s=parseInt($("#courseowner").val()),o=parseInt($("#isAdminOfSection").val()),u=parseInt($("#coursereadonly").val());u!=1&&(this.postUpdateView=new r({el:"#post_updates_container",config:{walls:["3_"+this.sectionId],savePostUrl:BAppConfig.get("site_post","savePostUrl"),canBeAnnouncement:s==parseInt(BAppConfig.get("mydata","id"))||o==1}}),this.postUpdateView.on("postSaved",_.bind(function(e){e&&e.approved&&e.approved==0?Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("post_needs_approval"),"#flashmessages",4e3):Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("post_saved"),"#flashmessages",3e3),this.updatesCollection.fetch()},this)),this.postUpdateView.render()),this.updatesList=new i({el:"#updates_list_container",collection:this.updatesCollection,wallType:3,wallOwner:this.sectionId,updateType:"section_post"}),this.updatesList.on("viewMoreUpdates",_.bind(function(){this.updatesCollection.loadMoreUpdates(!1)},this)),this.updatesList.on("increment_decreaseOffsset",_.bind(function(){this.updatesCollection.incrementDecreaseOffsset()},this))}});return o}),define("upcoming/main",["require","beyazpano","calendar/smallCalendar"],function(e,t,n){this.initParams;var r=function(){this.run=function(e){this.initConstructParams(e),$("body").on("eventAccepted",_.bind(function(e){var t=BAppConfig.get("mydata","id"),n=0;$("#idsection").val()!="undefined"&&$("#idsection").val()!=null&&(t=$("#idsection").val(),n=1),this.getUpcomingList(t,n)},this));if(!_.isUndefined(this.initParams.renderMiniCalendar)&&this.initParams.renderMiniCalendar==1){var t=new Array;!_.isUndefined(this.initParams.miniCalendarEvent)&&!_.isEmpty(this.initParams.miniCalendarEvent)&&(t=this.initParams.miniCalendarEvent);var r=new n(t);r.run()}},this.initConstructParams=function(e){this.initParams={},!_.isUndefined(e)&&!_.isEmpty(e)&&$.each(e,_.bind(function(e,t){this.initParams[e]=t},this))},this.getUpcomingList=function(e,t){$.ajax({type:"POST",url:BAppConfig.get("site_assignment","ajaxUrlAssignmentsJson")+"/upcominglist",data:{id:e,render:t},success:$.proxy(function(e){$("#upcoming_list").html(e.data.body)},this),dataType:"json"})}};return r}),define("section/main",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","section/views/updates","jquery.ui","upcoming/main"],function(e,t,n,r,i){var s=function(){this.run=function(){this.initMenus(),this.updates=new i({sectionId:$("#idsection").val()}),this.updates.render()},this.initMenus=function(){var e=BAppConfig.get("site_sections","config").left_menu;_.each(e.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",$("#idsection").val()),e.url=e.url.replace("__COURSE_ID__",$("#idcourse").val())},this));var t=new r({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"updates"});t.render(),n.render()}};return s}),define("section/members",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","courses/course","section-members/views/sectionMembersView","config"],function(e,t,n,r,i,s){var o={ALL:0,MEMBERS:1,ADMINS:2},u=function(){this.run=function(){this.course=new i,this.course.init(),this.course.initHandlers();var e=BAppConfig.get("site_sections","config").left_menu;_.each(e.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",$("#idEntity").val())},this));var t=new r({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"members"});t.render(),n.render();var o=$("#idEntity").val();if($(".next-page-members").attr("id"))var u=$(".next-page-members").attr("id").replace("next-page-","");else var u=0;var a={idEntity:o,offset:u,tab:"all_tab",ajaxUrl:BAppConfig.get("allsectionmembers","ajaxUrlAllSectionMembersJson"),limit:10},f=new s(a);f.render(),f.on("removeMemberFromGroup",_.bind(function(e){this.course.removeMember(e,f)},this)),f.on("removeAdmin",_.bind(function(e){this.course.removeAdmin(e,f)},this)),f.on("makeAdmin",_.bind(function(e){this.course.makeAdmin(e,f)},this))}};return u}),define("user-settings/privacy",["require","beyazpano","ezmark","utils","default/views/siteHeader","default/views/siteLeftMenu","order!bootstrap.tooltip"],function(e,t,n,r,i,s){var o=function(){var e;this.run=function(){e=BAppConfig.get("site_settings","config"),$(":radio","#privacy_settings").ezMark(),this.initHandlers(),i.render();var t=new s({el:"#content_left",config:e.left_menu,userid:BAppConfig.get("mydata","id"),selected_item:"privacy"});t.render()};var t=$("#privacy_settings tr:first td").length-1;if(t!=5){var n=80/t+"%";$("#privacy_settings tr td:nth-child(n+2)").width(n)}this.initHandlers=function(){$(".header","#possible_values_header").click(function(){var e=$(this).attr("data");$(':radio[data="'+e+'"]:not(.disabled):no):not(.locked)',"#privacy_settings").each(function(e,t){$(this).click()})}),$(".header").tooltip(),$("#edit-privacy").live("submit",_.bind(this.save,this));var e=0,t=$(":radio[section]","#edit-privacy").parent("div.ez-selected").children().val();$(":radio[section]","#edit-privacy").click(function(){var n=$(this),r=$(this).attr("section").replace(/_.*/,""),i=$(this).attr("section").replace(/.*_/,"");$(":radio[main_section]","#edit-privacy").each(function(s,o){var u=[],a=[];e=0;var f=$(this).attr("main_section").replace(/_.*/,""),l=$(this).attr("main_section").replace(/.*_/,"");if(f==r){u=$(":radio[main_section]","#edit-privacy").filter(function(){return $(this).val()<n.val()&&$(this).is(":checked")}),$(u).each(function(e,t){var r=$(t).parents("tr"),i=r.find("input[value="+n.val()+"]");a.push(i)}),l<i?($(this).attr("disabled","disabled"),$(this).parent().addClass("disabled")):$(this).hasClass("locked")||($(this).removeAttr("disabled"),$(this).parent().removeClass("disabled"));if(l==i)for(var o in a)l==i&&a[o][0]==$(this)[0]&&(e=parseInt(e)+1);t=n.val(),e>0&&$(this).click()}})})},this.save=function(t){t.preventDefault();var n=$(t.target).serialize();$.ajax({type:"POST",data:n,url:e.saveUserSettingsUrl,success:function(e){e.success?Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("update_privacy_settings_success"),"#flash-message",2e3):Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",2e3)},dataType:"json"})}};return o}),function(b){b.jgrid=b.jgrid||{},b.extend(b.jgrid,{version:"4.5.3",htmlDecode:function(e){return e&&("&nbsp;"===e||"&#160;"===e||1===e.length&&160===e.charCodeAt(0))?"":e?(""+e).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&"):e},htmlEncode:function(e){return e?(""+e).replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},format:function(e){var t=b.makeArray(arguments).slice(1);return null==e&&(e=""),e.replace(/\{(\d+)\}/g,function(e,n){return t[n]})},msie:"Microsoft Internet Explorer"===navigator.appName,msiever:function(){var e=-1;return null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(e=parseFloat(RegExp.$1)),e},getCellIndex:function(e){return e=b(e),e.is("tr")?-1:(e=(!e.is("td")&&!e.is("th")?e.closest("td,th"):e)[0],b.jgrid.msie?b.inArray(e,e.parentNode.cells):e.cellIndex)},stripHtml:function(e){var e=""+e,t=/<("[^"]*"|'[^']*'|[^'">])*>/gi;return e?(e=e.replace(t,""))&&"&nbsp;"!==e&&"&#160;"!==e?e.replace(/\"/g,"'"):"":e},stripPref:function(e,t){var n=b.type(e);if("string"===n||"number"===n)e=""+e,t=""!==e?(""+t).replace(""+e,""):t;return t},parse:function(d){return"while(1);"===d.substr(0,9)&&(d=d.substr(9)),"/*"===d.substr(0,2)&&(d=d.substr(2,d.length-4)),d||(d="{}"),!0===b.jgrid.useJSON&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(d):eval("("+d+")")},parseDate:function(e,t,n,r){var i=/^\/Date\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\)\/$/,s="string"==typeof t?t.match(i):null,i=function(e,t){e=""+e;for(t=parseInt(t,10)||2;e.length<t;)e="0"+e;return e},o={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},u=0,a,f,u=function(e,t){return 0===e?12===t&&(t=0):12!==t&&(t+=12),t};void 0===r&&(r=b.jgrid.formatter.date),void 0===r.parseRe&&(r.parseRe=/[Tt\\\/:_;.,\t\s-]/),r.masks.hasOwnProperty(e)&&(e=r.masks[e]);if(t&&null!=t)if(!isNaN(t-0)&&"u"===(""+e).toLowerCase())u=new Date(1e3*parseFloat(t));else if(t.constructor===Date)u=t;else if(null!==s)u=new Date(parseInt(s[1],10)),s[3]&&(e=60*Number(s[5])+Number(s[6]),e*="-"===s[4]?1:-1,e-=u.getTimezoneOffset(),u.setTime(Number(Number(u)+6e4*e)));else{t=(""+t).replace(/\\T/g,"T").replace(/\\t/,"t").split(r.parseRe),e=e.replace(/\\T/g,"T").replace(/\\t/,"t").split(r.parseRe),a=0;for(f=e.length;a<f;a++)"M"===e[a]&&(s=b.inArray(t[a],r.monthNames),-1!==s&&12>s&&(t[a]=s+1,o.m=t[a])),"F"===e[a]&&(s=b.inArray(t[a],r.monthNames,12),-1!==s&&11<s&&(t[a]=s+1-12,o.m=t[a])),"a"===e[a]&&(s=b.inArray(t[a],r.AmPm),-1!==s&&2>s&&t[a]===r.AmPm[s]&&(t[a]=s,o.h=u(t[a],o.h))),"A"===e[a]&&(s=b.inArray(t[a],r.AmPm),-1!==s&&1<s&&t[a]===r.AmPm[s]&&(t[a]=s-2,o.h=u(t[a],o.h))),"g"===e[a]&&(o.h=parseInt(t[a],10)),void 0!==t[a]&&(o[e[a].toLowerCase()]=parseInt(t[a],10));o.f&&(o.m=o.f);if(0===o.m&&0===o.y&&0===o.d)return"&#160;";o.m=parseInt(o.m,10)-1,u=o.y,70<=u&&99>=u?o.y=1900+o.y:0<=u&&69>=u&&(o.y=2e3+o.y),u=new Date(o.y,o.m,o.d,o.h,o.i,o.s,o.u)}else u=new Date(o.y,o.m,o.d,o.h,o.i,o.s,o.u);if(void 0===n)return u;r.masks.hasOwnProperty(n)?n=r.masks[n]:n||(n="Y-m-d"),e=u.getHours(),t=u.getMinutes(),o=u.getDate(),s=u.getMonth()+1,a=u.getTimezoneOffset(),f=u.getSeconds();var l=u.getMilliseconds(),c=u.getDay(),h=u.getFullYear(),p=(c+6)%7+1,d=(new Date(h,s-1,o)-new Date(h,0,1))/864e5,v={d:i(o),D:r.dayNames[c],j:o,l:r.dayNames[c+7],N:p,S:r.S(o),w:c,z:d,W:5>p?Math.floor((d+p-1)/7)+1:Math.floor((d+p-1)/7)||(4>((new Date(h-1,0,1)).getDay()+6)%7?53:52),F:r.monthNames[s-1+12],m:i(s),M:r.monthNames[s-1],n:s,t:"?",L:"?",o:"?",Y:h,y:(""+h).substring(2),a:12>e?r.AmPm[0]:r.AmPm[1],A:12>e?r.AmPm[2]:r.AmPm[3],B:"?",g:e%12||12,G:e,h:i(e%12||12),H:i(e),i:i(t),s:i(f),u:l,e:"?",I:"?",O:(0<a?"-":"+")+i(100*Math.floor(Math.abs(a)/60)+Math.abs(a)%60,4),P:"?",T:((""+u).match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),Z:"?",c:"?",r:"?",U:Math.floor(u/1e3)};return n.replace(/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,function(e){return v.hasOwnProperty(e)?v[e]:e.substring(1)})},jqID:function(e){return(""+e).replace(/[!"#$%&'()*+,.\/:; <=>?@\[\\\]\^`{|}~]/g,"\\$&")},guid:1,uidPref:"jqg",randId:function(e){return(e||b.jgrid.uidPref)+b.jgrid.guid++},getAccessor:function(e,t){var n,r,i=[],s;if("function"==typeof t)return t(e);n=e[t];if(void 0===n)try{if("string"==typeof t&&(i=t.split(".")),s=i.length)for(n=e;n&&s--;)r=i.shift(),n=n[r]}catch(o){}return n},getXmlData:function(e,t,n){var r="string"==typeof t?t.match(/^(.*)\[(\w+)\]$/):null;return"function"==typeof t?t(e):r&&r[2]?r[1]?b(r[1],e).attr(r[2]):b(e).attr(r[2]):(e=b(t,e),n?e:0<e.length?b(e).text():void 0)},cellWidth:function(){var e=b("<div class='ui-jqgrid' style='left:10000px'><table class='ui-jqgrid-btable' style='width:5px;'><tr class='jqgrow'><td style='width:5px;display:block;'></td></tr></table></div>"),t=e.appendTo("body").find("td").width();return e.remove(),.1<Math.abs(t-5)},cell_width:!0,ajaxOptions:{},from:function(d){return new function(d,c){"string"==typeof d&&(d=b.data(d));var e=this,a=d,i=!0,f=!1,h=c,j=/[\$,%]/g,k=null,m=null,n=0,l=!1,r="",u=[],E=!0;if("object"!=typeof d||!d.push)throw"data provides is not an array";return 0<d.length&&(E="object"!=typeof d[0]?!1:!0),this._hasData=function(){return null===a?!1:0===a.length?!1:!0},this._getStr=function(e){var t=[];return f&&t.push("jQuery.trim("),t.push("String("+e+")"),f&&t.push(")"),i||t.push(".toLowerCase()"),t.join("")},this._strComp=function(e){return"string"==typeof e?".toString()":""},this._group=function(e,t){return{field:e.toString(),unique:t,items:[]}},this._toStr=function(e){return f&&(e=b.trim(e)),e=e.toString().replace(/\\/g,"\\\\").replace(/\"/g,'\\"'),i?e:e.toLowerCase()},this._funcLoop=function(e){var t=[];return b.each(a,function(n,r){t.push(e(r))}),t},this._append=function(e){var t;h=null===h?"":h+(""===r?" && ":r);for(t=0;t<n;t++)h+="(";l&&(h+="!"),h+="("+e+")",l=!1,r="",n=0},this._setCommand=function(e,t){k=e,m=t},this._resetNegate=function(){l=!1},this._repeatCommand=function(t,n){return null===k?e:null!==t&&null!==n?k(t,n):null===m||!E?k(t):k(m,t)},this._equals=function(t,n){return 0===e._compare(t,n,1)},this._compare=function(e,t,n){var r=Object.prototype.toString;return void 0===n&&(n=1),void 0===e&&(e=null),void 0===t&&(t=null),null===e&&null===t?0:null===e&&null!==t?1:null!==e&&null===t?-1:"[object Date]"===r.call(e)&&"[object Date]"===r.call(t)?e<t?-n:e>t?n:0:(!i&&"number"!=typeof e&&"number"!=typeof t&&(e=""+e,t=""+t),e<t?-n:e>t?n:0)},this._performSort=function(){0!==u.length&&(a=e._doSort(a,0))},this._doSort=function(t,n){var r=u[n].by,i=u[n].dir,s=u[n].type,o=u[n].datefmt;if(n===u.length-1)return e._getOrder(t,r,i,s,o);n++;for(var r=e._getGroup(t,r,i,s,o),i=[],a,s=0;s<r.length;s++){a=e._doSort(r[s].items,n);for(o=0;o<a.length;o++)i.push(a[o])}return i},this._getOrder=function(t,n,r,s,o){var u=[],a=[],f="a"===r?1:-1,l,c;void 0===s&&(s="text"),c="float"===s||"number"===s||"currency"===s||"numeric"===s?function(e){return e=parseFloat((""+e).replace(j,"")),isNaN(e)?0:e}:"int"===s||"integer"===s?function(e){return e?parseFloat((""+e).replace(j,"")):0}:"date"===s||"datetime"===s?function(e){return b.jgrid.parseDate(o,e).getTime()}:b.isFunction(s)?s:function(e){return e=e?b.trim(""+e):"",i?e:e.toLowerCase()},b.each(t,function(e,t){l=""!==n?b.jgrid.getAccessor(t,n):t,void 0===l&&(l=""),l=c(l,t),a.push({vSort:l,index:e})}),a.sort(function(t,n){return t=t.vSort,n=n.vSort,e._compare(t,n,f)});for(var s=0,h=t.length;s<h;)r=a[s].index,u.push(t[r]),s++;return u},this._getGroup=function(t,n,r,i,s){var o=[],u=null,a=null,f;return b.each(e._getOrder(t,n,r,i,s),function(t,r){f=b.jgrid.getAccessor(r,n),null==f&&(f=""),e._equals(a,f)||(a=f,null!==u&&o.push(u),u=e._group(n,f)),u.items.push(r)}),null!==u&&o.push(u),o},this.ignoreCase=function(){return i=!1,e},this.useCase=function(){return i=!0,e},this.trim=function(){return f=!0,e},this.noTrim=function(){return f=!1,e},this.execute=function(){var d=h,c=[];return null===d?e:(b.each(a,function(){eval(d)&&c.push(this)}),a=c,e)},this.data=function(){return a},this.select=function(t){e._performSort();if(!e._hasData())return[];e.execute();if(b.isFunction(t)){var n=[];return b.each(a,function(e,r){n.push(t(r))}),n}return a},this.hasMatch=function(){return e._hasData()?(e.execute(),0<a.length):!1},this.andNot=function(t,n,r){return l=!l,e.and(t,n,r)},this.orNot=function(t,n,r){return l=!l,e.or(t,n,r)},this.not=function(t,n,r){return e.andNot(t,n,r)},this.and=function(t,n,i){return r=" && ",void 0===t?e:e._repeatCommand(t,n,i)},this.or=function(t,n,i){return r=" || ",void 0===t?e:e._repeatCommand(t,n,i)},this.orBegin=function(){return n++,e},this.orEnd=function(){return null!==h&&(h+=")"),e},this.isNot=function(t){return l=!l,e.is(t)},this.is=function(t){return e._append("this."+t),e._resetNegate(),e},this._compareValues=function(t,n,r,i,s){var o;o=E?"jQuery.jgrid.getAccessor(this,'"+n+"')":"this",void 0===r&&(r=null);var u=r,a=void 0===s.stype?"text":s.stype;if(null!==r)switch(a){case"int":case"integer":u=isNaN(Number(u))||""===u?"0":u,o="parseInt("+o+",10)",u="parseInt("+u+",10)";break;case"float":case"number":case"numeric":u=(""+u).replace(j,""),u=isNaN(Number(u))||""===u?"0":u,o="parseFloat("+o+")",u="parseFloat("+u+")";break;case"date":case"datetime":u=""+b.jgrid.parseDate(s.newfmt||"Y-m-d",u).getTime(),o='jQuery.jgrid.parseDate("'+s.srcfmt+'",'+o+").getTime()";break;default:o=e._getStr(o),u=e._getStr('"'+e._toStr(u)+'"')}return e._append(o+" "+i+" "+u),e._setCommand(t,n),e._resetNegate(),e},this.equals=function(t,n,r){return e._compareValues(e.equals,t,n,"==",r)},this.notEquals=function(t,n,r){return e._compareValues(e.equals,t,n,"!==",r)},this.isNull=function(t,n,r){return e._compareValues(e.equals,t,null,"===",r)},this.greater=function(t,n,r){return e._compareValues(e.greater,t,n,">",r)},this.less=function(t,n,r){return e._compareValues(e.less,t,n,"<",r)},this.greaterOrEquals=function(t,n,r){return e._compareValues(e.greaterOrEquals,t,n,">=",r)},this.lessOrEquals=function(t,n,r){return e._compareValues(e.lessOrEquals,t,n,"<=",r)},this.startsWith=function(t,n){var r=null==n?t:n,r=f?b.trim(r.toString()).length:r.toString().length;return E?e._append(e._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+".substr(0,"+r+") == "+e._getStr('"'+e._toStr(n)+'"')):(r=f?b.trim(n.toString()).length:n.toString().length,e._append(e._getStr("this")+".substr(0,"+r+") == "+e._getStr('"'+e._toStr(t)+'"'))),e._setCommand(e.startsWith,t),e._resetNegate(),e},this.endsWith=function(t,n){var r=null==n?t:n,r=f?b.trim(r.toString()).length:r.toString().length;return E?e._append(e._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+".substr("+e._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+".length-"+r+","+r+') == "'+e._toStr(n)+'"'):e._append(e._getStr("this")+".substr("+e._getStr("this")+'.length-"'+e._toStr(t)+'".length,"'+e._toStr(t)+'".length) == "'+e._toStr(t)+'"'),e._setCommand(e.endsWith,t),e._resetNegate(),e},this.contains=function(t,n){return E?e._append(e._getStr("jQuery.jgrid.getAccessor(this,'"+t+"')")+'.indexOf("'+e._toStr(n)+'",0) > -1'):e._append(e._getStr("this")+'.indexOf("'+e._toStr(t)+'",0) > -1'),e._setCommand(e.contains,t),e._resetNegate(),e},this.groupBy=function(t,n,r,i){return e._hasData()?e._getGroup(a,t,n,r,i):null},this.orderBy=function(t,n,r,i){n=null==n?"a":b.trim(n.toString().toLowerCase()),null==r&&(r="text"),null==i&&(i="Y-m-d");if("desc"===n||"descending"===n)n="d";if("asc"===n||"ascending"===n)n="a";return u.push({by:t,dir:n,type:r,datefmt:i}),e},e}(d,null)},getMethod:function(e){return this.getAccessor(b.fn.jqGrid,e)},extend:function(e){b.extend(b.fn.jqGrid,e),this.no_legacy_api||b.fn.extend(e)}}),b.fn.jqGrid=function(e){if("string"==typeof e){var t=b.jgrid.getMethod(e);if(!t)throw"jqGrid - No such method: "+e;var n=b.makeArray(arguments).slice(1);return t.apply(this,n)}return this.each(function(){if(!this.grid){var t=b.extend(!0,{url:"",height:150,page:1,rowNum:20,rowTotal:null,records:0,pager:"",pgbuttons:!0,pginput:!0,colModel:[],rowList:[],colNames:[],sortorder:"asc",sortname:"",datatype:"xml",mtype:"GET",altRows:!1,selarrrow:[],savedRow:[],shrinkToFit:!0,xmlReader:{},jsonReader:{},subGrid:!1,subGridModel:[],reccount:0,lastpage:0,lastsort:0,selrow:null,beforeSelectRow:null,onSelectRow:null,onSortCol:null,ondblClickRow:null,onRightClickRow:null,onPaging:null,onSelectAll:null,onInitGrid:null,loadComplete:null,gridComplete:null,loadError:null,loadBeforeSend:null,afterInsertRow:null,beforeRequest:null,beforeProcessing:null,onHeaderClick:null,viewrecords:!1,loadonce:!1,multiselect:!1,multikey:!1,editurl:null,search:!1,caption:"",hidegrid:!0,hiddengrid:!1,postData:{},userData:{},treeGrid:!1,treeGridModel:"nested",treeReader:{},treeANode:-1,ExpandColumn:null,tree_root_level:0,prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},forceFit:!1,gridstate:"visible",cellEdit:!1,cellsubmit:"remote",nv:0,loadui:"enable",toolbar:[!1,""],scroll:!1,multiboxonly:!1,deselectAfterSort:!0,scrollrows:!1,autowidth:!1,scrollOffset:18,cellLayout:5,subGridWidth:20,multiselectWidth:20,gridview:!1,rownumWidth:25,rownumbers:!1,pagerpos:"center",recordpos:"right",footerrow:!1,userDataOnFooter:!1,hoverrows:!0,altclass:"ui-priority-secondary",viewsortcols:[!1,"vertical",!0],resizeclass:"",autoencode:!1,remapColumns:[],ajaxGridOptions:{},direction:"ltr",toppager:!1,headertitles:!1,scrollTimeout:40,data:[],_index:{},grouping:!1,groupingView:{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:!1,sortitems:[],sortnames:[],summary:[],summaryval:[],plusicon:"ui-icon-circlesmall-plus",minusicon:"ui-icon-circlesmall-minus",displayField:[]},ignoreCase:!1,cmTemplate:{},idPrefix:"",multiSort:!1},b.jgrid.defaults,e||{}),n=this,r={headers:[],cols:[],footers:[],dragStart:function(e,r,i){this.resizing={idx:e,startX:r.clientX,sOL:r.clientX-6},this.hDiv.style.cursor="col-resize",this.curGbox=b("#rs_m"+b.jgrid.jqID(t.id),"#gbox_"+b.jgrid.jqID(t.id)),this.curGbox.css({display:"block",left:r.clientX-6,top:i[1],height:i[2]}),b(n).triggerHandler("jqGridResizeStart",[r,e]),b.isFunction(t.resizeStart)&&t.resizeStart.call(n,r,e),document.onselectstart=function(){return!1}},dragMove:function(e){if(this.resizing){var n=e.clientX-this.resizing.startX,e=this.headers[this.resizing.idx],r="ltr"===t.direction?e.width+n:e.width-n,i;33<r&&(this.curGbox.css({left:this.resizing.sOL+n}),!0===t.forceFit?(i=this.headers[this.resizing.idx+t.nv],n="ltr"===t.direction?i.width-n:i.width+n,33<n&&(e.newWidth=r,i.newWidth=n)):(this.newWidth="ltr"===t.direction?t.tblwidth+n:t.tblwidth-n,e.newWidth=r))}},dragEnd:function(){this.hDiv.style.cursor="default";if(this.resizing){var e=this.resizing.idx,r=this.headers[e].newWidth||this.headers[e].width,r=parseInt(r,10);this.resizing=!1,b("#rs_m"+b.jgrid.jqID(t.id)).css("display","none"),t.colModel[e].width=r,this.headers[e].width=r,this.headers[e].el.style.width=r+"px",this.cols[e].style.width=r+"px",0<this.footers.length&&(this.footers[e].style.width=r+"px"),!0===t.forceFit?(r=this.headers[e+t.nv].newWidth||this.headers[e+t.nv].width,this.headers[e+t.nv].width=r,this.headers[e+t.nv].el.style.width=r+"px",this.cols[e+t.nv].style.width=r+"px",0<this.footers.length&&(this.footers[e+t.nv].style.width=r+"px"),t.colModel[e+t.nv].width=r):(t.tblwidth=this.newWidth||t.tblwidth,b("table:first",this.bDiv).css("width",t.tblwidth+"px"),b("table:first",this.hDiv).css("width",t.tblwidth+"px"),this.hDiv.scrollLeft=this.bDiv.scrollLeft,t.footerrow&&(b("table:first",this.sDiv).css("width",t.tblwidth+"px"),this.sDiv.scrollLeft=this.bDiv.scrollLeft)),b(n).triggerHandler("jqGridResizeStop",[r,e]),b.isFunction(t.resizeStop)&&t.resizeStop.call(n,r,e)}this.curGbox=null,document.onselectstart=function(){return!0}},populateVisible:function(){r.timer&&clearTimeout(r.timer),r.timer=null;var e=b(r.bDiv).height();if(e){var n=b("table:first",r.bDiv),i,s;if(n[0].rows.length)try{s=(i=n[0].rows[1])?b(i).outerHeight()||r.prevRowHeight:r.prevRowHeight}catch(o){s=r.prevRowHeight}if(s){r.prevRowHeight=s;var u=t.rowNum;i=r.scrollTop=r.bDiv.scrollTop;var a=Math.round(n.position().top)-i,f=a+n.height();s*=u;var l,c,h;f<e&&0>=a&&(void 0===t.lastpage||parseInt((f+i+s-1)/s,10)<=t.lastpage)&&(c=parseInt((e-f+s-1)/s,10),0<=f||2>c||!0===t.scroll?(l=Math.round((f+i)/s)+1,a=-1):a=1),0<a&&(l=parseInt(i/s,10)+1,c=parseInt((i+e)/s,10)+2-l,h=!0),c&&(!t.lastpage||!(l>t.lastpage||1===t.lastpage||l===t.page&&l===t.lastpage))&&(r.hDiv.loading?r.timer=setTimeout(r.populateVisible,t.scrollTimeout):(t.page=l,h&&(r.selectionPreserver(n[0]),r.emptyRows.call(n[0],!1,!1)),r.populate(c)))}}},scrollGrid:function(e){if(t.scroll){var n=r.bDiv.scrollTop;void 0===r.scrollTop&&(r.scrollTop=0),n!==r.scrollTop&&(r.scrollTop=n,r.timer&&clearTimeout(r.timer),r.timer=setTimeout(r.populateVisible,t.scrollTimeout))}r.hDiv.scrollLeft=r.bDiv.scrollLeft,t.footerrow&&(r.sDiv.scrollLeft=r.bDiv.scrollLeft),e&&e.stopPropagation()},selectionPreserver:function(e){var t=e.p,n=t.selrow,r=t.selarrrow?b.makeArray(t.selarrrow):null,i=e.grid.bDiv.scrollLeft,s=function(){var o;t.selrow=null,t.selarrrow=[];if(t.multiselect&&r&&0<r.length)for(o=0;o<r.length;o++)r[o]!==n&&b(e).jqGrid("setSelection",r[o],!1,null);n&&b(e).jqGrid("setSelection",n,!1,null),e.grid.bDiv.scrollLeft=i,b(e).unbind(".selectionPreserver",s)};b(e).bind("jqGridGridComplete.selectionPreserver",s)}};if("TABLE"!==this.tagName.toUpperCase())alert("Element is not a table");else if(void 0!==document.documentMode&&5>=document.documentMode)alert("Grid can not be used in this ('quirks') mode!");else{b(this).empty().attr("tabindex","0"),this.p=t,this.p.useProp=!!b.fn.prop;var i,s;if(0===this.p.colNames.length)for(i=0;i<this.p.colModel.length;i++)this.p.colNames[i]=this.p.colModel[i].label||this.p.colModel[i].name;if(this.p.colNames.length!==this.p.colModel.length)alert(b.jgrid.errors.model);else{var o=b("<div class='ui-jqgrid-view'></div>"),u=b.jgrid.msie;n.p.direction=b.trim(n.p.direction.toLowerCase()),-1===b.inArray(n.p.direction,["ltr","rtl"])&&(n.p.direction="ltr"),s=n.p.direction,b(o).insertBefore(this),b(this).removeClass("scroll").appendTo(o);var a=b("<div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'></div>");b(a).attr({id:"gbox_"+this.id,dir:s}).insertBefore(o),b(o).attr("id","gview_"+this.id).appendTo(a),b("<div class='ui-widget-overlay jqgrid-overlay' id='lui_"+this.id+"'></div>").insertBefore(o),b("<div class='loading ui-state-default ui-state-active' id='load_"+this.id+"'>"+this.p.loadtext+"</div>").insertBefore(o),b(this).attr({cellspacing:"0",cellpadding:"0",border:"0",role:"grid","aria-multiselectable":!!this.p.multiselect,"aria-labelledby":"gbox_"+this.id});var f=function(e,t){return e=parseInt(e,10),isNaN(e)?t||0:e},l=function(e,t,i,s,o,u){var a=n.p.colModel[e],f=a.align,l='style="',c=a.classes,h=a.name,p=[];f&&(l+="text-align:"+f+";"),a.hidden===!0&&(l+="display:none;");if(t===0)l+="width: "+r.headers[e].width+"px;";else if(a.cellattr&&b.isFunction(a.cellattr)&&(e=a.cellattr.call(n,o,i,s,a,u))&&typeof e=="string"){e=e.replace(/style/i,"style").replace(/title/i,"title"),e.indexOf("title")>-1&&(a.title=!1),e.indexOf("class")>-1&&(c=void 0),p=e.replace("-style","-sti").split(/style/);if(p.length===2){p[1]=b.trim(p[1].replace("-sti","-style").replace("=",""));if(p[1].indexOf("'")===0||p[1].indexOf('"')===0)p[1]=p[1].substring(1);l+=p[1].replace(/'/gi,'"')}else l+='"'}return p.length||(p[0]="",l+='"'),l+=(c!==void 0?' class="'+c+'"':"")+(a.title&&i?' title="'+b.jgrid.stripHtml(i)+'"':""),l+=' aria-describedby="'+n.p.id+"_"+h+'"',l+p[0]},c=function(e){return e==null||e===""?"&#160;":n.p.autoencode?b.jgrid.htmlEncode(e):""+e},h=function(e,t,r,i,s){var o=n.p.colModel[r];return o.formatter!==void 0?(e=""+n.p.idPrefix!=""?b.jgrid.stripPref(n.p.idPrefix,e):e,e={rowId:e,colModel:o,gid:n.p.id,pos:r},t=b.isFunction(o.formatter)?o.formatter.call(n,t,e,i,s):b.fmatter?b.fn.fmatter.call(n,o.formatter,t,e,i,s):c(t)):t=c(t),t},p=function(e,t,n,r,i,s){return t=h(e,t,n,i,"add"),'<td role="gridcell" '+l(n,r,t,i,e,s)+">"+t+"</td>"},v=function(e,t,r,i){return i='<input role="checkbox" type="checkbox" id="jqg_'+n.p.id+"_"+e+'" class="cbox" name="jqg_'+n.p.id+"_"+e+'"'+(i?'checked="checked"':"")+"/>",'<td role="gridcell" '+l(t,r,"",null,e,!0)+">"+i+"</td>"},m=function(e,t,n,r){return n=(parseInt(n,10)-1)*parseInt(r,10)+1+t,'<td role="gridcell" class="ui-state-default jqgrid-rownum" '+l(e,t,n,null,t,!0)+">"+n+"</td>"},g=function(e){var t,r=[],i=0,s;for(s=0;s<n.p.colModel.length;s++)t=n.p.colModel[s],t.name!=="cb"&&t.name!=="subgrid"&&t.name!=="rn"&&(r[i]=e==="local"?t.name:e==="xml"||e==="xmlstring"?t.xmlmap||t.name:t.jsonmap||t.name,n.p.keyIndex!==!1&&t.key===!0&&(n.p.keyName=r[i]),i++);return r},y=function(e){var t=n.p.remapColumns;if(!t||!t.length)t=b.map(n.p.colModel,function(e,t){return t});return e&&(t=b.map(t,function(t){return t<e?null:t-e})),t},w=function(e,t){var n;this.p.deepempty?b(this.rows).slice(1).remove():(n=this.rows.length>0?this.rows[0]:null,b(this.firstChild).empty().append(n)),e&&this.p.scroll&&(b(this.grid.bDiv.firstChild).css({height:"auto"}),b(this.grid.bDiv.firstChild.firstChild).css({height:0,display:"none"}),this.grid.bDiv.scrollTop!==0&&(this.grid.bDiv.scrollTop=0)),t===!0&&this.p.treeGrid&&(this.p.data=[],this.p._index={})},E=function(){var e=n.p.data.length,t,r,i;t=n.p.rownumbers===!0?1:0,r=n.p.multiselect===!0?1:0,i=n.p.subGrid===!0?1:0,t=n.p.keyIndex===!1||n.p.loadonce===!0?n.p.localReader.id:n.p.colModel[n.p.keyIndex+r+i+t].name;for(r=0;r<e;r++)i=b.jgrid.getAccessor(n.p.data[r],t),i===void 0&&(i=""+(r+1)),n.p._index[i]=r},S=function(e,t,r,i,s,o){var u="-1",a="",f,t=t?"display:none;":"",r="ui-widget-content jqgrow ui-row-"+n.p.direction+(r?" "+r:"")+(o?" ui-state-highlight":""),o=b(n).triggerHandler("jqGridRowAttr",[i,s,e]);typeof o!="object"&&(o=b.isFunction(n.p.rowattr)?n.p.rowattr.call(n,i,s,e):{});if(!b.isEmptyObject(o)){o.hasOwnProperty("id")&&(e=o.id,delete o.id),o.hasOwnProperty("tabindex")&&(u=o.tabindex,delete o.tabindex),o.hasOwnProperty("style")&&(t+=o.style,delete o.style),o.hasOwnProperty("class")&&(r+=" "+o["class"],delete o["class"]);try{delete o.role}catch(l){}for(f in o)o.hasOwnProperty(f)&&(a+=" "+f+"="+o[f])}return'<tr role="row" id="'+e+'" tabindex="'+u+'" class="'+r+'"'+(t===""?"":' style="'+t+'"')+a+">"},x=function(e,t,r,i,s){var o=new Date,u=n.p.datatype!=="local"&&n.p.loadonce||n.p.datatype==="xmlstring",a=n.p.xmlReader,l=n.p.datatype==="local"?"local":"xml";u&&(n.p.data=[],n.p._index={},n.p.localReader.id="_id_"),n.p.reccount=0;if(b.isXMLDoc(e)){n.p.treeANode===-1&&!n.p.scroll?(w.call(n,!1,!0),r=1):r=r>1?r:1;var c=b(n),h,d,E=0,x,T=n.p.multiselect===!0?1:0,N=0,C,k=n.p.rownumbers===!0?1:0,L,A=[],O,M={},_,D,P=[],H=n.p.altRows===!0?n.p.altclass:"",B;n.p.subGrid===!0&&(N=1,C=b.jgrid.getMethod("addSubGridCell")),a.repeatitems||(A=g(l)),L=n.p.keyIndex===!1?b.isFunction(a.id)?a.id.call(n,e):a.id:n.p.keyIndex,A.length>0&&!isNaN(L)&&(L=n.p.keyName),l=(""+L).indexOf("[")===-1?A.length?function(e,t){return b(L,e).text()||t}:function(e,t){return b(a.cell,e).eq(L).text()||t}:function(e,t){return e.getAttribute(L.replace(/[\[\]]/g,""))||t},n.p.userData={},n.p.page=f(b.jgrid.getXmlData(e,a.page),n.p.page),n.p.lastpage=f(b.jgrid.getXmlData(e,a.total),1),n.p.records=f(b.jgrid.getXmlData(e,a.records)),b.isFunction(a.userdata)?n.p.userData=a.userdata.call(n,e)||{}:b.jgrid.getXmlData(e,a.userdata,!0).each(function(){n.p.userData[this.getAttribute("name")]=b(this).text()}),e=b.jgrid.getXmlData(e,a.root,!0),(e=b.jgrid.getXmlData(e,a.row,!0))||(e=[]);var j=e.length,F=0,I=[],q=parseInt(n.p.rowNum,10),R=n.p.scroll?b.jgrid.randId():1;j>0&&n.p.page<=0&&(n.p.page=1);if(e&&j){s&&(q*=s+1);var s=b.isFunction(n.p.afterInsertRow),U=!1,z;n.p.grouping&&(U=n.p.groupingView.groupCollapse===!0,z=b.jgrid.getMethod("groupingPrepare"));for(;F<j;){_=e[F],D=l(_,R+F),D=n.p.idPrefix+D,h=r===0?0:r+1,B=(h+F)%2===1?H:"";var W=P.length;P.push(""),k&&P.push(m(0,F,n.p.page,n.p.rowNum)),T&&P.push(v(D,k,F,!1)),N&&P.push(C.call(c,T+k,F+r));if(a.repeatitems){O||(O=y(T+N+k));var X=b.jgrid.getXmlData(_,a.cell,!0);b.each(O,function(e){var t=X[this];if(!t)return!1;x=t.textContent||t.text,M[n.p.colModel[e+T+N+k].name]=x,P.push(p(D,x,e+T+N+k,F+r,_,M))})}else for(h=0;h<A.length;h++)x=b.jgrid.getXmlData(_,A[h]),M[n.p.colModel[h+T+N+k].name]=x,P.push(p(D,x,h+T+N+k,F+r,_,M));P[W]=S(D,U,B,M,_,!1),P.push("</tr>"),n.p.grouping&&(I=z.call(c,P,I,M,F),P=[]);if(u||n.p.treeGrid===!0)M._id_=b.jgrid.stripPref(n.p.idPrefix,D),n.p.data.push(M),n.p._index[M._id_]=n.p.data.length-1;n.p.gridview===!1&&(b("tbody:first",t).append(P.join("")),c.triggerHandler("jqGridAfterInsertRow",[D,M,_]),s&&n.p.afterInsertRow.call(n,D,M,_),P=[]),M={},E++,F++;if(E===q)break}}n.p.gridview===!0&&(d=n.p.treeANode>-1?n.p.treeANode:0,n.p.grouping?(c.jqGrid("groupingRender",I,n.p.colModel.length),I=null):n.p.treeGrid===!0&&d>0?b(n.rows[d]).after(P.join("")):b("tbody:first",t).append(P.join("")));if(n.p.subGrid===!0)try{c.jqGrid("addSubGrid",T+k)}catch(V){}n.p.totaltime=new Date-o,E>0&&n.p.records===0&&(n.p.records=j),P=null;if(n.p.treeGrid===!0)try{c.jqGrid("setTreeNode",d+1,E+d+1)}catch($){}!n.p.treeGrid&&!n.p.scroll&&(n.grid.bDiv.scrollTop=0),n.p.reccount=E,n.p.treeANode=-1,n.p.userDataOnFooter&&c.jqGrid("footerData","set",n.p.userData,!0),u&&(n.p.records=j,n.p.lastpage=Math.ceil(j/q)),i||n.updatepager(!1,!0);if(u)for(;E<j;){_=e[E],D=l(_,E+R),D=n.p.idPrefix+D;if(a.repeatitems){O||(O=y(T+N+k));var J=b.jgrid.getXmlData(_,a.cell,!0);b.each(O,function(e){var t=J[this];if(!t)return!1;x=t.textContent||t.text,M[n.p.colModel[e+T+N+k].name]=x})}else for(h=0;h<A.length;h++)x=b.jgrid.getXmlData(_,A[h]),M[n.p.colModel[h+T+N+k].name]=x;M._id_=b.jgrid.stripPref(n.p.idPrefix,D),n.p.data.push(M),n.p._index[M._id_]=n.p.data.length-1,M={},E++}}},T=function(e,t,r,i,s){var o=new Date;if(e){n.p.treeANode===-1&&!n.p.scroll?(w.call(n,!1,!0),r=1):r=r>1?r:1;var u,a=n.p.datatype!=="local"&&n.p.loadonce||n.p.datatype==="jsonstring";a&&(n.p.data=[],n.p._index={},n.p.localReader.id="_id_"),n.p.reccount=0,n.p.datatype==="local"?(t=n.p.localReader,u="local"):(t=n.p.jsonReader,u="json");var l=b(n),c=0,h,d,E,x=[],T=n.p.multiselect?1:0,N=n.p.subGrid===!0?1:0,C,k=n.p.rownumbers===!0?1:0,L=y(T+N+k);u=g(u);var A,O,M,_={},D,P,H=[],B=n.p.altRows===!0?n.p.altclass:"",j;n.p.page=f(b.jgrid.getAccessor(e,t.page),n.p.page),n.p.lastpage=f(b.jgrid.getAccessor(e,t.total),1),n.p.records=f(b.jgrid.getAccessor(e,t.records)),n.p.userData=b.jgrid.getAccessor(e,t.userdata)||{},N&&(C=b.jgrid.getMethod("addSubGridCell")),M=n.p.keyIndex===!1?b.isFunction(t.id)?t.id.call(n,e):t.id:n.p.keyIndex,t.repeatitems||(x=u,x.length>0&&!isNaN(M)&&(M=n.p.keyName)),O=b.jgrid.getAccessor(e,t.root),O==null&&b.isArray(e)&&(O=e),O||(O=[]),e=O.length,d=0,e>0&&n.p.page<=0&&(n.p.page=1);var F=parseInt(n.p.rowNum,10),I=n.p.scroll?b.jgrid.randId():1,q=!1,R;s&&(F*=s+1),n.p.datatype==="local"&&!n.p.deselectAfterSort&&(q=!0);var U=b.isFunction(n.p.afterInsertRow),z=[],W=!1,X;n.p.grouping&&(W=n.p.groupingView.groupCollapse===!0,X=b.jgrid.getMethod("groupingPrepare"));for(;d<e;){s=O[d],P=b.jgrid.getAccessor(s,M),P===void 0&&(typeof M=="number"&&n.p.colModel[M+T+N+k]!=null&&(P=b.jgrid.getAccessor(s,n.p.colModel[M+T+N+k].name)),P===void 0&&(P=I+d,x.length===0&&t.cell&&(h=b.jgrid.getAccessor(s,t.cell)||s,P=h!=null&&h[M]!==void 0?h[M]:P))),P=n.p.idPrefix+P,h=r===1?0:r,j=(h+d)%2===1?B:"",q&&(R=n.p.multiselect?b.inArray(P,n.p.selarrrow)!==-1:P===n.p.selrow);var V=H.length;H.push(""),k&&H.push(m(0,d,n.p.page,n.p.rowNum)),T&&H.push(v(P,k,d,R)),N&&H.push(C.call(l,T+k,d+r)),A=u,t.repeatitems&&(t.cell&&(s=b.jgrid.getAccessor(s,t.cell)||s),b.isArray(s)&&(A=L));for(E=0;E<A.length;E++)h=b.jgrid.getAccessor(s,A[E]),_[n.p.colModel[E+T+N+k].name]=h,H.push(p(P,h,E+T+N+k,d+r,s,_));H[V]=S(P,W,j,_,s,R),H.push("</tr>"),n.p.grouping&&(z=X.call(l,H,z,_,d),H=[]);if(a||n.p.treeGrid===!0)_._id_=b.jgrid.stripPref(n.p.idPrefix,P),n.p.data.push(_),n.p._index[_._id_]=n.p.data.length-1;n.p.gridview===!1&&(b("#"+b.jgrid.jqID(n.p.id)+" tbody:first").append(H.join("")),l.triggerHandler("jqGridAfterInsertRow",[P,_,s]),U&&n.p.afterInsertRow.call(n,P,_,s),H=[]),_={},c++,d++;if(c===F)break}n.p.gridview===!0&&(D=n.p.treeANode>-1?n.p.treeANode:0,n.p.grouping?l.jqGrid("groupingRender",z,n.p.colModel.length):n.p.treeGrid===!0&&D>0?b(n.rows[D]).after(H.join("")):b("#"+b.jgrid.jqID(n.p.id)+" tbody:first").append(H.join("")));if(n.p.subGrid===!0)try{l.jqGrid("addSubGrid",T+k)}catch($){}n.p.totaltime=new Date-o,c>0&&n.p.records===0&&(n.p.records=e);if(n.p.treeGrid===!0)try{l.jqGrid("setTreeNode",D+1,c+D+1)}catch(J){}!n.p.treeGrid&&!n.p.scroll&&(n.grid.bDiv.scrollTop=0),n.p.reccount=c,n.p.treeANode=-1,n.p.userDataOnFooter&&l.jqGrid("footerData","set",n.p.userData,!0),a&&(n.p.records=e,n.p.lastpage=Math.ceil(e/F)),i||n.updatepager(!1,!0);if(a)for(;c<e&&O[c];){s=O[c],P=b.jgrid.getAccessor(s,M),P===void 0&&(typeof M=="number"&&n.p.colModel[M+T+N+k]!=null&&(P=b.jgrid.getAccessor(s,n.p.colModel[M+T+N+k].name)),P===void 0&&(P=I+c,x.length===0&&t.cell&&(r=b.jgrid.getAccessor(s,t.cell)||s,P=r!=null&&r[M]!==void 0?r[M]:P)));if(s){P=n.p.idPrefix+P,A=u,t.repeatitems&&(t.cell&&(s=b.jgrid.getAccessor(s,t.cell)||s),b.isArray(s)&&(A=L));for(E=0;E<A.length;E++)_[n.p.colModel[E+T+N+k].name]=b.jgrid.getAccessor(s,A[E]);_._id_=b.jgrid.stripPref(n.p.idPrefix,P),n.p.data.push(_),n.p._index[_._id_]=n.p.data.length-1,_={}}c++}}},N=function(){function e(t){var n=0,r,i,o,u,a;if(t.groups!=null){(i=t.groups.length&&t.groupOp.toString().toUpperCase()==="OR")&&v.orBegin();for(r=0;r<t.groups.length;r++){n>0&&i&&v.or();try{e(t.groups[r])}catch(f){alert(f)}n++}i&&v.orEnd()}if(t.rules!=null)try{(o=t.rules.length&&t.groupOp.toString().toUpperCase()==="OR")&&v.orBegin();for(r=0;r<t.rules.length;r++)a=t.rules[r],u=t.groupOp.toString().toUpperCase(),d[a.op]&&a.field&&(n>0&&u&&u==="OR"&&(v=v.or()),v=d[a.op](v,u)(a.field,a.data,s[a.field])),n++;o&&v.orEnd()}catch(l){alert(l)}}var t=n.p.multiSort?[]:"",r=[],i=!1,s={},o=[],u=[],a,f,l;if(b.isArray(n.p.data)){var c=n.p.grouping?n.p.groupingView:!1,h,p;b.each(n.p.colModel,function(){f=this.sorttype||"text",f==="date"||f==="datetime"?(this.formatter&&typeof this.formatter=="string"&&this.formatter==="date"?(a=this.formatoptions&&this.formatoptions.srcformat?this.formatoptions.srcformat:b.jgrid.formatter.date.srcformat,l=this.formatoptions&&this.formatoptions.newformat?this.formatoptions.newformat:b.jgrid.formatter.date.newformat):a=l=this.datefmt||"Y-m-d",s[this.name]={stype:f,srcfmt:a,newfmt:l}):s[this.name]={stype:f,srcfmt:"",newfmt:""};if(n.p.grouping){p=0;for(h=c.groupField.length;p<h;p++)if(this.name===c.groupField[p]){var e=this.name;this.index&&(e=this.index),o[p]=s[e],u[p]=e}}n.p.multiSort?this.lso&&(t.push(this.name),e=this.lso.split("-"),r.push(e[e.length-1])):!i&&(this.index===n.p.sortname||this.name===n.p.sortname)&&(t=this.name,i=!0)});if(!n.p.treeGrid){var d={eq:function(e){return e.equals},ne:function(e){return e.notEquals},lt:function(e){return e.less},le:function(e){return e.lessOrEquals},gt:function(e){return e.greater},ge:function(e){return e.greaterOrEquals},cn:function(e){return e.contains},nc:function(e,t){return t==="OR"?e.orNot().contains:e.andNot().contains},bw:function(e){return e.startsWith},bn:function(e,t){return t==="OR"?e.orNot().startsWith:e.andNot().startsWith},en:function(e,t){return t==="OR"?e.orNot().endsWith:e.andNot().endsWith},ew:function(e){return e.endsWith},ni:function(e,t){return t==="OR"?e.orNot().equals:e.andNot().equals},"in":function(e){return e.equals},nu:function(e){return e.isNull},nn:function(e,t){return t==="OR"?e.orNot().isNull:e.andNot().isNull}},v=b.jgrid.from(n.p.data);n.p.ignoreCase&&(v=v.ignoreCase());if(n.p.search===!0){var m=n.p.postData.filters;if(m)typeof m=="string"&&(m=b.jgrid.parse(m)),e(m);else try{v=d[n.p.postData.searchOper](v)(n.p.postData.searchField,n.p.postData.searchString,s[n.p.postData.searchField])}catch(g){}}if(n.p.grouping)for(p=0;p<h;p++)v.orderBy(u[p],c.groupOrder[p],o[p].stype,o[p].srcfmt);n.p.multiSort?b.each(t,function(e){v.orderBy(this,r[e],s[this].stype,s[this].srcfmt)}):t&&n.p.sortorder&&i&&(n.p.sortorder.toUpperCase()==="DESC"?v.orderBy(n.p.sortname,"d",s[t].stype,s[t].srcfmt):v.orderBy(n.p.sortname,"a",s[t].stype,s[t].srcfmt));var m=v.select(),y=parseInt(n.p.rowNum,10),w=m.length,E=parseInt(n.p.page,10),S=Math.ceil(w/y),x={},m=m.slice((E-1)*y,E*y),s=v=null;return x[n.p.localReader.total]=S,x[n.p.localReader.page]=E,x[n.p.localReader.records]=w,x[n.p.localReader.root]=m,x[n.p.localReader.userdata]=n.p.userData,m=null,x}b(n).jqGrid("SortTree",t,n.p.sortorder,s[t].stype||"text",s[t].srcfmt||"")}},C=function(){n.grid.hDiv.loading=!0;if(!n.p.hiddengrid)switch(n.p.loadui){case"enable":b("#load_"+b.jgrid.jqID(n.p.id)).show();break;case"block":b("#lui_"+b.jgrid.jqID(n.p.id)).show(),b("#load_"+b.jgrid.jqID(n.p.id)).show()}},k=function(){n.grid.hDiv.loading=!1;switch(n.p.loadui){case"enable":b("#load_"+b.jgrid.jqID(n.p.id)).hide();break;case"block":b("#lui_"+b.jgrid.jqID(n.p.id)).hide(),b("#load_"+b.jgrid.jqID(n.p.id)).hide()}},L=function(e){if(!n.grid.hDiv.loading){var t=n.p.scroll&&e===!1,r={},i,s=n.p.prmNames;n.p.page<=0&&(n.p.page=Math.min(1,n.p.lastpage)),s.search!==null&&(r[s.search]=n.p.search),s.nd!==null&&(r[s.nd]=(new Date).getTime()),s.rows!==null&&(r[s.rows]=n.p.rowNum),s.page!==null&&(r[s.page]=n.p.page),s.sort!==null&&(r[s.sort]=n.p.sortname),s.order!==null&&(r[s.order]=n.p.sortorder),n.p.rowTotal!==null&&s.totalrows!==null&&(r[s.totalrows]=n.p.rowTotal);var o=b.isFunction(n.p.loadComplete),u=o?n.p.loadComplete:null,a=0,e=e||1;e>1?s.npage!==null?(r[s.npage]=e,a=e-1,e=1):u=function(t){n.p.page++,n.grid.hDiv.loading=!1,o&&n.p.loadComplete.call(n,t),L(e-1)}:s.npage!==null&&delete n.p.postData[s.npage];if(n.p.grouping){b(n).jqGrid("groupingSetup");var f=n.p.groupingView,l,c="";for(l=0;l<f.groupField.length;l++){var h=f.groupField[l];b.each(n.p.colModel,function(e,t){t.name===h&&t.index&&(h=t.index)}),c+=h+" "+f.groupOrder[l]+", "}r[s.sort]=c+r[s.sort]}b.extend(n.p.postData,r);var p=n.p.scroll?n.rows.length-1:1,r=b(n).triggerHandler("jqGridBeforeRequest");if(r!==!1&&r!=="stop")if(b.isFunction(n.p.datatype))n.p.datatype.call(n,n.p.postData,"load_"+n.p.id,p,e,a);else{if(b.isFunction(n.p.beforeRequest)){r=n.p.beforeRequest.call(n),r===void 0&&(r=!0);if(r===!1)return}i=n.p.datatype.toLowerCase();switch(i){case"json":case"jsonp":case"xml":case"script":b.ajax(b.extend({url:n.p.url,type:n.p.mtype,dataType:i,data:b.isFunction(n.p.serializeGridData)?n.p.serializeGridData.call(n,n.p.postData):n.p.postData,success:function(r,s,o){if(b.isFunction(n.p.beforeProcessing)&&n.p.beforeProcessing.call(n,r,s,o)===!1)k();else{i==="xml"?x(r,n.grid.bDiv,p,e>1,a):T(r,n.grid.bDiv,p,e>1,a),b(n).triggerHandler("jqGridLoadComplete",[r]),u&&u.call(n,r),b(n).triggerHandler("jqGridAfterLoadComplete",[r]),t&&n.grid.populateVisible();if(n.p.loadonce||n.p.treeGrid)n.p.datatype="local";e===1&&k()}},error:function(t,r,i){b.isFunction(n.p.loadError)&&n.p.loadError.call(n,t,r,i),e===1&&k()},beforeSend:function(e,t){var r=!0;b.isFunction(n.p.loadBeforeSend)&&(r=n.p.loadBeforeSend.call(n,e,t)),r===void 0&&(r=!0);if(r===!1)return!1;C()}},b.jgrid.ajaxOptions,n.p.ajaxGridOptions));break;case"xmlstring":C(),r=typeof n.p.datastr!="string"?n.p.datastr:b.parseXML(n.p.datastr),x(r,n.grid.bDiv),b(n).triggerHandler("jqGridLoadComplete",[r]),o&&n.p.loadComplete.call(n,r),b(n).triggerHandler("jqGridAfterLoadComplete",[r]),n.p.datatype="local",n.p.datastr=null,k();break;case"jsonstring":C(),r=typeof n.p.datastr=="string"?b.jgrid.parse(n.p.datastr):n.p.datastr,T(r,n.grid.bDiv),b(n).triggerHandler("jqGridLoadComplete",[r]),o&&n.p.loadComplete.call(n,r),b(n).triggerHandler("jqGridAfterLoadComplete",[r]),n.p.datatype="local",n.p.datastr=null,k();break;case"local":case"clientside":C(),n.p.datatype="local",r=N(),T(r,n.grid.bDiv,p,e>1,a),b(n).triggerHandler("jqGridLoadComplete",[r]),u&&u.call(n,r),b(n).triggerHandler("jqGridAfterLoadComplete",[r]),t&&n.grid.populateVisible(),k()}}}},A=function(e){b("#cb_"+b.jgrid.jqID(n.p.id),n.grid.hDiv)[n.p.useProp?"prop":"attr"]("checked",e),n.p.frozenColumns&&n.p.id+"_frozen"&&b("#cb_"+b.jgrid.jqID(n.p.id),n.grid.fhDiv)[n.p.useProp?"prop":"attr"]("checked",e)},O=function(e,t){var r="",i="<table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>",o="",u,a,l,c,h=function(e){var t;return b.isFunction(n.p.onPaging)&&(t=n.p.onPaging.call(n,e)),t==="stop"?!1:(n.p.selrow=null,n.p.multiselect&&(n.p.selarrrow=[],A(!1)),n.p.savedRow=[],!0)},e=e.substr(1),t=t+("_"+e);u="pg_"+e,a=e+"_left",l=e+"_center",c=e+"_right",b("#"+b.jgrid.jqID(e)).append("<div id='"+u+"' class='ui-pager-control' role='group'><table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;height:100%;' role='row'><tbody><tr><td id='"+a+"' align='left'></td><td id='"+l+"' align='center' style='white-space:pre;'></td><td id='"+c+"' align='right'></td></tr></tbody></table></div>").attr("dir","ltr");if(n.p.rowList.length>0){o="<td dir='"+s+"'>",o+="<select class='ui-pg-selbox' role='listbox'>";for(a=0;a<n.p.rowList.length;a++)o+='<option role="option" value="'+n.p.rowList[a]+'"'+(n.p.rowNum===n.p.rowList[a]?' selected="selected"':"")+">"+n.p.rowList[a]+"</option>";o+="</select></td>"}s==="rtl"&&(i+=o),n.p.pginput===!0&&(r="<td dir='"+s+"'>"+b.jgrid.format(n.p.pgtext||"","<input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1_"+b.jgrid.jqID(e)+"'></span>")+"</td>"),n.p.pgbuttons===!0?(a=["first"+t,"prev"+t,"next"+t,"last"+t],s==="rtl"&&a.reverse(),i+="<td id='"+a[0]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-first'></span></td>",i+="<td id='"+a[1]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-prev'></span></td>",i=i+(r!==""?"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>"+r+"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>":"")+("<td id='"+a[2]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-next'></span></td>"),i+="<td id='"+a[3]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-end'></span></td>"):r!==""&&(i+=r),s==="ltr"&&(i+=o),i+="</tr></tbody></table>",n.p.viewrecords===!0&&b("td#"+e+"_"+n.p.recordpos,"#"+u).append("<div dir='"+s+"' style='text-align:"+n.p.recordpos+"' class='ui-paging-info'></div>"),b("td#"+e+"_"+n.p.pagerpos,"#"+u).append(i),o=b(".ui-jqgrid").css("font-size")||"11px",b(document.body).append("<div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+o+";visibility:hidden;' ></div>"),i=b(i).clone().appendTo("#testpg").width(),b("#testpg").remove(),i>0&&(r!==""&&(i+=50),b("td#"+e+"_"+n.p.pagerpos,"#"+u).width(i)),n.p._nvtd=[],n.p._nvtd[0]=i?Math.floor((n.p.width-i)/2):Math.floor(n.p.width/3),n.p._nvtd[1]=0,i=null,b(".ui-pg-selbox","#"+u).bind("change",function(){return h("records")?(n.p.page=Math.round(n.p.rowNum*(n.p.page-1)/this.value-.5)+1,n.p.rowNum=this.value,n.p.pager&&b(".ui-pg-selbox",n.p.pager).val(this.value),n.p.toppager&&b(".ui-pg-selbox",n.p.toppager).val(this.value),L(),!1):!1}),n.p.pgbuttons===!0&&(b(".ui-pg-button","#"+u).hover(function(){b(this).hasClass("ui-state-disabled")?this.style.cursor="default":(b(this).addClass("ui-state-hover"),this.style.cursor="pointer")},function(){b(this).hasClass("ui-state-disabled")||(b(this).removeClass("ui-state-hover"),this.style.cursor="default")}),b("#first"+b.jgrid.jqID(t)+", #prev"+b.jgrid.jqID(t)+", #next"+b.jgrid.jqID(t)+", #last"+b.jgrid.jqID(t)).click(function(){var e=f(n.p.page,1),r=f(n.p.lastpage,1),i=!1,s=!0,o=!0,u=!0,a=!0;return r===0||r===1?a=u=o=s=!1:r>1&&e>=1?e===1?o=s=!1:e===r&&(a=u=!1):r>1&&e===0&&(a=u=!1,e=r-1),h(this.id)?(this.id==="first"+t&&s&&(n.p.page=1,i=!0),this.id==="prev"+t&&o&&(n.p.page=e-1,i=!0),this.id==="next"+t&&u&&(n.p.page=e+1,i=!0),this.id==="last"+t&&a&&(n.p.page=r,i=!0),i&&L(),!1):!1})),n.p.pginput===!0&&b("input.ui-pg-input","#"+u).keypress(function(e){return(e.charCode||e.keyCode||0)===13?h("user")?(b(this).val(f(b(this).val(),1)),n.p.page=b(this).val()>0?b(this).val():n.p.page,L(),!1):!1:this})},M=function(e,t){var r,i="",s=n.p.colModel,o=!1,u;u=n.p.frozenColumns?t:n.grid.headers[e].el;var a="";b("span.ui-grid-ico-sort",u).addClass("ui-state-disabled"),b(u).attr("aria-selected","false");if(s[e].lso){if(s[e].lso==="asc")s[e].lso=s[e].lso+"-desc",a="desc";else if(s[e].lso==="desc")s[e].lso=s[e].lso+"-asc",a="asc";else if(s[e].lso==="asc-desc"||s[e].lso==="desc-asc")s[e].lso=""}else s[e].lso=a=s[e].firstsortorder||"asc";a?(b("span.s-ico",u).show(),b("span.ui-icon-"+a,u).removeClass("ui-state-disabled"),b(u).attr("aria-selected","true")):n.p.viewsortcols[0]||b("span.s-ico",u).hide(),n.p.sortorder="",b.each(s,function(e){this.lso&&(e>0&&o&&(i+=", "),r=this.lso.split("-"),i+=s[e].index||s[e].name,i+=" "+r[r.length-1],o=!0,n.p.sortorder=r[r.length-1])}),u=i.lastIndexOf(n.p.sortorder),i=i.substring(0,u),n.p.sortname=i},_=function(e,t,r,i,s){if(n.p.colModel[t].sortable&&!(n.p.savedRow.length>0)){r||(n.p.lastsort===t?n.p.sortorder==="asc"?n.p.sortorder="desc":n.p.sortorder==="desc"&&(n.p.sortorder="asc"):n.p.sortorder=n.p.colModel[t].firstsortorder||"asc",n.p.page=1);if(n.p.multiSort)M(t,s);else{if(i){if(n.p.lastsort===t&&n.p.sortorder===i&&!r)return;n.p.sortorder=i}r=n.grid.headers[n.p.lastsort].el,s=n.p.frozenColumns?s:n.grid.headers[t].el,b("span.ui-grid-ico-sort",r).addClass("ui-state-disabled"),b(r).attr("aria-selected","false"),n.p.frozenColumns&&(n.grid.fhDiv.find("span.ui-grid-ico-sort").addClass("ui-state-disabled"),n.grid.fhDiv.find("th").attr("aria-selected","false")),b("span.ui-icon-"+n.p.sortorder,s).removeClass("ui-state-disabled"),b(s).attr("aria-selected","true"),!n.p.viewsortcols[0]&&n.p.lastsort!==t&&(n.p.frozenColumns&&n.grid.fhDiv.find("span.s-ico").hide(),b("span.s-ico",r).hide(),b("span.s-ico",s).show()),e=e.substring(5+n.p.id.length+1),n.p.sortname=n.p.colModel[t].index||e}b(n).triggerHandler("jqGridSortCol",[n.p.sortname,t,n.p.sortorder])==="stop"?n.p.lastsort=t:b.isFunction(n.p.onSortCol)&&n.p.onSortCol.call(n,n.p.sortname,t,n.p.sortorder)==="stop"?n.p.lastsort=t:(n.p.datatype==="local"?n.p.deselectAfterSort&&b(n).jqGrid("resetSelection"):(n.p.selrow=null,n.p.multiselect&&A(!1),n.p.selarrrow=[],n.p.savedRow=[]),n.p.scroll&&(s=n.grid.bDiv.scrollLeft,w.call(n,!0,!1),n.grid.hDiv.scrollLeft=s),n.p.subGrid&&n.p.datatype==="local"&&b("td.sgexpanded","#"+b.jgrid.jqID(n.p.id)).each(function(){b(this).trigger("click")}),L(),n.p.lastsort=t,n.p.sortname!==e&&t&&(n.p.lastsort=t))}},D=function(e){return e=b(n.grid.headers[e].el),e=[e.position().left+e.outerWidth()],n.p.direction==="rtl"&&(e[0]=n.p.width-e[0]),e[0]=e[0]-n.grid.bDiv.scrollLeft,e.push(b(n.grid.hDiv).position().top),e.push(b(n.grid.bDiv).offset().top-b(n.grid.hDiv).offset().top+b(n.grid.bDiv).height()),e},P=function(e){var t,r=n.grid.headers,i=b.jgrid.getCellIndex(e);for(t=0;t<r.length;t++)if(e===r[t].el){i=t;break}return i};this.p.id=this.id,-1===b.inArray(n.p.multikey,["shiftKey","altKey","ctrlKey"])&&(n.p.multikey=!1),n.p.keyIndex=!1,n.p.keyName=!1;for(i=0;i<n.p.colModel.length;i++)n.p.colModel[i]=b.extend(!0,{},n.p.cmTemplate,n.p.colModel[i].template||{},n.p.colModel[i]),!1===n.p.keyIndex&&!0===n.p.colModel[i].key&&(n.p.keyIndex=i);n.p.sortorder=n.p.sortorder.toLowerCase(),b.jgrid.cell_width=b.jgrid.cellWidth(),!0===n.p.grouping&&(n.p.scroll=!1,n.p.rownumbers=!1,n.p.treeGrid=!1,n.p.gridview=!0);if(!0===this.p.treeGrid){try{b(this).jqGrid("setTreeGrid")}catch(H){}"local"!==n.p.datatype&&(n.p.localReader={id:"_id_"})}if(this.p.subGrid)try{b(n).jqGrid("setSubGrid")}catch(B){}this.p.multiselect&&(this.p.colNames.unshift("<input role='checkbox' id='cb_"+this.p.id+"' class='cbox' type='checkbox'/>"),this.p.colModel.unshift({name:"cb",width:b.jgrid.cell_width?n.p.multiselectWidth+n.p.cellLayout:n.p.multiselectWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0})),this.p.rownumbers&&(this.p.colNames.unshift(""),this.p.colModel.unshift({name:"rn",width:n.p.rownumWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,align:"center",fixed:!0})),n.p.xmlReader=b.extend(!0,{root:"rows",row:"row",page:"rows>page",total:"rows>total",records:"rows>records",repeatitems:!0,cell:"cell",id:"[id]",userdata:"userdata",subgrid:{root:"rows",row:"row",repeatitems:!0,cell:"cell"}},n.p.xmlReader),n.p.jsonReader=b.extend(!0,{root:"rows",page:"page",total:"total",records:"records",repeatitems:!0,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:!0,cell:"cell"}},n.p.jsonReader),n.p.localReader=b.extend(!0,{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:!0,cell:"cell"}},n.p.localReader),n.p.scroll&&(n.p.pgbuttons=!1,n.p.pginput=!1,n.p.rowList=[]),n.p.data.length&&E();var j="<thead><tr class='ui-jqgrid-labels' role='rowheader'>",F,I,q,R,U,z,W,X,V=X="",$=[],J=[];I=[];if(!0===n.p.shrinkToFit&&!0===n.p.forceFit)for(i=n.p.colModel.length-1;0<=i;i--)if(!n.p.colModel[i].hidden){n.p.colModel[i].resizable=!1;break}"horizontal"===n.p.viewsortcols[1]&&(X=" ui-i-asc",V=" ui-i-desc"),F=u?"class='ui-th-div-ie'":"",X="<span class='s-ico' style='display:none'><span sort='asc' class='ui-grid-ico-sort ui-icon-asc"+X+" ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-"+s+"'></span>"+("<span sort='desc' class='ui-grid-ico-sort ui-icon-desc"+V+" ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-"+s+"'></span></span>");if(n.p.multiSort){$=n.p.sortname.split(",");for(i=0;i<$.length;i++)I=b.trim($[i]).split(" "),$[i]=b.trim(I[0]),J[i]=I[1]?b.trim(I[1]):n.p.sortorder||"asc"}for(i=0;i<this.p.colNames.length;i++)I=n.p.headertitles?' title="'+b.jgrid.stripHtml(n.p.colNames[i])+'"':"",j+="<th id='"+n.p.id+"_"+n.p.colModel[i].name+"' role='columnheader' class='ui-state-default ui-th-column ui-th-"+s+"'"+I+">",I=n.p.colModel[i].index||n.p.colModel[i].name,j+="<div id='jqgh_"+n.p.id+"_"+n.p.colModel[i].name+"' "+F+">"+n.p.colNames[i],n.p.colModel[i].width=n.p.colModel[i].width?parseInt(n.p.colModel[i].width,10):150,"boolean"!=typeof n.p.colModel[i].title&&(n.p.colModel[i].title=!0),n.p.colModel[i].lso="",I===n.p.sortname&&(n.p.lastsort=i),n.p.multiSort&&(I=b.inArray(I,$),-1!==I&&(n.p.colModel[i].lso=J[I])),j+=X+"</div></th>";X=null,b(this).append(j+"</tr></thead>"),b("thead tr:first th",this).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});if(this.p.multiselect){var K=[],Q;b("#cb_"+b.jgrid.jqID(n.p.id),this).bind("click",function(){n.p.selarrrow=[];var e=n.p.frozenColumns===!0?n.p.id+"_frozen":"";this.checked?(b(n.rows).each(function(t){t>0&&!b(this).hasClass("ui-subgrid")&&!b(this).hasClass("jqgroup")&&!b(this).hasClass("ui-state-disabled")&&(b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+b.jgrid.jqID(this.id))[n.p.useProp?"prop":"attr"]("checked",!0),b(this).addClass("ui-state-highlight").attr("aria-selected","true"),n.p.selarrrow.push(this.id),n.p.selrow=this.id,e&&(b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+b.jgrid.jqID(this.id),n.grid.fbDiv)[n.p.useProp?"prop":"attr"]("checked",!0),b("#"+b.jgrid.jqID(this.id),n.grid.fbDiv).addClass("ui-state-highlight")))}),Q=!0,K=[]):(b(n.rows).each(function(t){t>0&&!b(this).hasClass("ui-subgrid")&&!b(this).hasClass("ui-state-disabled")&&(b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+b.jgrid.jqID(this.id))[n.p.useProp?"prop":"attr"]("checked",!1),b(this).removeClass("ui-state-highlight").attr("aria-selected","false"),K.push(this.id),e&&(b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+b.jgrid.jqID(this.id),n.grid.fbDiv)[n.p.useProp?"prop":"attr"]("checked",!1),b("#"+b.jgrid.jqID(this.id),n.grid.fbDiv).removeClass("ui-state-highlight")))}),n.p.selrow=null,Q=!1),b(n).triggerHandler("jqGridSelectAll",[Q?n.p.selarrrow:K,Q]),b.isFunction(n.p.onSelectAll)&&n.p.onSelectAll.call(n,Q?n.p.selarrrow:K,Q)})}!0===n.p.autowidth&&(j=b(a).innerWidth(),n.p.width=0<j?j:"nw"),function(){var e=0,t=b.jgrid.cell_width?0:f(n.p.cellLayout,0),i=0,s,o=f(n.p.scrollOffset,0),u,a=!1,l,c=0,h;b.each(n.p.colModel,function(){this.hidden===void 0&&(this.hidden=!1);if(n.p.grouping&&n.p.autowidth){var r=b.inArray(this.name,n.p.groupingView.groupField);r>=0&&n.p.groupingView.groupColumnShow.length>r&&(this.hidden=!n.p.groupingView.groupColumnShow[r])}this.widthOrg=u=f(this.width,0),this.hidden===!1&&(e+=u+t,this.fixed?c+=u+t:i++)}),isNaN(n.p.width)&&(n.p.width=e+(n.p.shrinkToFit===!1&&!isNaN(n.p.height)?o:0)),r.width=n.p.width,n.p.tblwidth=e,n.p.shrinkToFit===!1&&n.p.forceFit===!0&&(n.p.forceFit=!1),n.p.shrinkToFit===!0&&i>0&&(l=r.width-t*i-c,isNaN(n.p.height)||(l-=o,a=!0),e=0,b.each(n.p.colModel,function(r){this.hidden===!1&&!this.fixed&&(this.width=u=Math.round(l*this.width/(n.p.tblwidth-t*i-c)),e+=u,s=r)}),h=0,a?r.width-c-(e+t*i)!==o&&(h=r.width-c-(e+t*i)-o):!a&&Math.abs(r.width-c-(e+t*i))!==1&&(h=r.width-c-(e+t*i)),n.p.colModel[s].width=n.p.colModel[s].width+h,n.p.tblwidth=e+h+t*i+c,n.p.tblwidth>n.p.width&&(n.p.colModel[s].width=n.p.colModel[s].width-(n.p.tblwidth-parseInt(n.p.width,10)),n.p.tblwidth=n.p.width))}(),b(a).css("width",r.width+"px").append("<div class='ui-jqgrid-resize-mark' id='rs_m"+n.p.id+"'>&#160;</div>"),b(o).css("width",r.width+"px");var j=b("thead:first",n).get(0),G="";n.p.footerrow&&(G+="<table role='grid' style='width:"+n.p.tblwidth+"px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'><tbody><tr role='row' class='ui-widget-content footrow footrow-"+s+"'>");var o=b("tr:first",j),Y="<tr class='jqgfirstrow' role='row' style='height:auto'>";n.p.disableClick=!1,b("th",o).each(function(e){q=n.p.colModel[e].width,n.p.colModel[e].resizable===void 0&&(n.p.colModel[e].resizable=!0),n.p.colModel[e].resizable?(R=document.createElement("span"),b(R).html("&#160;").addClass("ui-jqgrid-resize ui-jqgrid-resize-"+s).css("cursor","col-resize"),b(this).addClass(n.p.resizeclass)):R="",b(this).css("width",q+"px").prepend(R),R=null;var t="";n.p.colModel[e].hidden&&(b(this).css("display","none"),t="display:none;"),Y+="<td role='gridcell' style='height:0px;width:"+q+"px;"+t+"'></td>",r.headers[e]={width:q,el:this},U=n.p.colModel[e].sortable,typeof U!="boolean"&&(U=n.p.colModel[e].sortable=!0),t=n.p.colModel[e].name,t==="cb"||t==="subgrid"||t==="rn"||n.p.viewsortcols[2]&&b(">div",this).addClass("ui-jqgrid-sortable"),U&&(n.p.multiSort?n.p.viewsortcols[0]?(b("div span.s-ico",this).show(),n.p.colModel[e].lso&&b("div span.ui-icon-"+n.p.colModel[e].lso,this).removeClass("ui-state-disabled")):n.p.colModel[e].lso&&(b("div span.s-ico",this).show(),b("div span.ui-icon-"+n.p.colModel[e].lso,this).removeClass("ui-state-disabled")):n.p.viewsortcols[0]?(b("div span.s-ico",this).show(),e===n.p.lastsort&&b("div span.ui-icon-"+n.p.sortorder,this).removeClass("ui-state-disabled")):e===n.p.lastsort&&(b("div span.s-ico",this).show(),b("div span.ui-icon-"+n.p.sortorder,this).removeClass("ui-state-disabled"))),n.p.footerrow&&(G+="<td role='gridcell' "+l(e,0,"",null,"",!1)+">&#160;</td>")}).mousedown(function(e){if(b(e.target).closest("th>span.ui-jqgrid-resize").length===1){var t=P(this);if(n.p.forceFit===!0){var i=n.p,s=t,o;for(o=t+1;o<n.p.colModel.length;o++)if(n.p.colModel[o].hidden!==!0){s=o;break}i.nv=s-t}return r.dragStart(t,e,D(t)),!1}}).click(function(e){if(n.p.disableClick)return n.p.disableClick=!1;var t="th>div.ui-jqgrid-sortable",r,i;n.p.viewsortcols[2]||(t="th>div>span>span.ui-grid-ico-sort"),e=b(e.target).closest(t);if(e.length===1){var s;if(n.p.frozenColumns){var o=b(this)[0].id.substring(n.p.id.length+1);b(n.p.colModel).each(function(e){if(this.name===o)return s=e,!1})}else s=P(this);return n.p.viewsortcols[2]||(r=!0,i=e.attr("sort")),s!=null&&_(b("div",this)[0].id,s,r,i,this),!1}});if(n.p.sortable&&b.fn.sortable)try{b(n).jqGrid("sortableColumns",o)}catch(Z){}n.p.footerrow&&(G+="</tr></tbody></table>"),Y+="</tr>",this.appendChild(document.createElement("tbody")),b(this).addClass("ui-jqgrid-btable").append(Y);var Y=null,o=b("<table class='ui-jqgrid-htable' style='width:"+n.p.tblwidth+"px' role='grid' aria-labelledby='gbox_"+this.id+"' cellspacing='0' cellpadding='0' border='0'></table>").append(j),et=n.p.caption&&!0===n.p.hiddengrid?!0:!1;i=b("<div class='ui-jqgrid-hbox"+("rtl"===s?"-rtl":"")+"'></div>"),j=null,r.hDiv=document.createElement("div"),b(r.hDiv).css({width:r.width+"px"}).addClass("ui-state-default ui-jqgrid-hdiv").append(i),b(i).append(o),o=null,et&&b(r.hDiv).hide(),n.p.pager&&("string"==typeof n.p.pager?"#"!==n.p.pager.substr(0,1)&&(n.p.pager="#"+n.p.pager):n.p.pager="#"+b(n.p.pager).attr("id"),b(n.p.pager).css({width:r.width+"px"}).addClass("ui-state-default ui-jqgrid-pager ui-corner-bottom").appendTo(a),et&&b(n.p.pager).hide(),O(n.p.pager,"")),!1===n.p.cellEdit&&!0===n.p.hoverrows&&b(n).bind("mouseover",function(e){W=b(e.target).closest("tr.jqgrow"),b(W).attr("class")!=="ui-subgrid"&&b(W).addClass("ui-state-hover")}).bind("mouseout",function(e){W=b(e.target).closest("tr.jqgrow"),b(W).removeClass("ui-state-hover")});var tt,nt,rt;b(n).before(r.hDiv).click(function(e){z=e.target,W=b(z,n.rows).closest("tr.jqgrow");if(b(W).length===0||W[0].className.indexOf("ui-state-disabled")>-1||(b(z,n).closest("table.ui-jqgrid-btable").attr("id")||"").replace("_frozen","")!==n.id)return this;var t=b(z).hasClass("cbox"),r=b(n).triggerHandler("jqGridBeforeSelectRow",[W[0].id,e]);(r=r===!1||r==="stop"?!1:!0)&&b.isFunction(n.p.beforeSelectRow)&&(r=n.p.beforeSelectRow.call(n,W[0].id,e));if(z.tagName!=="A"&&(z.tagName!=="INPUT"&&z.tagName!=="TEXTAREA"&&z.tagName!=="OPTION"&&z.tagName!=="SELECT"||!!t)&&r===!0){tt=W[0].id,nt=b.jgrid.getCellIndex(z),rt=b(z).closest("td,th").html(),b(n).triggerHandler("jqGridCellSelect",[tt,nt,rt,e]),b.isFunction(n.p.onCellSelect)&&n.p.onCellSelect.call(n,tt,nt,rt,e);if(n.p.cellEdit===!0)if(n.p.multiselect&&t)b(n).jqGrid("setSelection",tt,!0,e);else{tt=W[0].rowIndex;try{b(n).jqGrid("editCell",tt,nt,!0)}catch(i){}}else if(n.p.multikey)e[n.p.multikey]?b(n).jqGrid("setSelection",tt,!0,e):n.p.multiselect&&t&&(t=b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+tt).is(":checked"),b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+tt)[n.p.useProp?"prop":"attr"]("checked",t));else{if(n.p.multiselect&&n.p.multiboxonly&&!t){var s=n.p.frozenColumns?n.p.id+"_frozen":"";b(n.p.selarrrow).each(function(e,t){var r=b(n).jqGrid("getGridRowById",t);b(r).removeClass("ui-state-highlight"),b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+b.jgrid.jqID(t))[n.p.useProp?"prop":"attr"]("checked",!1),s&&(b("#"+b.jgrid.jqID(t),"#"+b.jgrid.jqID(s)).removeClass("ui-state-highlight"),b("#jqg_"+b.jgrid.jqID(n.p.id)+"_"+b.jgrid.jqID(t),"#"+b.jgrid.jqID(s))[n.p.useProp?"prop":"attr"]("checked",!1))}),n.p.selarrrow=[]}b(n).jqGrid("setSelection",tt,!0,e)}}}).bind("reloadGrid",function(e,t){n.p.treeGrid===!0&&(n.p.datatype=n.p.treedatatype),t&&t.current&&n.grid.selectionPreserver(n),n.p.datatype==="local"?(b(n).jqGrid("resetSelection"),n.p.data.length&&E()):n.p.treeGrid||(n.p.selrow=null,n.p.multiselect&&(n.p.selarrrow=[],A(!1)),n.p.savedRow=[]),n.p.scroll&&w.call(n,!0,!1);if(t&&t.page){var r=t.page;r>n.p.lastpage&&(r=n.p.lastpage),r<1&&(r=1),n.p.page=r,n.grid.bDiv.scrollTop=n.grid.prevRowHeight?(r-1)*n.grid.prevRowHeight*n.p.rowNum:0}return n.grid.prevRowHeight&&n.p.scroll?(delete n.p.lastpage,n.grid.populateVisible()):n.grid.populate(),n.p._inlinenav===!0&&b(n).jqGrid("showAddEditButtons"),!1}).dblclick(function(e){z=e.target,W=b(z,n.rows).closest("tr.jqgrow"),b(W).length!==0&&(tt=W[0].rowIndex,nt=b.jgrid.getCellIndex(z),b(n).triggerHandler("jqGridDblClickRow",[b(W).attr("id"),tt,nt,e]),b.isFunction(n.p.ondblClickRow)&&n.p.ondblClickRow.call(n,b(W).attr("id"),tt,nt,e))}).bind("contextmenu",function(e){z=e.target,W=b(z,n.rows).closest("tr.jqgrow"),b(W).length!==0&&(n.p.multiselect||b(n).jqGrid("setSelection",W[0].id,!0,e),tt=W[0].rowIndex,nt=b.jgrid.getCellIndex(z),b(n).triggerHandler("jqGridRightClickRow",[b(W).attr("id"),tt,nt,e]),b.isFunction(n.p.onRightClickRow)&&n.p.onRightClickRow.call(n,b(W).attr("id"),tt,nt,e))}),r.bDiv=document.createElement("div"),u&&"auto"===(""+n.p.height).toLowerCase()&&(n.p.height="100%"),b(r.bDiv).append(b('<div style="position:relative;'+(u&&8>b.jgrid.msiever()?"height:0.01%;":"")+'"></div>').append("<div></div>").append(this)).addClass("ui-jqgrid-bdiv").css({height:n.p.height+(isNaN(n.p.height)?"":"px"),width:r.width+"px"}).scroll(r.scrollGrid),b("table:first",r.bDiv).css({width:n.p.tblwidth+"px"}),b.support.tbody||2===b("tbody",this).length&&b("tbody:gt(0)",this).remove(),n.p.multikey&&(b.jgrid.msie?b(r.bDiv).bind("selectstart",function(){return!1}):b(r.bDiv).bind("mousedown",function(){return!1})),et&&b(r.bDiv).hide(),r.cDiv=document.createElement("div");var it=!0===n.p.hidegrid?b("<a role='link' class='ui-jqgrid-titlebar-close HeaderButton' />").hover(function(){it.addClass("ui-state-hover")},function(){it.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-circle-triangle-n'></span>").css("rtl"===s?"left":"right","0px"):"";b(r.cDiv).append(it).append("<span class='ui-jqgrid-title"+("rtl"===s?"-rtl":"")+"'>"+n.p.caption+"</span>").addClass("ui-jqgrid-titlebar ui-widget-header ui-corner-top ui-helper-clearfix"),b(r.cDiv).insertBefore(r.hDiv),n.p.toolbar[0]&&(r.uDiv=document.createElement("div"),"top"===n.p.toolbar[1]?b(r.uDiv).insertBefore(r.hDiv):"bottom"===n.p.toolbar[1]&&b(r.uDiv).insertAfter(r.hDiv),"both"===n.p.toolbar[1]?(r.ubDiv=document.createElement("div"),b(r.uDiv).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id).insertBefore(r.hDiv),b(r.ubDiv).addClass("ui-userdata ui-state-default").attr("id","tb_"+this.id).insertAfter(r.hDiv),et&&b(r.ubDiv).hide()):b(r.uDiv).width(r.width).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id),et&&b(r.uDiv).hide()),n.p.toppager&&(n.p.toppager=b.jgrid.jqID(n.p.id)+"_toppager",r.topDiv=b("<div id='"+n.p.toppager+"'></div>")[0],n.p.toppager="#"+n.p.toppager,b(r.topDiv).addClass("ui-state-default ui-jqgrid-toppager").width(r.width).insertBefore(r.hDiv),O(n.p.toppager,"_t")),n.p.footerrow&&(r.sDiv=b("<div class='ui-jqgrid-sdiv'></div>")[0],i=b("<div class='ui-jqgrid-hbox"+("rtl"===s?"-rtl":"")+"'></div>"),b(r.sDiv).append(i).width(r.width).insertAfter(r.hDiv),b(i).append(G),r.footers=b(".ui-jqgrid-ftable",r.sDiv)[0].rows[0].cells,n.p.rownumbers&&(r.footers[0].className="ui-state-default jqgrid-rownum"),et&&b(r.sDiv).hide()),i=null;if(n.p.caption){var st=n.p.datatype;!0===n.p.hidegrid&&(b(".ui-jqgrid-titlebar-close",r.cDiv).click(function(e){var t=b.isFunction(n.p.onHeaderClick),i=".ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-pager, .ui-jqgrid-sdiv",s,o=this;return n.p.toolbar[0]===!0&&(n.p.toolbar[1]==="both"&&(i+=", #"+b(r.ubDiv).attr("id")),i+=", #"+b(r.uDiv).attr("id")),s=b(i,"#gview_"+b.jgrid.jqID(n.p.id)).length,n.p.gridstate==="visible"?b(i,"#gbox_"+b.jgrid.jqID(n.p.id)).slideUp("fast",function(){s--,s===0&&(b("span",o).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),n.p.gridstate="hidden",b("#gbox_"+b.jgrid.jqID(n.p.id)).hasClass("ui-resizable")&&b(".ui-resizable-handle","#gbox_"+b.jgrid.jqID(n.p.id)).hide(),b(n).triggerHandler("jqGridHeaderClick",[n.p.gridstate,e]),t&&(et||n.p.onHeaderClick.call(n,n.p.gridstate,e)))}):n.p.gridstate==="hidden"&&b(i,"#gbox_"+b.jgrid.jqID(n.p.id)).slideDown("fast",function(){s--,s===0&&(b("span",o).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),et&&(n.p.datatype=st,L(),et=!1),n.p.gridstate="visible",b("#gbox_"+b.jgrid.jqID(n.p.id)).hasClass("ui-resizable")&&b(".ui-resizable-handle","#gbox_"+b.jgrid.jqID(n.p.id)).show(),b(n).triggerHandler("jqGridHeaderClick",[n.p.gridstate,e]),t&&(et||n.p.onHeaderClick.call(n,n.p.gridstate,e)))}),!1}),et&&(n.p.datatype="local",b(".ui-jqgrid-titlebar-close",r.cDiv).trigger("click")))}else b(r.cDiv).hide();b(r.hDiv).after(r.bDiv).mousemove(function(e){if(r.resizing)return r.dragMove(e),!1}),b(".ui-jqgrid-labels",r.hDiv).bind("selectstart",function(){return!1}),b(document).bind("mouseup.jqGrid"+n.p.id,function(){return r.resizing?(r.dragEnd(),!1):!0}),n.formatCol=l,n.sortData=_,n.updatepager=function(e,t){var r,i,s,o,u,a,l,c="",h=n.p.pager?"_"+b.jgrid.jqID(n.p.pager.substr(1)):"",p=n.p.toppager?"_"+n.p.toppager.substr(1):"";s=parseInt(n.p.page,10)-1,s<0&&(s=0),s*=parseInt(n.p.rowNum,10),u=s+n.p.reccount;if(n.p.scroll){r=b("tbody:first > tr:gt(0)",n.grid.bDiv),s=u-r.length,n.p.reccount=r.length;if(r=r.outerHeight()||n.grid.prevRowHeight)i=s*r,l=parseInt(n.p.records,10)*r,b(">div:first",n.grid.bDiv).css({height:l}).children("div:first").css({height:i,display:i?"":"none"}),n.grid.bDiv.scrollTop==0&&n.p.page>1&&(n.grid.bDiv.scrollTop=n.p.rowNum*(n.p.page-1)*r);n.grid.bDiv.scrollLeft=n.grid.hDiv.scrollLeft}c=n.p.pager||"";if(c+=n.p.toppager?c?","+n.p.toppager:n.p.toppager:"")l=b.jgrid.formatter.integer||{},r=f(n.p.page),i=f(n.p.lastpage),b(".selbox",c)[this.p.useProp?"prop":"attr"]("disabled",!1),n.p.pginput===!0&&(b(".ui-pg-input",c).val(n.p.page),o=n.p.toppager?"#sp_1"+h+",#sp_1"+p:"#sp_1"+h,b(o).html(b.fmatter?b.fmatter.util.NumberFormat(n.p.lastpage,l):n.p.lastpage)),n.p.viewrecords&&(n.p.reccount===0?b(".ui-paging-info",c).html(n.p.emptyrecords):(o=s+1,a=n.p.records,b.fmatter&&(o=b.fmatter.util.NumberFormat(o,l),u=b.fmatter.util.NumberFormat(u,l),a=b.fmatter.util.NumberFormat(a,l)),b(".ui-paging-info",c).html(b.jgrid.format(n.p.recordtext,o,u,a)))),n.p.pgbuttons===!0&&(r<=0&&(r=i=0),r===1||r===0?(b("#first"+h+", #prev"+h).addClass("ui-state-disabled").removeClass("ui-state-hover"),n.p.toppager&&b("#first_t"+p+", #prev_t"+p).addClass("ui-state-disabled").removeClass("ui-state-hover")):(b("#first"+h+", #prev"+h).removeClass("ui-state-disabled"),n.p.toppager&&b("#first_t"+p+", #prev_t"+p).removeClass("ui-state-disabled")),r===i||r===0?(b("#next"+h+", #last"+h).addClass("ui-state-disabled").removeClass("ui-state-hover"),n.p.toppager&&b("#next_t"+p+", #last_t"+p).addClass("ui-state-disabled").removeClass("ui-state-hover")):(b("#next"+h+", #last"+h).removeClass("ui-state-disabled"),n.p.toppager&&b("#next_t"+p+", #last_t"+p).removeClass("ui-state-disabled")));e===!0&&n.p.rownumbers===!0&&b(">td.jqgrid-rownum",n.rows).each(function(e){b(this).html(s+1+e)}),t&&n.p.jqgdnd&&b(n).jqGrid("gridDnD","updateDnD"),b(n).triggerHandler("jqGridGridComplete"),b.isFunction(n.p.gridComplete)&&n.p.gridComplete.call(n),b(n).triggerHandler("jqGridAfterGridComplete")},n.refreshIndex=E,n.setHeadCheckBox=A,n.constructTr=S,n.formatter=function(e,t,n,r,i){return h(e,t,n,r,i)},b.extend(r,{populate:L,emptyRows:w,beginReq:C,endReq:k}),this.grid=r,n.addXmlData=function(e){x(e,n.grid.bDiv)},n.addJSONData=function(e){T(e,n.grid.bDiv)},this.grid.cols=this.rows[0].cells,b(n).triggerHandler("jqGridInitGrid"),b.isFunction(n.p.onInitGrid)&&n.p.onInitGrid.call(n),L(),n.p.hiddengrid=!1}}}})},b.jgrid.extend({getGridParam:function(e){var t=this[0];return!t||!t.grid?void 0:e?void 0!==t.p[e]?t.p[e]:null:t.p},setGridParam:function(e){return this.each(function(){this.grid&&"object"==typeof e&&b.extend(!0,this.p,e)})},getGridRowById:function(e){var t;return this.each(function(){try{t=this.rows.namedItem(e)}catch(n){t=b(this.grid.bDiv).find("#"+b.jgrid.jqID(e))}}),t},getDataIDs:function(){var e=[],t=0,n,r=0;return this.each(function(){if((n=this.rows.length)&&0<n)for(;t<n;)b(this.rows[t]).hasClass("jqgrow")&&(e[r]=this.rows[t].id,r++),t++}),e},setSelection:function(e,t,n){return this.each(function(){var r,i,s,o,u,a;if(void 0!==e&&(t=!1===t?!1:!0,(i=b(this).jqGrid("getGridRowById",e))&&i.className&&!(-1<i.className.indexOf("ui-state-disabled"))))if(!0===this.p.scrollrows&&(s=b(this).jqGrid("getGridRowById",e).rowIndex,0<=s&&(r=b(this.grid.bDiv)[0].clientHeight,o=b(this.grid.bDiv)[0].scrollTop,u=b(this.rows[s]).position().top,s=this.rows[s].clientHeight,u+s>=r+o?b(this.grid.bDiv)[0].scrollTop=u-(r+o)+s+o:u<r+o&&u<o&&(b(this.grid.bDiv)[0].scrollTop=u))),!0===this.p.frozenColumns&&(a=this.p.id+"_frozen"),this.p.multiselect){if(this.setHeadCheckBox(!1),this.p.selrow=i.id,o=b.inArray(this.p.selrow,this.p.selarrrow),-1===o?("ui-subgrid"!==i.className&&b(i).addClass("ui-state-highlight").attr("aria-selected","true"),r=!0,this.p.selarrrow.push(this.p.selrow)):("ui-subgrid"!==i.className&&b(i).removeClass("ui-state-highlight").attr("aria-selected","false"),r=!1,this.p.selarrrow.splice(o,1),u=this.p.selarrrow[0],this.p.selrow=void 0===u?null:u),b("#jqg_"+b.jgrid.jqID(this.p.id)+"_"+b.jgrid.jqID(i.id))[this.p.useProp?"prop":"attr"]("checked",r),a&&(-1===o?b("#"+b.jgrid.jqID(e),"#"+b.jgrid.jqID(a)).addClass("ui-state-highlight"):b("#"+b.jgrid.jqID(e),"#"+b.jgrid.jqID(a)).removeClass("ui-state-highlight"),b("#jqg_"+b.jgrid.jqID(this.p.id)+"_"+b.jgrid.jqID(e),"#"+b.jgrid.jqID(a))[this.p.useProp?"prop":"attr"]("checked",r)),t)b(this).triggerHandler("jqGridSelectRow",[i.id,r,n]),this.p.onSelectRow&&this.p.onSelectRow.call(this,i.id,r,n)}else"ui-subgrid"!==i.className&&(this.p.selrow!==i.id?(b(b(this).jqGrid("getGridRowById",this.p.selrow)).removeClass("ui-state-highlight").attr({"aria-selected":"false",tabindex:"-1"}),b(i).addClass("ui-state-highlight").attr({"aria-selected":"true",tabindex:"0"}),a&&(b("#"+b.jgrid.jqID(this.p.selrow),"#"+b.jgrid.jqID(a)).removeClass("ui-state-highlight"),b("#"+b.jgrid.jqID(e),"#"+b.jgrid.jqID(a)).addClass("ui-state-highlight")),r=!0):r=!1,this.p.selrow=i.id,t)&&(b(this).triggerHandler("jqGridSelectRow",[i.id,r,n]),this.p.onSelectRow&&this.p.onSelectRow.call(this,i.id,r,n))})},resetSelection:function(e){return this.each(function(){var t=this,n,r;!0===t.p.frozenColumns&&(r=t.p.id+"_frozen"),void 0!==e?(n=e===t.p.selrow?t.p.selrow:e,b("#"+b.jgrid.jqID(t.p.id)+" tbody:first tr#"+b.jgrid.jqID(n)).removeClass("ui-state-highlight").attr("aria-selected","false"),r&&b("#"+b.jgrid.jqID(n),"#"+b.jgrid.jqID(r)).removeClass("ui-state-highlight"),t.p.multiselect&&(b("#jqg_"+b.jgrid.jqID(t.p.id)+"_"+b.jgrid.jqID(n),"#"+b.jgrid.jqID(t.p.id))[t.p.useProp?"prop":"attr"]("checked",!1),r&&b("#jqg_"+b.jgrid.jqID(t.p.id)+"_"+b.jgrid.jqID(n),"#"+b.jgrid.jqID(r))[t.p.useProp?"prop":"attr"]("checked",!1),t.setHeadCheckBox(!1)),n=null):t.p.multiselect?(b(t.p.selarrrow).each(function(e,n){b(b(t).jqGrid("getGridRowById",n)).removeClass("ui-state-highlight").attr("aria-selected","false"),b("#jqg_"+b.jgrid.jqID(t.p.id)+"_"+b.jgrid.jqID(n))[t.p.useProp?"prop":"attr"]("checked",!1),r&&(b("#"+b.jgrid.jqID(n),"#"+b.jgrid.jqID(r)).removeClass("ui-state-highlight"),b("#jqg_"+b.jgrid.jqID(t.p.id)+"_"+b.jgrid.jqID(n),"#"+b.jgrid.jqID(r))[t.p.useProp?"prop":"attr"]("checked",!1))}),t.setHeadCheckBox(!1),t.p.selarrrow=[]):t.p.selrow&&(b("#"+b.jgrid.jqID(t.p.id)+" tbody:first tr#"+b.jgrid.jqID(t.p.selrow)).removeClass("ui-state-highlight").attr("aria-selected","false"),r&&b("#"+b.jgrid.jqID(t.p.selrow),"#"+b.jgrid.jqID(r)).removeClass("ui-state-highlight"),t.p.selrow=null),!0===t.p.cellEdit&&0<=parseInt(t.p.iCol,10)&&0<=parseInt(t.p.iRow,10)&&(b("td:eq("+t.p.iCol+")",t.rows[t.p.iRow]).removeClass("edit-cell ui-state-highlight"),b(t.rows[t.p.iRow]).removeClass("selected-row ui-state-hover")),t.p.savedRow=[]})},getRowData:function(e){var t={},n,r=!1,i,s=0;return this.each(function(){var o=this,u,f;if(void 0===e)r=!0,n=[],i=o.rows.length;else{f=b(o).jqGrid("getGridRowById",e);if(!f)return t;i=2}for(;s<i;)r&&(f=o.rows[s]),b(f).hasClass("jqgrow")&&(b('td[role="gridcell"]',f).each(function(e){u=o.p.colModel[e].name;if("cb"!==u&&"subgrid"!==u&&"rn"!==u)if(!0===o.p.treeGrid&&u===o.p.ExpandColumn)t[u]=b.jgrid.htmlDecode(b("span:first",this).html());else try{t[u]=b.unformat.call(o,this,{rowId:f.id,colModel:o.p.colModel[e]},e)}catch(n){t[u]=b.jgrid.htmlDecode(b(this).html())}}),r&&(n.push(t),t={})),s++}),n||t},delRowData:function(e){var t=!1,n,r;return this.each(function(){n=b(this).jqGrid("getGridRowById",e);if(!n)return!1;b(n).remove(),this.p.records--,this.p.reccount--,this.updatepager(!0,!1),t=!0,this.p.multiselect&&(r=b.inArray(e,this.p.selarrrow),-1!==r&&this.p.selarrrow.splice(r,1)),this.p.selrow=this.p.multiselect&&0<this.p.selarrrow.length?this.p.selarrrow[this.p.selarrrow.length-1]:null;if("local"===this.p.datatype){var i=this.p._index[b.jgrid.stripPref(this.p.idPrefix,e)];void 0!==i&&(this.p.data.splice(i,1),this.refreshIndex())}if(!0===this.p.altRows&&t){var s=this.p.altclass;b(this.rows).each(function(e){e%2===1?b(this).addClass(s):b(this).removeClass(s)})}}),t},setRowData:function(e,t,n){var r,i=!0,s;return this.each(function(){if(!this.grid)return!1;var o=this,u,f,l=typeof n,h={};f=b(this).jqGrid("getGridRowById",e);if(!f)return!1;if(t)try{if(b(this.p.colModel).each(function(n){r=this.name;var i=b.jgrid.getAccessor(t,r);void 0!==i&&(h[r]=this.formatter&&"string"==typeof this.formatter&&"date"===this.formatter?b.unformat.date.call(o,i,this):i,u=o.formatter(e,i,n,t,"edit"),s=this.title?{title:b.jgrid.stripHtml(u)}:{},!0===o.p.treeGrid&&r===o.p.ExpandColumn?b("td[role='gridcell']:eq("+n+") > span:first",f).html(u).attr(s):b("td[role='gridcell']:eq("+n+")",f).html(u).attr(s))}),"local"===o.p.datatype){var p=b.jgrid.stripPref(o.p.idPrefix,e),v=o.p._index[p],m;if(o.p.treeGrid)for(m in o.p.treeReader)o.p.treeReader.hasOwnProperty(m)&&delete h[o.p.treeReader[m]];void 0!==v&&(o.p.data[v]=b.extend(!0,o.p.data[v],h)),h=null}}catch(y){i=!1}i&&("string"===l?b(f).addClass(n):"object"===l&&b(f).css(n),b(o).triggerHandler("jqGridAfterGridComplete"))}),i},addRowData:function(e,t,n,r){n||(n="last");var i=!1,s,o,u,a,f,l,c,h,p="",d,v,m,g,y,w;return t&&(b.isArray(t)?(d=!0,n="last",v=e):(t=[t],d=!1),this.each(function(){var S=t.length;f=this.p.rownumbers===!0?1:0,u=this.p.multiselect===!0?1:0,a=this.p.subGrid===!0?1:0,d||(e!==void 0?e=""+e:(e=b.jgrid.randId(),this.p.keyIndex!==!1&&(v=this.p.colModel[this.p.keyIndex+u+a+f].name,t[0][v]!==void 0&&(e=t[0][v])))),m=this.p.altclass;for(var x=0,N="",C={},A=b.isFunction(this.p.afterInsertRow)?!0:!1;x<S;){g=t[x],o=[];if(d){try{e=g[v],e===void 0&&(e=b.jgrid.randId())}catch(O){e=b.jgrid.randId()}N=this.p.altRows===!0?(this.rows.length-1)%2===0?m:"":""}w=e,e=this.p.idPrefix+e,f&&(p=this.formatCol(0,1,"",null,e,!0),o[o.length]='<td role="gridcell" class="ui-state-default jqgrid-rownum" '+p+">0</td>"),u&&(h='<input role="checkbox" type="checkbox" id="jqg_'+this.p.id+"_"+e+'" class="cbox"/>',p=this.formatCol(f,1,"",null,e,!0),o[o.length]='<td role="gridcell" '+p+">"+h+"</td>"),a&&(o[o.length]=b(this).jqGrid("addSubGridCell",u+f,1));for(c=u+a+f;c<this.p.colModel.length;c++)y=this.p.colModel[c],s=y.name,C[s]=g[s],h=this.formatter(e,b.jgrid.getAccessor(g,s),c,g),p=this.formatCol(c,1,h,g,e,C),o[o.length]='<td role="gridcell" '+p+">"+h+"</td>";o.unshift(this.constructTr(e,!1,N,C,g,!1)),o[o.length]="</tr>";if(this.rows.length===0)b("table:first",this.grid.bDiv).append(o.join(""));else switch(n){case"last":b(this.rows[this.rows.length-1]).after(o.join("")),l=this.rows.length-1;break;case"first":b(this.rows[0]).after(o.join("")),l=1;break;case"after":if(l=b(this).jqGrid("getGridRowById",r))b(this.rows[l.rowIndex+1]).hasClass("ui-subgrid")?b(this.rows[l.rowIndex+1]).after(o):b(l).after(o.join("")),l=l.rowIndex+1;break;case"before":if(l=b(this).jqGrid("getGridRowById",r))b(l).before(o.join("")),l=l.rowIndex-1}this.p.subGrid===!0&&b(this).jqGrid("addSubGrid",u+f,l),this.p.records++,this.p.reccount++,b(this).triggerHandler("jqGridAfterInsertRow",[e,g,g]),A&&this.p.afterInsertRow.call(this,e,g,g),x++,this.p.datatype==="local"&&(C[this.p.localReader.id]=w,this.p._index[w]=this.p.data.length,this.p.data.push(C),C={})}this.p.altRows===!0&&!d&&(n==="last"?(this.rows.length-1)%2===1&&b(this.rows[this.rows.length-1]).addClass(m):b(this.rows).each(function(e){e%2===1?b(this).addClass(m):b(this).removeClass(m)})),this.updatepager(!0,!0),i=!0})),i},footerData:function(e,t,n){function r(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}var i,s=!1,o={},u;return void 0===e&&(e="get"),"boolean"!=typeof n&&(n=!0),e=e.toLowerCase(),this.each(function(){var l=this,p;if(!l.grid||!l.p.footerrow||"set"===e&&r(t))return!1;s=!0,b(this.p.colModel).each(function(r){i=this.name,"set"===e?void 0!==t[i]&&(p=n?l.formatter("",t[i],r,t,"edit"):t[i],u=this.title?{title:b.jgrid.stripHtml(p)}:{},b("tr.footrow td:eq("+r+")",l.grid.sDiv).html(p).attr(u),s=!0):"get"===e&&(o[i]=b("tr.footrow td:eq("+r+")",l.grid.sDiv).html())})}),"get"===e?o:s},showHideCol:function(e,t){return this.each(function(){var n=this,r=!1,i=b.jgrid.cell_width?0:n.p.cellLayout,s;if(n.grid){"string"==typeof e&&(e=[e]),t="none"!==t?"":"none";var o=""===t?!0:!1,u=n.p.groupHeader&&("object"==typeof n.p.groupHeader||b.isFunction(n.p.groupHeader));u&&b(n).jqGrid("destroyGroupHeader",!1),b(this.p.colModel).each(function(u){if(-1!==b.inArray(this.name,e)&&this.hidden===o){if(!0===n.p.frozenColumns&&!0===this.frozen)return!0;b("tr[role=rowheader]",n.grid.hDiv).each(function(){b(this.cells[u]).css("display",t)}),b(n.rows).each(function(){b(this).hasClass("jqgroup")||b(this.cells[u]).css("display",t)}),n.p.footerrow&&b("tr.footrow td:eq("+u+")",n.grid.sDiv).css("display",t),s=parseInt(this.width,10),n.p.tblwidth="none"===t?n.p.tblwidth-(s+i):n.p.tblwidth+(s+i),this.hidden=!o,r=!0,b(n).triggerHandler("jqGridShowHideCol",[o,this.name,u])}}),!0===r&&(!0===n.p.shrinkToFit&&!isNaN(n.p.height)&&(n.p.tblwidth+=parseInt(n.p.scrollOffset,10)),b(n).jqGrid("setGridWidth",!0===n.p.shrinkToFit?n.p.tblwidth:n.p.width)),u&&b(n).jqGrid("setGroupHeaders",n.p.groupHeader)}})},hideCol:function(e){return this.each(function(){b(this).jqGrid("showHideCol",e,"none")})},showCol:function(e){return this.each(function(){b(this).jqGrid("showHideCol",e,"")})},remapColumns:function(e,t,n){function r(t){var n;n=t.length?b.makeArray(t):b.extend({},t),b.each(e,function(e){t[e]=n[this]})}function i(t,n){b(">tr"+(n||""),t).each(function(){var t=this,n=b.makeArray(t.cells);b.each(e,function(){var e=n[this];e&&t.appendChild(e)})})}var s=this.get(0);r(s.p.colModel),r(s.p.colNames),r(s.grid.headers),i(b("thead:first",s.grid.hDiv),n&&":not(.ui-jqgrid-labels)"),t&&i(b("#"+b.jgrid.jqID(s.p.id)+" tbody:first"),".jqgfirstrow, tr.jqgrow, tr.jqfoot"),s.p.footerrow&&i(b("tbody:first",s.grid.sDiv)),s.p.remapColumns&&(s.p.remapColumns.length?r(s.p.remapColumns):s.p.remapColumns=b.makeArray(e)),s.p.lastsort=b.inArray(s.p.lastsort,e),s.p.treeGrid&&(s.p.expColInd=b.inArray(s.p.expColInd,e)),b(s).triggerHandler("jqGridRemapColumns",[e,t,n])},setGridWidth:function(e,t){return this.each(function(){if(this.grid){var n=this,r,i=0,s=b.jgrid.cell_width?0:n.p.cellLayout,o,u=0,a=!1,f=n.p.scrollOffset,l,c=0,h;"boolean"!=typeof t&&(t=n.p.shrinkToFit);if(!isNaN(e)){e=parseInt(e,10),n.grid.width=n.p.width=e,b("#gbox_"+b.jgrid.jqID(n.p.id)).css("width",e+"px"),b("#gview_"+b.jgrid.jqID(n.p.id)).css("width",e+"px"),b(n.grid.bDiv).css("width",e+"px"),b(n.grid.hDiv).css("width",e+"px"),n.p.pager&&b(n.p.pager).css("width",e+"px"),n.p.toppager&&b(n.p.toppager).css("width",e+"px"),!0===n.p.toolbar[0]&&(b(n.grid.uDiv).css("width",e+"px"),"both"===n.p.toolbar[1]&&b(n.grid.ubDiv).css("width",e+"px")),n.p.footerrow&&b(n.grid.sDiv).css("width",e+"px"),!1===t&&!0===n.p.forceFit&&(n.p.forceFit=!1);if(!0===t){b.each(n.p.colModel,function(){this.hidden===!1&&(r=this.widthOrg,i+=r+s,this.fixed?c+=r+s:u++)});if(0===u)return;n.p.tblwidth=i,l=e-s*u-c,!isNaN(n.p.height)&&(b(n.grid.bDiv)[0].clientHeight<b(n.grid.bDiv)[0].scrollHeight||1===n.rows.length)&&(a=!0,l-=f);var i=0,p=0<n.grid.cols.length;b.each(n.p.colModel,function(e){this.hidden===!1&&!this.fixed&&(r=this.widthOrg,r=Math.round(l*r/(n.p.tblwidth-s*u-c)),r<0||(this.width=r,i+=r,n.grid.headers[e].width=r,n.grid.headers[e].el.style.width=r+"px",n.p.footerrow&&(n.grid.footers[e].style.width=r+"px"),p&&(n.grid.cols[e].style.width=r+"px"),o=e))});if(!o)return;h=0,a?e-c-(i+s*u)!==f&&(h=e-c-(i+s*u)-f):1!==Math.abs(e-c-(i+s*u))&&(h=e-c-(i+s*u)),n.p.colModel[o].width+=h,n.p.tblwidth=i+h+s*u+c,n.p.tblwidth>e?(a=n.p.tblwidth-parseInt(e,10),n.p.tblwidth=e,r=n.p.colModel[o].width-=a):r=n.p.colModel[o].width,n.grid.headers[o].width=r,n.grid.headers[o].el.style.width=r+"px",p&&(n.grid.cols[o].style.width=r+"px"),n.p.footerrow&&(n.grid.footers[o].style.width=r+"px")}n.p.tblwidth&&(b("table:first",n.grid.bDiv).css("width",n.p.tblwidth+"px"),b("table:first",n.grid.hDiv).css("width",n.p.tblwidth+"px"),n.grid.hDiv.scrollLeft=n.grid.bDiv.scrollLeft,n.p.footerrow&&b("table:first",n.grid.sDiv).css("width",n.p.tblwidth+"px"))}}})},setGridHeight:function(e){return this.each(function(){if(this.grid){var t=b(this.grid.bDiv);t.css({height:e+(isNaN(e)?"":"px")}),!0===this.p.frozenColumns&&b("#"+b.jgrid.jqID(this.p.id)+"_frozen").parent().height(t.height()-16),this.p.height=e,this.p.scroll&&this.grid.populateVisible()}})},setCaption:function(e){return this.each(function(){this.p.caption=e,b("span.ui-jqgrid-title, span.ui-jqgrid-title-rtl",this.grid.cDiv).html(e),b(this.grid.cDiv).show()})},setLabel:function(e,t,n,r){return this.each(function(){var i=-1;if(this.grid&&void 0!==e&&(b(this.p.colModel).each(function(t){if(this.name===e)return i=t,!1}),0<=i)){var s=b("tr.ui-jqgrid-labels th:eq("+i+")",this.grid.hDiv);if(t){var o=b(".s-ico",s);b("[id^=jqgh_]",s).empty().html(t).append(o),this.p.colNames[i]=t}n&&("string"==typeof n?b(s).addClass(n):b(s).css(n)),"object"==typeof r&&b(s).attr(r)}})},setCell:function(e,t,n,r,i,s){return this.each(function(){var o=-1,u,f;if(this.grid&&(isNaN(t)?b(this.p.colModel).each(function(e){if(this.name===t)return o=e,!1}):o=parseInt(t,10),0<=o&&(u=b(this).jqGrid("getGridRowById",e)))){var l=b("td:eq("+o+")",u);if(""!==n||!0===s)u=this.formatter(e,n,o,u,"edit"),f=this.p.colModel[o].title?{title:b.jgrid.stripHtml(u)}:{},this.p.treeGrid&&0<b(".tree-wrap",b(l)).length?b("span",b(l)).html(u).attr(f):b(l).html(u).attr(f),"local"===this.p.datatype&&(u=this.p.colModel[o],n=u.formatter&&"string"==typeof u.formatter&&"date"===u.formatter?b.unformat.date.call(this,n,u):n,f=this.p._index[b.jgrid.stripPref(this.p.idPrefix,e)],void 0!==f&&(this.p.data[f][u.name]=n));"string"==typeof r?b(l).addClass(r):r&&b(l).css(r),"object"==typeof i&&b(l).attr(i)}})},getCell:function(e,t){var n=!1;return this.each(function(){var r=-1;if(this.grid&&(isNaN(t)?b(this.p.colModel).each(function(e){if(this.name===t)return r=e,!1}):r=parseInt(t,10),0<=r)){var i=b(this).jqGrid("getGridRowById",e);if(i)try{n=b.unformat.call(this,b("td:eq("+r+")",i),{rowId:i.id,colModel:this.p.colModel[r]},r)}catch(s){n=b.jgrid.htmlDecode(b("td:eq("+r+")",i).html())}}}),n},getCol:function(e,t,n){var r=[],i,s=0,o,u,a,t="boolean"!=typeof t?!1:t;return void 0===n&&(n=!1),this.each(function(){var l=-1;if(this.grid&&(isNaN(e)?b(this.p.colModel).each(function(t){if(this.name===e)return l=t,!1}):l=parseInt(e,10),0<=l)){var p=this.rows.length,v=0,m=0;if(p&&0<p){for(;v<p;){if(b(this.rows[v]).hasClass("jqgrow")){try{i=b.unformat.call(this,b(this.rows[v].cells[l]),{rowId:this.rows[v].id,colModel:this.p.colModel[l]},l)}catch(y){i=b.jgrid.htmlDecode(this.rows[v].cells[l].innerHTML)}n?(a=parseFloat(i),isNaN(a)||(s+=a,void 0===u&&(u=o=a),o=Math.min(o,a),u=Math.max(u,a),m++)):t?r.push({id:this.rows[v].id,value:i}):r.push(i)}v++}if(n)switch(n.toLowerCase()){case"sum":r=s;break;case"avg":r=s/m;break;case"count":r=p-1;break;case"min":r=o;break;case"max":r=u}}}}),r},clearGridData:function(e){return this.each(function(){if(this.grid){"boolean"!=typeof e&&(e=!1);if(this.p.deepempty)b("#"+b.jgrid.jqID(this.p.id)+" tbody:first tr:gt(0)").remove();else{var t=b("#"+b.jgrid.jqID(this.p.id)+" tbody:first tr:first")[0];b("#"+b.jgrid.jqID(this.p.id)+" tbody:first").empty().append(t)}this.p.footerrow&&e&&b(".ui-jqgrid-ftable td",this.grid.sDiv).html("&#160;"),this.p.selrow=null,this.p.selarrrow=[],this.p.savedRow=[],this.p.records=0,this.p.page=1,this.p.lastpage=0,this.p.reccount=0,this.p.data=[],this.p._index={},this.updatepager(!0,!1)}})},getInd:function(e,t){var n=!1,r;return this.each(function(){(r=b(this).jqGrid("getGridRowById",e))&&(n=!0===t?r:r.rowIndex)}),n},bindKeys:function(e){var t=b.extend({onEnter:null,onSpace:null,onLeftKey:null,onRightKey:null,scrollingRows:!0},e||{});return this.each(function(){var e=this;b("body").is("[role]")||b("body").attr("role","application"),e.p.scrollrows=t.scrollingRows,b(e).keydown(function(n){var r=b(e).find("tr[tabindex=0]")[0],i,s,o,u=e.p.treeReader.expanded_field;if(r)if(o=e.p._index[b.jgrid.stripPref(e.p.idPrefix,r.id)],37===n.keyCode||38===n.keyCode||39===n.keyCode||40===n.keyCode){if(38===n.keyCode){s=r.previousSibling,i="";if(s)if(b(s).is(":hidden")){for(;s;)if(s=s.previousSibling,!b(s).is(":hidden")&&b(s).hasClass("jqgrow")){i=s.id;break}}else i=s.id;b(e).jqGrid("setSelection",i,!0,n),n.preventDefault()}if(40===n.keyCode){s=r.nextSibling,i="";if(s)if(b(s).is(":hidden")){for(;s;)if(s=s.nextSibling,!b(s).is(":hidden")&&b(s).hasClass("jqgrow")){i=s.id;break}}else i=s.id;b(e).jqGrid("setSelection",i,!0,n),n.preventDefault()}37===n.keyCode&&(e.p.treeGrid&&e.p.data[o][u]&&b(r).find("div.treeclick").trigger("click"),b(e).triggerHandler("jqGridKeyLeft",[e.p.selrow]),b.isFunction(t.onLeftKey)&&t.onLeftKey.call(e,e.p.selrow)),39===n.keyCode&&(e.p.treeGrid&&!e.p.data[o][u]&&b(r).find("div.treeclick").trigger("click"),b(e).triggerHandler("jqGridKeyRight",[e.p.selrow]),b.isFunction(t.onRightKey)&&t.onRightKey.call(e,e.p.selrow))}else 13===n.keyCode?(b(e).triggerHandler("jqGridKeyEnter",[e.p.selrow]),b.isFunction(t.onEnter)&&t.onEnter.call(e,e.p.selrow)):32===n.keyCode&&(b(e).triggerHandler("jqGridKeySpace",[e.p.selrow]),b.isFunction(t.onSpace)&&t.onSpace.call(e,e.p.selrow))})})},unbindKeys:function(){return this.each(function(){b(this).unbind("keydown")})},getLocalRow:function(e){var t=!1,n;return this.each(function(){void 0!==e&&(n=this.p._index[b.jgrid.stripPref(this.p.idPrefix,e)],0<=n&&(t=this.p.data[n]))}),t}})}(jQuery),function(e){e.fmatter={},e.extend(e.fmatter,{isBoolean:function(e){return"boolean"==typeof e},isObject:function(t){return t&&("object"==typeof t||e.isFunction(t))||!1},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isValue:function(e){return this.isObject(e)||this.isString(e)||this.isNumber(e)||this.isBoolean(e)},isEmpty:function(t){return!this.isString(t)&&this.isValue(t)?!1:this.isValue(t)?(t=e.trim(t).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,""),""===t):!0}}),e.fn.fmatter=function(t,n,r,i,s){var o=n,r=e.extend({},e.jgrid.formatter,r);try{o=e.fn.fmatter[t].call(this,n,r,i,s)}catch(u){}return o},e.fmatter.util={NumberFormat:function(t,n){e.fmatter.isNumber(t)||(t*=1);if(e.fmatter.isNumber(t)){var r=0>t,i=""+t,s=n.decimalSeparator||".",o;if(e.fmatter.isNumber(n.decimalPlaces)){var u=n.decimalPlaces,i=Math.pow(10,u),i=""+Math.round(t*i)/i;o=i.lastIndexOf(".");if(0<u){0>o?(i+=s,o=i.length-1):"."!==s&&(i=i.replace(".",s));for(;i.length-1-o<u;)i+="0"}}if(n.thousandsSeparator){u=n.thousandsSeparator,o=i.lastIndexOf(s),o=-1<o?o:i.length;var s=i.substring(o),f=-1,l;for(l=o;0<l;l--)f++,0===f%3&&l!==o&&(!r||1<l)&&(s=u+s),s=i.charAt(l-1)+s;i=s}return i=n.prefix?n.prefix+i:i,i=n.suffix?i+n.suffix:i}return t}},e.fn.fmatter.defaultFormat=function(t,n){return e.fmatter.isValue(t)&&""!==t?t:n.defaultValue||"&#160;"},e.fn.fmatter.email=function(t,n){return e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):'<a href="mailto:'+t+'">'+t+"</a>"},e.fn.fmatter.checkbox=function(t,n){var r=e.extend({},n.checkbox),i;void 0!==n.colModel&&void 0!==n.colModel.formatoptions&&(r=e.extend({},r,n.colModel.formatoptions)),i=!0===r.disabled?'disabled="disabled"':"";if(e.fmatter.isEmpty(t)||void 0===t)t=e.fn.fmatter.defaultFormat(t,r);return t=(""+t+"").toLowerCase(),'<input type="checkbox" '+(0>t.search(/(false|f|0|no|n|off|undefined)/i)?" checked='checked' ":"")+' value="'+t+'" offval="no" '+i+"/>"},e.fn.fmatter.link=function(t,n){var r={target:n.target},i="";return void 0!==n.colModel&&void 0!==n.colModel.formatoptions&&(r=e.extend({},r,n.colModel.formatoptions)),r.target&&(i="target="+r.target),e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):"<a "+i+' href="'+t+'">'+t+"</a>"},e.fn.fmatter.showlink=function(t,n){var r={baseLinkUrl:n.baseLinkUrl,showAction:n.showAction,addParam:n.addParam||"",target:n.target,idName:n.idName},i="";return void 0!==n.colModel&&void 0!==n.colModel.formatoptions&&(r=e.extend({},r,n.colModel.formatoptions)),r.target&&(i="target="+r.target),r=r.baseLinkUrl+r.showAction+"?"+r.idName+"="+n.rowId+r.addParam,e.fmatter.isString(t)||e.fmatter.isNumber(t)?"<a "+i+' href="'+r+'">'+t+"</a>":e.fn.fmatter.defaultFormat(t,n)},e.fn.fmatter.integer=function(t,n){var r=e.extend({},n.integer);return void 0!==n.colModel&&void 0!==n.colModel.formatoptions&&(r=e.extend({},r,n.colModel.formatoptions)),e.fmatter.isEmpty(t)?r.defaultValue:e.fmatter.util.NumberFormat(t,r)},e.fn.fmatter.number=function(t,n){var r=e.extend({},n.number);return void 0!==n.colModel&&void 0!==n.colModel.formatoptions&&(r=e.extend({},r,n.colModel.formatoptions)),e.fmatter.isEmpty(t)?r.defaultValue:e.fmatter.util.NumberFormat(t,r)},e.fn.fmatter.currency=function(t,n){var r=e.extend({},n.currency);return void 0!==n.colModel&&void 0!==n.colModel.formatoptions&&(r=e.extend({},r,n.colModel.formatoptions)),e.fmatter.isEmpty(t)?r.defaultValue:e.fmatter.util.NumberFormat(t,r)},e.fn.fmatter.date=function(t,n,r,i){return r=e.extend({},n.date),void 0!==n.colModel&&void 0!==n.colModel.formatoptions&&(r=e.extend({},r,n.colModel.formatoptions)),!r.reformatAfterEdit&&"edit"===i?e.fn.fmatter.defaultFormat(t,n):e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):e.jgrid.parseDate(r.srcformat,t,r.newformat,r)},e.fn.fmatter.select=function(t,n){var t=""+t,r=!1,i=[],s,o;void 0!==n.colModel.formatoptions?(r=n.colModel.formatoptions.value,s=void 0===n.colModel.formatoptions.separator?":":n.colModel.formatoptions.separator,o=void 0===n.colModel.formatoptions.delimiter?";":n.colModel.formatoptions.delimiter):void 0!==n.colModel.editoptions&&(r=n.colModel.editoptions.value,s=void 0===n.colModel.editoptions.separator?":":n.colModel.editoptions.separator,o=void 0===n.colModel.editoptions.delimiter?";":n.colModel.editoptions.delimiter);if(r){var u=!0===n.colModel.editoptions.multiple?!0:!1,f=[];u&&(f=t.split(","),f=e.map(f,function(t){return e.trim(t)}));if(e.fmatter.isString(r)){var l=r.split(o),c=0,h;for(h=0;h<l.length;h++)if(o=l[h].split(s),2<o.length&&(o[1]=e.map(o,function(e,t){if(t>0)return e}).join(s)),u)-1<e.inArray(o[0],f)&&(i[c]=o[1],c++);else if(e.trim(o[0])===e.trim(t)){i[0]=o[1];break}}else e.fmatter.isObject(r)&&(u?i=e.map(f,function(e){return r[e]}):i[0]=r[t]||"")}return t=i.join(", "),""===t?e.fn.fmatter.defaultFormat(t,n):t},e.fn.fmatter.rowactions=function(t){var n=e(this).closest("tr.jqgrow"),r=n.attr("id"),i=e(this).closest("table.ui-jqgrid-btable").attr("id").replace(/_frozen([^_]*)$/,"$1"),i=e("#"+i),s=i[0],o=s.p,u=o.colModel[e.jgrid.getCellIndex(this)],f=u.frozen?e("tr#"+r+" td:eq("+e.jgrid.getCellIndex(this)+") > div",i):e(this).parent(),l={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null,restoreAfterError:!0,mtype:"POST",delOptions:{},editOptions:{}},c=function(t){e.isFunction(l.afterRestore)&&l.afterRestore.call(s,t),f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide()};void 0!==u.formatoptions&&(l=e.extend(l,u.formatoptions)),void 0!==o.editOptions&&(l.editOptions=o.editOptions),void 0!==o.delOptions&&(l.delOptions=o.delOptions),n.hasClass("jqgrid-new-row")&&(l.extraparam[o.prmNames.oper]=o.prmNames.addoper),n={keys:l.keys,oneditfunc:l.onEdit,successfunc:l.onSuccess,url:l.url,extraparam:l.extraparam,aftersavefunc:function(t,n){e.isFunction(l.afterSave)&&l.afterSave.call(s,t,n),f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide()},errorfunc:l.onError,afterrestorefunc:c,restoreAfterError:l.restoreAfterError,mtype:l.mtype};switch(t){case"edit":i.jqGrid("editRow",r,n),f.find("div.ui-inline-edit,div.ui-inline-del").hide(),f.find("div.ui-inline-save,div.ui-inline-cancel").show(),i.triggerHandler("jqGridAfterGridComplete");break;case"save":i.jqGrid("saveRow",r,n)&&(f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide(),i.triggerHandler("jqGridAfterGridComplete"));break;case"cancel":i.jqGrid("restoreRow",r,c),f.find("div.ui-inline-edit,div.ui-inline-del").show(),f.find("div.ui-inline-save,div.ui-inline-cancel").hide(),i.triggerHandler("jqGridAfterGridComplete");break;case"del":i.jqGrid("delGridRow",r,l.delOptions);break;case"formedit":i.jqGrid("setSelection",r),i.jqGrid("editGridRow",r,l.editOptions)}},e.fn.fmatter.actions=function(t,n){var r={keys:!1,editbutton:!0,delbutton:!0,editformbutton:!1},i=n.rowId,s="";return void 0!==n.colModel.formatoptions&&(r=e.extend(r,n.colModel.formatoptions)),void 0===i||e.fmatter.isEmpty(i)?"":(r.editformbutton?s+="<div title='"+e.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+("id='jEditButton_"+i+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'formedit'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ")+"><span class='ui-icon ui-icon-pencil'></span></div>":r.editbutton&&(s+="<div title='"+e.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+("id='jEditButton_"+i+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'edit'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover') ")+"><span class='ui-icon ui-icon-pencil'></span></div>"),r.delbutton&&(s+="<div title='"+e.jgrid.nav.deltitle+"' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' "+("id='jDeleteButton_"+i+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'del'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ")+"><span class='ui-icon ui-icon-trash'></span></div>"),s+="<div title='"+e.jgrid.edit.bSubmit+"' style='float:left;display:none' class='ui-pg-div ui-inline-save' "+("id='jSaveButton_"+i+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'save'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ")+"><span class='ui-icon ui-icon-disk'></span></div>",s+="<div title='"+e.jgrid.edit.bCancel+"' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel' "+("id='jCancelButton_"+i+"' onclick=jQuery.fn.fmatter.rowactions.call(this,'cancel'); onmouseover=jQuery(this).addClass('ui-state-hover'); onmouseout=jQuery(this).removeClass('ui-state-hover'); ")+"><span class='ui-icon ui-icon-cancel'></span></div>","<div style='margin-left:8px;'>"+s+"</div>")},e.unformat=function(t,n,r,i){var s,o=n.colModel.formatter,u=n.colModel.formatoptions||{},f=/([\.\*\_\'\(\)\{\}\+\?\\])/g,l=n.colModel.unformat||e.fn.fmatter[o]&&e.fn.fmatter[o].unformat;if(void 0!==l&&e.isFunction(l))s=l.call(this,e(t).text(),n,t);else if(void 0!==o&&e.fmatter.isString(o))switch(s=e.jgrid.formatter||{},o){case"integer":u=e.extend({},s.integer,u),n=u.thousandsSeparator.replace(f,"\\$1"),s=e(t).text().replace(RegExp(n,"g"),"");break;case"number":u=e.extend({},s.number,u),n=u.thousandsSeparator.replace(f,"\\$1"),s=e(t).text().replace(RegExp(n,"g"),"").replace(u.decimalSeparator,".");break;case"currency":u=e.extend({},s.currency,u),n=u.thousandsSeparator.replace(f,"\\$1"),n=RegExp(n,"g"),s=e(t).text(),u.prefix&&u.prefix.length&&(s=s.substr(u.prefix.length)),u.suffix&&u.suffix.length&&(s=s.substr(0,s.length-u.suffix.length)),s=s.replace(n,"").replace(u.decimalSeparator,".");break;case"checkbox":u=n.colModel.editoptions?n.colModel.editoptions.value.split(":"):["Yes","No"],s=e("input",t).is(":checked")?u[0]:u[1];break;case"select":s=e.unformat.select(t,n,r,i);break;case"actions":return"";default:s=e(t).text()}return void 0!==s?s:!0===i?e(t).text():e.jgrid.htmlDecode(e(t).html())},e.unformat.select=function(t,n,r,i){r=[],t=e(t).text();if(!0===i)return t;var i=e.extend({},void 0!==n.colModel.formatoptions?n.colModel.formatoptions:n.colModel.editoptions),n=void 0===i.separator?":":i.separator,s=void 0===i.delimiter?";":i.delimiter;if(i.value){var o=i.value,i=!0===i.multiple?!0:!1,u=[];i&&(u=t.split(","),u=e.map(u,function(t){return e.trim(t)}));if(e.fmatter.isString(o)){var f=o.split(s),l=0,c;for(c=0;c<f.length;c++)if(s=f[c].split(n),2<s.length&&(s[1]=e.map(s,function(e,t){if(t>0)return e}).join(n)),i)-1<e.inArray(s[1],u)&&(r[l]=s[0],l++);else if(e.trim(s[1])===e.trim(t)){r[0]=s[0];break}}else if(e.fmatter.isObject(o)||e.isArray(o))i||(u[0]=t),r=e.map(u,function(t){var n;e.each(o,function(e,r){if(r===t)return n=e,!1});if(n!==void 0)return n});return r.join(", ")}return t||""},e.unformat.date=function(t,n){var r=e.jgrid.formatter.date||{};return void 0!==n.formatoptions&&(r=e.extend({},r,n.formatoptions)),e.fmatter.isEmpty(t)?e.fn.fmatter.defaultFormat(t,n):e.jgrid.parseDate(r.newformat,t,r.srcformat,r)}}(jQuery),function(e){e.jgrid.extend({getColProp:function(e){var t={},n=this[0];if(!n.grid)return!1;var n=n.p.colModel,r;for(r=0;r<n.length;r++)if(n[r].name===e){t=n[r];break}return t},setColProp:function(t,n){return this.each(function(){if(this.grid&&n){var r=this.p.colModel,i;for(i=0;i<r.length;i++)if(r[i].name===t){e.extend(!0,this.p.colModel[i],n);break}}})},sortGrid:function(e,t,n){return this.each(function(){var r=-1,i,s=!1;if(this.grid){e||(e=this.p.sortname);for(i=0;i<this.p.colModel.length;i++)if(this.p.colModel[i].index===e||this.p.colModel[i].name===e){r=i,!0===this.p.frozenColumns&&!0===this.p.colModel[i].frozen&&(s=this.grid.fhDiv.find("#"+this.p.id+"_"+e));break}-1!==r&&(i=this.p.colModel[r].sortable,"boolean"!=typeof i&&(i=!0),"boolean"!=typeof t&&(t=!1),i&&this.sortData("jqgh_"+this.p.id+"_"+e,r,t,n,s))}})},clearBeforeUnload:function(){return this.each(function(){var t=this.grid;t.emptyRows.call(this,!0,!0),e(document).unbind("mouseup.jqGrid"+this.p.id),e(t.hDiv).unbind("mousemove"),e(this).unbind(),t.dragEnd=null,t.dragMove=null,t.dragStart=null,t.emptyRows=null,t.populate=null,t.populateVisible=null,t.scrollGrid=null,t.selectionPreserver=null,t.bDiv=null,t.cDiv=null,t.hDiv=null,t.cols=null;var n,r=t.headers.length;for(n=0;n<r;n++)t.headers[n].el=null;this.addJSONData=this.addXmlData=this.formatter=this.constructTr=this.setHeadCheckBox=this.refreshIndex=this.updatepager=this.sortData=this.formatCol=null})},GridDestroy:function(){return this.each(function(){if(this.grid){this.p.pager&&e(this.p.pager).remove();try{e(this).jqGrid("clearBeforeUnload"),e("#gbox_"+e.jgrid.jqID(this.id)).remove()}catch(t){}}})},GridUnload:function(){return this.each(function(){if(this.grid){var t=e(this).attr("id"),n=e(this).attr("class");this.p.pager&&e(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom");var r=document.createElement("table");e(r).attr({id:t}),r.className=n,t=e.jgrid.jqID(this.id),e(r).removeClass("ui-jqgrid-btable"),1===e(this.p.pager).parents("#gbox_"+t).length?(e(r).insertBefore("#gbox_"+t).show(),e(this.p.pager).insertBefore("#gbox_"+t)):e(r).insertBefore("#gbox_"+t).show(),e(this).jqGrid("clearBeforeUnload"),e("#gbox_"+t).remove()}})},setGridState:function(t){return this.each(function(){this.grid&&("hidden"===t?(e(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+e.jgrid.jqID(this.p.id)).slideUp("fast"),this.p.pager&&e(this.p.pager).slideUp("fast"),this.p.toppager&&e(this.p.toppager).slideUp("fast"),!0===this.p.toolbar[0]&&("both"===this.p.toolbar[1]&&e(this.grid.ubDiv).slideUp("fast"),e(this.grid.uDiv).slideUp("fast")),this.p.footerrow&&e(".ui-jqgrid-sdiv","#gbox_"+e.jgrid.jqID(this.p.id)).slideUp("fast"),e(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),this.p.gridstate="hidden"):"visible"===t&&(e(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+e.jgrid.jqID(this.p.id)).slideDown("fast"),this.p.pager&&e(this.p.pager).slideDown("fast"),this.p.toppager&&e(this.p.toppager).slideDown("fast"),!0===this.p.toolbar[0]&&("both"===this.p.toolbar[1]&&e(this.grid.ubDiv).slideDown("fast"),e(this.grid.uDiv).slideDown("fast")),this.p.footerrow&&e(".ui-jqgrid-sdiv","#gbox_"+e.jgrid.jqID(this.p.id)).slideDown("fast"),e(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),this.p.gridstate="visible"))})},filterToolbar:function(t){return t=e.extend({autosearch:!0,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw",searchOperators:!1,operandTitle:"Click to select search operation.",operands:{eq:"==",ne:"!",lt:"<",le:"<=",gt:">",ge:">=",bw:"^",bn:"!^","in":"=",ni:"!=",ew:"|",en:"!@",cn:"~",nc:"!~",nu:"#",nn:"!#"}},e.jgrid.search,t||{}),this.each(function(){var n=this;if(!this.ftoolbar){var r=function(){var r={},i=0,s,o,u={},f;e.each(n.p.colModel,function(){var l=e("#gs_"+e.jgrid.jqID(this.name),!0===this.frozen&&!0===n.p.frozenColumns?n.grid.fhDiv:n.grid.hDiv);o=this.index||this.name,f=t.searchOperators?l.parent().prev().children("a").attr("soper")||t.defaultSearch:this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"select"===this.stype?"eq":t.defaultSearch;if((s="custom"===this.stype&&e.isFunction(this.searchoptions.custom_value)&&0<l.length&&"SPAN"===l[0].nodeName.toUpperCase()?this.searchoptions.custom_value.call(n,l.children(".customelement:first"),"get"):l.val())||"nu"===f||"nn"===f)r[o]=s,u[o]=f,i++;else try{delete n.p.postData[o]}catch(h){}});var l=0<i?!0:!1;if(!0===t.stringResult||"local"===n.p.datatype){var h='{"groupOp":"'+t.groupOp+'","rules":[',p=0;e.each(r,function(e,t){0<p&&(h+=","),h+='{"field":"'+e+'",',h+='"op":"'+u[e]+'",',h+='"data":"'+(t+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',p++}),h+="]}",e.extend(n.p.postData,{filters:h}),e.each(["searchField","searchString","searchOper"],function(e,t){n.p.postData.hasOwnProperty(t)&&delete n.p.postData[t]})}else e.extend(n.p.postData,r);var d;n.p.searchurl&&(d=n.p.url,e(n).jqGrid("setGridParam",{url:n.p.searchurl}));var v="stop"===e(n).triggerHandler("jqGridToolbarBeforeSearch")?!0:!1;!v&&e.isFunction(t.beforeSearch)&&(v=t.beforeSearch.call(n)),v||e(n).jqGrid("setGridParam",{search:l}).trigger("reloadGrid",[{page:1}]),d&&e(n).jqGrid("setGridParam",{url:d}),e(n).triggerHandler("jqGridToolbarAfterSearch"),e.isFunction(t.afterSearch)&&t.afterSearch.call(n)},i=function(i,s,o){e("#sopt_menu").remove();var s=parseInt(s,10),o=parseInt(o,10)+18,s='<ul id="sopt_menu" class="ui-search-menu" role="menu" tabindex="0" style="font-size:'+(e(".ui-jqgrid-view").css("font-size")||"11px")+";left:"+s+"px;top:"+o+'px;">',o=e(i).attr("soper"),u,f=[],l,h=0,p=e(i).attr("colname");for(u=n.p.colModel.length;h<u&&n.p.colModel[h].name!==p;)h++;h=n.p.colModel[h],p=e.extend({},h.searchoptions),p.sopt||(p.sopt=[],p.sopt[0]="select"===h.stype?"eq":t.defaultSearch),e.each(t.odata,function(){f.push(this.oper)});for(h=0;h<p.sopt.length;h++)l=e.inArray(p.sopt[h],f),-1!==l&&(u=o===t.odata[l].oper?"ui-state-highlight":"",s+='<li class="ui-menu-item '+u+'" role="presentation"><a class="ui-corner-all g-menu-item" tabindex="0" role="menuitem" value="'+t.odata[l].oper+'" oper="'+t.operands[t.odata[l].oper]+'"><table cellspacing="0" cellpadding="0" border="0"><tr><td width="25px">'+t.operands[t.odata[l].oper]+"</td><td>"+t.odata[l].text+"</td></tr></table></a></li>");e("body").append(s+"</ul>"),e("#sopt_menu").addClass("ui-menu ui-widget ui-widget-content ui-corner-all"),e("#sopt_menu > li > a").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).click(function(){var s=e(this).attr("value"),o=e(this).attr("oper");e(n).triggerHandler("jqGridToolbarSelectOper",[s,o,i]),e("#sopt_menu").hide(),e(i).text(o).attr("soper",s),t.autosearch===!0&&(o=e(i).parent().next().children()[0],(e(o).val()||s==="nu"||s==="nn")&&r())})},s=e("<tr class='ui-search-toolbar' role='rowheader'></tr>"),o;e.each(n.p.colModel,function(i){var u=this,f,l;l="";var p="=",d,v=e("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+n.p.direction+"'></th>"),m=e("<div style='position:relative;height:100%;padding-right:0.3em;padding-left:0.3em;'></div>"),g=e("<table class='ui-search-table' cellspacing='0'><tr><td class='ui-search-oper'></td><td class='ui-search-input'></td><td class='ui-search-clear'></td></tr></table>");!0===this.hidden&&e(v).css("display","none"),this.search=!1===this.search?!1:!0,void 0===this.stype&&(this.stype="text"),f=e.extend({},this.searchoptions||{});if(this.search){if(t.searchOperators){l=f.sopt?f.sopt[0]:"select"===u.stype?"eq":t.defaultSearch;for(d=0;d<t.odata.length;d++)if(t.odata[d].oper===l){p=t.operands[l]||"";break}l="<a title='"+(null!=f.searchtitle?f.searchtitle:t.operandTitle)+"' style='padding-right: 0.5em;' soper='"+l+"' class='soptclass' colname='"+this.name+"'>"+p+"</a>"}e("td:eq(0)",g).attr("colindex",i).append(l),void 0===f.clearSearch&&(f.clearSearch=!0),f.clearSearch&&e("td:eq(2)",g).append("<a title='Clear Search Value' style='padding-right: 0.3em;padding-left: 0.3em;' class='clearsearchclass'>x</a>");switch(this.stype){case"select":if(l=this.surl||f.dataUrl)e(m).append(g),e.ajax(e.extend({url:l,dataType:"html",success:function(i){f.buildSelect!==void 0?(i=f.buildSelect(i))&&e("td:eq(1)",g).append(i):e("td:eq(1)",g).append(i),f.defaultValue!==void 0&&e("select",m).val(f.defaultValue),e("select",m).attr({name:u.index||u.name,id:"gs_"+u.name}),f.attr&&e("select",m).attr(f.attr),e("select",m).css({width:"100%"}),e.jgrid.bindEv.call(n,e("select",m)[0],f),t.autosearch===!0&&e("select",m).change(function(){return r(),!1}),i=null}},e.jgrid.ajaxOptions,n.p.ajaxSelectOptions||{}));else{var y,w,E;u.searchoptions?(y=void 0===u.searchoptions.value?"":u.searchoptions.value,w=void 0===u.searchoptions.separator?":":u.searchoptions.separator,E=void 0===u.searchoptions.delimiter?";":u.searchoptions.delimiter):u.editoptions&&(y=void 0===u.editoptions.value?"":u.editoptions.value,w=void 0===u.editoptions.separator?":":u.editoptions.separator,E=void 0===u.editoptions.delimiter?";":u.editoptions.delimiter);if(y){i=document.createElement("select"),i.style.width="100%",e(i).attr({name:u.index||u.name,id:"gs_"+u.name});var S;if("string"==typeof y){l=y.split(E);for(S=0;S<l.length;S++)y=l[S].split(w),E=document.createElement("option"),E.value=y[0],E.innerHTML=y[1],i.appendChild(E)}else if("object"==typeof y)for(S in y)y.hasOwnProperty(S)&&(E=document.createElement("option"),E.value=S,E.innerHTML=y[S],i.appendChild(E));void 0!==f.defaultValue&&e(i).val(f.defaultValue),f.attr&&e(i).attr(f.attr),e(m).append(g),e.jgrid.bindEv.call(n,i,f),e("td:eq(1)",g).append(i),!0===t.autosearch&&e(i).change(function(){return r(),!1})}}break;case"text":w=void 0!==f.defaultValue?f.defaultValue:"",e("td:eq(1)",g).append("<input type='text' style='width:100%;padding:0px;' name='"+(u.index||u.name)+"' id='gs_"+u.name+"' value='"+w+"'/>"),e(m).append(g),f.attr&&e("input",m).attr(f.attr),e.jgrid.bindEv.call(n,e("input",m)[0],f),!0===t.autosearch&&(t.searchOnEnter?e("input",m).keypress(function(e){return(e.charCode||e.keyCode||0)===13?(r(),!1):this}):e("input",m).keydown(function(e){switch(e.which){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:o&&clearTimeout(o),o=setTimeout(function(){r()},500)}}));break;case"custom":e("td:eq(1)",g).append("<span style='width:95%;padding:0px;' name='"+(u.index||u.name)+"' id='gs_"+u.name+"'/>"),e(m).append(g);try{if(!e.isFunction(f.custom_element))throw"e1";var x=f.custom_element.call(n,void 0!==f.defaultValue?f.defaultValue:"",f);if(!x)throw"e2";x=e(x).addClass("customelement"),e(m).find(">span").append(x)}catch(T){"e1"===T&&e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"===T?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,"string"==typeof T?T:T.message,e.jgrid.edit.bClose)}}}e(v).append(m),e(s).append(v),t.searchOperators||e("td:eq(0)",g).hide()}),e("table thead",n.grid.hDiv).append(s),t.searchOperators&&(e(".soptclass",s).click(function(t){var n=e(this).offset();i(this,n.left,n.top),t.stopPropagation()}),e("body").on("click",function(t){"soptclass"!==t.target.className&&e("#sopt_menu").hide()})),e(".clearsearchclass",s).click(function(){var i=e(this).parents("tr:first"),s=parseInt(e("td.ui-search-oper",i).attr("colindex"),10),o=e.extend({},n.p.colModel[s].searchoptions||{}),o=o.defaultValue?o.defaultValue:"";n.p.colModel[s].stype==="select"?o?e("td.ui-search-input select",i).val(o):e("td.ui-search-input select",i)[0].selectedIndex=0:e("td.ui-search-input input",i).val(o),t.autosearch===!0&&r()}),this.ftoolbar=!0,this.triggerToolbar=r,this.clearToolbar=function(r){var i={},s=0,o,r=typeof r!="boolean"?!0:r;e.each(n.p.colModel,function(){var t,r=e("#gs_"+e.jgrid.jqID(this.name),this.frozen===!0&&n.p.frozenColumns===!0?n.grid.fhDiv:n.grid.hDiv);this.searchoptions&&this.searchoptions.defaultValue!==void 0&&(t=this.searchoptions.defaultValue),o=this.index||this.name;switch(this.stype){case"select":r.find("option").each(function(n){n===0&&(this.selected=!0);if(e(this).val()===t)return this.selected=!0,!1});if(t!==void 0)i[o]=t,s++;else try{delete n.p.postData[o]}catch(u){}break;case"text":r.val(t);if(t!==void 0)i[o]=t,s++;else try{delete n.p.postData[o]}catch(f){}break;case"custom":e.isFunction(this.searchoptions.custom_value)&&r.length>0&&r[0].nodeName.toUpperCase()==="SPAN"&&this.searchoptions.custom_value.call(n,r.children(".customelement:first"),"set",t)}});var u=s>0?!0:!1;if(t.stringResult===!0||n.p.datatype==="local"){var f='{"groupOp":"'+t.groupOp+'","rules":[',l=0;e.each(i,function(e,t){l>0&&(f+=","),f+='{"field":"'+e+'",',f+='"op":"eq",',f+='"data":"'+(t+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',l++}),f+="]}",e.extend(n.p.postData,{filters:f}),e.each(["searchField","searchString","searchOper"],function(e,t){n.p.postData.hasOwnProperty(t)&&delete n.p.postData[t]})}else e.extend(n.p.postData,i);var h;n.p.searchurl&&(h=n.p.url,e(n).jqGrid("setGridParam",{url:n.p.searchurl}));var p=e(n).triggerHandler("jqGridToolbarBeforeClear")==="stop"?!0:!1;!p&&e.isFunction(t.beforeClear)&&(p=t.beforeClear.call(n)),p||r&&e(n).jqGrid("setGridParam",{search:u}).trigger("reloadGrid",[{page:1}]),h&&e(n).jqGrid("setGridParam",{url:h}),e(n).triggerHandler("jqGridToolbarAfterClear"),e.isFunction(t.afterClear)&&t.afterClear()},this.toggleToolbar=function(){var t=e("tr.ui-search-toolbar",n.grid.hDiv),r=n.p.frozenColumns===!0?e("tr.ui-search-toolbar",n.grid.fhDiv):!1;t.css("display")==="none"?(t.show(),r&&r.show()):(t.hide(),r&&r.hide())}}})},destroyFilterToolbar:function(){return this.each(function(){this.ftoolbar&&(this.toggleToolbar=this.clearToolbar=this.triggerToolbar=null,this.ftoolbar=!1,e(this.grid.hDiv).find("table thead tr.ui-search-toolbar").remove())})},destroyGroupHeader:function(t){return void 0===t&&(t=!0),this.each(function(){var n,r,i,s,o,u;r=this.grid;var f=e("table.ui-jqgrid-htable thead",r.hDiv),l=this.p.colModel;if(r){e(this).unbind(".setGroupHeaders"),n=e("<tr>",{role:"rowheader"}).addClass("ui-jqgrid-labels"),s=r.headers,r=0;for(i=s.length;r<i;r++){o=l[r].hidden?"none":"",o=e(s[r].el).width(s[r].width).css("display",o);try{o.removeAttr("rowSpan")}catch(c){o.attr("rowSpan",1)}n.append(o),u=o.children("span.ui-jqgrid-resize"),0<u.length&&(u[0].style.height=""),o.children("div")[0].style.top=""}e(f).children("tr.ui-jqgrid-labels").remove(),e(f).prepend(n),!0===t&&e(this).jqGrid("setGridParam",{groupHeader:null})}})},setGroupHeaders:function(t){return t=e.extend({useColSpanStyle:!1,groupHeaders:[]},t||{}),this.each(function(){this.p.groupHeader=t;var n,r,i=0,s,o,u,f,l,c=this.p.colModel,h=c.length,p=this.grid.headers,d=e("table.ui-jqgrid-htable",this.grid.hDiv),v=d.children("thead").children("tr.ui-jqgrid-labels:last").addClass("jqg-second-row-header");s=d.children("thead");var m=d.find(".jqg-first-row-header");void 0===m[0]?m=e("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):m.empty();var g,y=function(e,t){var n=t.length,r;for(r=0;r<n;r++)if(t[r].startColumnName===e)return r;return-1};e(this).prepend(s),s=e("<tr>",{role:"rowheader"}).addClass("ui-jqgrid-labels jqg-third-row-header");for(n=0;n<h;n++)if(u=p[n].el,f=e(u),r=c[n],o={height:"0px",width:p[n].width+"px",display:r.hidden?"none":""},e("<th>",{role:"gridcell"}).css(o).addClass("ui-first-th-"+this.p.direction).appendTo(m),u.style.width="",o=y(r.name,t.groupHeaders),0<=o){o=t.groupHeaders[o],i=o.numberOfColumns,l=o.titleText;for(o=r=0;o<i&&n+o<h;o++)c[n+o].hidden||r++;o=e("<th>").attr({role:"columnheader"}).addClass("ui-state-default ui-th-column-header ui-th-"+this.p.direction).css({height:"22px","border-top":"0px none"}).html(l),0<r&&o.attr("colspan",""+r),this.p.headertitles&&o.attr("title",o.text()),0===r&&o.hide(),f.before(o),s.append(u),i-=1}else 0===i?t.useColSpanStyle?f.attr("rowspan","2"):(e("<th>",{role:"columnheader"}).addClass("ui-state-default ui-th-column-header ui-th-"+this.p.direction).css({display:r.hidden?"none":"","border-top":"0px none"}).insertBefore(f),s.append(u)):(s.append(u),i--);c=e(this).children("thead"),c.prepend(m),s.insertAfter(v),d.append(c),t.useColSpanStyle&&(d.find("span.ui-jqgrid-resize").each(function(){var t=e(this).parent();t.is(":visible")&&(this.style.cssText="height: "+t.height()+"px !important; cursor: col-resize;")}),d.find("div.ui-jqgrid-sortable").each(function(){var t=e(this),n=t.parent();n.is(":visible")&&n.is(":has(span.ui-jqgrid-resize)")&&t.css("top",(n.height()-t.outerHeight())/2+"px")})),g=c.find("tr.jqg-first-row-header"),e(this).bind("jqGridResizeStop.setGroupHeaders",function(e,t,n){g.find("th").eq(n).width(t)})})},setFrozenColumns:function(){return this.each(function(){if(this.grid){var t=this,n=t.p.colModel,r=0,i=n.length,s=-1,o=!1;if(!(!0===t.p.subGrid||!0===t.p.treeGrid||!0===t.p.cellEdit||t.p.sortable||t.p.scroll||t.p.grouping)){t.p.rownumbers&&r++;for(t.p.multiselect&&r++;r<i;){if(!0!==n[r].frozen)break;o=!0,s=r,r++}if(0<=s&&o){n=t.p.caption?e(t.grid.cDiv).outerHeight():0,r=e(".ui-jqgrid-htable","#gview_"+e.jgrid.jqID(t.p.id)).height(),t.p.toppager&&(n+=e(t.grid.topDiv).outerHeight()),!0===t.p.toolbar[0]&&"bottom"!==t.p.toolbar[1]&&(n+=e(t.grid.uDiv).outerHeight()),t.grid.fhDiv=e('<div style="position:absolute;left:0px;top:'+n+"px;height:"+r+'px;" class="frozen-div ui-state-default ui-jqgrid-hdiv"></div>'),t.grid.fbDiv=e('<div style="position:absolute;left:0px;top:'+(parseInt(n,10)+parseInt(r,10)+1)+'px;overflow-y:hidden" class="frozen-bdiv ui-jqgrid-bdiv"></div>'),e("#gview_"+e.jgrid.jqID(t.p.id)).append(t.grid.fhDiv),n=e(".ui-jqgrid-htable","#gview_"+e.jgrid.jqID(t.p.id)).clone(!0);if(t.p.groupHeader){e("tr.jqg-first-row-header, tr.jqg-third-row-header",n).each(function(){e("th:gt("+s+")",this).remove()});var u=-1,f=-1,l,c;e("tr.jqg-second-row-header th",n).each(function(){l=parseInt(e(this).attr("colspan"),10);if(c=parseInt(e(this).attr("rowspan"),10))u++,f++;l&&(u+=l,f++);if(u===s)return!1}),u!==s&&(f=s),e("tr.jqg-second-row-header",n).each(function(){e("th:gt("+f+")",this).remove()})}else e("tr",n).each(function(){e("th:gt("+s+")",this).remove()});e(n).width(1),e(t.grid.fhDiv).append(n).mousemove(function(e){if(t.grid.resizing)return t.grid.dragMove(e),!1}),e(t).bind("jqGridResizeStop.setFrozenColumns",function(n,r,i){n=e(".ui-jqgrid-htable",t.grid.fhDiv),e("th:eq("+i+")",n).width(r),n=e(".ui-jqgrid-btable",t.grid.fbDiv),e("tr:first td:eq("+i+")",n).width(r)}),e(t).bind("jqGridSortCol.setFrozenColumns",function(n,r,i){n=e("tr.ui-jqgrid-labels:last th:eq("+t.p.lastsort+")",t.grid.fhDiv),r=e("tr.ui-jqgrid-labels:last th:eq("+i+")",t.grid.fhDiv),e("span.ui-grid-ico-sort",n).addClass("ui-state-disabled"),e(n).attr("aria-selected","false"),e("span.ui-icon-"+t.p.sortorder,r).removeClass("ui-state-disabled"),e(r).attr("aria-selected","true"),!t.p.viewsortcols[0]&&t.p.lastsort!==i&&(e("span.s-ico",n).hide(),e("span.s-ico",r).show())}),e("#gview_"+e.jgrid.jqID(t.p.id)).append(t.grid.fbDiv),e(t.grid.bDiv).scroll(function(){e(t.grid.fbDiv).scrollTop(e(this).scrollTop())}),!0===t.p.hoverrows&&e("#"+e.jgrid.jqID(t.p.id)).unbind("mouseover").unbind("mouseout"),e(t).bind("jqGridAfterGridComplete.setFrozenColumns",function(){e("#"+e.jgrid.jqID(t.p.id)+"_frozen").remove(),e(t.grid.fbDiv).height(e(t.grid.bDiv).height()-16);var n=e("#"+e.jgrid.jqID(t.p.id)).clone(!0);e("tr[role=row]",n).each(function(){e("td[role=gridcell]:gt("+s+")",this).remove()}),e(n).width(1).attr("id",t.p.id+"_frozen"),e(t.grid.fbDiv).append(n),!0===t.p.hoverrows&&(e("tr.jqgrow",n).hover(function(){e(this).addClass("ui-state-hover"),e("#"+e.jgrid.jqID(this.id),"#"+e.jgrid.jqID(t.p.id)).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover"),e("#"+e.jgrid.jqID(this.id),"#"+e.jgrid.jqID(t.p.id)).removeClass("ui-state-hover")}),e("tr.jqgrow","#"+e.jgrid.jqID(t.p.id)).hover(function(){e(this).addClass("ui-state-hover"),e("#"+e.jgrid.jqID(this.id),"#"+e.jgrid.jqID(t.p.id)+"_frozen").addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover"),e("#"+e.jgrid.jqID(this.id),"#"+e.jgrid.jqID(t.p.id)+"_frozen").removeClass("ui-state-hover")})),n=null}),t.grid.hDiv.loading||e(t).triggerHandler("jqGridAfterGridComplete"),t.p.frozenColumns=!0}}}})},destroyFrozenColumns:function(){return this.each(function(){if(this.grid&&!0===this.p.frozenColumns){e(this.grid.fhDiv).remove(),e(this.grid.fbDiv).remove(),this.grid.fhDiv=null,this.grid.fbDiv=null,e(this).unbind(".setFrozenColumns");if(!0===this.p.hoverrows){var t;e("#"+e.jgrid.jqID(this.p.id)).bind("mouseover",function(n){t=e(n.target).closest("tr.jqgrow"),"ui-subgrid"!==e(t).attr("class")&&e(t).addClass("ui-state-hover")}).bind("mouseout",function(n){t=e(n.target).closest("tr.jqgrow"),e(t).removeClass("ui-state-hover")})}this.p.frozenColumns=!1}})}})}(jQuery),function(e){e.extend(e.jgrid,{showModal:function(e){e.w.show()},closeModal:function(e){e.w.hide().attr("aria-hidden","true"),e.o&&e.o.remove()},hideModal:function(t,n){n=e.extend({jqm:!0,gb:""},n||{});if(n.onClose){var r=n.gb&&"string"==typeof n.gb&&"#gbox_"===n.gb.substr(0,6)?n.onClose.call(e("#"+n.gb.substr(6))[0],t):n.onClose(t);if("boolean"==typeof r&&!r)return}if(e.fn.jqm&&!0===n.jqm)e(t).attr("aria-hidden","true").jqmHide();else{if(""!==n.gb)try{e(".jqgrid-overlay:first",n.gb).hide()}catch(i){}e(t).hide().attr("aria-hidden","true")}},findPos:function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]},createModal:function(t,n,r,i,s,o,u){var r=e.extend(!0,{},e.jgrid.jqModal||{},r),f=document.createElement("div"),l,c=this,u=e.extend({},u||{});l="rtl"===e(r.gbox).attr("dir")?!0:!1,f.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog",f.id=t.themodal;var h=document.createElement("div");h.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix",h.id=t.modalhead,e(h).append("<span class='ui-jqdialog-title'>"+r.caption+"</span>");var p=e("<a class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){p.addClass("ui-state-hover")},function(){p.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'></span>");e(h).append(p),l?(f.dir="rtl",e(".ui-jqdialog-title",h).css("float","right"),e(".ui-jqdialog-titlebar-close",h).css("left","0.3em")):(f.dir="ltr",e(".ui-jqdialog-title",h).css("float","left"),e(".ui-jqdialog-titlebar-close",h).css("right","0.3em"));var d=document.createElement("div");e(d).addClass("ui-jqdialog-content ui-widget-content").attr("id",t.modalcontent),e(d).append(n),f.appendChild(d),e(f).prepend(h),!0===o?e("body").append(f):"string"==typeof o?e(o).append(f):e(f).insertBefore(i),e(f).css(u),void 0===r.jqModal&&(r.jqModal=!0),n={};if(e.fn.jqm&&!0===r.jqModal)0===r.left&&0===r.top&&r.overlay&&(u=[],u=e.jgrid.findPos(s),r.left=u[0]+4,r.top=u[1]+4),n.top=r.top+"px",n.left=r.left;else if(0!==r.left||0!==r.top)n.left=r.left,n.top=r.top+"px";e("a.ui-jqdialog-titlebar-close",h).click(function(){var n=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||r.onClose,i=e("#"+e.jgrid.jqID(t.themodal)).data("gbox")||r.gbox;return c.hideModal("#"+e.jgrid.jqID(t.themodal),{gb:i,jqm:r.jqModal,onClose:n}),!1});if(0===r.width||!r.width)r.width=300;if(0===r.height||!r.height)r.height=200;r.zIndex||(i=e(i).parents("*[role=dialog]").filter(":first").css("z-index"),r.zIndex=i?parseInt(i,10)+2:950),i=0,l&&n.left&&!o&&(i=e(r.gbox).width()-(isNaN(r.width)?0:parseInt(r.width,10))-8,n.left=parseInt(n.left,10)+parseInt(i,10)),n.left&&(n.left+="px"),e(f).css(e.extend({width:isNaN(r.width)?"auto":r.width+"px",height:isNaN(r.height)?"auto":r.height+"px",zIndex:r.zIndex,overflow:"hidden"},n)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":t.modalhead,"aria-hidden":"true"}),void 0===r.drag&&(r.drag=!0),void 0===r.resize&&(r.resize=!0);if(r.drag)if(e(h).css("cursor","move"),e.fn.jqDrag)e(f).jqDrag(h);else try{e(f).draggable({handle:e("#"+e.jgrid.jqID(h.id))})}catch(v){}if(r.resize)if(e.fn.jqResize)e(f).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se'></div>"),e("#"+e.jgrid.jqID(t.themodal)).jqResize(".jqResize",t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):!1);else try{e(f).resizable({handles:"se, sw",alsoResize:t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):!1})}catch(m){}!0===r.closeOnEscape&&e(f).keydown(function(n){n.which==27&&(n=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||r.onClose,c.hideModal("#"+e.jgrid.jqID(t.themodal),{gb:r.gbox,jqm:r.jqModal,onClose:n}))})},viewModal:function(t,n){n=e.extend({toTop:!0,overlay:10,modal:!1,overlayClass:"ui-widget-overlay",onShow:e.jgrid.showModal,onHide:e.jgrid.closeModal,gbox:"",jqm:!0,jqM:!0},n||{});if(e.fn.jqm&&!0===n.jqm)n.jqM?e(t).attr("aria-hidden","false").jqm(n).jqmShow():e(t).attr("aria-hidden","false").jqmShow();else{""!==n.gbox&&(e(".jqgrid-overlay:first",n.gbox).show(),e(t).data("gbox",n.gbox)),e(t).show().attr("aria-hidden","false");try{e(":input:visible",t)[0].focus()}catch(r){}}},info_dialog:function(t,n,r,i){var s={width:290,height:"auto",dataheight:"auto",drag:!0,resize:!1,left:250,top:170,zIndex:1e3,jqModal:!0,modal:!1,closeOnEscape:!0,align:"center",buttonalign:"center",buttons:[]};e.extend(!0,s,e.jgrid.jqModal||{},{caption:"<b>"+t+"</b>"},i||{});var o=s.jqModal,u=this;e.fn.jqm&&!o&&(o=!1),t="";if(0<s.buttons.length)for(i=0;i<s.buttons.length;i++)void 0===s.buttons[i].id&&(s.buttons[i].id="info_button_"+i),t+="<a id='"+s.buttons[i].id+"' class='fm-button ui-state-default ui-corner-all'>"+s.buttons[i].text+"</a>";i=isNaN(s.dataheight)?s.dataheight:s.dataheight+"px",n="<div id='info_id'>"+("<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+i+";"+("text-align:"+s.align+";")+"'>"+n+"</div>"),n+=r?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+s.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+r+"</a>"+t+"</div>":""!==t?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+s.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+t+"</div>":"",n+="</div>";try{"false"===e("#info_dialog").attr("aria-hidden")&&e.jgrid.hideModal("#info_dialog",{jqm:o}),e("#info_dialog").remove()}catch(f){}e.jgrid.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},n,s,"","",!0),t&&e.each(s.buttons,function(t){e("#"+e.jgrid.jqID(this.id),"#info_id").bind("click",function(){return s.buttons[t].onClick.call(e("#info_dialog")),!1})}),e("#closedialog","#info_id").click(function(){return u.hideModal("#info_dialog",{jqm:o,onClose:e("#info_dialog").data("onClose")||s.onClose,gb:e("#info_dialog").data("gbox")||s.gbox}),!1}),e(".fm-button","#info_dialog").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}),e.isFunction(s.beforeOpen)&&s.beforeOpen(),e.jgrid.viewModal("#info_dialog",{onHide:function(e){e.w.hide().remove(),e.o&&e.o.remove()},modal:s.modal,jqm:o}),e.isFunction(s.afterOpen)&&s.afterOpen();try{e("#info_dialog").focus()}catch(l){}},bindEv:function(t,n){e.isFunction(n.dataInit)&&n.dataInit.call(this,t,n),n.dataEvents&&e.each(n.dataEvents,function(){void 0!==this.data?e(t).bind(this.type,this.data,this.fn):e(t).bind(this.type,this.fn)})},createEl:function(t,n,r,i,s){function o(t,n,r){var i="dataInit,dataEvents,dataUrl,buildSelect,sopt,searchhidden,defaultValue,attr,custom_element,custom_value".split(",");void 0!==r&&e.isArray(r)&&e.merge(i,r),e.each(n,function(n,r){-1===e.inArray(n,i)&&e(t).attr(n,r)}),n.hasOwnProperty("id")||e(t).attr("id",e.jgrid.randId())}var u="",f=this;switch(t){case"textarea":u=document.createElement("textarea"),i?n.cols||e(u).css({width:"98%"}):n.cols||(n.cols=20),n.rows||(n.rows=2);if("&nbsp;"===r||"&#160;"===r||1===r.length&&160===r.charCodeAt(0))r="";u.value=r,o(u,n),e(u).attr({role:"textbox",multiline:"true"});break;case"checkbox":u=document.createElement("input"),u.type="checkbox",n.value?(t=n.value.split(":"),r===t[0]&&(u.checked=!0,u.defaultChecked=!0),u.value=t[0],e(u).attr("offval",t[1])):(t=(r+"").toLowerCase(),0>t.search(/(false|f|0|no|n|off|undefined)/i)&&""!==t?(u.checked=!0,u.defaultChecked=!0,u.value=r):u.value="on",e(u).attr("offval","off")),o(u,n,["value"]),e(u).attr("role","checkbox");break;case"select":u=document.createElement("select"),u.setAttribute("role","select"),i=[],!0===n.multiple?(t=!0,u.multiple="multiple",e(u).attr("aria-multiselectable","true")):t=!1;if(void 0!==n.dataUrl){var t=n.name?(""+n.id).substring(0,(""+n.id).length-(""+n.name).length-1):""+n.id,l=n.postData||s.postData;f.p&&f.p.idPrefix&&(t=e.jgrid.stripPref(f.p.idPrefix,t)),e.ajax(e.extend({url:e.isFunction(n.dataUrl)?n.dataUrl.call(f,t,r,""+n.name):n.dataUrl,type:"GET",dataType:"html",data:e.isFunction(l)?l.call(f,t,r,""+n.name):l,context:{elem:u,options:n,vl:r},success:function(t){var n=[],r=this.elem,i=this.vl,s=e.extend({},this.options),u=s.multiple===!0,t=e.isFunction(s.buildSelect)?s.buildSelect.call(f,t):t;typeof t=="string"&&(t=e(e.trim(t)).html()),t&&(e(r).append(t),o(r,s,l?["postData"]:void 0),s.size===void 0&&(s.size=u?3:1),u?(n=i.split(","),n=e.map(n,function(t){return e.trim(t)})):n[0]=e.trim(i),setTimeout(function(){e("option",r).each(function(t){t===0&&r.multiple&&(this.selected=!1),e(this).attr("role","option");if(e.inArray(e.trim(e(this).text()),n)>-1||e.inArray(e.trim(e(this).val()),n)>-1)this.selected="selected"})},0))}},s||{}))}else if(n.value){var c;void 0===n.size&&(n.size=t?3:1),t&&(i=r.split(","),i=e.map(i,function(t){return e.trim(t)})),"function"==typeof n.value&&(n.value=n.value());var h,p,d=void 0===n.separator?":":n.separator,s=void 0===n.delimiter?";":n.delimiter;if("string"==typeof n.value){h=n.value.split(s);for(c=0;c<h.length;c++)p=h[c].split(d),2<p.length&&(p[1]=e.map(p,function(e,t){if(t>0)return e}).join(d)),s=document.createElement("option"),s.setAttribute("role","option"),s.value=p[0],s.innerHTML=p[1],u.appendChild(s),!t&&(e.trim(p[0])===e.trim(r)||e.trim(p[1])===e.trim(r))&&(s.selected="selected"),t&&(-1<e.inArray(e.trim(p[1]),i)||-1<e.inArray(e.trim(p[0]),i))&&(s.selected="selected")}else if("object"==typeof n.value)for(c in d=n.value,d)d.hasOwnProperty(c)&&(s=document.createElement("option"),s.setAttribute("role","option"),s.value=c,s.innerHTML=d[c],u.appendChild(s),!t&&(e.trim(c)===e.trim(r)||e.trim(d[c])===e.trim(r))&&(s.selected="selected"),t&&(-1<e.inArray(e.trim(d[c]),i)||-1<e.inArray(e.trim(c),i))&&(s.selected="selected"));o(u,n,["value"])}break;case"text":case"password":case"button":c="button"===t?"button":"textbox",u=document.createElement("input"),u.type=t,u.value=r,o(u,n),"button"!==t&&(i?n.size||e(u).css({width:"98%"}):n.size||(n.size=20)),e(u).attr("role",c);break;case"image":case"file":u=document.createElement("input"),u.type=t,o(u,n);break;case"custom":u=document.createElement("span");try{if(!e.isFunction(n.custom_element))throw"e1";if(!(d=n.custom_element.call(f,r,n)))throw"e2";d=e(d).addClass("customelement").attr({id:n.id,name:n.name}),e(u).empty().append(d)}catch(v){"e1"===v&&e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"===v?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,"string"==typeof v?v:v.message,e.jgrid.edit.bClose)}}return u},checkDate:function(e,t){var n={},r,e=e.toLowerCase();r=-1!==e.indexOf("/")?"/":-1!==e.indexOf("-")?"-":-1!==e.indexOf(".")?".":"/",e=e.split(r),t=t.split(r);if(3!==t.length)return!1;r=-1;var i,s=-1,o=-1,u;for(u=0;u<e.length;u++)i=isNaN(t[u])?0:parseInt(t[u],10),n[e[u]]=i,i=e[u],-1!==i.indexOf("y")&&(r=u),-1!==i.indexOf("m")&&(o=u),-1!==i.indexOf("d")&&(s=u);i="y"===e[r]||"yyyy"===e[r]?4:"yy"===e[r]?2:-1,u=[0,31,29,31,30,31,30,31,31,30,31,30,31];var a;return-1===r?!1:(a=n[e[r]].toString(),2===i&&1===a.length&&(i=1),a.length!==i||0===n[e[r]]&&"00"!==t[r]||-1===o?!1:(a=n[e[o]].toString(),1>a.length||1>n[e[o]]||12<n[e[o]]||-1===s?!1:(a=n[e[s]].toString(),1>a.length||1>n[e[s]]||31<n[e[s]]||2===n[e[o]]&&n[e[s]]>(0!==n[e[r]]%4||0===n[e[r]]%100&&0!==n[e[r]]%400?28:29)||n[e[s]]>u[n[e[o]]]?!1:!0)))},isEmpty:function(e){return e.match(/^\s+$/)||""===e?!0:!1},checkTime:function(t){var n=/^(\d{1,2}):(\d{2})([apAP][Mm])?$/;if(!e.jgrid.isEmpty(t)){if(!(t=t.match(n)))return!1;if(t[3]){if(1>t[1]||12<t[1])return!1}else if(23<t[1])return!1;if(59<t[2])return!1}return!0},checkValues:function(t,n,r,i){var s,o,u;u=this.p.colModel;if(void 0===r)if("string"==typeof n){r=0;for(i=u.length;r<i;r++)if(u[r].name===n){s=u[r].editrules,n=r,null!=u[r].formoptions&&(o=u[r].formoptions.label);break}}else 0<=n&&(s=u[n].editrules);else s=r,o=void 0===i?"_":i;if(s){o||(o=null!=this.p.colNames?this.p.colNames[n]:u[n].label);if(!0===s.required&&e.jgrid.isEmpty(t))return[!1,o+": "+e.jgrid.edit.msg.required,""];r=!1===s.required?!1:!0;if(!0===s.number&&(!1!==r||!e.jgrid.isEmpty(t))&&isNaN(t))return[!1,o+": "+e.jgrid.edit.msg.number,""];if(void 0!==s.minValue&&!isNaN(s.minValue)&&parseFloat(t)<parseFloat(s.minValue))return[!1,o+": "+e.jgrid.edit.msg.minValue+" "+s.minValue,""];if(void 0!==s.maxValue&&!isNaN(s.maxValue)&&parseFloat(t)>parseFloat(s.maxValue))return[!1,o+": "+e.jgrid.edit.msg.maxValue+" "+s.maxValue,""];if(!0===s.email&&(!1!==r||!e.jgrid.isEmpty(t))&&(i=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,!i.test(t)))return[!1,o+": "+e.jgrid.edit.msg.email,""];if(!(!0!==s.integer||!1===r&&!!e.jgrid.isEmpty(t)||!isNaN(t)&&0===t%1&&-1===t.indexOf(".")))return[!1,o+": "+e.jgrid.edit.msg.integer,""];if(!0===s.date&&(!1!==r||!e.jgrid.isEmpty(t))&&(u[n].formatoptions&&u[n].formatoptions.newformat?(u=u[n].formatoptions.newformat,e.jgrid.formatter.date.masks.hasOwnProperty(u)&&(u=e.jgrid.formatter.date.masks[u])):u=u[n].datefmt||"Y-m-d",!e.jgrid.checkDate(u,t)))return[!1,o+": "+e.jgrid.edit.msg.date+" - "+u,""];if(!0===s.time&&(!1!==r||!e.jgrid.isEmpty(t))&&!e.jgrid.checkTime(t))return[!1,o+": "+e.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];if(!0===s.url&&(!1!==r||!e.jgrid.isEmpty(t))&&(i=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i,!i.test(t)))return[!1,o+": "+e.jgrid.edit.msg.url,""];if(!0===s.custom&&(!1!==r||!e.jgrid.isEmpty(t)))return e.isFunction(s.custom_func)?(t=s.custom_func.call(this,t,o,n),e.isArray(t)?t:[!1,e.jgrid.edit.msg.customarray,""]):[!1,e.jgrid.edit.msg.customfcheck,""]}return[!0,"",""]}})}(jQuery),function(e){var t={};e.jgrid.extend({searchGrid:function(t){return t=e.extend(!0,{recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,afterChange:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,searchOnEnter:!1,multipleSearch:!1,multipleGroup:!1,top:0,left:0,jqModal:!0,modal:!1,resize:!0,width:450,height:"auto",dataheight:"auto",showQuery:!1,errorcheck:!0,sopt:null,stringResult:void 0,onClose:null,onSearch:null,onReset:null,toTop:!0,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:!1,layer:null,operands:{eq:"=",ne:"<>",lt:"<",le:"<=",gt:">",ge:">=",bw:"LIKE",bn:"NOT LIKE","in":"IN",ni:"NOT IN",ew:"LIKE",en:"NOT LIKE",cn:"LIKE",nc:"NOT LIKE",nu:"IS NULL",nn:"ISNOT NULL"}},e.jgrid.search,t||{}),this.each(function(){function n(n){s=e(r).triggerHandler("jqGridFilterBeforeShow",[n]),void 0===s&&(s=!0),s&&e.isFunction(t.beforeShowSearch)&&(s=t.beforeShowSearch.call(r,n)),s&&(e.jgrid.viewModal("#"+e.jgrid.jqID(u.themodal),{gbox:"#gbox_"+e.jgrid.jqID(i),jqm:t.jqModal,modal:t.modal,overlay:t.overlay,toTop:t.toTop}),e(r).triggerHandler("jqGridFilterAfterShow",[n]),e.isFunction(t.afterShowSearch)&&t.afterShowSearch.call(r,n))}var r=this;if(r.grid){var i="fbox_"+r.p.id,s=!0,o=!0,u={themodal:"searchmod"+i,modalhead:"searchhd"+i,modalcontent:"searchcnt"+i,scrollelm:i},f=r.p.postData[t.sFilter];"string"==typeof f&&(f=e.jgrid.parse(f)),!0===t.recreateFilter&&e("#"+e.jgrid.jqID(u.themodal)).remove();if(void 0!==e("#"+e.jgrid.jqID(u.themodal))[0])n(e("#fbox_"+e.jgrid.jqID(+r.p.id)));else{var l=e("<div><div id='"+i+"' class='searchFilter' style='overflow:auto'></div></div>").insertBefore("#gview_"+e.jgrid.jqID(r.p.id)),c="left",h="";"rtl"===r.p.direction&&(c="right",h=" style='text-align:left'",l.attr("dir","rtl"));var p=e.extend([],r.p.colModel),d="<a id='"+i+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+t.Find+"</a>",v="<a id='"+i+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+t.Reset+"</a>",m="",g="",y,w=!1,E=-1;t.showQuery&&(m="<a id='"+i+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>"),t.columns.length?(p=t.columns,E=0,y=p[0].index||p[0].name):e.each(p,function(e,t){t.label||(t.label=r.p.colNames[e]);if(!w){var n=t.search===void 0?!0:t.search,i=t.hidden===!0;if(t.searchoptions&&t.searchoptions.searchhidden===!0&&n||n&&!i)w=!0,y=t.index||t.name,E=e}});if(!f&&y||!1===t.multipleSearch){var S="eq";0<=E&&p[E].searchoptions&&p[E].searchoptions.sopt?S=p[E].searchoptions.sopt[0]:t.sopt&&t.sopt.length&&(S=t.sopt[0]),f={groupOp:"AND",rules:[{field:y,op:S,data:""}]}}w=!1,t.tmplNames&&t.tmplNames.length&&(w=!0,g=t.tmplLabel,g+="<select class='ui-template'>",g+="<option value='default'>Default</option>",e.each(t.tmplNames,function(e,t){g+="<option value='"+e+"'>"+t+"</option>"}),g+="</select>"),c="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+i+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:"+c+"'>"+v+g+"</td><td class='EditButton' "+h+">"+m+d+"</td></tr></tbody></table>",i=e.jgrid.jqID(i),e("#"+i).jqFilter({columns:p,filter:t.loadDefaults?f:null,showQuery:t.showQuery,errorcheck:t.errorcheck,sopt:t.sopt,groupButton:t.multipleGroup,ruleButtons:t.multipleSearch,afterRedraw:t.afterRedraw,ops:t.odata,operands:t.operands,ajaxSelectOptions:r.p.ajaxSelectOptions,groupOps:t.groupOps,onChange:function(){this.p.showQuery&&e(".query",this).html(this.toUserFriendlyString()),e.isFunction(t.afterChange)&&t.afterChange.call(r,e("#"+i),t)},direction:r.p.direction,id:r.p.id}),l.append(c),w&&t.tmplFilters&&t.tmplFilters.length&&e(".ui-template",l).bind("change",function(){var n=e(this).val();return n==="default"?e("#"+i).jqFilter("addFilter",f):e("#"+i).jqFilter("addFilter",t.tmplFilters[parseInt(n,10)]),!1}),!0===t.multipleGroup&&(t.multipleSearch=!0),e(r).triggerHandler("jqGridFilterInitialize",[e("#"+i)]),e.isFunction(t.onInitializeSearch)&&t.onInitializeSearch.call(r,e("#"+i)),t.gbox="#gbox_"+i,t.layer?e.jgrid.createModal(u,l,t,"#gview_"+e.jgrid.jqID(r.p.id),e("#gbox_"+e.jgrid.jqID(r.p.id))[0],"#"+e.jgrid.jqID(t.layer),{position:"relative"}):e.jgrid.createModal(u,l,t,"#gview_"+e.jgrid.jqID(r.p.id),e("#gbox_"+e.jgrid.jqID(r.p.id))[0]),(t.searchOnEnter||t.closeOnEscape)&&e("#"+e.jgrid.jqID(u.themodal)).keydown(function(n){var r=e(n.target);if(t.searchOnEnter&&n.which===13&&!r.hasClass("add-group")&&!r.hasClass("add-rule")&&!r.hasClass("delete-group")&&!r.hasClass("delete-rule")&&(!r.hasClass("fm-button")||!r.is("[id$=_query]")))return e("#"+i+"_search").focus().click(),!1;if(t.closeOnEscape&&n.which===27)return e("#"+e.jgrid.jqID(u.modalhead)).find(".ui-jqdialog-titlebar-close").focus().click(),!1}),m&&e("#"+i+"_query").bind("click",function(){return e(".queryresult",l).toggle(),!1}),void 0===t.stringResult&&(t.stringResult=t.multipleSearch),e("#"+i+"_search").bind("click",function(){var n=e("#"+i),s={},f,l=n.jqFilter("filterData");if(t.errorcheck){n[0].hideError(),t.showQuery||n.jqFilter("toSQLString");if(n[0].p.error)return n[0].showError(),!1}if(t.stringResult){try{f=xmlJsonClass.toJson(l,"","",!1)}catch(c){try{f=JSON.stringify(l)}catch(h){}}typeof f=="string"&&(s[t.sFilter]=f,e.each([t.sField,t.sValue,t.sOper],function(){s[this]=""}))}else t.multipleSearch?(s[t.sFilter]=l,e.each([t.sField,t.sValue,t.sOper],function(){s[this]=""})):(s[t.sField]=l.rules[0].field,s[t.sValue]=l.rules[0].data,s[t.sOper]=l.rules[0].op,s[t.sFilter]="");return r.p.search=!0,e.extend(r.p.postData,s),o=e(r).triggerHandler("jqGridFilterSearch"),o===void 0&&(o=!0),o&&e.isFunction(t.onSearch)&&(o=t.onSearch.call(r,r.p.filters)),o!==!1&&e(r).trigger("reloadGrid",[{page:1}]),t.closeAfterSearch&&e.jgrid.hideModal("#"+e.jgrid.jqID(u.themodal),{gb:"#gbox_"+e.jgrid.jqID(r.p.id),jqm:t.jqModal,onClose:t.onClose}),!1}),e("#"+i+"_reset").bind("click",function(){var n={},s=e("#"+i);return r.p.search=!1,t.multipleSearch===!1?n[t.sField]=n[t.sValue]=n[t.sOper]="":n[t.sFilter]="",s[0].resetFilter(),w&&e(".ui-template",l).val("default"),e.extend(r.p.postData,n),o=e(r).triggerHandler("jqGridFilterReset"),o===void 0&&(o=!0),o&&e.isFunction(t.onReset)&&(o=t.onReset.call(r)),o!==!1&&e(r).trigger("reloadGrid",[{page:1}]),t.closeAfterReset&&e.jgrid.hideModal("#"+e.jgrid.jqID(u.themodal),{gb:"#gbox_"+e.jgrid.jqID(r.p.id),jqm:t.jqModal,onClose:t.onClose}),!1}),n(e("#"+i)),e(".fm-button:not(.ui-state-disabled)",l).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")})}}})},editGridRow:function(n,r){return r=e.extend(!0,{top:0,left:0,width:300,datawidth:"auto",height:"auto",dataheight:"auto",modal:!1,overlay:30,drag:!0,resize:!0,url:null,mtype:"POST",clearAfterAdd:!0,closeAfterEdit:!1,reloadAfterSubmit:!0,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:!1,jqModal:!0,closeOnEscape:!1,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[!1,13],navkeys:[!1,38,40],checkOnSubmit:!1,checkOnUpdate:!1,_savedData:{},processing:!1,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:!0,overlayClass:"ui-widget-overlay"},e.jgrid.edit,r||{}),t[e(this)[0].p.id]=r,this.each(function(){function i(){return e(S+" > tbody > tr > td > .FormElement").each(function(){var t=e(".customelement",this);if(t.length){var n=e(t[0]).attr("name");e.each(g.p.colModel,function(){if(this.name===n&&this.editoptions&&e.isFunction(this.editoptions.custom_value)){try{if(M[n]=this.editoptions.custom_value.call(g,e("#"+e.jgrid.jqID(n),S),"get"),void 0===M[n])throw"e1"}catch(t){"e1"===t?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,t.message,e.jgrid.edit.bClose)}return!0}})}else{switch(e(this).get(0).type){case"checkbox":e(this).is(":checked")?M[this.name]=e(this).val():(t=e(this).attr("offval"),M[this.name]=t);break;case"select-one":M[this.name]=e("option:selected",this).val();break;case"select-multiple":M[this.name]=e(this).val(),M[this.name]=M[this.name]?M[this.name].join(","):"",e("option:selected",this).each(function(t,n){e(n).text()});break;case"password":case"text":case"textarea":case"button":M[this.name]=e(this).val()}g.p.autoencode&&(M[this.name]=e.jgrid.htmlEncode(M[this.name]))}}),!0}function o(n,r,i,s){var o,u,f,l=0,c,h,p,d=[],v=!1,m="",y;for(y=1;y<=s;y++)m+="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>";return"_empty"!==n&&(v=e(r).jqGrid("getInd",n)),e(r.p.colModel).each(function(y){o=this.name,h=(u=this.editrules&&!0===this.editrules.edithidden?!1:!0===this.hidden?!0:!1)?"style='display:none'":"";if("cb"!==o&&"subgrid"!==o&&!0===this.editable&&"rn"!==o){if(!1===v)c="";else if(o===r.p.ExpandColumn&&!0===r.p.treeGrid)c=e("td[role='gridcell']:eq("+y+")",r.rows[v]).text();else{try{c=e.unformat.call(r,e("td[role='gridcell']:eq("+y+")",r.rows[v]),{rowId:n,colModel:this},y)}catch(E){c=this.edittype&&"textarea"===this.edittype?e("td[role='gridcell']:eq("+y+")",r.rows[v]).text():e("td[role='gridcell']:eq("+y+")",r.rows[v]).html()}if(!c||"&nbsp;"===c||"&#160;"===c||1===c.length&&160===c.charCodeAt(0))c=""}var S=e.extend({},this.editoptions||{},{id:o,name:o}),x=e.extend({},{elmprefix:"",elmsuffix:"",rowabove:!1,rowcontent:""},this.formoptions||{}),T=parseInt(x.rowpos,10)||l+1,N=parseInt(2*(parseInt(x.colpos,10)||1),10);"_empty"===n&&S.defaultValue&&(c=e.isFunction(S.defaultValue)?S.defaultValue.call(g):S.defaultValue),this.edittype||(this.edittype="text"),g.p.autoencode&&(c=e.jgrid.htmlDecode(c)),p=e.jgrid.createEl.call(g,this.edittype,S,c,!1,e.extend({},e.jgrid.ajaxOptions,r.p.ajaxSelectOptions||{}));if(t[g.p.id].checkOnSubmit||t[g.p.id].checkOnUpdate)t[g.p.id]._savedData[o]=c;e(p).addClass("FormElement"),-1<e.inArray(this.edittype,["text","textarea","password","select"])&&e(p).addClass("ui-widget-content ui-corner-all"),f=e(i).find("tr[rowpos="+T+"]");if(x.rowabove){var C=e("<tr><td class='contentinfo' colspan='"+2*s+"'>"+x.rowcontent+"</td></tr>");e(i).append(C),C[0].rp=T}0===f.length&&(f=e("<tr "+h+" rowpos='"+T+"'></tr>").addClass("FormData").attr("id","tr_"+o),e(f).append(m),e(i).append(f),f[0].rp=T),e("td:eq("+(N-2)+")",f[0]).html(void 0===x.label?r.p.colNames[y]:x.label),e("td:eq("+(N-1)+")",f[0]).append(x.elmprefix).append(p).append(x.elmsuffix),"custom"===this.edittype&&e.isFunction(S.custom_value)&&S.custom_value.call(g,e("#"+o,"#"+w),"set",c),e.jgrid.bindEv.call(g,p,S),d[l]=y,l++}}),0<l&&(y=e("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(2*s-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+r.p.id+"_id' value='"+n+"'/></td></tr>"),y[0].rp=l+999,e(i).append(y),t[g.p.id].checkOnSubmit||t[g.p.id].checkOnUpdate)&&(t[g.p.id]._savedData[r.p.id+"_id"]=n),d}function u(n,r,i){var s,o=0,u,f,l,c,h;if(t[g.p.id].checkOnSubmit||t[g.p.id].checkOnUpdate)t[g.p.id]._savedData={},t[g.p.id]._savedData[r.p.id+"_id"]=n;var p=r.p.colModel;if("_empty"===n)e(p).each(function(){s=this.name,l=e.extend({},this.editoptions||{}),(f=e("#"+e.jgrid.jqID(s),"#"+i))&&f.length&&null!==f[0]&&(c="","custom"===this.edittype&&e.isFunction(l.custom_value)?l.custom_value.call(g,e("#"+s,"#"+i),"set",c):l.defaultValue?(c=e.isFunction(l.defaultValue)?l.defaultValue.call(g):l.defaultValue,"checkbox"===f[0].type?(h=c.toLowerCase(),0>h.search(/(false|f|0|no|n|off|undefined)/i)&&""!==h?(f[0].checked=!0,f[0].defaultChecked=!0,f[0].value=c):(f[0].checked=!1,f[0].defaultChecked=!1)):f.val(c)):"checkbox"===f[0].type?(f[0].checked=!1,f[0].defaultChecked=!1,c=e(f).attr("offval")):f[0].type&&"select"===f[0].type.substr(0,6)?f[0].selectedIndex=0:f.val(c),!0===t[g.p.id].checkOnSubmit||t[g.p.id].checkOnUpdate)&&(t[g.p.id]._savedData[s]=c)}),e("#id_g","#"+i).val(n);else{var d=e(r).jqGrid("getInd",n,!0);d&&(e('td[role="gridcell"]',d).each(function(f){s=p[f].name;if("cb"!==s&&"subgrid"!==s&&"rn"!==s&&!0===p[f].editable){if(s===r.p.ExpandColumn&&!0===r.p.treeGrid)u=e(this).text();else try{u=e.unformat.call(r,e(this),{rowId:n,colModel:p[f]},f)}catch(l){u="textarea"===p[f].edittype?e(this).text():e(this).html()}g.p.autoencode&&(u=e.jgrid.htmlDecode(u));if(!0===t[g.p.id].checkOnSubmit||t[g.p.id].checkOnUpdate)t[g.p.id]._savedData[s]=u;s=e.jgrid.jqID(s);switch(p[f].edittype){case"password":case"text":case"button":case"image":case"textarea":if("&nbsp;"===u||"&#160;"===u||1===u.length&&160===u.charCodeAt(0))u="";e("#"+s,"#"+i).val(u);break;case"select":var c=u.split(","),c=e.map(c,function(t){return e.trim(t)});e("#"+s+" option","#"+i).each(function(){this.selected=!!p[f].editoptions.multiple||e.trim(u)!==e.trim(e(this).text())&&c[0]!==e.trim(e(this).text())&&c[0]!==e.trim(e(this).val())?p[f].editoptions.multiple?-1<e.inArray(e.trim(e(this).text()),c)||-1<e.inArray(e.trim(e(this).val()),c)?!0:!1:!1:!0});break;case"checkbox":u=""+u,p[f].editoptions&&p[f].editoptions.value?p[f].editoptions.value.split(":")[0]===u?e("#"+s,"#"+i)[g.p.useProp?"prop":"attr"]({checked:!0,defaultChecked:!0}):e("#"+s,"#"+i)[g.p.useProp?"prop":"attr"]({checked:!1,defaultChecked:!1}):(u=u.toLowerCase(),0>u.search(/(false|f|0|no|n|off|undefined)/i)&&""!==u?(e("#"+s,"#"+i)[g.p.useProp?"prop":"attr"]("checked",!0),e("#"+s,"#"+i)[g.p.useProp?"prop":"attr"]("defaultChecked",!0)):(e("#"+s,"#"+i)[g.p.useProp?"prop":"attr"]("checked",!1),e("#"+s,"#"+i)[g.p.useProp?"prop":"attr"]("defaultChecked",!1)));break;case"custom":try{if(!p[f].editoptions||!e.isFunction(p[f].editoptions.custom_value))throw"e1";p[f].editoptions.custom_value.call(g,e("#"+s,"#"+i),"set",u)}catch(h){"e1"===h?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,h.message,e.jgrid.edit.bClose)}}o++}}),0<o&&e("#id_g",S).val(n))}}function f(){e.each(g.p.colModel,function(e,t){t.editoptions&&!0===t.editoptions.NullIfEmpty&&M.hasOwnProperty(t.name)&&""===M[t.name]&&(M[t.name]="null")})}function l(){var n,i=[!0,"",""],s={},o=g.p.prmNames,l,h,p,d,v,m=e(g).triggerHandler("jqGridAddEditBeforeCheckValues",[e("#"+w),D]);m&&"object"==typeof m&&(M=m),e.isFunction(t[g.p.id].beforeCheckValues)&&(m=t[g.p.id].beforeCheckValues.call(g,M,e("#"+w),D))&&"object"==typeof m&&(M=m);for(p in M)if(M.hasOwnProperty(p)&&(i=e.jgrid.checkValues.call(g,M[p],p),!1===i[0]))break;f(),i[0]&&(s=e(g).triggerHandler("jqGridAddEditClickSubmit",[t[g.p.id],M,D]),void 0===s&&e.isFunction(t[g.p.id].onclickSubmit)&&(s=t[g.p.id].onclickSubmit.call(g,t[g.p.id],M,D)||{}),i=e(g).triggerHandler("jqGridAddEditBeforeSubmit",[M,e("#"+w),D]),void 0===i&&(i=[!0,"",""]),i[0]&&e.isFunction(t[g.p.id].beforeSubmit)&&(i=t[g.p.id].beforeSubmit.call(g,M,e("#"+w),D)));if(i[0]&&!t[g.p.id].processing){t[g.p.id].processing=!0,e("#sData",S+"_2").addClass("ui-state-active"),h=o.oper,l=o.id,M[h]="_empty"===e.trim(M[g.p.id+"_id"])?o.addoper:o.editoper,M[h]!==o.addoper?M[l]=M[g.p.id+"_id"]:void 0===M[l]&&(M[l]=M[g.p.id+"_id"]),delete M[g.p.id+"_id"],M=e.extend(M,t[g.p.id].editData,s);if(!0===g.p.treeGrid)for(v in M[h]===o.addoper&&(d=e(g).jqGrid("getGridParam","selrow"),M["adjacency"===g.p.treeGridModel?g.p.treeReader.parent_id_field:"parent_id"]=d),g.p.treeReader)g.p.treeReader.hasOwnProperty(v)&&(s=g.p.treeReader[v],M.hasOwnProperty(s)&&(M[h]!==o.addoper||"parent_id_field"!==v)&&delete M[s]);M[l]=e.jgrid.stripPref(g.p.idPrefix,M[l]),v=e.extend({url:t[g.p.id].url||e(g).jqGrid("getGridParam","editurl"),type:t[g.p.id].mtype,data:e.isFunction(t[g.p.id].serializeEditData)?t[g.p.id].serializeEditData.call(g,M):M,complete:function(s,f){var p;M[l]=g.p.idPrefix+M[l],s.status>=300&&s.status!==304?(i[0]=!1,i[1]=e(g).triggerHandler("jqGridAddEditErrorTextFormat",[s,D]),i[1]=e.isFunction(t[g.p.id].errorTextFormat)?t[g.p.id].errorTextFormat.call(g,s,D):f+" Status: '"+s.statusText+"'. Error code: "+s.status):(i=e(g).triggerHandler("jqGridAddEditAfterSubmit",[s,M,D]),i===void 0&&(i=[!0,"",""]),i[0]&&e.isFunction(t[g.p.id].afterSubmit)&&(i=t[g.p.id].afterSubmit.call(g,s,M,D)));if(i[0]===!1)e("#FormError>td",S).html(i[1]),e("#FormError",S).show();else{g.p.autoencode&&e.each(M,function(t,n){M[t]=e.jgrid.htmlDecode(n)}),M[h]===o.addoper?(i[2]||(i[2]=e.jgrid.randId()),M[l]=i[2],t[g.p.id].reloadAfterSubmit?e(g).trigger("reloadGrid"):g.p.treeGrid===!0?e(g).jqGrid("addChildNode",i[2],d,M):e(g).jqGrid("addRowData",i[2],M,r.addedrow),t[g.p.id].closeAfterAdd?(g.p.treeGrid!==!0&&e(g).jqGrid("setSelection",i[2]),e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose})):t[g.p.id].clearAfterAdd&&u("_empty",g,w)):(t[g.p.id].reloadAfterSubmit?(e(g).trigger("reloadGrid"),t[g.p.id].closeAfterEdit||setTimeout(function(){e(g).jqGrid("setSelection",M[l])},1e3)):g.p.treeGrid===!0?e(g).jqGrid("setTreeRow",M[l],M):e(g).jqGrid("setRowData",M[l],M),t[g.p.id].closeAfterEdit&&e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose})),e.isFunction(t[g.p.id].afterComplete)&&(n=s,setTimeout(function(){e(g).triggerHandler("jqGridAddEditAfterComplete",[n,M,e("#"+w),D]),t[g.p.id].afterComplete.call(g,n,M,e("#"+w),D),n=null},500));if(t[g.p.id].checkOnSubmit||t[g.p.id].checkOnUpdate){e("#"+w).data("disabled",!1);if(t[g.p.id]._savedData[g.p.id+"_id"]!=="_empty")for(p in t[g.p.id]._savedData)t[g.p.id]._savedData.hasOwnProperty(p)&&M[p]&&(t[g.p.id]._savedData[p]=M[p])}}t[g.p.id].processing=!1,e("#sData",S+"_2").removeClass("ui-state-active");try{e(":input:visible","#"+w)[0].focus()}catch(v){}}},e.jgrid.ajaxOptions,t[g.p.id].ajaxEditOptions),!v.url&&!t[g.p.id].useDataProxy&&(e.isFunction(g.p.dataProxy)?t[g.p.id].useDataProxy=!0:(i[0]=!1,i[1]+=" "+e.jgrid.errors.nourl)),i[0]&&(t[g.p.id].useDataProxy?(s=g.p.dataProxy.call(g,v,"set_"+g.p.id),void 0===s&&(s=[!0,""]),!1===s[0]?(i[0]=!1,i[1]=s[1]||"Error deleting the selected row!"):(v.data.oper===o.addoper&&t[g.p.id].closeAfterAdd&&e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose}),v.data.oper===o.editoper&&t[g.p.id].closeAfterEdit&&e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose}))):e.ajax(v))}!1===i[0]&&(e("#FormError>td",S).html(i[1]),e("#FormError",S).show())}function h(e,t){var n=!1,r;for(r in e)if(e.hasOwnProperty(r)&&e[r]!=t[r]){n=!0;break}return n}function p(){var n=!0;return e("#FormError",S).hide(),t[g.p.id].checkOnUpdate&&(M={},i(),_=h(M,t[g.p.id]._savedData))&&(e("#"+w).data("disabled",!0),e(".confirm","#"+x.themodal).show(),n=!1),n}function d(){var t;if("_empty"!==n&&void 0!==g.p.savedRow&&0<g.p.savedRow.length&&e.isFunction(e.fn.jqGrid.restoreRow))for(t=0;t<g.p.savedRow.length;t++)if(g.p.savedRow[t].id==n){e(g).jqGrid("restoreRow",n);break}}function v(t,n){var r=n[1].length-1;0===t?e("#pData",S+"_2").addClass("ui-state-disabled"):void 0!==n[1][t-1]&&e("#"+e.jgrid.jqID(n[1][t-1])).hasClass("ui-state-disabled")?e("#pData",S+"_2").addClass("ui-state-disabled"):e("#pData",S+"_2").removeClass("ui-state-disabled"),t===r?e("#nData",S+"_2").addClass("ui-state-disabled"):void 0!==n[1][t+1]&&e("#"+e.jgrid.jqID(n[1][t+1])).hasClass("ui-state-disabled")?e("#nData",S+"_2").addClass("ui-state-disabled"):e("#nData",S+"_2").removeClass("ui-state-disabled")}function m(){var t=e(g).jqGrid("getDataIDs"),n=e("#id_g",S).val();return[e.inArray(n,t),t]}var g=this;if(g.grid&&n){var y=g.p.id,w="FrmGrid_"+y,E="TblGrid_"+y,S="#"+e.jgrid.jqID(E),x={themodal:"editmod"+y,modalhead:"edithd"+y,modalcontent:"editcnt"+y,scrollelm:w},T=e.isFunction(t[g.p.id].beforeShowForm)?t[g.p.id].beforeShowForm:!1,N=e.isFunction(t[g.p.id].afterShowForm)?t[g.p.id].afterShowForm:!1,C=e.isFunction(t[g.p.id].beforeInitData)?t[g.p.id].beforeInitData:!1,k=e.isFunction(t[g.p.id].onInitializeForm)?t[g.p.id].onInitializeForm:!1,L=!0,A=1,O=0,M,_,D,w=e.jgrid.jqID(w);"new"===n?(n="_empty",D="add",r.caption=t[g.p.id].addCaption):(r.caption=t[g.p.id].editCaption,D="edit"),!0===r.recreateForm&&void 0!==e("#"+e.jgrid.jqID(x.themodal))[0]&&e("#"+e.jgrid.jqID(x.themodal)).remove();var P=!0;r.checkOnUpdate&&r.jqModal&&!r.modal&&(P=!1);if(void 0!==e("#"+e.jgrid.jqID(x.themodal))[0]){L=e(g).triggerHandler("jqGridAddEditBeforeInitData",[e("#"+e.jgrid.jqID(w)),D]),void 0===L&&(L=!0),L&&C&&(L=C.call(g,e("#"+w),D));if(!1===L)return;d(),e(".ui-jqdialog-title","#"+e.jgrid.jqID(x.modalhead)).html(r.caption),e("#FormError",S).hide(),t[g.p.id].topinfo?(e(".topinfo",S).html(t[g.p.id].topinfo),e(".tinfo",S).show()):e(".tinfo",S).hide(),t[g.p.id].bottominfo?(e(".bottominfo",S+"_2").html(t[g.p.id].bottominfo),e(".binfo",S+"_2").show()):e(".binfo",S+"_2").hide(),u(n,g,w),"_empty"===n||!t[g.p.id].viewPagerButtons?e("#pData, #nData",S+"_2").hide():e("#pData, #nData",S+"_2").show(),!0===t[g.p.id].processing&&(t[g.p.id].processing=!1,e("#sData",S+"_2").removeClass("ui-state-active")),!0===e("#"+w).data("disabled")&&(e(".confirm","#"+e.jgrid.jqID(x.themodal)).hide(),e("#"+w).data("disabled",!1)),e(g).triggerHandler("jqGridAddEditBeforeShowForm",[e("#"+w),D]),T&&T.call(g,e("#"+w),D),e("#"+e.jgrid.jqID(x.themodal)).data("onClose",t[g.p.id].onClose),e.jgrid.viewModal("#"+e.jgrid.jqID(x.themodal),{gbox:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,jqM:!1,overlay:r.overlay,modal:r.modal,overlayClass:r.overlayClass}),P||e("."+e.jgrid.jqID(r.overlayClass)).click(function(){return p()?(e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose}),!1):!1}),e(g).triggerHandler("jqGridAddEditAfterShowForm",[e("#"+w),D]),N&&N.call(g,e("#"+w),D)}else{var H=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px",L=isNaN(r.datawidth)?r.datawidth:r.datawidth+"px",H=e("<form name='FormPost' id='"+w+"' class='FormGrid' onSubmit='return false;' style='width:"+L+";overflow:auto;position:relative;height:"+H+";'></form>").data("disabled",!1),B=e("<table id='"+E+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),L=e(g).triggerHandler("jqGridAddEditBeforeInitData",[e("#"+w),D]);void 0===L&&(L=!0),L&&C&&(L=C.call(g,e("#"+w),D));if(!1===L)return;d(),e(g.p.colModel).each(function(){var e=this.formoptions;A=Math.max(A,e?e.colpos||0:0),O=Math.max(O,e?e.rowpos||0:0)}),e(H).append(B),C=e("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+2*A+"'></td></tr>"),C[0].rp=0,e(B).append(C),C=e("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+2*A+"'>"+t[g.p.id].topinfo+"</td></tr>"),C[0].rp=0,e(B).append(C);var L=(C="rtl"===g.p.direction?!0:!1)?"nData":"pData",j=C?"pData":"nData";o(n,g,B,A);var L="<a id='"+L+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",j="<a id='"+j+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",F="<a id='sData' class='fm-button ui-state-default ui-corner-all'>"+r.bSubmit+"</a>",I="<a id='cData' class='fm-button ui-state-default ui-corner-all'>"+r.bCancel+"</a>",E="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+E+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(C?j+L:L+j)+"</td><td class='EditButton'>"+F+I+"</td></tr>"+("<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+t[g.p.id].bottominfo+"</td></tr>"),E=E+"</tbody></table>";if(0<O){var q=[];e.each(e(B)[0].rows,function(e,t){q[e]=t}),q.sort(function(e,t){return e.rp>t.rp?1:e.rp<t.rp?-1:0}),e.each(q,function(t,n){e("tbody",B).append(n)})}r.gbox="#gbox_"+e.jgrid.jqID(y);var R=!1;!0===r.closeOnEscape&&(r.closeOnEscape=!1,R=!0),E=e("<div></div>").append(H).append(E),e.jgrid.createModal(x,E,r,"#gview_"+e.jgrid.jqID(g.p.id),e("#gbox_"+e.jgrid.jqID(g.p.id))[0]),C&&(e("#pData, #nData",S+"_2").css("float","right"),e(".EditButton",S+"_2").css("text-align","left")),t[g.p.id].topinfo&&e(".tinfo",S).show(),t[g.p.id].bottominfo&&e(".binfo",S+"_2").show(),E=E=null,e("#"+e.jgrid.jqID(x.themodal)).keydown(function(n){var i=n.target;if(e("#"+w).data("disabled")===!0)return!1;if(t[g.p.id].savekey[0]===!0&&n.which===t[g.p.id].savekey[1]&&i.tagName!=="TEXTAREA")return e("#sData",S+"_2").trigger("click"),!1;if(n.which===27)return p()?(R&&e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:r.gbox,jqm:r.jqModal,onClose:t[g.p.id].onClose}),!1):!1;if(t[g.p.id].navkeys[0]===!0){if(e("#id_g",S).val()==="_empty")return!0;if(n.which===t[g.p.id].navkeys[1])return e("#pData",S+"_2").trigger("click"),!1;if(n.which===t[g.p.id].navkeys[2])return e("#nData",S+"_2").trigger("click"),!1}}),r.checkOnUpdate&&(e("a.ui-jqdialog-titlebar-close span","#"+e.jgrid.jqID(x.themodal)).removeClass("jqmClose"),e("a.ui-jqdialog-titlebar-close","#"+e.jgrid.jqID(x.themodal)).unbind("click").click(function(){return p()?(e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose}),!1):!1})),r.saveicon=e.extend([!0,"left","ui-icon-disk"],r.saveicon),r.closeicon=e.extend([!0,"left","ui-icon-close"],r.closeicon),!0===r.saveicon[0]&&e("#sData",S+"_2").addClass("right"===r.saveicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.saveicon[2]+"'></span>"),!0===r.closeicon[0]&&e("#cData",S+"_2").addClass("right"===r.closeicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.closeicon[2]+"'></span>");if(t[g.p.id].checkOnSubmit||t[g.p.id].checkOnUpdate)F="<a id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bYes+"</a>",j="<a id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bNo+"</a>",I="<a id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+r.bExit+"</a>",E=r.zIndex||999,E++,e("<div class='"+r.overlayClass+" jqgrid-overlay confirm' style='z-index:"+E+";display:none;'>&#160;</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(E+1)+"'>"+r.saveData+"<br/><br/>"+F+j+I+"</div>").insertAfter("#"+w),e("#sNew","#"+e.jgrid.jqID(x.themodal)).click(function(){return l(),e("#"+w).data("disabled",!1),e(".confirm","#"+e.jgrid.jqID(x.themodal)).hide(),!1}),e("#nNew","#"+e.jgrid.jqID(x.themodal)).click(function(){return e(".confirm","#"+e.jgrid.jqID(x.themodal)).hide(),e("#"+w).data("disabled",!1),setTimeout(function(){e(":input:visible","#"+w)[0].focus()},0),!1}),e("#cNew","#"+e.jgrid.jqID(x.themodal)).click(function(){return e(".confirm","#"+e.jgrid.jqID(x.themodal)).hide(),e("#"+w).data("disabled",!1),e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose}),!1});e(g).triggerHandler("jqGridAddEditInitializeForm",[e("#"+w),D]),k&&k.call(g,e("#"+w),D),"_empty"===n||!t[g.p.id].viewPagerButtons?e("#pData,#nData",S+"_2").hide():e("#pData,#nData",S+"_2").show(),e(g).triggerHandler("jqGridAddEditBeforeShowForm",[e("#"+w),D]),T&&T.call(g,e("#"+w),D),e("#"+e.jgrid.jqID(x.themodal)).data("onClose",t[g.p.id].onClose),e.jgrid.viewModal("#"+e.jgrid.jqID(x.themodal),{gbox:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,overlay:r.overlay,modal:r.modal,overlayClass:r.overlayClass}),P||e("."+e.jgrid.jqID(r.overlayClass)).click(function(){return p()?(e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose}),!1):!1}),e(g).triggerHandler("jqGridAddEditAfterShowForm",[e("#"+w),D]),N&&N.call(g,e("#"+w),D),e(".fm-button","#"+e.jgrid.jqID(x.themodal)).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}),e("#sData",S+"_2").click(function(){return M={},e("#FormError",S).hide(),i(),M[g.p.id+"_id"]==="_empty"?l():r.checkOnSubmit===!0?(_=h(M,t[g.p.id]._savedData))?(e("#"+w).data("disabled",!0),e(".confirm","#"+e.jgrid.jqID(x.themodal)).show()):l():l(),!1}),e("#cData",S+"_2").click(function(){return p()?(e.jgrid.hideModal("#"+e.jgrid.jqID(x.themodal),{gb:"#gbox_"+e.jgrid.jqID(y),jqm:r.jqModal,onClose:t[g.p.id].onClose}),!1):!1}),e("#nData",S+"_2").click(function(){if(!p())return!1;e("#FormError",S).hide();var t=m();t[0]=parseInt(t[0],10);if(t[0]!==-1&&t[1][t[0]+1]){e(g).triggerHandler("jqGridAddEditClickPgButtons",["next",e("#"+w),t[1][t[0]]]);var n;if(e.isFunction(r.onclickPgButtons)){n=r.onclickPgButtons.call(g,"next",e("#"+w),t[1][t[0]]);if(n!==void 0&&n===!1)return!1}if(e("#"+e.jgrid.jqID(t[1][t[0]+1])).hasClass("ui-state-disabled"))return!1;u(t[1][t[0]+1],g,w),e(g).jqGrid("setSelection",t[1][t[0]+1]),e(g).triggerHandler("jqGridAddEditAfterClickPgButtons",["next",e("#"+w),t[1][t[0]]]),e.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons.call(g,"next",e("#"+w),t[1][t[0]+1]),v(t[0]+1,t)}return!1}),e("#pData",S+"_2").click(function(){if(!p())return!1;e("#FormError",S).hide();var t=m();if(t[0]!==-1&&t[1][t[0]-1]){e(g).triggerHandler("jqGridAddEditClickPgButtons",["prev",e("#"+w),t[1][t[0]]]);var n;if(e.isFunction(r.onclickPgButtons)){n=r.onclickPgButtons.call(g,"prev",e("#"+w),t[1][t[0]]);if(n!==void 0&&n===!1)return!1}if(e("#"+e.jgrid.jqID(t[1][t[0]-1])).hasClass("ui-state-disabled"))return!1;u(t[1][t[0]-1],g,w),e(g).jqGrid("setSelection",t[1][t[0]-1]),e(g).triggerHandler("jqGridAddEditAfterClickPgButtons",["prev",e("#"+w),t[1][t[0]]]),e.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons.call(g,"prev",e("#"+w),t[1][t[0]-1]),v(t[0]-1,t)}return!1})}T=m(),v(T[0],T)}})},viewGridRow:function(n,r){return r=e.extend(!0,{top:0,left:0,width:0,datawidth:"auto",height:"auto",dataheight:"auto",modal:!1,overlay:30,drag:!0,resize:!0,jqModal:!0,closeOnEscape:!1,labelswidth:"30%",closeicon:[],navkeys:[!1,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:!0,recreateForm:!1},e.jgrid.view,r||{}),t[e(this)[0].p.id]=r,this.each(function(){function i(){(!0===t[h.p.id].closeOnEscape||!0===t[h.p.id].navkeys[0])&&setTimeout(function(){e(".ui-jqdialog-titlebar-close","#"+e.jgrid.jqID(y.modalhead)).focus()},0)}function o(t,n,i,s){var o,u,f,l=0,h,p,d=[],v=!1,m,g="<td class='CaptionTD form-view-label ui-widget-content' width='"+r.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",y="",b=["integer","number","currency"],w=0,E=0,S,x,T;for(m=1;m<=s;m++)y+=1===m?g:"<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>";return e(n.p.colModel).each(function(){u=this.editrules&&!0===this.editrules.edithidden?!1:!0===this.hidden?!0:!1,!u&&"right"===this.align&&(this.formatter&&-1!==e.inArray(this.formatter,b)?w=Math.max(w,parseInt(this.width,10)):E=Math.max(E,parseInt(this.width,10)))}),S=0!==w?w:0!==E?E:0,v=e(n).jqGrid("getInd",t),e(n.p.colModel).each(function(t){o=this.name,x=!1,p=(u=this.editrules&&!0===this.editrules.edithidden?!1:!0===this.hidden?!0:!1)?"style='display:none'":"",T="boolean"!=typeof this.viewable?!0:this.viewable;if("cb"!==o&&"subgrid"!==o&&"rn"!==o&&T){h=!1===v?"":o===n.p.ExpandColumn&&!0===n.p.treeGrid?e("td:eq("+t+")",n.rows[v]).text():e("td:eq("+t+")",n.rows[v]).html(),x="right"===this.align&&0!==S?!0:!1;var r=e.extend({},{rowabove:!1,rowcontent:""},this.formoptions||{}),c=parseInt(r.rowpos,10)||l+1,m=parseInt(2*(parseInt(r.colpos,10)||1),10);if(r.rowabove){var g=e("<tr><td class='contentinfo' colspan='"+2*s+"'>"+r.rowcontent+"</td></tr>");e(i).append(g),g[0].rp=c}f=e(i).find("tr[rowpos="+c+"]"),0===f.length&&(f=e("<tr "+p+" rowpos='"+c+"'></tr>").addClass("FormData").attr("id","trv_"+o),e(f).append(y),e(i).append(f),f[0].rp=c),e("td:eq("+(m-2)+")",f[0]).html("<b>"+(void 0===r.label?n.p.colNames[t]:r.label)+"</b>"),e("td:eq("+(m-1)+")",f[0]).append("<span>"+h+"</span>").attr("id","v_"+o),x&&e("td:eq("+(m-1)+") span",f[0]).css({"text-align":"right",width:S+"px"}),d[l]=t,l++}}),0<l&&(t=e("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(2*s-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+t+"'/></td></tr>"),t[0].rp=l+99,e(i).append(t)),d}function u(t,n){var r,i,s=0,o,u;if(u=e(n).jqGrid("getInd",t,!0))e("td",u).each(function(t){r=n.p.colModel[t].name,i=n.p.colModel[t].editrules&&!0===n.p.colModel[t].editrules.edithidden?!1:!0===n.p.colModel[t].hidden?!0:!1,"cb"!==r&&"subgrid"!==r&&"rn"!==r&&(o=r===n.p.ExpandColumn&&!0===n.p.treeGrid?e(this).text():e(this).html(),r=e.jgrid.jqID("v_"+r),e("#"+r+" span","#"+v).html(o),i&&e("#"+r,"#"+v).parents("tr:first").hide(),s++)}),0<s&&e("#id_g","#"+v).val(t)}function f(t,n){var r=n[1].length-1;0===t?e("#pData","#"+v+"_2").addClass("ui-state-disabled"):void 0!==n[1][t-1]&&e("#"+e.jgrid.jqID(n[1][t-1])).hasClass("ui-state-disabled")?e("#pData",v+"_2").addClass("ui-state-disabled"):e("#pData","#"+v+"_2").removeClass("ui-state-disabled"),t===r?e("#nData","#"+v+"_2").addClass("ui-state-disabled"):void 0!==n[1][t+1]&&e("#"+e.jgrid.jqID(n[1][t+1])).hasClass("ui-state-disabled")?e("#nData",v+"_2").addClass("ui-state-disabled"):e("#nData","#"+v+"_2").removeClass("ui-state-disabled")}function l(){var t=e(h).jqGrid("getDataIDs"),n=e("#id_g","#"+v).val();return[e.inArray(n,t),t]}var h=this;if(h.grid&&n){var p=h.p.id,d="ViewGrid_"+e.jgrid.jqID(p),v="ViewTbl_"+e.jgrid.jqID(p),m="ViewGrid_"+p,g="ViewTbl_"+p,y={themodal:"viewmod"+p,modalhead:"viewhd"+p,modalcontent:"viewcnt"+p,scrollelm:d},w=e.isFunction(t[h.p.id].beforeInitData)?t[h.p.id].beforeInitData:!1,E=!0,S=1,x=0;!0===r.recreateForm&&void 0!==e("#"+e.jgrid.jqID(y.themodal))[0]&&e("#"+e.jgrid.jqID(y.themodal)).remove();if(void 0!==e("#"+e.jgrid.jqID(y.themodal))[0]){w&&(E=w.call(h,e("#"+d)),void 0===E&&(E=!0));if(!1===E)return;e(".ui-jqdialog-title","#"+e.jgrid.jqID(y.modalhead)).html(r.caption),e("#FormError","#"+v).hide(),u(n,h),e.isFunction(t[h.p.id].beforeShowForm)&&t[h.p.id].beforeShowForm.call(h,e("#"+d)),e.jgrid.viewModal("#"+e.jgrid.jqID(y.themodal),{gbox:"#gbox_"+e.jgrid.jqID(p),jqm:r.jqModal,jqM:!1,overlay:r.overlay,modal:r.modal}),i()}else{var T=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px",N=isNaN(r.datawidth)?r.datawidth:r.datawidth+"px",m=e("<form name='FormPost' id='"+m+"' class='FormGrid' style='width:"+N+";overflow:auto;position:relative;height:"+T+";'></form>"),C=e("<table id='"+g+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");w&&(E=w.call(h,e("#"+d)),void 0===E&&(E=!0));if(!1===E)return;e(h.p.colModel).each(function(){var e=this.formoptions;S=Math.max(S,e?e.colpos||0:0),x=Math.max(x,e?e.rowpos||0:0)}),e(m).append(C),o(n,h,C,S),g="rtl"===h.p.direction?!0:!1,w="<a id='"+(g?"nData":"pData")+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",E="<a id='"+(g?"pData":"nData")+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",T="<a id='cData' class='fm-button ui-state-default ui-corner-all'>"+r.bClose+"</a>";if(0<x){var k=[];e.each(e(C)[0].rows,function(e,t){k[e]=t}),k.sort(function(e,t){return e.rp>t.rp?1:e.rp<t.rp?-1:0}),e.each(k,function(t,n){e("tbody",C).append(n)})}r.gbox="#gbox_"+e.jgrid.jqID(p),m=e("<div></div>").append(m).append("<table border='0' class='EditTable' id='"+v+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+r.labelswidth+"'>"+(g?E+w:w+E)+"</td><td class='EditButton'>"+T+"</td></tr></tbody></table>"),e.jgrid.createModal(y,m,r,"#gview_"+e.jgrid.jqID(h.p.id),e("#gview_"+e.jgrid.jqID(h.p.id))[0]),g&&(e("#pData, #nData","#"+v+"_2").css("float","right"),e(".EditButton","#"+v+"_2").css("text-align","left")),r.viewPagerButtons||e("#pData, #nData","#"+v+"_2").hide(),m=null,e("#"+y.themodal).keydown(function(n){if(n.which===27)return t[h.p.id].closeOnEscape&&e.jgrid.hideModal("#"+e.jgrid.jqID(y.themodal),{gb:r.gbox,jqm:r.jqModal,onClose:r.onClose}),!1;if(r.navkeys[0]===!0){if(n.which===r.navkeys[1])return e("#pData","#"+v+"_2").trigger("click"),!1;if(n.which===r.navkeys[2])return e("#nData","#"+v+"_2").trigger("click"),!1}}),r.closeicon=e.extend([!0,"left","ui-icon-close"],r.closeicon),!0===r.closeicon[0]&&e("#cData","#"+v+"_2").addClass("right"===r.closeicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.closeicon[2]+"'></span>"),e.isFunction(r.beforeShowForm)&&r.beforeShowForm.call(h,e("#"+d)),e.jgrid.viewModal("#"+e.jgrid.jqID(y.themodal),{gbox:"#gbox_"+e.jgrid.jqID(p),jqm:r.jqModal,overlay:r.overlay,modal:r.modal}),e(".fm-button:not(.ui-state-disabled)","#"+v+"_2").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}),i(),e("#cData","#"+v+"_2").click(function(){return e.jgrid.hideModal("#"+e.jgrid.jqID(y.themodal),{gb:"#gbox_"+e.jgrid.jqID(p),jqm:r.jqModal,onClose:r.onClose}),!1}),e("#nData","#"+v+"_2").click(function(){e("#FormError","#"+v).hide();var t=l();return t[0]=parseInt(t[0],10),t[0]!==-1&&t[1][t[0]+1]&&(e.isFunction(r.onclickPgButtons)&&r.onclickPgButtons.call(h,"next",e("#"+d),t[1][t[0]]),u(t[1][t[0]+1],h),e(h).jqGrid("setSelection",t[1][t[0]+1]),e.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons.call(h,"next",e("#"+d),t[1][t[0]+1]),f(t[0]+1,t)),i(),!1}),e("#pData","#"+v+"_2").click(function(){e("#FormError","#"+v).hide();var t=l();return t[0]!==-1&&t[1][t[0]-1]&&(e.isFunction(r.onclickPgButtons)&&r.onclickPgButtons.call(h,"prev",e("#"+d),t[1][t[0]]),u(t[1][t[0]-1],h),e(h).jqGrid("setSelection",t[1][t[0]-1]),e.isFunction(r.afterclickPgButtons)&&r.afterclickPgButtons.call(h,"prev",e("#"+d),t[1][t[0]-1]),f(t[0]-1,t)),i(),!1})}m=l(),f(m[0],m)}})},delGridRow:function(n,r){return r=e.extend(!0,{top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:!1,overlay:30,drag:!0,resize:!0,url:"",mtype:"POST",reloadAfterSubmit:!0,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:!0,closeOnEscape:!1,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:!1,serializeDelData:null,useDataProxy:!1},e.jgrid.del,r||{}),t[e(this)[0].p.id]=r,this.each(function(){var i=this;if(i.grid&&n){var o=e.isFunction(t[i.p.id].beforeShowForm),u=e.isFunction(t[i.p.id].afterShowForm),f=e.isFunction(t[i.p.id].beforeInitData)?t[i.p.id].beforeInitData:!1,l=i.p.id,h={},p=!0,d="DelTbl_"+e.jgrid.jqID(l),v,m,g,y,w="DelTbl_"+l,E={themodal:"delmod"+l,modalhead:"delhd"+l,modalcontent:"delcnt"+l,scrollelm:d};e.isArray(n)&&(n=n.join());if(void 0!==e("#"+e.jgrid.jqID(E.themodal))[0]){f&&(p=f.call(i,e("#"+d)),void 0===p&&(p=!0));if(!1===p)return;e("#DelData>td","#"+d).text(n),e("#DelError","#"+d).hide(),!0===t[i.p.id].processing&&(t[i.p.id].processing=!1,e("#dData","#"+d).removeClass("ui-state-active")),o&&t[i.p.id].beforeShowForm.call(i,e("#"+d)),e.jgrid.viewModal("#"+e.jgrid.jqID(E.themodal),{gbox:"#gbox_"+e.jgrid.jqID(l),jqm:t[i.p.id].jqModal,jqM:!1,overlay:t[i.p.id].overlay,modal:t[i.p.id].modal})}else{var S=isNaN(t[i.p.id].dataheight)?t[i.p.id].dataheight:t[i.p.id].dataheight+"px",x=isNaN(r.datawidth)?r.datawidth:r.datawidth+"px",w="<div id='"+w+"' class='formdata' style='width:"+x+";overflow:auto;position:relative;height:"+S+";'><table class='DelTable'><tbody><tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>"+("<tr id='DelData' style='display:none'><td >"+n+"</td></tr>"),w=w+('<tr><td class="delmsg" style="white-space:pre;">'+t[i.p.id].msg+"</td></tr><tr><td >&#160;</td></tr>"),w=w+"</tbody></table></div>"+("<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+d+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='DelButton EditButton'>"+("<a id='dData' class='fm-button ui-state-default ui-corner-all'>"+r.bSubmit+"</a>")+"&#160;"+("<a id='eData' class='fm-button ui-state-default ui-corner-all'>"+r.bCancel+"</a>")+"</td></tr></tbody></table>");r.gbox="#gbox_"+e.jgrid.jqID(l),e.jgrid.createModal(E,w,r,"#gview_"+e.jgrid.jqID(i.p.id),e("#gview_"+e.jgrid.jqID(i.p.id))[0]),f&&(p=f.call(i,e("#"+d)),void 0===p&&(p=!0));if(!1===p)return;e(".fm-button","#"+d+"_2").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}),r.delicon=e.extend([!0,"left","ui-icon-scissors"],t[i.p.id].delicon),r.cancelicon=e.extend([!0,"left","ui-icon-cancel"],t[i.p.id].cancelicon),!0===r.delicon[0]&&e("#dData","#"+d+"_2").addClass("right"===r.delicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.delicon[2]+"'></span>"),!0===r.cancelicon[0]&&e("#eData","#"+d+"_2").addClass("right"===r.cancelicon[1]?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+r.cancelicon[2]+"'></span>"),e("#dData","#"+d+"_2").click(function(){var n=[!0,""],s,o=e("#DelData>td","#"+d).text();h={},e.isFunction(t[i.p.id].onclickSubmit)&&(h=t[i.p.id].onclickSubmit.call(i,t[i.p.id],o)||{}),e.isFunction(t[i.p.id].beforeSubmit)&&(n=t[i.p.id].beforeSubmit.call(i,o));if(n[0]&&!t[i.p.id].processing){t[i.p.id].processing=!0,g=i.p.prmNames,v=e.extend({},t[i.p.id].delData,h),y=g.oper,v[y]=g.deloper,m=g.id,o=(""+o).split(",");if(!o.length)return!1;for(s in o)o.hasOwnProperty(s)&&(o[s]=e.jgrid.stripPref(i.p.idPrefix,o[s]));v[m]=o.join(),e(this).addClass("ui-state-active"),s=e.extend({url:t[i.p.id].url||e(i).jqGrid("getGridParam","editurl"),type:t[i.p.id].mtype,data:e.isFunction(t[i.p.id].serializeDelData)?t[i.p.id].serializeDelData.call(i,v):v,complete:function(s,u){var f;s.status>=300&&s.status!==304?(n[0]=!1,n[1]=e.isFunction(t[i.p.id].errorTextFormat)?t[i.p.id].errorTextFormat.call(i,s):u+" Status: '"+s.statusText+"'. Error code: "+s.status):e.isFunction(t[i.p.id].afterSubmit)&&(n=t[i.p.id].afterSubmit.call(i,s,v));if(n[0]===!1)e("#DelError>td","#"+d).html(n[1]),e("#DelError","#"+d).show();else{if(t[i.p.id].reloadAfterSubmit&&i.p.datatype!=="local")e(i).trigger("reloadGrid");else{if(i.p.treeGrid===!0)try{e(i).jqGrid("delTreeNode",i.p.idPrefix+o[0])}catch(h){}else for(f=0;f<o.length;f++)e(i).jqGrid("delRowData",i.p.idPrefix+o[f]);i.p.selrow=null,i.p.selarrrow=[]}e.isFunction(t[i.p.id].afterComplete)&&setTimeout(function(){t[i.p.id].afterComplete.call(i,s,o)},500)}t[i.p.id].processing=!1,e("#dData","#"+d+"_2").removeClass("ui-state-active"),n[0]&&e.jgrid.hideModal("#"+e.jgrid.jqID(E.themodal),{gb:"#gbox_"+e.jgrid.jqID(l),jqm:r.jqModal,onClose:t[i.p.id].onClose})}},e.jgrid.ajaxOptions,t[i.p.id].ajaxDelOptions),!s.url&&!t[i.p.id].useDataProxy&&(e.isFunction(i.p.dataProxy)?t[i.p.id].useDataProxy=!0:(n[0]=!1,n[1]=n[1]+(" "+e.jgrid.errors.nourl))),n[0]&&(t[i.p.id].useDataProxy?(s=i.p.dataProxy.call(i,s,"del_"+i.p.id),s===void 0&&(s=[!0,""]),s[0]===!1?(n[0]=!1,n[1]=s[1]||"Error deleting the selected row!"):e.jgrid.hideModal("#"+e.jgrid.jqID(E.themodal),{gb:"#gbox_"+e.jgrid.jqID(l),jqm:r.jqModal,onClose:t[i.p.id].onClose})):e.ajax(s))}return n[0]===!1&&(e("#DelError>td","#"+d).html(n[1]),e("#DelError","#"+d).show()),!1}),e("#eData","#"+d+"_2").click(function(){return e.jgrid.hideModal("#"+e.jgrid.jqID(E.themodal),{gb:"#gbox_"+e.jgrid.jqID(l),jqm:t[i.p.id].jqModal,onClose:t[i.p.id].onClose}),!1}),o&&t[i.p.id].beforeShowForm.call(i,e("#"+d)),e.jgrid.viewModal("#"+e.jgrid.jqID(E.themodal),{gbox:"#gbox_"+e.jgrid.jqID(l),jqm:t[i.p.id].jqModal,overlay:t[i.p.id].overlay,modal:t[i.p.id].modal})}u&&t[i.p.id].afterShowForm.call(i,e("#"+d)),!0===t[i.p.id].closeOnEscape&&setTimeout(function(){e(".ui-jqdialog-titlebar-close","#"+e.jgrid.jqID(E.modalhead)).focus()},0)}})},navGrid:function(t,n,r,i,s,o,u){return n=e.extend({edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",del:!0,delicon:"ui-icon-trash",search:!0,searchicon:"ui-icon-search",refresh:!0,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:!1,viewicon:"ui-icon-document",position:"left",closeOnEscape:!0,beforeRefresh:null,afterRefresh:null,cloneToTop:!1,alertwidth:200,alertheight:"auto",alerttop:null,alertleft:null,alertzIndex:null},e.jgrid.nav,n||{}),this.each(function(){if(!this.nav){var f={themodal:"alertmod_"+this.p.id,modalhead:"alerthd_"+this.p.id,modalcontent:"alertcnt_"+this.p.id},l=this,p;if(l.grid&&"string"==typeof t){void 0===e("#"+f.themodal)[0]&&(!n.alerttop&&!n.alertleft&&(void 0!==window.innerWidth?(n.alertleft=window.innerWidth,n.alerttop=window.innerHeight):void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(n.alertleft=document.documentElement.clientWidth,n.alerttop=document.documentElement.clientHeight):(n.alertleft=1024,n.alerttop=768),n.alertleft=n.alertleft/2-parseInt(n.alertwidth,10)/2,n.alerttop=n.alerttop/2-25),e.jgrid.createModal(f,"<div>"+n.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+e.jgrid.jqID(l.p.id),jqModal:!0,drag:!0,resize:!0,caption:n.alertcap,top:n.alerttop,left:n.alertleft,width:n.alertwidth,height:n.alertheight,closeOnEscape:n.closeOnEscape,zIndex:n.alertzIndex},"#gview_"+e.jgrid.jqID(l.p.id),e("#gbox_"+e.jgrid.jqID(l.p.id))[0],!0));var d=1,v,m=function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},g=function(){e(this).removeClass("ui-state-hover")};n.cloneToTop&&l.p.toppager&&(d=2);for(v=0;v<d;v++){var y=e("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),w,E;0===v?(w=t,E=l.p.id,w===l.p.toppager&&(E+="_top",d=1)):(w=l.p.toppager,E=l.p.id+"_top"),"rtl"===l.p.direction&&e(y).attr("dir","rtl").css("float","right"),n.add&&(i=i||{},p=e("<td class='ui-pg-button ui-corner-all'></td>"),e(p).append("<div class='ui-pg-div'><span class='ui-icon "+n.addicon+"'></span>"+n.addtext+"</div>"),e("tr",y).append(p),e(p,y).attr({title:n.addtitle||"",id:i.id||"add_"+E}).click(function(){return e(this).hasClass("ui-state-disabled")||(e.isFunction(n.addfunc)?n.addfunc.call(l):e(l).jqGrid("editGridRow","new",i)),!1}).hover(m,g),p=null),n.edit&&(p=e("<td class='ui-pg-button ui-corner-all'></td>"),r=r||{},e(p).append("<div class='ui-pg-div'><span class='ui-icon "+n.editicon+"'></span>"+n.edittext+"</div>"),e("tr",y).append(p),e(p,y).attr({title:n.edittitle||"",id:r.id||"edit_"+E}).click(function(){if(!e(this).hasClass("ui-state-disabled")){var t=l.p.selrow;t?e.isFunction(n.editfunc)?n.editfunc.call(l,t):e(l).jqGrid("editGridRow",t,r):(e.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+e.jgrid.jqID(l.p.id),jqm:!0}),e("#jqg_alrt").focus())}return!1}).hover(m,g),p=null),n.view&&(p=e("<td class='ui-pg-button ui-corner-all'></td>"),u=u||{},e(p).append("<div class='ui-pg-div'><span class='ui-icon "+n.viewicon+"'></span>"+n.viewtext+"</div>"),e("tr",y).append(p),e(p,y).attr({title:n.viewtitle||"",id:u.id||"view_"+E}).click(function(){if(!e(this).hasClass("ui-state-disabled")){var t=l.p.selrow;t?e.isFunction(n.viewfunc)?n.viewfunc.call(l,t):e(l).jqGrid("viewGridRow",t,u):(e.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+e.jgrid.jqID(l.p.id),jqm:!0}),e("#jqg_alrt").focus())}return!1}).hover(m,g),p=null),n.del&&(p=e("<td class='ui-pg-button ui-corner-all'></td>"),s=s||{},e(p).append("<div class='ui-pg-div'><span class='ui-icon "+n.delicon+"'></span>"+n.deltext+"</div>"),e("tr",y).append(p),e(p,y).attr({title:n.deltitle||"",id:s.id||"del_"+E}).click(function(){if(!e(this).hasClass("ui-state-disabled")){var t;l.p.multiselect?(t=l.p.selarrrow,t.length===0&&(t=null)):t=l.p.selrow,t?e.isFunction(n.delfunc)?n.delfunc.call(l,t):e(l).jqGrid("delGridRow",t,s):(e.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+e.jgrid.jqID(l.p.id),jqm:!0}),e("#jqg_alrt").focus())}return!1}).hover(m,g),p=null),(n.add||n.edit||n.del||n.view)&&e("tr",y).append("<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>"),n.search&&(p=e("<td class='ui-pg-button ui-corner-all'></td>"),o=o||{},e(p).append("<div class='ui-pg-div'><span class='ui-icon "+n.searchicon+"'></span>"+n.searchtext+"</div>"),e("tr",y).append(p),e(p,y).attr({title:n.searchtitle||"",id:o.id||"search_"+E}).click(function(){return e(this).hasClass("ui-state-disabled")||(e.isFunction(n.searchfunc)?n.searchfunc.call(l,o):e(l).jqGrid("searchGrid",o)),!1}).hover(m,g),o.showOnLoad&&!0===o.showOnLoad&&e(p,y).click(),p=null),n.refresh&&(p=e("<td class='ui-pg-button ui-corner-all'></td>"),e(p).append("<div class='ui-pg-div'><span class='ui-icon "+n.refreshicon+"'></span>"+n.refreshtext+"</div>"),e("tr",y).append(p),e(p,y).attr({title:n.refreshtitle||"",id:"refresh_"+E}).click(function(){if(!e(this).hasClass("ui-state-disabled")){e.isFunction(n.beforeRefresh)&&n.beforeRefresh.call(l),l.p.search=!1;try{var t=l.p.id;l.p.postData.filters="";try{e("#fbox_"+e.jgrid.jqID(t)).jqFilter("resetFilter")}catch(r){}e.isFunction(l.clearToolbar)&&l.clearToolbar.call(l,!1)}catch(i){}switch(n.refreshstate){case"firstpage":e(l).trigger("reloadGrid",[{page:1}]);break;case"current":e(l).trigger("reloadGrid",[{current:!0}])}e.isFunction(n.afterRefresh)&&n.afterRefresh.call(l)}return!1}).hover(m,g),p=null),p=e(".ui-jqgrid").css("font-size")||"11px",e("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+p+";visibility:hidden;' ></div>"),p=e(y).clone().appendTo("#testpg2").width(),e("#testpg2").remove(),e(w+"_"+n.position,w).append(y),l.p._nvtd&&(p>l.p._nvtd[0]&&(e(w+"_"+n.position,w).width(p),l.p._nvtd[0]=p),l.p._nvtd[1]=p),y=p=p=null,this.nav=!0}}}})},navButtonAdd:function(t,n){return n=e.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},n||{}),this.each(function(){if(this.grid){"string"==typeof t&&0!==t.indexOf("#")&&(t="#"+e.jgrid.jqID(t));var r=e(".navtable",t)[0],i=this;if(r&&(!n.id||void 0===e("#"+e.jgrid.jqID(n.id),r)[0])){var s=e("<td></td>");"NONE"===n.buttonicon.toString().toUpperCase()?e(s).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+n.caption+"</div>"):e(s).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+n.buttonicon+"'></span>"+n.caption+"</div>"),n.id&&e(s).attr("id",n.id),"first"===n.position?0===r.rows[0].cells.length?e("tr",r).append(s):e("tr td:eq(0)",r).before(s):e("tr",r).append(s),e(s,r).attr("title",n.title||"").click(function(t){return e(this).hasClass("ui-state-disabled")||e.isFunction(n.onClickButton)&&n.onClickButton.call(i,t),!1}).hover(function(){e(this).hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")})}}})},navSeparatorAdd:function(t,n){return n=e.extend({sepclass:"ui-separator",sepcontent:"",position:"last"},n||{}),this.each(function(){if(this.grid){"string"==typeof t&&0!==t.indexOf("#")&&(t="#"+e.jgrid.jqID(t));var r=e(".navtable",t)[0];if(r){var i="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+n.sepclass+"'></span>"+n.sepcontent+"</td>";"first"===n.position?0===r.rows[0].cells.length?e("tr",r).append(i):e("tr td:eq(0)",r).before(i):e("tr",r).append(i)}}})},GridToForm:function(t,n){return this.each(function(){var r=this,i;if(r.grid){var s=e(r).jqGrid("getRowData",t);if(s)for(i in s)s.hasOwnProperty(i)&&(e("[name="+e.jgrid.jqID(i)+"]",n).is("input:radio")||e("[name="+e.jgrid.jqID(i)+"]",n).is("input:checkbox")?e("[name="+e.jgrid.jqID(i)+"]",n).each(function(){e(this).val()==s[i]?e(this)[r.p.useProp?"prop":"attr"]("checked",!0):e(this)[r.p.useProp?"prop":"attr"]("checked",!1)}):e("[name="+e.jgrid.jqID(i)+"]",n).val(s[i]))}})},FormToGrid:function(t,n,r,i){return this.each(function(){if(this.grid){r||(r="set"),i||(i="first");var s=e(n).serializeArray(),o={};e.each(s,function(e,t){o[t.name]=t.value}),"add"===r?e(this).jqGrid("addRowData",t,o,i):"set"===r&&e(this).jqGrid("setRowData",t,o)}})}})}(jQuery),function(e){e.fn.jqFilter=function(t){if("string"==typeof t){var n=e.fn.jqFilter[t];if(!n)throw"jqFilter - No such method: "+t;var r=e.makeArray(arguments).slice(1);return n.apply(this,r)}var i=e.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[],operands:null,numopts:"eq,ne,lt,le,gt,ge,nu,nn,in,ni".split(","),stropts:"eq,ne,bw,bn,ew,en,cn,nc,nu,nn,in,ni".split(","),strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},e.jgrid.filter,t||{});return this.each(function(){if(!this.filter){this.p=i;if(null===this.p.filter||void 0===this.p.filter)this.p.filter={groupOp:this.p.groupOps[0].op,rules:[],groups:[]};var t,n=this.p.columns.length,r,s=/msie/i.test(navigator.userAgent)&&!window.opera;this.p.initFilter=e.extend(!0,{},this.p.filter);if(n){for(t=0;t<n;t++)if(r=this.p.columns[t],r.stype?r.inputtype=r.stype:r.inputtype||(r.inputtype="text"),r.sorttype?r.searchtype=r.sorttype:r.searchtype||(r.searchtype="string"),void 0===r.hidden&&(r.hidden=!1),r.label||(r.label=r.name),r.index&&(r.name=r.index),r.hasOwnProperty("searchoptions")||(r.searchoptions={}),!r.hasOwnProperty("searchrules"))r.searchrules={};this.p.showQuery&&e(this).append("<table class='queryresult ui-widget ui-widget-content' style='display:block;max-width:440px;border:0px none;' dir='"+this.p.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var o=function(){return e("#"+e.jgrid.jqID(i.id))[0]||null},u=function(t,n){var r=[!0,""],s=o();if(e.isFunction(n.searchrules))r=n.searchrules.call(s,t,n);else if(e.jgrid&&e.jgrid.checkValues)try{r=e.jgrid.checkValues.call(s,t,-1,n.searchrules,n.label)}catch(u){}r&&r.length&&!1===r[0]&&(i.error=!r[0],i.errmsg=r[1])};this.onchange=function(){return this.p.error=!1,this.p.errmsg="",e.isFunction(this.p.onChange)?this.p.onChange.call(this,this.p):!1},this.reDraw=function(){e("table.group:first",this).remove();var t=this.createTableForGroup(i.filter,null);e(this).append(t),e.isFunction(this.p.afterRedraw)&&this.p.afterRedraw.call(this,this.p)},this.createTableForGroup=function(t,n){var r=this,s,o=e("<table class='group ui-widget ui-widget-content' style='border:0px none;'><tbody></tbody></table>"),u="left";"rtl"===this.p.direction&&(u="right",o.attr("dir","rtl")),null===n&&o.append("<tr class='error' style='display:none;'><th colspan='5' class='ui-state-error' align='"+u+"'></th></tr>");var f=e("<tr></tr>");o.append(f),u=e("<th colspan='5' align='"+u+"'></th>"),f.append(u);if(!0===this.p.ruleButtons){var l=e("<select class='opsel'></select>");u.append(l);var f="",c;for(s=0;s<i.groupOps.length;s++)c=t.groupOp===r.p.groupOps[s].op?" selected='selected'":"",f+="<option value='"+r.p.groupOps[s].op+"'"+c+">"+r.p.groupOps[s].text+"</option>";l.append(f).bind("change",function(){t.groupOp=e(l).val(),r.onchange()})}f="<span></span>",this.p.groupButton&&(f=e("<input type='button' value='+ {}' title='Add subgroup' class='add-group'/>"),f.bind("click",function(){return t.groups===void 0&&(t.groups=[]),t.groups.push({groupOp:i.groupOps[0].op,rules:[],groups:[]}),r.reDraw(),r.onchange(),!1})),u.append(f);if(!0===this.p.ruleButtons){var f=e("<input type='button' value='+' title='Add rule' class='add-rule ui-add'/>"),h;f.bind("click",function(){t.rules===void 0&&(t.rules=[]);for(s=0;s<r.p.columns.length;s++){var n=r.p.columns[s].search===void 0?!0:r.p.columns[s].search,i=r.p.columns[s].hidden===!0;if(r.p.columns[s].searchoptions.searchhidden===!0&&n||n&&!i){h=r.p.columns[s];break}}return n=h.searchoptions.sopt?h.searchoptions.sopt:r.p.sopt?r.p.sopt:e.inArray(h.searchtype,r.p.strarr)!==-1?r.p.stropts:r.p.numopts,t.rules.push({field:h.name,op:n[0],data:""}),r.reDraw(),!1}),u.append(f)}null!==n&&(f=e("<input type='button' value='-' title='Delete group' class='delete-group'/>"),u.append(f),f.bind("click",function(){for(s=0;s<n.groups.length;s++)if(n.groups[s]===t){n.groups.splice(s,1);break}return r.reDraw(),r.onchange(),!1}));if(void 0!==t.groups)for(s=0;s<t.groups.length;s++)u=e("<tr></tr>"),o.append(u),f=e("<td class='first'></td>"),u.append(f),f=e("<td colspan='4'></td>"),f.append(this.createTableForGroup(t.groups[s],t)),u.append(f);void 0===t.groupOp&&(t.groupOp=r.p.groupOps[0].op);if(void 0!==t.rules)for(s=0;s<t.rules.length;s++)o.append(this.createTableRowForRule(t.rules[s],t));return o},this.createTableRowForRule=function(t,n){var r=this,u=o(),f=e("<tr></tr>"),l,c,h,p,d="",v;f.append("<td class='first'></td>");var m=e("<td class='columns'></td>");f.append(m);var g=e("<select></select>"),y,b=[];m.append(g),g.bind("change",function(){t.field=e(g).val(),h=e(this).parents("tr:first");for(l=0;l<r.p.columns.length;l++)if(r.p.columns[l].name===t.field){p=r.p.columns[l];break}if(p){p.searchoptions.id=e.jgrid.randId(),s&&"text"===p.inputtype&&!p.searchoptions.size&&(p.searchoptions.size=10);var n=e.jgrid.createEl.call(u,p.inputtype,p.searchoptions,"",!0,r.p.ajaxSelectOptions||{},!0);e(n).addClass("input-elm"),c=p.searchoptions.sopt?p.searchoptions.sopt:r.p.sopt?r.p.sopt:-1!==e.inArray(p.searchtype,r.p.strarr)?r.p.stropts:r.p.numopts;var i="",o=0;b=[],e.each(r.p.ops,function(){b.push(this.oper)});for(l=0;l<c.length;l++)y=e.inArray(c[l],b),-1!==y&&(0===o&&(t.op=r.p.ops[y].oper),i+="<option value='"+r.p.ops[y].oper+"'>"+r.p.ops[y].text+"</option>",o++);e(".selectopts",h).empty().append(i),e(".selectopts",h)[0].selectedIndex=0,e.jgrid.msie&&9>e.jgrid.msiever()&&(i=parseInt(e("select.selectopts",h)[0].offsetWidth,10)+1,e(".selectopts",h).width(i),e(".selectopts",h).css("width","auto")),e(".data",h).empty().append(n),e.jgrid.bindEv.call(u,n,p.searchoptions),e(".input-elm",h).bind("change",function(n){var i=e(this).hasClass("ui-autocomplete-input")?200:0;setTimeout(function(){var i=n.target;t.data=i.nodeName.toUpperCase()==="SPAN"&&p.searchoptions&&e.isFunction(p.searchoptions.custom_value)?p.searchoptions.custom_value.call(u,e(i).children(".customelement:first"),"get"):i.value,r.onchange()},i)}),setTimeout(function(){t.data=e(n).val(),r.onchange()},0)}});for(l=m=0;l<r.p.columns.length;l++){v=void 0===r.p.columns[l].search?!0:r.p.columns[l].search;var w=!0===r.p.columns[l].hidden;if(!0===r.p.columns[l].searchoptions.searchhidden&&v||v&&!w)v="",t.field===r.p.columns[l].name&&(v=" selected='selected'",m=l),d+="<option value='"+r.p.columns[l].name+"'"+v+">"+r.p.columns[l].label+"</option>"}g.append(d),d=e("<td class='operators'></td>"),f.append(d),p=i.columns[m],p.searchoptions.id=e.jgrid.randId(),s&&"text"===p.inputtype&&!p.searchoptions.size&&(p.searchoptions.size=10),m=e.jgrid.createEl.call(u,p.inputtype,p.searchoptions,t.data,!0,r.p.ajaxSelectOptions||{},!0);if("nu"===t.op||"nn"===t.op)e(m).attr("readonly","true"),e(m).attr("disabled","true");var E=e("<select class='selectopts'></select>");d.append(E),E.bind("change",function(){t.op=e(E).val(),h=e(this).parents("tr:first");var n=e(".input-elm",h)[0];t.op==="nu"||t.op==="nn"?(t.data="",n.tagName.toUpperCase()!=="SELECT"&&(n.value=""),n.setAttribute("readonly","true"),n.setAttribute("disabled","true")):(n.tagName.toUpperCase()==="SELECT"&&(t.data=n.value),n.removeAttribute("readonly"),n.removeAttribute("disabled")),r.onchange()}),c=p.searchoptions.sopt?p.searchoptions.sopt:r.p.sopt?r.p.sopt:-1!==e.inArray(p.searchtype,r.p.strarr)?r.p.stropts:r.p.numopts,d="",e.each(r.p.ops,function(){b.push(this.oper)});for(l=0;l<c.length;l++)y=e.inArray(c[l],b),-1!==y&&(v=t.op===r.p.ops[y].oper?" selected='selected'":"",d+="<option value='"+r.p.ops[y].oper+"'"+v+">"+r.p.ops[y].text+"</option>");return E.append(d),d=e("<td class='data'></td>"),f.append(d),d.append(m),e.jgrid.bindEv.call(u,m,p.searchoptions),e(m).addClass("input-elm").bind("change",function(){t.data=p.inputtype==="custom"?p.searchoptions.custom_value.call(u,e(this).children(".customelement:first"),"get"):e(this).val(),r.onchange()}),d=e("<td></td>"),f.append(d),!0===this.p.ruleButtons&&(m=e("<input type='button' value='-' title='Delete rule' class='delete-rule ui-del'/>"),d.append(m),m.bind("click",function(){for(l=0;l<n.rules.length;l++)if(n.rules[l]===t){n.rules.splice(l,1);break}return r.reDraw(),r.onchange(),!1})),f},this.getStringForGroup=function(e){var t="(",n;if(void 0!==e.groups)for(n=0;n<e.groups.length;n++){1<t.length&&(t+=" "+e.groupOp+" ");try{t+=this.getStringForGroup(e.groups[n])}catch(r){alert(r)}}if(void 0!==e.rules)try{for(n=0;n<e.rules.length;n++)1<t.length&&(t+=" "+e.groupOp+" "),t+=this.getStringForRule(e.rules[n])}catch(i){alert(i)}return t+=")","()"===t?"":t},this.getStringForRule=function(t){var n="",r="",s,o;for(s=0;s<this.p.ops.length;s++)if(this.p.ops[s].oper===t.op){n=this.p.operands.hasOwnProperty(t.op)?this.p.operands[t.op]:"",r=this.p.ops[s].oper;break}for(s=0;s<this.p.columns.length;s++)if(this.p.columns[s].name===t.field){o=this.p.columns[s];break}if(void 0===o)return"";s=t.data;if("bw"===r||"bn"===r)s+="%";if("ew"===r||"en"===r)s="%"+s;if("cn"===r||"nc"===r)s="%"+s+"%";if("in"===r||"ni"===r)s=" ("+s+")";return i.errorcheck&&u(t.data,o),-1!==e.inArray(o.searchtype,["int","integer","float","number","currency"])||"nn"===r||"nu"===r?t.field+" "+n+" "+s:t.field+" "+n+' "'+s+'"'},this.resetFilter=function(){this.p.filter=e.extend(!0,{},this.p.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){e("th.ui-state-error",this).html(""),e("tr.error",this).hide()},this.showError=function(){e("th.ui-state-error",this).html(this.p.errmsg),e("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(i.filter)},this.toString=function(){function e(n){var r="(",i;if(void 0!==n.groups)for(i=0;i<n.groups.length;i++)1<r.length&&(r="OR"===n.groupOp?r+" || ":r+" && "),r+=e(n.groups[i]);if(void 0!==n.rules)for(i=0;i<n.rules.length;i++){1<r.length&&(r="OR"===n.groupOp?r+" || ":r+" && ");var s=n.rules[i];if(t.p.errorcheck){for(var o=void 0,f=void 0,o=0;o<t.p.columns.length;o++)if(t.p.columns[o].name===s.field){f=t.p.columns[o];break}f&&u(s.data,f)}r+=s.op+"(item."+s.field+",'"+s.data+"')"}return r+=")","()"===r?"":r}var t=this;return e(this.p.filter)},this.reDraw(),this.p.showQuery&&this.onchange(),this.filter=!0}}})},e.extend(e.fn.jqFilter,{toSQLString:function(){var e="";return this.each(function(){e=this.toUserFriendlyString()}),e},filterData:function(){var e;return this.each(function(){e=this.p.filter}),e},getParameter:function(e){return void 0!==e&&this.p.hasOwnProperty(e)?this.p[e]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(t){"string"==typeof t&&(t=e.jgrid.parse(t)),this.each(function(){this.p.filter=t,this.reDraw(),this.onchange()})}})}(jQuery),function(e){e.jgrid.inlineEdit=e.jgrid.inlineEdit||{},e.jgrid.extend({editRow:function(t,n,r,i,s,o,u,f,l){var c={},h=e.makeArray(arguments).slice(1);if("object"===e.type(h[0]))c=h[0];else if(void 0!==n&&(c.keys=n),e.isFunction(r)&&(c.oneditfunc=r),e.isFunction(i)&&(c.successfunc=i),void 0!==s&&(c.url=s),void 0!==o&&(c.extraparam=o),e.isFunction(u)&&(c.aftersavefunc=u),e.isFunction(f)&&(c.errorfunc=f),e.isFunction(l))c.afterrestorefunc=l;return c=e.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},e.jgrid.inlineEdit,c),this.each(function(){var n=this,r,i,s=0,o=null,u={},f,l,h;n.grid&&(f=e(n).jqGrid("getInd",t,!0),!1!==f&&(h=e.isFunction(c.beforeEditRow)?c.beforeEditRow.call(n,c,t):void 0,void 0===h&&(h=!0),h&&"0"===(e(f).attr("editable")||"0")&&!e(f).hasClass("not-editable-row")))&&(l=n.p.colModel,e('td[role="gridcell"]',f).each(function(f){r=l[f].name;var c=!0===n.p.treeGrid&&r===n.p.ExpandColumn;if(c)i=e("span:first",this).html();else try{i=e.unformat.call(n,this,{rowId:t,colModel:l[f]},f)}catch(h){i=l[f].edittype&&"textarea"===l[f].edittype?e(this).text():e(this).html()}if("cb"!==r&&"subgrid"!==r&&"rn"!==r&&(n.p.autoencode&&(i=e.jgrid.htmlDecode(i)),u[r]=i,!0===l[f].editable)){null===o&&(o=f),c?e("span:first",this).html(""):e(this).html("");var p=e.extend({},l[f].editoptions||{},{id:t+"_"+r,name:r});l[f].edittype||(l[f].edittype="text");if("&nbsp;"===i||"&#160;"===i||1===i.length&&160===i.charCodeAt(0))i="";var v=e.jgrid.createEl.call(n,l[f].edittype,p,i,!0,e.extend({},e.jgrid.ajaxOptions,n.p.ajaxSelectOptions||{}));e(v).addClass("editable"),c?e("span:first",this).append(v):e(this).append(v),e.jgrid.bindEv.call(n,v,p),"select"===l[f].edittype&&void 0!==l[f].editoptions&&!0===l[f].editoptions.multiple&&void 0===l[f].editoptions.dataUrl&&e.jgrid.msie&&e(v).width(e(v).width()),s++}}),0<s&&(u.id=t,n.p.savedRow.push(u),e(f).attr("editable","1"),e("td:eq("+o+") input",f).focus(),!0===c.keys&&e(f).bind("keydown",function(r){if(27===r.keyCode){e(n).jqGrid("restoreRow",t,c.afterrestorefunc);if(n.p._inlinenav)try{e(n).jqGrid("showAddEditButtons")}catch(i){}return!1}if(13===r.keyCode){if("TEXTAREA"===r.target.tagName)return!0;if(e(n).jqGrid("saveRow",t,c)&&n.p._inlinenav)try{e(n).jqGrid("showAddEditButtons")}catch(s){}return!1}}),e(n).triggerHandler("jqGridInlineEditRow",[t,c]),e.isFunction(c.oneditfunc)&&c.oneditfunc.call(n,t)))})},saveRow:function(t,n,r,i,s,o,u){var f=e.makeArray(arguments).slice(1),l={};if("object"===e.type(f[0]))l=f[0];else if(e.isFunction(n)&&(l.successfunc=n),void 0!==r&&(l.url=r),void 0!==i&&(l.extraparam=i),e.isFunction(s)&&(l.aftersavefunc=s),e.isFunction(o)&&(l.errorfunc=o),e.isFunction(u))l.afterrestorefunc=u;var l=e.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST"},e.jgrid.inlineEdit,l),c=!1,h=this[0],p,d={},v={},m={},g,y,b;if(!h.grid)return c;b=e(h).jqGrid("getInd",t,!0);if(!1===b)return c;f=e.isFunction(l.beforeSaveRow)?l.beforeSaveRow.call(h,l,t):void 0,void 0===f&&(f=!0);if(f){f=e(b).attr("editable"),l.url=l.url||h.p.editurl;if("1"===f){var w;e('td[role="gridcell"]',b).each(function(t){w=h.p.colModel[t],p=w.name;if("cb"!==p&&"subgrid"!==p&&!0===w.editable&&"rn"!==p&&!e(this).hasClass("not-editable-cell")){switch(w.edittype){case"checkbox":var n=["Yes","No"];w.editoptions&&(n=w.editoptions.value.split(":")),d[p]=e("input",this).is(":checked")?n[0]:n[1];break;case"text":case"password":case"textarea":case"button":d[p]=e("input, textarea",this).val();break;case"select":if(w.editoptions.multiple){var n=e("select",this),r=[];d[p]=e(n).val(),d[p]=d[p]?d[p].join(","):"",e("select option:selected",this).each(function(t,n){r[t]=e(n).text()}),v[p]=r.join(",")}else d[p]=e("select option:selected",this).val(),v[p]=e("select option:selected",this).text();w.formatter&&"select"===w.formatter&&(v={});break;case"custom":try{if(!w.editoptions||!e.isFunction(w.editoptions.custom_value))throw"e1";if(d[p]=w.editoptions.custom_value.call(h,e(".customelement",this),"get"),void 0===d[p])throw"e2"}catch(i){"e1"===i&&e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"===i?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,i.message,e.jgrid.edit.bClose)}}y=e.jgrid.checkValues.call(h,d[p],t);if(!1===y[0])return!1;h.p.autoencode&&(d[p]=e.jgrid.htmlEncode(d[p])),"clientArray"!==l.url&&w.editoptions&&!0===w.editoptions.NullIfEmpty&&""===d[p]&&(m[p]="null")}});if(!1===y[0]){try{var E=e(h).jqGrid("getGridRowById",t),S=e.jgrid.findPos(E);e.jgrid.info_dialog(e.jgrid.errors.errcap,y[1],e.jgrid.edit.bClose,{left:S[0],top:S[1]+e(E).outerHeight()})}catch(x){alert(y[1])}return c}f=h.p.prmNames,E=t,S=!1===h.p.keyIndex?f.id:h.p.colModel[h.p.keyIndex+(!0===h.p.rownumbers?1:0)+(!0===h.p.multiselect?1:0)+(!0===h.p.subGrid?1:0)].name,d&&(d[f.oper]=f.editoper,void 0===d[S]||""===d[S]?d[S]=t:b.id!==h.p.idPrefix+d[S]&&(f=e.jgrid.stripPref(h.p.idPrefix,t),void 0!==h.p._index[f]&&(h.p._index[d[S]]=h.p._index[f],delete h.p._index[f]),t=h.p.idPrefix+d[S],e(b).attr("id",t),h.p.selrow===E&&(h.p.selrow=t),e.isArray(h.p.selarrrow)&&(f=e.inArray(E,h.p.selarrrow),0<=f&&(h.p.selarrrow[f]=t)),h.p.multiselect)&&(f="jqg_"+h.p.id+"_"+t,e("input.cbox",b).attr("id",f).attr("name",f)),void 0===h.p.inlineData&&(h.p.inlineData={}),d=e.extend({},d,h.p.inlineData,l.extraparam));if("clientArray"===l.url){d=e.extend({},d,v),h.p.autoencode&&e.each(d,function(t,n){d[t]=e.jgrid.htmlDecode(n)}),f=e(h).jqGrid("setRowData",t,d),e(b).attr("editable","0");for(S=0;S<h.p.savedRow.length;S++)if(""+h.p.savedRow[S].id==""+E){g=S;break}0<=g&&h.p.savedRow.splice(g,1),e(h).triggerHandler("jqGridInlineAfterSaveRow",[t,f,d,l]),e.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(h,t,f,l),c=!0,e(b).removeClass("jqgrid-new-row").unbind("keydown")}else e("#lui_"+e.jgrid.jqID(h.p.id)).show(),m=e.extend({},d,m),m[S]=e.jgrid.stripPref(h.p.idPrefix,m[S]),e.ajax(e.extend({url:l.url,data:e.isFunction(h.p.serializeRowData)?h.p.serializeRowData.call(h,m):m,type:l.mtype,async:!1,complete:function(n,r){e("#lui_"+e.jgrid.jqID(h.p.id)).hide();if("success"===r){var i=!0,s;s=e(h).triggerHandler("jqGridInlineSuccessSaveRow",[n,t,l]),e.isArray(s)||(s=[!0,d]),s[0]&&e.isFunction(l.successfunc)&&(s=l.successfunc.call(h,n)),e.isArray(s)?(i=s[0],d=s[1]||d):i=s;if(!0===i){h.p.autoencode&&e.each(d,function(t,n){d[t]=e.jgrid.htmlDecode(n)}),d=e.extend({},d,v),e(h).jqGrid("setRowData",t,d),e(b).attr("editable","0");for(i=0;i<h.p.savedRow.length;i++)if(""+h.p.savedRow[i].id==""+t){g=i;break}0<=g&&h.p.savedRow.splice(g,1),e(h).triggerHandler("jqGridInlineAfterSaveRow",[t,n,d,l]),e.isFunction(l.aftersavefunc)&&l.aftersavefunc.call(h,t,n),c=!0,e(b).removeClass("jqgrid-new-row").unbind("keydown")}else e(h).triggerHandler("jqGridInlineErrorSaveRow",[t,n,r,null,l]),e.isFunction(l.errorfunc)&&l.errorfunc.call(h,t,n,r,null),!0===l.restoreAfterError&&e(h).jqGrid("restoreRow",t,l.afterrestorefunc)}},error:function(n,r,i){e("#lui_"+e.jgrid.jqID(h.p.id)).hide(),e(h).triggerHandler("jqGridInlineErrorSaveRow",[t,n,r,i,l]);if(e.isFunction(l.errorfunc))l.errorfunc.call(h,t,n,r,i);else{n=n.responseText||n.statusText;try{e.jgrid.info_dialog(e.jgrid.errors.errcap,'<div class="ui-state-error">'+n+"</div>",e.jgrid.edit.bClose,{buttonalign:"right"})}catch(s){alert(n)}}!0===l.restoreAfterError&&e(h).jqGrid("restoreRow",t,l.afterrestorefunc)}},e.jgrid.ajaxOptions,h.p.ajaxRowOptions||{}))}return c}},restoreRow:function(t,n){var r=e.makeArray(arguments).slice(1),i={};return"object"===e.type(r[0])?i=r[0]:e.isFunction(n)&&(i.afterrestorefunc=n),i=e.extend(!0,{},e.jgrid.inlineEdit,i),this.each(function(){var n=this,r,s,o={},u;if(n.grid){s=e(n).jqGrid("getInd",t,!0);if(s!==!1){u=e.isFunction(i.beforeCancelRow)?i.beforeCancelRow.call(n,cancelPrm,sr):void 0,u===void 0&&(u=!0);if(u){for(u=0;u<n.p.savedRow.length;u++)if(""+n.p.savedRow[u].id==""+t){r=u;break}if(r>=0){if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker","#"+e.jgrid.jqID(s.id)).datepicker("hide")}catch(f){}e.each(n.p.colModel,function(){this.editable===!0&&n.p.savedRow[r].hasOwnProperty(this.name)&&(o[this.name]=n.p.savedRow[r][this.name])}),e(n).jqGrid("setRowData",t,o),e(s).attr("editable","0").unbind("keydown"),n.p.savedRow.splice(r,1),e("#"+e.jgrid.jqID(t),"#"+e.jgrid.jqID(n.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){e(n).jqGrid("delRowData",t),e(n).jqGrid("showAddEditButtons")},0)}e(n).triggerHandler("jqGridInlineAfterRestoreRow",[t]),e.isFunction(i.afterrestorefunc)&&i.afterrestorefunc.call(n,t)}}}})},addRow:function(t){return t=e.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},t||{}),this.each(function(){if(this.grid){var n=this,r=e.isFunction(t.beforeAddRow)?t.beforeAddRow.call(n,t.addRowParams):void 0;void 0===r&&(r=!0),r&&(t.rowID=e.isFunction(t.rowID)?t.rowID.call(n,t):null!=t.rowID?t.rowID:e.jgrid.randId(),!0===t.useDefValues&&e(n.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var r=this.editoptions.defaultValue,r=e.isFunction(r)?r.call(n):r;t.initdata[this.name]=r}}),e(n).jqGrid("addRowData",t.rowID,t.initdata,t.position),t.rowID=n.p.idPrefix+t.rowID,e("#"+e.jgrid.jqID(t.rowID),"#"+e.jgrid.jqID(n.p.id)).addClass("jqgrid-new-row"),t.useFormatter?e("#"+e.jgrid.jqID(t.rowID)+" .ui-inline-edit","#"+e.jgrid.jqID(n.p.id)).click():(r=n.p.prmNames,t.addRowParams.extraparam[r.oper]=r.addoper,e(n).jqGrid("editRow",t.rowID,t.addRowParams),e(n).jqGrid("setSelection",t.rowID)))}})},inlineNav:function(t,n){return n=e.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},e.jgrid.nav,n||{}),this.each(function(){if(this.grid){var r=this,i,s=e.jgrid.jqID(r.p.id);r.p._inlinenav=!0;if(!0===n.addParams.useFormatter){var o=r.p.colModel,u;for(u=0;u<o.length;u++)if(o[u].formatter&&"actions"===o[u].formatter){o[u].formatoptions&&(o=e.extend({keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},o[u].formatoptions),n.addParams.addRowParams={keys:o.keys,oneditfunc:o.onEdit,successfunc:o.onSuccess,url:o.url,extraparam:o.extraparam,aftersavefunc:o.afterSave,errorfunc:o.onError,afterrestorefunc:o.afterRestore});break}}n.add&&e(r).jqGrid("navButtonAdd",t,{caption:n.addtext,title:n.addtitle,buttonicon:n.addicon,id:r.p.id+"_iladd",onClickButton:function(){e(r).jqGrid("addRow",n.addParams),n.addParams.useFormatter||(e("#"+s+"_ilsave").removeClass("ui-state-disabled"),e("#"+s+"_ilcancel").removeClass("ui-state-disabled"),e("#"+s+"_iladd").addClass("ui-state-disabled"),e("#"+s+"_iledit").addClass("ui-state-disabled"))}}),n.edit&&e(r).jqGrid("navButtonAdd",t,{caption:n.edittext,title:n.edittitle,buttonicon:n.editicon,id:r.p.id+"_iledit",onClickButton:function(){var t=e(r).jqGrid("getGridParam","selrow");t?(e(r).jqGrid("editRow",t,n.editParams),e("#"+s+"_ilsave").removeClass("ui-state-disabled"),e("#"+s+"_ilcancel").removeClass("ui-state-disabled"),e("#"+s+"_iladd").addClass("ui-state-disabled"),e("#"+s+"_iledit").addClass("ui-state-disabled")):(e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+s,jqm:!0}),e("#jqg_alrt").focus())}}),n.save&&(e(r).jqGrid("navButtonAdd",t,{caption:n.savetext||"",title:n.savetitle||"Save row",buttonicon:n.saveicon,id:r.p.id+"_ilsave",onClickButton:function(){var t=r.p.savedRow[0].id;if(t){var i=r.p.prmNames,o=i.oper,u={};e("#"+e.jgrid.jqID(t),"#"+s).hasClass("jqgrid-new-row")?(n.addParams.addRowParams.extraparam[o]=i.addoper,u=n.addParams.addRowParams):(n.editParams.extraparam||(n.editParams.extraparam={}),n.editParams.extraparam[o]=i.editoper,u=n.editParams),e(r).jqGrid("saveRow",t,u)&&e(r).jqGrid("showAddEditButtons")}else e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+s,jqm:!0}),e("#jqg_alrt").focus()}}),e("#"+s+"_ilsave").addClass("ui-state-disabled")),n.cancel&&(e(r).jqGrid("navButtonAdd",t,{caption:n.canceltext||"",title:n.canceltitle||"Cancel row editing",buttonicon:n.cancelicon,id:r.p.id+"_ilcancel",onClickButton:function(){var t=r.p.savedRow[0].id,i={};t?(i=e("#"+e.jgrid.jqID(t),"#"+s).hasClass("jqgrid-new-row")?n.addParams.addRowParams:n.editParams,e(r).jqGrid("restoreRow",t,i),e(r).jqGrid("showAddEditButtons")):(e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+s,jqm:!0}),e("#jqg_alrt").focus())}}),e("#"+s+"_ilcancel").addClass("ui-state-disabled")),!0===n.restoreAfterSelect&&(i=e.isFunction(r.p.beforeSelectRow)?r.p.beforeSelectRow:!1,r.p.beforeSelectRow=function(t,s){var o=!0;return r.p.savedRow.length>0&&r.p._inlinenav===!0&&t!==r.p.selrow&&r.p.selrow!==null&&(r.p.selrow===n.addParams.rowID?e(r).jqGrid("delRowData",r.p.selrow):e(r).jqGrid("restoreRow",r.p.selrow,n.editParams),e(r).jqGrid("showAddEditButtons")),i&&(o=i.call(r,t,s)),o})}})},showAddEditButtons:function(){return this.each(function(){if(this.grid){var t=e.jgrid.jqID(this.p.id);e("#"+t+"_ilsave").addClass("ui-state-disabled"),e("#"+t+"_ilcancel").addClass("ui-state-disabled"),e("#"+t+"_iladd").removeClass("ui-state-disabled"),e("#"+t+"_iledit").removeClass("ui-state-disabled")}})}})}(jQuery),function(e){e.jgrid.extend({editCell:function(t,n,r){return this.each(function(){var i=this,s,o,u,l;if(i.grid&&!0===i.p.cellEdit){n=parseInt(n,10),i.p.selrow=i.rows[t].id,i.p.knv||e(i).jqGrid("GridNav");if(0<i.p.savedRow.length){if(!0===r&&t==i.p.iRow&&n==i.p.iCol)return;e(i).jqGrid("saveCell",i.p.savedRow[0].id,i.p.savedRow[0].ic)}else window.setTimeout(function(){e("#"+e.jgrid.jqID(i.p.knv)).attr("tabindex","-1").focus()},0);l=i.p.colModel[n],s=l.name;if("subgrid"!==s&&"cb"!==s&&"rn"!==s){u=e("td:eq("+n+")",i.rows[t]);if(!0===l.editable&&!0===r&&!u.hasClass("not-editable-cell")){0<=parseInt(i.p.iCol,10)&&0<=parseInt(i.p.iRow,10)&&(e("td:eq("+i.p.iCol+")",i.rows[i.p.iRow]).removeClass("edit-cell ui-state-highlight"),e(i.rows[i.p.iRow]).removeClass("selected-row ui-state-hover")),e(u).addClass("edit-cell ui-state-highlight"),e(i.rows[t]).addClass("selected-row ui-state-hover");try{o=e.unformat.call(i,u,{rowId:i.rows[t].id,colModel:l},n)}catch(c){o=l.edittype&&"textarea"===l.edittype?e(u).text():e(u).html()}i.p.autoencode&&(o=e.jgrid.htmlDecode(o)),l.edittype||(l.edittype="text"),i.p.savedRow.push({id:t,ic:n,name:s,v:o});if("&nbsp;"===o||"&#160;"===o||1===o.length&&160===o.charCodeAt(0))o="";if(e.isFunction(i.p.formatCell)){var h=i.p.formatCell.call(i,i.rows[t].id,s,o,t,n);void 0!==h&&(o=h)}e(i).triggerHandler("jqGridBeforeEditCell",[i.rows[t].id,s,o,t,n]),e.isFunction(i.p.beforeEditCell)&&i.p.beforeEditCell.call(i,i.rows[t].id,s,o,t,n);var h=e.extend({},l.editoptions||{},{id:t+"_"+s,name:s}),p=e.jgrid.createEl.call(i,l.edittype,h,o,!0,e.extend({},e.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{}));e(u).html("").append(p).attr("tabindex","0"),e.jgrid.bindEv.call(i,p,h),window.setTimeout(function(){e(p).focus()},0),e("input, select, textarea",u).bind("keydown",function(r){r.keyCode===27&&(e("input.hasDatepicker",u).length>0?e(".ui-datepicker").is(":hidden")?e(i).jqGrid("restoreCell",t,n):e("input.hasDatepicker",u).datepicker("hide"):e(i).jqGrid("restoreCell",t,n));if(r.keyCode===13)return e(i).jqGrid("saveCell",t,n),!1;if(r.keyCode===9){if(i.grid.hDiv.loading)return!1;r.shiftKey?e(i).jqGrid("prevCell",t,n):e(i).jqGrid("nextCell",t,n)}r.stopPropagation()}),e(i).triggerHandler("jqGridAfterEditCell",[i.rows[t].id,s,o,t,n]),e.isFunction(i.p.afterEditCell)&&i.p.afterEditCell.call(i,i.rows[t].id,s,o,t,n)}else 0<=parseInt(i.p.iCol,10)&&0<=parseInt(i.p.iRow,10)&&(e("td:eq("+i.p.iCol+")",i.rows[i.p.iRow]).removeClass("edit-cell ui-state-highlight"),e(i.rows[i.p.iRow]).removeClass("selected-row ui-state-hover")),u.addClass("edit-cell ui-state-highlight"),e(i.rows[t]).addClass("selected-row ui-state-hover"),o=u.html().replace(/\&#160\;/ig,""),e(i).triggerHandler("jqGridSelectCell",[i.rows[t].id,s,o,t,n]),e.isFunction(i.p.onSelectCell)&&i.p.onSelectCell.call(i,i.rows[t].id,s,o,t,n);i.p.iCol=n,i.p.iRow=t}}})},saveCell:function(t,n){return this.each(function(){var r=this,i;if(r.grid&&!0===r.p.cellEdit){i=1<=r.p.savedRow.length?0:null;if(null!==i){var s=e("td:eq("+n+")",r.rows[t]),o,u,a=r.p.colModel[n],l=a.name,c=e.jgrid.jqID(l);switch(a.edittype){case"select":if(a.editoptions.multiple){var c=e("#"+t+"_"+c,r.rows[t]),h=[];(o=e(c).val())?o.join(","):o="",e("option:selected",c).each(function(t,n){h[t]=e(n).text()}),u=h.join(",")}else o=e("#"+t+"_"+c+" option:selected",r.rows[t]).val(),u=e("#"+t+"_"+c+" option:selected",r.rows[t]).text();a.formatter&&(u=o);break;case"checkbox":var p=["Yes","No"];a.editoptions&&(p=a.editoptions.value.split(":")),u=o=e("#"+t+"_"+c,r.rows[t]).is(":checked")?p[0]:p[1];break;case"password":case"text":case"textarea":case"button":u=o=e("#"+t+"_"+c,r.rows[t]).val();break;case"custom":try{if(!a.editoptions||!e.isFunction(a.editoptions.custom_value))throw"e1";o=a.editoptions.custom_value.call(r,e(".customelement",s),"get");if(void 0===o)throw"e2";u=o}catch(v){"e1"===v&&e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose),"e2"===v?e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose):e.jgrid.info_dialog(e.jgrid.errors.errcap,v.message,e.jgrid.edit.bClose)}}if(u!==r.p.savedRow[i].v){if(i=e(r).triggerHandler("jqGridBeforeSaveCell",[r.rows[t].id,l,o,t,n]))u=o=i;e.isFunction(r.p.beforeSaveCell)&&(i=r.p.beforeSaveCell.call(r,r.rows[t].id,l,o,t,n))&&(u=o=i);var m=e.jgrid.checkValues.call(r,o,n);if(!0===m[0]){i=e(r).triggerHandler("jqGridBeforeSubmitCell",[r.rows[t].id,l,o,t,n])||{},e.isFunction(r.p.beforeSubmitCell)&&((i=r.p.beforeSubmitCell.call(r,r.rows[t].id,l,o,t,n))||(i={})),0<e("input.hasDatepicker",s).length&&e("input.hasDatepicker",s).datepicker("hide");if("remote"===r.p.cellsubmit)if(r.p.cellurl){var g={};r.p.autoencode&&(o=e.jgrid.htmlEncode(o)),g[l]=o,p=r.p.prmNames,a=p.id,c=p.oper,g[a]=e.jgrid.stripPref(r.p.idPrefix,r.rows[t].id),g[c]=p.editoper,g=e.extend(i,g),e("#lui_"+e.jgrid.jqID(r.p.id)).show(),r.grid.hDiv.loading=!0,e.ajax(e.extend({url:r.p.cellurl,data:e.isFunction(r.p.serializeCellData)?r.p.serializeCellData.call(r,g):g,type:"POST",complete:function(i,a){e("#lui_"+r.p.id).hide(),r.grid.hDiv.loading=!1;if(a==="success"){var c=e(r).triggerHandler("jqGridAfterSubmitCell",[r,i,g.id,l,o,t,n])||[!0,""];c[0]===!0&&e.isFunction(r.p.afterSubmitCell)&&(c=r.p.afterSubmitCell.call(r,i,g.id,l,o,t,n)),c[0]===!0?(e(s).empty(),e(r).jqGrid("setCell",r.rows[t].id,n,u,!1,!1,!0),e(s).addClass("dirty-cell"),e(r.rows[t]).addClass("edited"),e(r).triggerHandler("jqGridAfterSaveCell",[r.rows[t].id,l,o,t,n]),e.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell.call(r,r.rows[t].id,l,o,t,n),r.p.savedRow.splice(0,1)):(e.jgrid.info_dialog(e.jgrid.errors.errcap,c[1],e.jgrid.edit.bClose),e(r).jqGrid("restoreCell",t,n))}},error:function(i,s,o){e("#lui_"+e.jgrid.jqID(r.p.id)).hide(),r.grid.hDiv.loading=!1,e(r).triggerHandler("jqGridErrorCell",[i,s,o]),e.isFunction(r.p.errorCell)?r.p.errorCell.call(r,i,s,o):e.jgrid.info_dialog(e.jgrid.errors.errcap,i.status+" : "+i.statusText+"<br/>"+s,e.jgrid.edit.bClose),e(r).jqGrid("restoreCell",t,n)}},e.jgrid.ajaxOptions,r.p.ajaxCellOptions||{}))}else try{e.jgrid.info_dialog(e.jgrid.errors.errcap,e.jgrid.errors.nourl,e.jgrid.edit.bClose),e(r).jqGrid("restoreCell",t,n)}catch(y){}"clientArray"===r.p.cellsubmit&&(e(s).empty(),e(r).jqGrid("setCell",r.rows[t].id,n,u,!1,!1,!0),e(s).addClass("dirty-cell"),e(r.rows[t]).addClass("edited"),e(r).triggerHandler("jqGridAfterSaveCell",[r.rows[t].id,l,o,t,n]),e.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell.call(r,r.rows[t].id,l,o,t,n),r.p.savedRow.splice(0,1))}else try{window.setTimeout(function(){e.jgrid.info_dialog(e.jgrid.errors.errcap,o+" "+m[1],e.jgrid.edit.bClose)},100),e(r).jqGrid("restoreCell",t,n)}catch(w){}}else e(r).jqGrid("restoreCell",t,n)}window.setTimeout(function(){e("#"+e.jgrid.jqID(r.p.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(t,n){return this.each(function(){var r=this,i;if(r.grid&&!0===r.p.cellEdit){i=1<=r.p.savedRow.length?0:null;if(null!==i){var s=e("td:eq("+n+")",r.rows[t]);if(e.isFunction(e.fn.datepicker))try{e("input.hasDatepicker",s).datepicker("hide")}catch(o){}e(s).empty().attr("tabindex","-1"),e(r).jqGrid("setCell",r.rows[t].id,n,r.p.savedRow[i].v,!1,!1,!0),e(r).triggerHandler("jqGridAfterRestoreCell",[r.rows[t].id,r.p.savedRow[i].v,t,n]),e.isFunction(r.p.afterRestoreCell)&&r.p.afterRestoreCell.call(r,r.rows[t].id,r.p.savedRow[i].v,t,n),r.p.savedRow.splice(0,1)}window.setTimeout(function(){e("#"+r.p.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(t,n){return this.each(function(){var r=!1,i;if(this.grid&&!0===this.p.cellEdit){for(i=n+1;i<this.p.colModel.length;i++)if(!0===this.p.colModel[i].editable){r=i;break}!1!==r?e(this).jqGrid("editCell",t,r,!0):0<this.p.savedRow.length&&e(this).jqGrid("saveCell",t,n)}})},prevCell:function(t,n){return this.each(function(){var r=!1,i;if(this.grid&&!0===this.p.cellEdit){for(i=n-1;0<=i;i--)if(!0===this.p.colModel[i].editable){r=i;break}!1!==r?e(this).jqGrid("editCell",t,r,!0):0<this.p.savedRow.length&&e(this).jqGrid("saveCell",t,n)}})},GridNav:function(){return this.each(function(){function t(t,n,i){if("v"===i.substr(0,1)){var s=e(r.grid.bDiv)[0].clientHeight,o=e(r.grid.bDiv)[0].scrollTop,u=r.rows[t].offsetTop+r.rows[t].clientHeight,f=r.rows[t].offsetTop;"vd"===i&&u>=s&&(e(r.grid.bDiv)[0].scrollTop=e(r.grid.bDiv)[0].scrollTop+r.rows[t].clientHeight),"vu"===i&&f<o&&(e(r.grid.bDiv)[0].scrollTop=e(r.grid.bDiv)[0].scrollTop-r.rows[t].clientHeight)}"h"===i&&(i=e(r.grid.bDiv)[0].clientWidth,s=e(r.grid.bDiv)[0].scrollLeft,o=r.rows[t].cells[n].offsetLeft,r.rows[t].cells[n].offsetLeft+r.rows[t].cells[n].clientWidth>=i+parseInt(s,10)?e(r.grid.bDiv)[0].scrollLeft=e(r.grid.bDiv)[0].scrollLeft+r.rows[t].cells[n].clientWidth:o<s&&(e(r.grid.bDiv)[0].scrollLeft=e(r.grid.bDiv)[0].scrollLeft-r.rows[t].cells[n].clientWidth))}function n(e,t){var n,i;if("lft"===t){n=e+1;for(i=e;0<=i;i--)if(!0!==r.p.colModel[i].hidden){n=i;break}}if("rgt"===t){n=e-1;for(i=e;i<r.p.colModel.length;i++)if(!0!==r.p.colModel[i].hidden){n=i;break}}return n}var r=this;if(r.grid&&!0===r.p.cellEdit){r.p.knv=r.p.id+"_kn";var i=e("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+r.p.knv+"'></div></div>"),s,o;e(i).insertBefore(r.grid.cDiv),e("#"+r.p.knv).focus().keydown(function(i){o=i.keyCode,"rtl"===r.p.direction&&(37===o?o=39:39===o&&(o=37));switch(o){case 38:0<r.p.iRow-1&&(t(r.p.iRow-1,r.p.iCol,"vu"),e(r).jqGrid("editCell",r.p.iRow-1,r.p.iCol,!1));break;case 40:r.p.iRow+1<=r.rows.length-1&&(t(r.p.iRow+1,r.p.iCol,"vd"),e(r).jqGrid("editCell",r.p.iRow+1,r.p.iCol,!1));break;case 37:0<=r.p.iCol-1&&(s=n(r.p.iCol-1,"lft"),t(r.p.iRow,s,"h"),e(r).jqGrid("editCell",r.p.iRow,s,!1));break;case 39:r.p.iCol+1<=r.p.colModel.length-1&&(s=n(r.p.iCol+1,"rgt"),t(r.p.iRow,s,"h"),e(r).jqGrid("editCell",r.p.iRow,s,!1));break;case 13:0<=parseInt(r.p.iCol,10)&&0<=parseInt(r.p.iRow,10)&&e(r).jqGrid("editCell",r.p.iRow,r.p.iCol,!0);break;default:return!0}return!1})}})},getChangedCells:function(t){var n=[];return t||(t="all"),this.each(function(){var r=this,i;r.grid&&!0===r.p.cellEdit&&e(r.rows).each(function(s){var o={};e(this).hasClass("edited")&&(e("td",this).each(function(n){i=r.p.colModel[n].name;if("cb"!==i&&"subgrid"!==i)if("dirty"===t){if(e(this).hasClass("dirty-cell"))try{o[i]=e.unformat.call(r,this,{rowId:r.rows[s].id,colModel:r.p.colModel[n]},n)}catch(u){o[i]=e.jgrid.htmlDecode(e(this).html())}}else try{o[i]=e.unformat.call(r,this,{rowId:r.rows[s].id,colModel:r.p.colModel[n]},n)}catch(f){o[i]=e.jgrid.htmlDecode(e(this).html())}}),o.id=this.id,n.push(o))})}),n}})}(jQuery),function(e){e.fn.jqm=function(r){var s={overlay:50,closeoverlay:!0,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:i,ajaxText:"",target:i,modal:i,toTop:i,onShow:i,onHide:i,onLoad:i};return this.each(function(){if(this._jqm)return n[this._jqm].c=e.extend({},n[this._jqm].c,r);t++,this._jqm=t,n[t]={c:e.extend(s,e.jqm.params,r),a:i,w:e(this).addClass("jqmID"+t),s:t},s.trigger&&e(this).jqmAddTrigger(s.trigger)})},e.fn.jqmAddClose=function(e){return a(this,e,"jqmHide")},e.fn.jqmAddTrigger=function(e){return a(this,e,"jqmShow")},e.fn.jqmShow=function(t){return this.each(function(){e.jqm.open(this._jqm,t)})},e.fn.jqmHide=function(t){return this.each(function(){e.jqm.close(this._jqm,t)})},e.jqm={hash:{},open:function(t,u){var a=n[t],f=a.c,l="."+f.closeClass,h=parseInt(a.w.css("z-index")),h=0<h?h:3e3,v=e("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":h-1,opacity:f.overlay/100});return a.a?i:(a.t=u,a.a=!0,a.w.css("z-index",h),f.modal?(r[0]||setTimeout(function(){o("bind")},1),r.push(t)):0<f.overlay?f.closeoverlay&&a.w.jqmAddClose(v):v=i,a.o=v?v.addClass(f.overlayClass).prependTo("body"):i,f.ajax?(h=f.target||a.w,v=f.ajax,h="string"==typeof h?e(h,a.w):e(h),v="@"==v.substr(0,1)?e(u).attr(v.substring(1)):v,h.html(f.ajaxText).load(v,function(){f.onLoad&&f.onLoad.call(this,a),l&&a.w.jqmAddClose(e(l,a.w)),s(a)})):l&&a.w.jqmAddClose(e(l,a.w)),f.toTop&&a.o&&a.w.before('<span id="jqmP'+a.w[0]._jqm+'"></span>').insertAfter(a.o),f.onShow?f.onShow(a):a.w.show(),s(a),i)},close:function(t){return t=n[t],t.a?(t.a=i,r[0]&&(r.pop(),r[0]||o("unbind")),t.c.toTop&&t.o&&e("#jqmP"+t.w[0]._jqm).after(t.w).remove(),t.c.onHide?t.c.onHide(t):(t.w.hide(),t.o&&t.o.remove()),i):i},params:{}};var t=0,n=e.jqm.hash,r=[],i=!1,s=function(t){try{e(":input:visible",t.w)[0].focus()}catch(n){}},o=function(t){e(document)[t]("keypress",u)[t]("keydown",u)[t]("mousedown",u)},u=function(t){var i=n[r[r.length-1]],o=!e(t.target).parents(".jqmID"+i.s)[0];return o&&(e(".jqmID"+i.s).each(function(){var n=e(this),r=n.offset();if(r.top<=t.pageY&&t.pageY<=r.top+n.height()&&r.left<=t.pageX&&t.pageX<=r.left+n.width())return o=!1}),s(i)),!o},a=function(t,r,s){return t.each(function(){var t=this._jqm;e(r).each(function(){this[s]||(this[s]=[],e(this).click(function(){for(var e in{jqmShow:1,jqmHide:1})for(var t in this[e])n[this[e][t]]&&n[this[e][t]].w[e](this);return i})),this[s].push(t)})})}}(jQuery),function(e){e.fn.jqDrag=function(e){return o(this,e,"d")},e.fn.jqResize=function(e,t){return o(this,e,"r",t)},e.jqDnR={dnr:{},e:0,drag:function(e){return"d"==n.k?r.css({left:n.X+e.pageX-n.pX,top:n.Y+e.pageY-n.pY}):(r.css({width:Math.max(e.pageX-n.pX+n.W,0),height:Math.max(e.pageY-n.pY+n.H,0)}),s&&i.css({width:Math.max(e.pageX-s.pX+s.W,0),height:Math.max(e.pageY-s.pY+s.H,0)})),!1},stop:function(){e(document).unbind("mousemove",t.drag).unbind("mouseup",t.stop)}};var t=e.jqDnR,n=t.dnr,r=t.e,i,s,o=function(t,o,l,c){return t.each(function(){o=o?e(o,t):t,o.bind("mousedown",{e:t,k:l},function(t){var o=t.data,l={};r=o.e,i=c?e(c):!1;if("relative"!=r.css("position"))try{r.position(l)}catch(h){}n={X:l.left||u("left")||0,Y:l.top||u("top")||0,W:u("width")||r[0].scrollWidth||0,H:u("height")||r[0].scrollHeight||0,pX:t.pageX,pY:t.pageY,k:o.k},s=i&&"d"!=o.k?{X:l.left||a("left")||0,Y:l.top||a("top")||0,W:i[0].offsetWidth||a("width")||0,H:i[0].offsetHeight||a("height")||0,pX:t.pageX,pY:t.pageY,k:o.k}:!1;if(e("input.hasDatepicker",r[0])[0])try{e("input.hasDatepicker",r[0]).datepicker("hide")}catch(p){}return e(document).mousemove(e.jqDnR.drag).mouseup(e.jqDnR.stop),!1})})},u=function(e){return parseInt(r.css(e),10)||!1},a=function(e){return parseInt(i.css(e),10)||!1}}(jQuery),function(e){e.jgrid.extend({setSubGrid:function(){return this.each(function(){var t,n;this.p.subGridOptions=e.extend({plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0},this.p.subGridOptions||{}),this.p.colNames.unshift(""),this.p.colModel.unshift({name:"subgrid",width:e.jgrid.cell_width?this.p.subGridWidth+this.p.cellLayout:this.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0}),t=this.p.subGridModel;if(t[0]){t[0].align=e.extend([],t[0].align||[]);for(n=0;n<t[0].name.length;n++)t[0].align[n]=t[0].align[n]||"left"}})},addSubGridCell:function(e,t){var n="",r,i;return this.each(function(){n=this.formatCol(e,t),i=this.p.id,r=this.p.subGridOptions.plusicon}),'<td role="gridcell" aria-describedby="'+i+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+n+"><a style='cursor:pointer;'><span class='ui-icon "+r+"'></span></a></td>"},addSubGrid:function(t,n){return this.each(function(){var r=this;if(r.grid){var i=function(t,n,i){n=e("<td align='"+r.p.subGridModel[0].align[i]+"'></td>").html(n),e(t).append(n)},s=function(t,n){var s,o,u,a=e("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),f=e("<tr></tr>");for(o=0;o<r.p.subGridModel[0].name.length;o++)s=e("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+r.p.direction+"'></th>"),e(s).html(r.p.subGridModel[0].name[o]),e(s).width(r.p.subGridModel[0].width[o]),e(f).append(s);return e(a).append(f),t&&(u=r.p.xmlReader.subgrid,e(u.root+" "+u.row,t).each(function(){f=e("<tr class='ui-widget-content ui-subtblcell'></tr>");if(!0===u.repeatitems)e(u.cell,this).each(function(t){i(f,e(this).text()||"&#160;",t)});else{var t=r.p.subGridModel[0].mapping||r.p.subGridModel[0].name;if(t)for(o=0;o<t.length;o++)i(f,e(t[o],this).text()||"&#160;",o)}e(a).append(f)})),s=e("table:first",r.grid.bDiv).attr("id")+"_",e("#"+e.jgrid.jqID(s+n)).append(a),r.grid.hDiv.loading=!1,e("#load_"+e.jgrid.jqID(r.p.id)).hide(),!1},o=function(t,n){var s,o,u,a,f,l=e("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),c=e("<tr></tr>");for(o=0;o<r.p.subGridModel[0].name.length;o++)s=e("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+r.p.direction+"'></th>"),e(s).html(r.p.subGridModel[0].name[o]),e(s).width(r.p.subGridModel[0].width[o]),e(c).append(s);e(l).append(c);if(t&&(a=r.p.jsonReader.subgrid,s=e.jgrid.getAccessor(t,a.root),void 0!==s))for(o=0;o<s.length;o++){u=s[o],c=e("<tr class='ui-widget-content ui-subtblcell'></tr>");if(!0===a.repeatitems){a.cell&&(u=u[a.cell]);for(f=0;f<u.length;f++)i(c,u[f]||"&#160;",f)}else{var h=r.p.subGridModel[0].mapping||r.p.subGridModel[0].name;if(h.length)for(f=0;f<h.length;f++)i(c,u[h[f]]||"&#160;",f)}e(l).append(c)}return o=e("table:first",r.grid.bDiv).attr("id")+"_",e("#"+e.jgrid.jqID(o+n)).append(l),r.grid.hDiv.loading=!1,e("#load_"+e.jgrid.jqID(r.p.id)).hide(),!1},u=function(t){var n,i,u,a;n=e(t).attr("id"),i={nd_:(new Date).getTime()},i[r.p.prmNames.subgridid]=n;if(!r.p.subGridModel[0])return!1;if(r.p.subGridModel[0].params)for(a=0;a<r.p.subGridModel[0].params.length;a++)for(u=0;u<r.p.colModel.length;u++)r.p.colModel[u].name===r.p.subGridModel[0].params[a]&&(i[r.p.colModel[u].name]=e("td:eq("+u+")",t).text().replace(/\&#160\;/ig,""));if(!r.grid.hDiv.loading)switch(r.grid.hDiv.loading=!0,e("#load_"+e.jgrid.jqID(r.p.id)).show(),r.p.subgridtype||(r.p.subgridtype=r.p.datatype),e.isFunction(r.p.subgridtype)?r.p.subgridtype.call(r,i):r.p.subgridtype=r.p.subgridtype.toLowerCase(),r.p.subgridtype){case"xml":case"json":e.ajax(e.extend({type:r.p.mtype,url:r.p.subGridUrl,dataType:r.p.subgridtype,data:e.isFunction(r.p.serializeSubGridData)?r.p.serializeSubGridData.call(r,i):i,complete:function(t){r.p.subgridtype==="xml"?s(t.responseXML,n):o(e.jgrid.parse(t.responseText),n)}},e.jgrid.ajaxOptions,r.p.ajaxSubgridOptions||{}))}return!1},a,f,l,h=0,p,v;e.each(r.p.colModel,function(){(!0===this.hidden||"rn"===this.name||"cb"===this.name)&&h++});var m=r.rows.length,g=1;void 0!==n&&0<n&&(g=n,m=n+1);for(;g<m;)e(r.rows[g]).hasClass("jqgrow")&&e(r.rows[g].cells[t]).bind("click",function(){var n=e(this).parent("tr")[0];v=n.nextSibling;if(e(this).hasClass("sgcollapsed")){f=r.p.id,a=n.id;if(r.p.subGridOptions.reloadOnExpand===!0||r.p.subGridOptions.reloadOnExpand===!1&&!e(v).hasClass("ui-subgrid")){l=t>=1?"<td colspan='"+t+"'>&#160;</td>":"",p=e(r).triggerHandler("jqGridSubGridBeforeExpand",[f+"_"+a,a]),(p=p===!1||p==="stop"?!1:!0)&&e.isFunction(r.p.subGridBeforeExpand)&&(p=r.p.subGridBeforeExpand.call(r,f+"_"+a,a));if(p===!1)return!1;e(n).after("<tr role='row' class='ui-subgrid'>"+l+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon "+r.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(r.p.colNames.length-1-h,10)+"' class='ui-widget-content subgrid-data'><div id="+f+"_"+a+" class='tablediv'></div></td></tr>"),e(r).triggerHandler("jqGridSubGridRowExpanded",[f+"_"+a,a]),e.isFunction(r.p.subGridRowExpanded)?r.p.subGridRowExpanded.call(r,f+"_"+a,a):u(n)}else e(v).show();e(this).html("<a style='cursor:pointer;'><span class='ui-icon "+r.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded"),r.p.subGridOptions.selectOnExpand&&e(r).jqGrid("setSelection",a)}else if(e(this).hasClass("sgexpanded")){p=e(r).triggerHandler("jqGridSubGridRowColapsed",[f+"_"+a,a]),p=p===!1||p==="stop"?!1:!0,a=n.id,p&&e.isFunction(r.p.subGridRowColapsed)&&(p=r.p.subGridRowColapsed.call(r,f+"_"+a,a));if(p===!1)return!1;r.p.subGridOptions.reloadOnExpand===!0?e(v).remove(".ui-subgrid"):e(v).hasClass("ui-subgrid")&&e(v).hide(),e(this).html("<a style='cursor:pointer;'><span class='ui-icon "+r.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed"),r.p.subGridOptions.selectOnCollapse&&e(r).jqGrid("setSelection",a)}return!1}),g++;!0===r.p.subGridOptions.expandOnLoad&&e(r.rows).filter(".jqgrow").each(function(t,n){e(n.cells[0]).click()}),r.subGridXml=function(e,t){s(e,t)},r.subGridJson=function(e,t){o(e,t)}}})},expandSubGridRow:function(t){return this.each(function(){if((this.grid||t)&&!0===this.p.subGrid){var n=e(this).jqGrid("getInd",t,!0);n&&(n=e("td.sgcollapsed",n)[0])&&e(n).trigger("click")}})},collapseSubGridRow:function(t){return this.each(function(){if((this.grid||t)&&!0===this.p.subGrid){var n=e(this).jqGrid("getInd",t,!0);n&&(n=e("td.sgexpanded",n)[0])&&e(n).trigger("click")}})},toggleSubGridRow:function(t){return this.each(function(){if((this.grid||t)&&!0===this.p.subGrid){var n=e(this).jqGrid("getInd",t,!0);if(n){var r=e("td.sgcollapsed",n)[0];r?e(r).trigger("click"):(r=e("td.sgexpanded",n)[0])&&e(r).trigger("click")}}})}})}(jQuery),function(e){e.extend(e.jgrid,{template:function(t){var n=e.makeArray(arguments).slice(1),r,i=n.length;return null==t&&(t=""),t.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,function(t,s){if(!isNaN(parseInt(s,10)))return n[parseInt(s,10)];for(r=0;r<i;r++)if(e.isArray(n[r]))for(var o=n[r],u=o.length;u--;)if(s===o[u].nm)return o[u].v})}}),e.jgrid.extend({groupingSetup:function(){return this.each(function(){var t,n,r=this.p.colModel,i=this.p.groupingView;if(null===i||"object"!=typeof i&&!e.isFunction(i))this.p.grouping=!1;else if(i.groupField.length){void 0===i.visibiltyOnNextGrouping&&(i.visibiltyOnNextGrouping=[]),i.lastvalues=[],i.groups=[],i.counters=[];for(t=0;t<i.groupField.length;t++)i.groupOrder[t]||(i.groupOrder[t]="asc"),i.groupText[t]||(i.groupText[t]="{0}"),"boolean"!=typeof i.groupColumnShow[t]&&(i.groupColumnShow[t]=!0),"boolean"!=typeof i.groupSummary[t]&&(i.groupSummary[t]=!1),!0===i.groupColumnShow[t]?(i.visibiltyOnNextGrouping[t]=!0,e(this).jqGrid("showCol",i.groupField[t])):(i.visibiltyOnNextGrouping[t]=e("#"+e.jgrid.jqID(this.p.id+"_"+i.groupField[t])).is(":visible"),e(this).jqGrid("hideCol",i.groupField[t]));i.summary=[],t=0;for(n=r.length;t<n;t++)r[t].summaryType&&(r[t].summaryDivider?i.summary.push({nm:r[t].name,st:r[t].summaryType,v:"",sd:r[t].summaryDivider,vd:"",sr:r[t].summaryRound,srt:r[t].summaryRoundType||"round"}):i.summary.push({nm:r[t].name,st:r[t].summaryType,v:"",sr:r[t].summaryRound,srt:r[t].summaryRoundType||"round"}))}else this.p.grouping=!1})},groupingPrepare:function(t,n,r,i){return this.each(function(){var s=this.p.groupingView,o=this,u,l=s.groupField.length,c,h,p,d=0;for(u=0;u<l;u++)c=s.groupField[u],p=s.displayField[u],h=r[c],p=null==p?null:r[p],null==p&&(p=h),void 0!==h&&(0===i?(s.groups.push({idx:u,dataIndex:c,value:h,displayValue:p,startRow:i,cnt:1,summary:[]}),s.lastvalues[u]=h,s.counters[u]={cnt:1,pos:s.groups.length-1,summary:e.extend(!0,[],s.summary)}):"object"!=typeof h&&(e.isArray(s.isInTheSameGroup)&&e.isFunction(s.isInTheSameGroup[u])?!s.isInTheSameGroup[u].call(o,s.lastvalues[u],h,u,s):s.lastvalues[u]!==h)?(s.groups.push({idx:u,dataIndex:c,value:h,displayValue:p,startRow:i,cnt:1,summary:[]}),s.lastvalues[u]=h,d=1,s.counters[u]={cnt:1,pos:s.groups.length-1,summary:e.extend(!0,[],s.summary)}):1===d?(s.groups.push({idx:u,dataIndex:c,value:h,displayValue:p,startRow:i,cnt:1,summary:[]}),s.lastvalues[u]=h,s.counters[u]={cnt:1,pos:s.groups.length-1,summary:e.extend(!0,[],s.summary)}):(s.counters[u].cnt+=1,s.groups[s.counters[u].pos].cnt=s.counters[u].cnt),e.each(s.counters[u].summary,function(){e.isFunction(this.st)?this.v=this.st.call(o,this.v,this.nm,r):(this.v=e(o).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,r),this.st.toLowerCase()==="avg"&&this.sd&&(this.vd=e(o).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,r)))}),s.groups[s.counters[u].pos].summary=s.counters[u].summary);n.push(t)}),n},groupingToggle:function(t){return this.each(function(){var n=this.p.groupingView,r=t.split("_"),i=parseInt(r[r.length-2],10);r.splice(r.length-2,2);var s=r.join("_"),r=n.minusicon,o=n.plusicon,u=e("#"+e.jgrid.jqID(t)),u=u.length?u[0].nextSibling:null,a=e("#"+e.jgrid.jqID(t)+" span.tree-wrap-"+this.p.direction),f=function(t){return t=e.map(t.split(" "),function(e){if(e.substring(0,s.length+1)===s+"_")return parseInt(e.substring(s.length+1),10)}),0<t.length?t[0]:void 0},l,c=!1;if(a.hasClass(r)){if(n.showSummaryOnHide){if(u)for(;u&&!(e(u).hasClass("jqfoot")&&parseInt(e(u).attr("jqfootlevel"),10)<=i);)e(u).hide(),u=u.nextSibling}else if(u)for(;u;){n=f(u.className);if(void 0!==n&&n<=i)break;e(u).hide(),u=u.nextSibling}a.removeClass(r).addClass(o),c=!0}else{if(u)for(l=void 0;u;){n=f(u.className),void 0===l&&(l=void 0===n);if(void 0!==n){if(n<=i)break;n===i+1&&e(u).show().find(">td>span.tree-wrap-"+this.p.direction).removeClass(r).addClass(o)}else l&&e(u).show();u=u.nextSibling}a.removeClass(o).addClass(r)}e(this).triggerHandler("jqGridGroupingClickGroup",[t,c]),e.isFunction(this.p.onClickGroup)&&this.p.onClickGroup.call(this,t,c)}),!1},groupingRender:function(t,n){return this.each(function(){function r(e,t,n){var r=!1;if(0===t)r=n[e];else{var i=n[e].idx;if(0===i)r=n[e];else for(;0<=e;e--)if(n[e].idx===i-t){r=n[e];break}}return r}var i=this,s=i.p.groupingView,o="",u="",a,f,l=s.groupCollapse?s.plusicon:s.minusicon,c,h=[],p=s.groupField.length,l=l+(" tree-wrap-"+i.p.direction);e.each(i.p.colModel,function(e,t){var n;for(n=0;n<p;n++)if(s.groupField[n]===t.name){h[n]=e;break}});var d=0,v=e.makeArray(s.groupSummary);v.reverse(),e.each(s.groups,function(y,E){d++,f=i.p.id+"ghead_"+E.idx,a=f+"_"+y,u="<span style='cursor:pointer;' class='ui-icon "+l+"' onclick=\"jQuery('#"+e.jgrid.jqID(i.p.id)+"').jqGrid('groupingToggle','"+a+"');return false;\"></span>";try{e.isArray(s.formatDisplayField)&&e.isFunction(s.formatDisplayField[E.idx])?(E.displayValue=s.formatDisplayField[E.idx].call(i,E.displayValue,E.value,i.p.colModel[h[E.idx]],E.idx,s),c=E.displayValue):c=i.formatter(a,E.displayValue,h[E.idx],E.value)}catch(S){c=E.displayValue}o+='<tr id="'+a+'"'+(s.groupCollapse&&0<E.idx?' style="display:none;" ':" ")+'role="row" class= "ui-widget-content jqgroup ui-row-'+i.p.direction+" "+f+'"><td style="padding-left:'+12*E.idx+'px;" colspan="'+n+'">'+u+e.jgrid.template(s.groupText[E.idx],c,E.cnt,E.summary)+"</td></tr>";if(p-1===E.idx){var T=s.groups[y+1],N,C,L=void 0!==T?s.groups[y+1].startRow:t.length;for(C=E.startRow;C<L;C++)o+=t[C].join("");var A;if(void 0!==T){for(A=0;A<s.groupField.length&&T.dataIndex!==s.groupField[A];A++);d=s.groupField.length-A}for(T=0;T<d;T++)if(v[T]){C="",s.groupCollapse&&!s.showSummaryOnHide&&(C=' style="display:none;"'),o+="<tr"+C+' jqfootlevel="'+(E.idx-T)+'" role="row" class="ui-widget-content jqfoot ui-row-'+i.p.direction+'">',C=r(y,T,s.groups);var O=i.p.colModel,M,_=C.cnt;for(N=0;N<n;N++){var D="<td "+i.formatCol(N,1,"")+">&#160;</td>",P="{0}";e.each(C.summary,function(){if(this.nm===O[N].name){O[N].summaryTpl&&(P=O[N].summaryTpl),"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v/=this.vd:this.v&&0<_&&(this.v/=_));try{M=i.formatter("",this.v,N,this)}catch(t){M=this.v}return D="<td "+i.formatCol(N,1,"")+">"+e.jgrid.format(P,M)+"</td>",!1}}),o+=D}o+="</tr>"}d=A}}),e("#"+e.jgrid.jqID(i.p.id)+" tbody:first").append(o),o=null})},groupingGroupBy:function(t,n){return this.each(function(){"string"==typeof t&&(t=[t]);var r=this.p.groupingView;this.p.grouping=!0,void 0===r.visibiltyOnNextGrouping&&(r.visibiltyOnNextGrouping=[]);var i;for(i=0;i<r.groupField.length;i++)!r.groupColumnShow[i]&&r.visibiltyOnNextGrouping[i]&&e(this).jqGrid("showCol",r.groupField[i]);for(i=0;i<t.length;i++)r.visibiltyOnNextGrouping[i]=e("#"+e.jgrid.jqID(this.p.id)+"_"+e.jgrid.jqID(t[i])).is(":visible");this.p.groupingView=e.extend(this.p.groupingView,n||{}),r.groupField=t,e(this).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){void 0===t&&(t=!0),this.p.grouping=!1;if(!0===t){var n=this.p.groupingView,r;for(r=0;r<n.groupField.length;r++)!n.groupColumnShow[r]&&n.visibiltyOnNextGrouping[r]&&e(this).jqGrid("showCol",n.groupField);e("tr.jqgroup, tr.jqfoot","#"+e.jgrid.jqID(this.p.id)+" tbody:first").remove(),e("tr.jqgrow:hidden","#"+e.jgrid.jqID(this.p.id)+" tbody:first").show()}else e(this).trigger("reloadGrid")})},groupingCalculations:{handler:function(e,t,n,r,i,s){var o={sum:function(){return parseFloat(t||0)+parseFloat(s[n]||0)},min:function(){return""===t?parseFloat(s[n]||0):Math.min(parseFloat(t),parseFloat(s[n]||0))},max:function(){return""===t?parseFloat(s[n]||0):Math.max(parseFloat(t),parseFloat(s[n]||0))},count:function(){return""===t&&(t=0),s.hasOwnProperty(n)?t+1:0},avg:function(){return o.sum()}};if(!o[e])throw"jqGrid Grouping No such method: "+e;return e=o[e](),null!=r&&("fixed"===i?e=e.toFixed(r):(r=Math.pow(10,r),e=Math.round(e*r)/r)),e}}})}(jQuery),function(e){e.jgrid.extend({setTreeNode:function(t,n){return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)for(var i=r.p.expColInd,s=r.p.treeReader.expanded_field,o=r.p.treeReader.leaf_field,u=r.p.treeReader.level_field,a=r.p.treeReader.icon_field,f=r.p.treeReader.loaded,l,h,p,v;t<n;)v=e.jgrid.stripPref(r.p.idPrefix,r.rows[t].id),v=r.p.data[r.p._index[v]],"nested"===r.p.treeGridModel&&!v[o]&&(l=parseInt(v[r.p.treeReader.left_field],10),h=parseInt(v[r.p.treeReader.right_field],10),v[o]=h===l+1?"true":"false",r.rows[t].cells[r.p._treeleafpos].innerHTML=v[o]),l=parseInt(v[u],10),0===r.p.tree_root_level?(p=l+1,h=l):(p=l,h=l-1),p="<div class='tree-wrap tree-wrap-"+r.p.direction+"' style='width:"+18*p+"px;'>",p+="<div style='"+("rtl"===r.p.direction?"right:":"left:")+18*h+"px;' class='ui-icon ",void 0!==v[f]&&(v[f]="true"===v[f]||!0===v[f]?!0:!1),"true"===v[o]||!0===v[o]?(p+=(void 0!==v[a]&&""!==v[a]?v[a]:r.p.treeIcons.leaf)+" tree-leaf treeclick",v[o]=!0,h="leaf"):(v[o]=!1,h=""),v[s]=("true"===v[s]||!0===v[s]?!0:!1)&&(v[f]||void 0===v[f]),p=!1===v[s]?p+(!0===v[o]?"'":r.p.treeIcons.plus+" tree-plus treeclick'"):p+(!0===v[o]?"'":r.p.treeIcons.minus+" tree-minus treeclick'"),p+="></div></div>",e(r.rows[t].cells[i]).wrapInner("<span class='cell-wrapper"+h+"'></span>").prepend(p),l!==parseInt(r.p.tree_root_level,10)&&((v=(v=e(r).jqGrid("getNodeParent",v))&&v.hasOwnProperty(s)?v[s]:!0)||e(r.rows[t]).css("display","none")),e(r.rows[t].cells[i]).find("div.treeclick").bind("click",function(t){return t=e.jgrid.stripPref(r.p.idPrefix,e(t.target||t.srcElement,r.rows).closest("tr.jqgrow")[0].id),t=r.p._index[t],r.p.data[t][o]||(r.p.data[t][s]?(e(r).jqGrid("collapseRow",r.p.data[t]),e(r).jqGrid("collapseNode",r.p.data[t])):(e(r).jqGrid("expandRow",r.p.data[t]),e(r).jqGrid("expandNode",r.p.data[t]))),!1}),!0===r.p.ExpandColClick&&e(r.rows[t].cells[i]).find("span.cell-wrapper").css("cursor","pointer").bind("click",function(t){var t=e.jgrid.stripPref(r.p.idPrefix,e(t.target||t.srcElement,r.rows).closest("tr.jqgrow")[0].id),n=r.p._index[t];return r.p.data[n][o]||(r.p.data[n][s]?(e(r).jqGrid("collapseRow",r.p.data[n]),e(r).jqGrid("collapseNode",r.p.data[n])):(e(r).jqGrid("expandRow",r.p.data[n]),e(r).jqGrid("expandNode",r.p.data[n]))),e(r).jqGrid("setSelection",t),!1}),t++})},setTreeGrid:function(){return this.each(function(){var t=this,n=0,r=!1,i,s,o,u=[];if(t.p.treeGrid){t.p.treedatatype||e.extend(t.p,{treedatatype:t.p.datatype}),t.p.subGrid=!1,t.p.altRows=!1,t.p.pgbuttons=!1,t.p.pginput=!1,t.p.gridview=!0,null===t.p.rowTotal&&(t.p.rowNum=1e4),t.p.multiselect=!1,t.p.rowList=[],t.p.expColInd=0,t.p.treeIcons=e.extend({plus:"ui-icon-triangle-1-"+("rtl"===t.p.direction?"w":"e"),minus:"ui-icon-triangle-1-s",leaf:"ui-icon-radio-off"},t.p.treeIcons||{}),"nested"===t.p.treeGridModel?t.p.treeReader=e.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},t.p.treeReader):"adjacency"===t.p.treeGridModel&&(t.p.treeReader=e.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},t.p.treeReader));for(s in t.p.colModel)if(t.p.colModel.hasOwnProperty(s))for(o in i=t.p.colModel[s].name,i===t.p.ExpandColumn&&!r&&(r=!0,t.p.expColInd=n),n++,t.p.treeReader)t.p.treeReader.hasOwnProperty(o)&&t.p.treeReader[o]===i&&u.push(i);e.each(t.p.treeReader,function(r,i){i&&e.inArray(i,u)===-1&&(r==="leaf_field"&&(t.p._treeleafpos=n),n++,t.p.colNames.push(i),t.p.colModel.push({name:i,width:1,hidden:!0,sortable:!1,resizable:!1,hidedlg:!0,editable:!0,search:!1}))})}})},expandRow:function(t){this.each(function(){var n=this;if(n.grid&&n.p.treeGrid){var r=e(n).jqGrid("getNodeChildren",t),i=n.p.treeReader.expanded_field;e(r).each(function(){var t=n.p.idPrefix+e.jgrid.getAccessor(this,n.p.localReader.id);e(e(n).jqGrid("getGridRowById",t)).css("display",""),this[i]&&e(n).jqGrid("expandRow",this)})}})},collapseRow:function(t){this.each(function(){var n=this;if(n.grid&&n.p.treeGrid){var r=e(n).jqGrid("getNodeChildren",t),i=n.p.treeReader.expanded_field;e(r).each(function(){var t=n.p.idPrefix+e.jgrid.getAccessor(this,n.p.localReader.id);e(e(n).jqGrid("getGridRowById",t)).css("display","none"),this[i]&&e(n).jqGrid("collapseRow",this)})}})},getRootNodes:function(){var t=[];return this.each(function(){var n=this;if(n.grid&&n.p.treeGrid)switch(n.p.treeGridModel){case"nested":var r=n.p.treeReader.level_field;e(n.p.data).each(function(){parseInt(this[r],10)===parseInt(n.p.tree_root_level,10)&&t.push(this)});break;case"adjacency":var i=n.p.treeReader.parent_id_field;e(n.p.data).each(function(){(null===this[i]||"null"===(""+this[i]).toLowerCase())&&t.push(this)})}}),t},getNodeDepth:function(t){var n=null;return this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":n=parseInt(t[this.p.treeReader.level_field],10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":n=e(this).jqGrid("getNodeAncestors",t).length}}),n},getNodeParent:function(t){var n=null;return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)switch(r.p.treeGridModel){case"nested":var i=r.p.treeReader.left_field,s=r.p.treeReader.right_field,o=r.p.treeReader.level_field,u=parseInt(t[i],10),a=parseInt(t[s],10),f=parseInt(t[o],10);e(this.p.data).each(function(){if(parseInt(this[o],10)===f-1&&parseInt(this[i],10)<u&&parseInt(this[s],10)>a)return n=this,!1});break;case"adjacency":var l=r.p.treeReader.parent_id_field,h=r.p.localReader.id;e(this.p.data).each(function(){if(this[h]===e.jgrid.stripPref(r.p.idPrefix,t[l]))return n=this,!1})}}),n},getNodeChildren:function(t){var n=[];return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)switch(r.p.treeGridModel){case"nested":var i=r.p.treeReader.left_field,s=r.p.treeReader.right_field,o=r.p.treeReader.level_field,u=parseInt(t[i],10),a=parseInt(t[s],10),f=parseInt(t[o],10);e(this.p.data).each(function(){parseInt(this[o],10)===f+1&&parseInt(this[i],10)>u&&parseInt(this[s],10)<a&&n.push(this)});break;case"adjacency":var l=r.p.treeReader.parent_id_field,h=r.p.localReader.id;e(this.p.data).each(function(){this[l]==e.jgrid.stripPref(r.p.idPrefix,t[h])&&n.push(this)})}}),n},getFullTreeNode:function(t){var n=[];return this.each(function(){var r=this,i;if(r.grid&&r.p.treeGrid)switch(r.p.treeGridModel){case"nested":var s=r.p.treeReader.left_field,o=r.p.treeReader.right_field,u=r.p.treeReader.level_field,a=parseInt(t[s],10),f=parseInt(t[o],10),l=parseInt(t[u],10);e(this.p.data).each(function(){parseInt(this[u],10)>=l&&parseInt(this[s],10)>=a&&parseInt(this[s],10)<=f&&n.push(this)});break;case"adjacency":if(t){n.push(t);var h=r.p.treeReader.parent_id_field,p=r.p.localReader.id;e(this.p.data).each(function(t){i=n.length;for(t=0;t<i;t++)if(e.jgrid.stripPref(r.p.idPrefix,n[t][p])===this[h]){n.push(this);break}})}}}),n},getNodeAncestors:function(t){var n=[];return this.each(function(){if(this.grid&&this.p.treeGrid)for(var r=e(this).jqGrid("getNodeParent",t);r;)n.push(r),r=e(this).jqGrid("getNodeParent",r)}),n},isVisibleNode:function(t){var n=!0;return this.each(function(){if(this.grid&&this.p.treeGrid){var r=e(this).jqGrid("getNodeAncestors",t),i=this.p.treeReader.expanded_field;e(r).each(function(){n=n&&this[i];if(!n)return!1})}}),n},isNodeLoaded:function(t){var n;return this.each(function(){if(this.grid&&this.p.treeGrid){var r=this.p.treeReader.leaf_field,i=this.p.treeReader.loaded;n=void 0!==t?void 0!==t[i]?t[i]:t[r]||0<e(this).jqGrid("getNodeChildren",t).length?!0:!1:!1}}),n},expandNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var n=this.p.treeReader.expanded_field,r=this.p.treeReader.parent_id_field,i=this.p.treeReader.loaded,s=this.p.treeReader.level_field,o=this.p.treeReader.left_field,u=this.p.treeReader.right_field;if(!t[n]){var a=e.jgrid.getAccessor(t,this.p.localReader.id),f=e("#"+this.p.idPrefix+e.jgrid.jqID(a),this.grid.bDiv)[0],l=this.p._index[a];e(this).jqGrid("isNodeLoaded",this.p.data[l])?(t[n]=!0,e("div.treeclick",f).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")):this.grid.hDiv.loading||(t[n]=!0,e("div.treeclick",f).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=f.rowIndex,this.p.datatype=this.p.treedatatype,"nested"===this.p.treeGridModel?e(this).jqGrid("setGridParam",{postData:{nodeid:a,n_left:t[o],n_right:t[u],n_level:t[s]}}):e(this).jqGrid("setGridParam",{postData:{nodeid:a,parentid:t[r],n_level:t[s]}}),e(this).trigger("reloadGrid"),t[i]=!0,"nested"===this.p.treeGridModel?e(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):e(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}}))}}})},collapseNode:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var n=this.p.treeReader.expanded_field;t[n]&&(t[n]=!1,n=e.jgrid.getAccessor(t,this.p.localReader.id),n=e("#"+this.p.idPrefix+e.jgrid.jqID(n),this.grid.bDiv)[0],e("div.treeclick",n).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus"))}})},SortTree:function(t,n,r,i){return this.each(function(){if(this.grid&&this.p.treeGrid){var s,o,u,f=[],l=this,p;s=e(this).jqGrid("getRootNodes"),s=e.jgrid.from(s),s.orderBy(t,n,r,i),p=s.select(),s=0;for(o=p.length;s<o;s++)u=p[s],f.push(u),e(this).jqGrid("collectChildrenSortTree",f,u,t,n,r,i);e.each(f,function(t){var n=e.jgrid.getAccessor(this,l.p.localReader.id);e("#"+e.jgrid.jqID(l.p.id)+" tbody tr:eq("+t+")").after(e("tr#"+e.jgrid.jqID(n),l.grid.bDiv))}),f=p=s=null}})},collectChildrenSortTree:function(t,n,r,i,s,o){return this.each(function(){if(this.grid&&this.p.treeGrid){var u,f,l,p;u=e(this).jqGrid("getNodeChildren",n),u=e.jgrid.from(u),u.orderBy(r,i,s,o),p=u.select(),u=0;for(f=p.length;u<f;u++)l=p[u],t.push(l),e(this).jqGrid("collectChildrenSortTree",t,l,r,i,s,o)}})},setTreeRow:function(t,n){var r=!1;return this.each(function(){this.grid&&this.p.treeGrid&&(r=e(this).jqGrid("setRowData",t,n))}),r},delTreeNode:function(t){return this.each(function(){var n=this.p.localReader.id,r,i=this.p.treeReader.left_field,s=this.p.treeReader.right_field,o,u,a;if(this.grid&&this.p.treeGrid&&(r=this.p._index[t],void 0!==r)){o=parseInt(this.p.data[r][s],10),u=o-parseInt(this.p.data[r][i],10)+1;var f=e(this).jqGrid("getFullTreeNode",this.p.data[r]);if(0<f.length)for(r=0;r<f.length;r++)e(this).jqGrid("delRowData",f[r][n]);if("nested"===this.p.treeGridModel){n=e.jgrid.from(this.p.data).greater(i,o,{stype:"integer"}).select();if(n.length)for(a in n)n.hasOwnProperty(a)&&(n[a][i]=parseInt(n[a][i],10)-u);n=e.jgrid.from(this.p.data).greater(s,o,{stype:"integer"}).select();if(n.length)for(a in n)n.hasOwnProperty(a)&&(n[a][s]=parseInt(n[a][s],10)-u)}}})},addChildNode:function(t,n,r,i){var s=this[0];if(r){var o=s.p.treeReader.expanded_field,u=s.p.treeReader.leaf_field,a=s.p.treeReader.level_field,f=s.p.treeReader.parent_id_field,l=s.p.treeReader.left_field,c=s.p.treeReader.right_field,h=s.p.treeReader.loaded,p,v,m,g,y;p=0;var b=n,w;void 0===i&&(i=!1);if(void 0===t||null===t){y=s.p.data.length-1;if(0<=y)for(;0<=y;)p=Math.max(p,parseInt(s.p.data[y][s.p.localReader.id],10)),y--;t=p+1}var E=e(s).jqGrid("getInd",n);w=!1;if(void 0===n||null===n||""===n)b=n=null,p="last",g=s.p.tree_root_level,y=s.p.data.length+1;else if(p="after",v=s.p._index[n],m=s.p.data[v],n=m[s.p.localReader.id],g=parseInt(m[a],10)+1,y=e(s).jqGrid("getFullTreeNode",m),y.length?(b=y=y[y.length-1][s.p.localReader.id],y=e(s).jqGrid("getInd",b)+1):y=e(s).jqGrid("getInd",n)+1,m[u])w=!0,m[o]=!0,e(s.rows[E]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(s.p.treeIcons.leaf+" tree-leaf").addClass(s.p.treeIcons.minus+" tree-minus"),s.p.data[v][u]=!1,m[h]=!0;v=y+1,void 0===r[o]&&(r[o]=!1),void 0===r[h]&&(r[h]=!1),r[a]=g,void 0===r[u]&&(r[u]=!0),"adjacency"===s.p.treeGridModel&&(r[f]=n);if("nested"===s.p.treeGridModel){var S;if(null!==n){u=parseInt(m[c],10),a=e.jgrid.from(s.p.data),a=a.greaterOrEquals(c,u,{stype:"integer"}),a=a.select();if(a.length)for(S in a)a.hasOwnProperty(S)&&(a[S][l]=a[S][l]>u?parseInt(a[S][l],10)+2:a[S][l],a[S][c]=a[S][c]>=u?parseInt(a[S][c],10)+2:a[S][c]);r[l]=u,r[c]=u+1}else{u=parseInt(e(s).jqGrid("getCol",c,!1,"max"),10),a=e.jgrid.from(s.p.data).greater(l,u,{stype:"integer"}).select();if(a.length)for(S in a)a.hasOwnProperty(S)&&(a[S][l]=parseInt(a[S][l],10)+2);a=e.jgrid.from(s.p.data).greater(c,u,{stype:"integer"}).select();if(a.length)for(S in a)a.hasOwnProperty(S)&&(a[S][c]=parseInt(a[S][c],10)+2);r[l]=u+1,r[c]=u+2}}if(null===n||e(s).jqGrid("isNodeLoaded",m)||w)e(s).jqGrid("addRowData",t,r,p,b),e(s).jqGrid("setTreeNode",y,v);m&&!m[o]&&i&&e(s.rows[E]).find("div.treeclick").click()}}})}(jQuery),function(e){e.jgrid.extend({jqGridImport:function(t){return t=e.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},t||{}),this.each(function(){var n=this,r=function(t,r){var i=e(r.xmlGrid.config,t)[0],s=e(r.xmlGrid.data,t)[0],o,u;if(xmlJsonClass.xml2json&&e.jgrid.parse){i=xmlJsonClass.xml2json(i," "),i=e.jgrid.parse(i);for(u in i)i.hasOwnProperty(u)&&(o=i[u]);s?(s=i.grid.datatype,i.grid.datatype="xmlstring",i.grid.datastr=t,e(n).jqGrid(o).jqGrid("setGridParam",{datatype:s})):e(n).jqGrid(o)}else alert("xml2json or parse are not present")},i=function(t,r){if(t&&"string"==typeof t){var i=!1;e.jgrid.useJSON&&(e.jgrid.useJSON=!1,i=!0);var s=e.jgrid.parse(t);i&&(e.jgrid.useJSON=!0),i=s[r.jsonGrid.config];if(s=s[r.jsonGrid.data]){var o=i.datatype;i.datatype="jsonstring",i.datastr=s,e(n).jqGrid(i).jqGrid("setGridParam",{datatype:o})}else e(n).jqGrid(i)}};switch(t.imptype){case"xml":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"xml",complete:function(i,s){"success"===s&&(r(i.responseXML,t),e(n).triggerHandler("jqGridImportComplete",[i,t]),e.isFunction(t.importComplete)&&t.importComplete(i))}},t.ajaxOptions));break;case"xmlstring":if(t.impstring&&"string"==typeof t.impstring){var s=e.parseXML(t.impstring);s&&(r(s,t),e(n).triggerHandler("jqGridImportComplete",[s,t]),e.isFunction(t.importComplete)&&t.importComplete(s),t.impstring=null),s=null}break;case"json":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"json",complete:function(r){try{i(r.responseText,t),e(n).triggerHandler("jqGridImportComplete",[r,t]),e.isFunction(t.importComplete)&&t.importComplete(r)}catch(s){}}},t.ajaxOptions));break;case"jsonstring":t.impstring&&"string"==typeof t.impstring&&(i(t.impstring,t),e(n).triggerHandler("jqGridImportComplete",[t.impstring,t]),e.isFunction(t.importComplete)&&t.importComplete(t.impstring),t.impstring=null)}})},jqGridExport:function(t){var t=e.extend({exptype:"xmlstring",root:"grid",ident:"	"},t||{}),n=null;return this.each(function(){if(this.grid){var r,i=e.extend(!0,{},e(this).jqGrid("getGridParam"));i.rownumbers&&(i.colNames.splice(0,1),i.colModel.splice(0,1)),i.multiselect&&(i.colNames.splice(0,1),i.colModel.splice(0,1)),i.subGrid&&(i.colNames.splice(0,1),i.colModel.splice(0,1)),i.knv=null;if(i.treeGrid)for(r in i.treeReader)i.treeReader.hasOwnProperty(r)&&(i.colNames.splice(i.colNames.length-1),i.colModel.splice(i.colModel.length-1));switch(t.exptype){case"xmlstring":n="<"+t.root+">"+xmlJsonClass.json2xml(i,t.ident)+"</"+t.root+">";break;case"jsonstring":n="{"+xmlJsonClass.toJson(i,t.root,t.ident,!1)+"}",void 0!==i.postData.filters&&(n=n.replace(/filters":"/,'filters":'),n=n.replace(/}]}"/,"}]}"))}}}),n},excelExport:function(t){return t=e.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},t||{}),this.each(function(){if(this.grid){var n;"remote"===t.exptype&&(n=e.extend({},this.p.postData),n[t.oper]=t.tag,n=jQuery.param(n),n=-1!==t.url.indexOf("?")?t.url+"&"+n:t.url+"?"+n,window.location=n)}})}})}(jQuery);var xmlJsonClass={xml2json:function(e,t){9===e.nodeType&&(e=e.documentElement);var n=this.toJson(this.toObj(this.removeWhite(e)),e.nodeName,"	");return"{\n"+t+(t?n.replace(/\t/g,t):n.replace(/\t|\n/g,""))+"\n}"},json2xml:function(e,t){var n=function(e,t,r){var i="",s,o;if(e instanceof Array)if(0===e.length)i+=r+"<"+t+">__EMPTY_ARRAY_</"+t+">\n";else{s=0;for(o=e.length;s<o;s+=1)var u=r+n(e[s],t,r+"	")+"\n",i=i+u}else if("object"==typeof e){s=!1,i+=r+"<"+t;for(o in e)e.hasOwnProperty(o)&&("@"===o.charAt(0)?i+=" "+o.substr(1)+'="'+e[o].toString()+'"':s=!0);i+=s?">":"/>";if(s){for(o in e)e.hasOwnProperty(o)&&("#text"===o?i+=e[o]:"#cdata"===o?i+="<![CDATA["+e[o]+"]]>":"@"!==o.charAt(0)&&(i+=n(e[o],o,r+"	")));i+=("\n"===i.charAt(i.length-1)?r:"")+"</"+t+">"}}else"function"==typeof e?i+=r+"<"+t+"><![CDATA["+e+"]]></"+t+">":(void 0===e&&(e=""),i='""'===e.toString()||0===e.toString().length?i+(r+"<"+t+">__EMPTY_STRING_</"+t+">"):i+(r+"<"+t+">"+e.toString()+"</"+t+">"));return i},r="",i;for(i in e)e.hasOwnProperty(i)&&(r+=n(e[i],i,""));return t?r.replace(/\t/g,t):r.replace(/\t|\n/g,"")},toObj:function(e){var t={},n=/function/i;if(1===e.nodeType){if(e.attributes.length){var r;for(r=0;r<e.attributes.length;r+=1)t["@"+e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString()}if(e.firstChild){var i=r=0,s=!1,o;for(o=e.firstChild;o;o=o.nextSibling)1===o.nodeType?s=!0:3===o.nodeType&&o.nodeValue.match(/[^ \f\n\r\t\v]/)?r+=1:4===o.nodeType&&(i+=1);if(s)if(2>r&&2>i){this.removeWhite(e);for(o=e.firstChild;o;o=o.nextSibling)3===o.nodeType?t["#text"]=this.escape(o.nodeValue):4===o.nodeType?n.test(o.nodeValue)?t[o.nodeName]=[t[o.nodeName],o.nodeValue]:t["#cdata"]=this.escape(o.nodeValue):t[o.nodeName]?t[o.nodeName]instanceof Array?t[o.nodeName][t[o.nodeName].length]=this.toObj(o):t[o.nodeName]=[t[o.nodeName],this.toObj(o)]:t[o.nodeName]=this.toObj(o)}else e.attributes.length?t["#text"]=this.escape(this.innerXml(e)):t=this.escape(this.innerXml(e));else if(r)e.attributes.length?t["#text"]=this.escape(this.innerXml(e)):(t=this.escape(this.innerXml(e)),"__EMPTY_ARRAY_"===t?t="[]":"__EMPTY_STRING_"===t&&(t=""));else if(i)if(1<i)t=this.escape(this.innerXml(e));else for(o=e.firstChild;o;o=o.nextSibling){if(n.test(e.firstChild.nodeValue)){t=e.firstChild.nodeValue;break}t["#cdata"]=this.escape(o.nodeValue)}}!e.attributes.length&&!e.firstChild&&(t=null)}else 9===e.nodeType?t=this.toObj(e.documentElement):alert("unhandled node type: "+e.nodeType);return t},toJson:function(e,t,n,r){void 0===r&&(r=!0);var i=t?'"'+t+'"':"",s="	",o="\n";r||(o=s="");if("[]"===e)i+=t?":[]":"[]";else if(e instanceof Array){var u,a,f=[];a=0;for(u=e.length;a<u;a+=1)f[a]=this.toJson(e[a],"",n+s,r);i+=(t?":[":"[")+(1<f.length?o+n+s+f.join(","+o+n+s)+o+n:f.join(""))+"]"}else if(null===e)i+=(t&&":")+"null";else if("object"==typeof e){u=[];for(a in e)e.hasOwnProperty(a)&&(u[u.length]=this.toJson(e[a],a,n+s,r));i+=(t?":{":"{")+(1<u.length?o+n+s+u.join(","+o+n+s)+o+n:u.join(""))+"}"}else i="string"==typeof e?i+((t&&":")+'"'+e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"'):i+((t&&":")+e.toString());return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var n=function(e){var t="",r;if(1===e.nodeType){t+="<"+e.nodeName;for(r=0;r<e.attributes.length;r+=1)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(r=e.firstChild;r;r=r.nextSibling)t+=n(r);t+="</"+e.nodeName+">"}else t+="/>"}else 3===e.nodeType?t+=e.nodeValue:4===e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},e=e.firstChild;e;e=e.nextSibling)t+=n(e);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();var t;for(t=e.firstChild;t;)if(3===t.nodeType)if(t.nodeValue.match(/[^ \f\n\r\t\v]/))t=t.nextSibling;else{var n=t.nextSibling;e.removeChild(t),t=n}else 1===t.nodeType&&this.removeWhite(t),t=t.nextSibling;return e}};(function(b){b.jgrid.msie&&8===b.jgrid.msiever()&&(b.expr[":"].hidden=function(e){return 0===e.offsetWidth||0===e.offsetHeight||"none"===e.style.display}),b.jgrid._multiselect=!1;if(b.ui&&b.ui.multiselect){if(b.ui.multiselect.prototype._setSelected){var o=b.ui.multiselect.prototype._setSelected;b.ui.multiselect.prototype._setSelected=function(e,t){var n=o.call(this,e,t);if(t&&this.selectedList){var r=this.element;this.selectedList.find("li").each(function(){b(this).data("optionLink")&&b(this).data("optionLink").remove().appendTo(r)})}return n}}b.ui.multiselect.prototype.destroy&&(b.ui.multiselect.prototype.destroy=function(){this.element.show(),this.container.remove(),b.Widget===void 0?b.widget.prototype.destroy.apply(this,arguments):b.Widget.prototype.destroy.apply(this,arguments)}),b.jgrid._multiselect=!0}b.jgrid.extend({sortableColumns:function(e){return this.each(function(){function t(){n.p.disableClick=!0}var n=this,r=b.jgrid.jqID(n.p.id),r={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+r+"_cb,#jqgh_"+r+"_rn,#jqgh_"+r+"_subgrid),:hidden)",placeholder:{element:function(e){return b(document.createElement(e[0].nodeName)).addClass(e[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(e,t){t.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),t.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}},update:function(e,t){var r=b(t.item).parent(),r=b(">th",r),i={},s=n.p.id+"_";b.each(n.p.colModel,function(e){i[this.name]=e});var o=[];r.each(function(){var e=b(">div",this).get(0).id.replace(/^jqgh_/,"").replace(s,"");i.hasOwnProperty(e)&&o.push(i[e])}),b(n).jqGrid("remapColumns",o,!0,!0),b.isFunction(n.p.sortable.update)&&n.p.sortable.update(o),setTimeout(function(){n.p.disableClick=!1},50)}};n.p.sortable.options?b.extend(r,n.p.sortable.options):b.isFunction(n.p.sortable)&&(n.p.sortable={update:n.p.sortable});if(r.start){var i=r.start;r.start=function(e,n){t(),i.call(this,e,n)}}else r.start=t;n.p.sortable.exclude&&(r.items=r.items+(":not("+n.p.sortable.exclude+")")),e.sortable(r).data("sortable").floating=!0})},columnChooser:function(e){function t(e,t){e&&(typeof e=="string"?b.fn[e]&&b.fn[e].apply(t,b.makeArray(arguments).slice(2)):b.isFunction(e)&&e.apply(t,b.makeArray(arguments).slice(2)))}var n=this;if(!b("#colchooser_"+b.jgrid.jqID(n[0].p.id)).length){var r=b('<div id="colchooser_'+n[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),i=b("select",r),e=b.extend({width:420,height:240,classname:null,done:function(e){e&&n.jqGrid("remapColumns",e,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470},dlog_opts:function(e){var t={};return t[e.bSubmit]=function(){e.apply_perm(),e.cleanup(!1)},t[e.bCancel]=function(){e.cleanup(!0)},b.extend(!0,{buttons:t,close:function(){e.cleanup(!0)},modal:e.modal||!1,resizable:e.resizable||!0,width:e.width+20},e.dialog_opts||{})},apply_perm:function(){b("option",i).each(function(){this.selected?n.jqGrid("showCol",s[this.value].name):n.jqGrid("hideCol",s[this.value].name)});var t=[];b("option:selected",i).each(function(){t.push(parseInt(this.value,10))}),b.each(t,function(){delete u[s[parseInt(this,10)].name]}),b.each(u,function(){var e=parseInt(this,10),n=t,r=e;if(r>=0){var i=n.slice(),s=i.splice(r,Math.max(n.length-r,r));r>n.length&&(r=n.length),i[r]=e,t=i.concat(s)}else t=void 0}),e.done&&e.done.call(n,t)},cleanup:function(s){t(e.dlog,r,"destroy"),t(e.msel,i,"destroy"),r.remove(),s&&e.done&&e.done.call(n)},msel_opts:{}},b.jgrid.col,e||{});if(b.ui&&b.ui.multiselect&&e.msel==="multiselect"){if(!b.jgrid._multiselect){alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");return}e.msel_opts=b.extend(b.ui.multiselect.defaults,e.msel_opts)}e.caption&&r.attr("title",e.caption),e.classname&&(r.addClass(e.classname),i.addClass(e.classname)),e.width&&(b(">div",r).css({width:e.width,margin:"0 auto"}),i.css("width",e.width)),e.height&&(b(">div",r).css("height",e.height),i.css("height",e.height-10));var s=n.jqGrid("getGridParam","colModel"),o=n.jqGrid("getGridParam","colNames"),u={},a=[];i.empty(),b.each(s,function(e){u[this.name]=e,this.hidedlg?this.hidden||a.push(e):i.append("<option value='"+e+"' "+(this.hidden?"":"selected='selected'")+">"+b.jgrid.stripHtml(o[e])+"</option>")});var f=b.isFunction(e.dlog_opts)?e.dlog_opts.call(n,e):e.dlog_opts;t(e.dlog,r,f),f=b.isFunction(e.msel_opts)?e.msel_opts.call(n,e):e.msel_opts,t(e.msel,i,f)}},sortableRows:function(e){return this.each(function(){var t=this;t.grid&&!t.p.treeGrid&&b.fn.sortable&&(e=b.extend({cursor:"move",axis:"y",items:".jqgrow"},e||{}),e.start&&b.isFunction(e.start)?(e._start_=e.start,delete e.start):e._start_=!1,e.update&&b.isFunction(e.update)?(e._update_=e.update,delete e.update):e._update_=!1,e.start=function(n,r){b(r.item).css("border-width","0px"),b("td",r.item).each(function(e){this.style.width=t.grid.cols[e].style.width});if(t.p.subGrid){var i=b(r.item).attr("id");try{b(t).jqGrid("collapseSubGridRow",i)}catch(s){}}e._start_&&e._start_.apply(this,[n,r])},e.update=function(n,r){b(r.item).css("border-width",""),t.p.rownumbers===!0&&b("td.jqgrid-rownum",t.rows).each(function(e){b(this).html(e+1+(parseInt(t.p.page,10)-1)*parseInt(t.p.rowNum,10))}),e._update_&&e._update_.apply(this,[n,r])},b("tbody:first",t).sortable(e),b("tbody:first",t).disableSelection())})},gridDnD:function(e){return this.each(function(){function t(){var e=b.data(n,"dnd");b("tr.jqgrow:not(.ui-draggable)",n).draggable(b.isFunction(e.drag)?e.drag.call(b(n),e):e.drag)}var n=this,r,i;if(n.grid&&!n.p.treeGrid&&b.fn.draggable&&b.fn.droppable){b("#jqgrid_dnd")[0]===void 0&&b("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>");if(typeof e=="string"&&e==="updateDnD"&&n.p.jqgdnd===!0)t();else{e=b.extend({drag:function(e){return b.extend({start:function(t,r){var i;if(n.p.subGrid){i=b(r.helper).attr("id");try{b(n).jqGrid("collapseSubGridRow",i)}catch(s){}}for(i=0;i<b.data(n,"dnd").connectWith.length;i++)b(b.data(n,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")===0&&b(b.data(n,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});r.helper.addClass("ui-state-highlight"),b("td",r.helper).each(function(e){this.style.width=n.grid.headers[e].width+"px"}),e.onstart&&b.isFunction(e.onstart)&&e.onstart.call(b(n),t,r)},stop:function(t,r){var i;r.helper.dropped&&!e.dragcopy&&(i=b(r.helper).attr("id"),i===void 0&&(i=b(this).attr("id")),b(n).jqGrid("delRowData",i));for(i=0;i<b.data(n,"dnd").connectWith.length;i++)b(b.data(n,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");e.onstop&&b.isFunction(e.onstop)&&e.onstop.call(b(n),t,r)}},e.drag_opts||{})},drop:function(e){return b.extend({accept:function(e){return b(e).hasClass("jqgrow")?(e=b(e).closest("table.ui-jqgrid-btable"),e.length>0&&b.data(e[0],"dnd")!==void 0?(e=b.data(e[0],"dnd").connectWith,b.inArray("#"+b.jgrid.jqID(this.id),e)!==-1?!0:!1):!1):e},drop:function(t,r){if(b(r.draggable).hasClass("jqgrow")){var i=b(r.draggable).attr("id"),i=r.draggable.parent().parent().jqGrid("getRowData",i);if(!e.dropbyname){var s=0,o={},u,f,l=b("#"+b.jgrid.jqID(this.id)).jqGrid("getGridParam","colModel");try{for(f in i)i.hasOwnProperty(f)&&(u=l[s].name,u==="cb"||u==="rn"||u==="subgrid"||i.hasOwnProperty(f)&&l[s]&&(o[u]=i[f]),s++);i=o}catch(h){}}r.helper.dropped=!0,e.beforedrop&&b.isFunction(e.beforedrop)&&(u=e.beforedrop.call(this,t,r,i,b("#"+b.jgrid.jqID(n.p.id)),b(this)),u!==void 0&&u!==null&&typeof u=="object"&&(i=u));if(r.helper.dropped){var p;e.autoid&&(b.isFunction(e.autoid)?p=e.autoid.call(this,i):(p=Math.ceil(Math.random()*1e3),p=e.autoidprefix+p)),b("#"+b.jgrid.jqID(this.id)).jqGrid("addRowData",p,i,e.droppos)}e.ondrop&&b.isFunction(e.ondrop)&&e.ondrop.call(this,t,r,i)}}},e.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},e||{});if(e.connectWith){e.connectWith=e.connectWith.split(","),e.connectWith=b.map(e.connectWith,function(e){return b.trim(e)}),b.data(n,"dnd",e),n.p.reccount!==0&&!n.p.jqgdnd&&t(),n.p.jqgdnd=!0;for(r=0;r<e.connectWith.length;r++)i=e.connectWith[r],b(i).droppable(b.isFunction(e.drop)?e.drop.call(b(n),e):e.drop)}}}})},gridResize:function(a){return this.each(function(){var d=this,c=b.jgrid.jqID(d.p.id);d.grid&&b.fn.resizable&&(a=b.extend({},a||{}),a.alsoResize?(a._alsoResize_=a.alsoResize,delete a.alsoResize):a._alsoResize_=!1,a.stop&&b.isFunction(a.stop)?(a._stop_=a.stop,delete a.stop):a._stop_=!1,a.stop=function(e,t){b(d).jqGrid("setGridParam",{height:b("#gview_"+c+" .ui-jqgrid-bdiv").height()}),b(d).jqGrid("setGridWidth",t.size.width,a.shrinkToFit),a._stop_&&a._stop_.call(d,e,t)},a.alsoResize=a._alsoResize_?eval("("+("{'#gview_"+c+" .ui-jqgrid-bdiv':true,'"+a._alsoResize_+"':true}")+")"):b(".ui-jqgrid-bdiv","#gview_"+c),delete a._alsoResize_,b("#gbox_"+c).resizable(a))})}})})(jQuery),define("jquery.jqgrid.site",function(){}),define("text!grading/templates.html",[],function(){return'<script type="text/template" id="site_grid_header">\r\n    <%if(type == "test"){%>\r\n    <span class="gradebookTest"><%= name %></span>\r\n    <% } else if(type == "final") { %>\r\n    <span><%= name %></span>\r\n    <% } else if(type == "assignment") { %>\r\n    <span><a href="<%= link %>" class="gradingLink gradebookAssignment"><%= name %></a></span>\r\n    <% } else if(type == "quiz") { %>\r\n    <span><a href="<%= link %>" class="gradingLink gradebookQuiz"><%= name %></a></span>\r\n    <% } %>\r\n    <%if(type != "final") { %>\r\n    <a href="#" class="edit-grading" id="edit-grading-<%= id %>"></a>\r\n    <% } %>\r\n    <ul class="clearfix <% (type == \'final\') ? print(\'final_grade\') : print(\'\'); %>">\r\n        <li class="header_label"><%= translate(\'max_points\')%></li>\r\n        <%if(type != "final") { %>\r\n        <li class="header_label"><%= translate(\'weight\')%></li>\r\n        <% } %>\r\n        <li class="clearfix"></li>\r\n        <li class="value"><%= max_points %></li>    \r\n        <%if(weight && type != "final"){%>\r\n        <li class="value"><%= weight %> &#37;</li>\r\n        <% } else if(type != "final") {%>\r\n        <li class="value"> 0 &#37;</li>\r\n        <% } %>\r\n</script>\r\n\r\n<script type="text/template" id="site_student_grid_header">\r\n    <%if(type == "test"){%>\r\n    <span class="gradebookTest"><%= name %></span>\r\n    <% } else if(type == "final") { %>\r\n    <span><%= name %></span>\r\n    <% } else if (type == "assignment") { %>\r\n    <span><a href="<%= link %>" class="gradingLink gradebookAssignment"><%= name %></a></span>\r\n    <% } else if(type == "quiz") { %>\r\n    <span><a href="<%= link %>" class="gradingLink gradebookQuiz"><%= name %></a></span>\r\n    <% } %>\r\n    <ul class="clearfix">\r\n        <li class="header_label"><%= translate(\'max_points\')%></li>\r\n        <li class="header_label"><%= translate(\'weight\')%></li>     \r\n        <li class="clearfix"></li>\r\n        <li class="value"><%= max_points %></li>\r\n        <%if(weight){%>\r\n        <li class="value"><%= weight %> &#37;</li>\r\n        <% } else if(type == "final") {%>\r\n        <li class="value">&nbsp;</li>\r\n        <% } else {%>\r\n        <li class="value"> 0 &#37;</li>\r\n        <% } %>\r\n</script>\r\n\r\n<script type="text/template" id="popup-grading">\r\n    <div id="popup_section" class="modal fade hide" data-backdrop="static"></div>\r\n</script>\r\n'}),define("grading/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("grading_templates",n);return r}),define("grading/views/gradingView",["require","beyazpano","order!jquery.validate","order!jquery.validate.messages_locale","order!jquery.jqgrid.locale","gradepopup/views/gradepopup","jquery.jqgrid.site","grading/_templates"],function(e,t,n,r,i,s){var o=Backbone.View.extend({totalWeight:0,totalGradings:0,totalGradingsWithWeight:0,templateNames:{tableheader:"site_grid_header",tablestudentheader:"site_student_grid_header"},initialize:function(e){this.config={ajaxUrlGradingHtml:BAppConfig.get("grading","ajaxUrlGradingHtml"),ajaxUrlGradingJson:BAppConfig.get("grading","ajaxUrlGradingJson"),ajaxUrlInstructorGradingJson:BAppConfig.get("grading","getGradingUrl"),ajaxUrlStudentGradingJson:BAppConfig.get("grading","getStudentGradingUrl")}},render:function(){var e=BAppConfig.get("mydata","role"),n=BAppConfig.get("mydata","id"),r=BAppConfig.get("global","currentLang"),i,o=new Array("",translate("student_name")),u,a="ltr";e==="INSTRUCTOR"&&isAdmin===!0?u=200:u=217,r==="ar"&&(a="rtl");var f=new Array({name:"studentid",index:"studentid",frozen:!0,hidden:!0},{name:"student",index:"student",frozen:!0,sortable:!1,resizable:!1,width:u});this.totalGradings=header_data.length;for(var l=0;l<this.totalGradings;l++){header_data[l].weight&&header_data[l]["equal"]=="0"&&(this.totalWeight+=parseInt(header_data[l].weight),this.totalGradingsWithWeight++);var c=header_data[l];header_data[l]["type"]=="assignment"&&(c.link=BAppConfig.get("site_assignment","assignment_info").replace("__ASSIGNMENT_ID__",header_data[l].additional_id)),header_data[l]["type"]=="quiz"&&(c.link=BAppConfig.get("site_quiz","quizInfo").replace("__QUIZ_ID__",header_data[l].additional_id).replace("__TAB__","")),e==="INSTRUCTOR"&&isAdmin===!0?i=t.renderTemplate(this.templateNames.tableheader,c):i=t.renderTemplate(this.templateNames.tablestudentheader,c),o.push($.trim(i)),f.push({name:"grading_"+header_data[l].id,index:"grading_"+header_data[l].id,sortable:!1,resizable:!1,width:180})}var h={name:translate("final_grade"),type:"final",max_points:"100",weight:final_weight};e==="INSTRUCTOR"&&isAdmin===!0?i=t.renderTemplate(this.templateNames.tableheader,h):i=t.renderTemplate(this.templateNames.tablestudentheader,h),o.push($.trim(i)),f.push({name:"final",index:"final",sortable:!1,resizable:!1,width:180});var p=new s({type:"gradebook"});if(e==="INSTRUCTOR"&&isAdmin===!0){var d=this.styleGradebook;$("#instructorGradingTable").jqGrid({url:this.config.ajaxUrlInstructorGradingJson,datatype:"json",mtype:"POST",postData:{section:$("#idsection").val()},colNames:o,colModel:f,hidegrid:!1,gridview:!0,altRows:!0,altclass:"altClass",autowidth:!0,viewrecords:!0,shrinkToFit:!1,loadonce:!1,loadtext:translate("update_grid"),loadui:"block",height:"65",direction:a,rowNum:"500",footerrow:!0,userDataOnFooter:!0,jsonReader:{root:"grades",repeatitems:!1,id:"studentid",userdata:"footerData"},loadComplete:function(e){e.success===!1&&document.location.reload(!0);var t=jQuery("#instructorGradingTable").jqGrid("getGridParam","records");d(header_data.length,t),$("#gview_instructorGradingTable a.editlink").on("click",function(){Utils.block(".middleBar");var e=$(this).parent().attr("aria-describedby").replace("instructorGradingTable_grading_",""),t=$(this).parent().parent().attr("id"),n=$("#idsection").val(),r={idgrading:e,idstudent:t,sectionId:n};p.renderPopup(r)}),$("#instructorGradingTable td, .ui-jqgrid-ftable td").removeAttr("title")},loadError:function(e,t,n){document.location.reload(!0)}});if(!$.browser.msie&&(!$.browser.mozilla||$.browser.mozilla&&$.browser.version>=17)||$.browser.msie&&$.browser.version>8)$("#instructorGradingTable").jqGrid("setFrozenColumns"),$(".frozen-div  #instructorGradingTable_student").height($(".ui-jqgrid-hbox #instructorGradingTable_student").height()),a==="rtl"&&$(".frozen-div  #instructorGradingTable_student").height($(".ui-jqgrid-hbox-rtl #instructorGradingTable_student").height());var v=navigator.userAgent.toLowerCase();a==="rtl"&&v.indexOf("safari")!==-1&&v.indexOf("chrome")!==-1&&$(".ui-jqgrid .ui-jqgrid-hbox-rtl").css({position:"relative","float":"none"}),$("#gview_instructorGradingTable a.gradingLink").on("click",function(){window.location.href=$(this).attr("href")}),this.initHandlers()}else{$("#studentGradingTable").jqGrid({url:this.config.ajaxUrlStudentGradingJson,datatype:"json",mtype:"POST",postData:{section:$("#idsection").val()},colNames:o,colModel:f,hidegrid:!1,gridview:!0,altRows:!0,altclass:"altClass",autowidth:!0,viewrecords:!0,shrinkToFit:!1,height:"65",loadtext:translate("update_grid"),loadui:"block",direction:a,jsonReader:{root:"grades",repeatitems:!1,id:"studentid"},loadComplete:function(e){e.success===!1&&document.location.reload(!0),$("#gview_studentGradingTable a.messagelink").on("click",function(e){e.preventDefault(),Utils.block(".middleBar");var t=$(this).parent().attr("aria-describedby").replace("studentGradingTable_grading_",""),n=$(this).parent().parent().attr("id"),r=$("#idsection").val(),i={idgrading:t,idstudent:n,sectionId:r};p.renderPopup(i)}),$("#studentGradingTable td").removeAttr("title")},loadError:function(e,t,n){document.location.reload(!0)}}),$("#studentGradingTable").jqGrid("setFrozenColumns"),$("#gview_studentGradingTable a.gradingLink").on("click",function(){window.location.href=$(this).attr("href")}),$(".frozen-div  #studentGradingTable_student").height($(".ui-jqgrid-hbox #studentGradingTable_student").height()),a==="rtl"&&$(".frozen-div  #studentGradingTable_student").height($(".ui-jqgrid-hbox-rtl #studentGradingTable_student").height());var v=navigator.userAgent.toLowerCase();a==="rtl"&&v.indexOf("safari")!==-1&&v.indexOf("chrome")!==-1&&$(".ui-jqgrid .ui-jqgrid-hbox-rtl").css({position:"relative","float":"none"});switch(header_data.length){case 0:jQuery("#studentGradingTable").setGridWidth("407"),jQuery("#studentGradingTable").setGridHeight("48");break;case 1:jQuery("#studentGradingTable").setGridWidth("592"),jQuery("#studentGradingTable").setGridHeight("48");break;case 2:jQuery("#studentGradingTable").setGridHeight("48");break;default:}}},validateTestGrading:{rules:{"data[name]":{required:!0,minlength:2,maxlength:128},"data[max_points]":{number:!0,required:!0,max:100},"data[weight]":{number:!0}}},validateGrading:{rules:{"data[weight]":{number:!0}}},initHandlers:function(){$(".add-grading").on("click",_.bind(this.openPopupAddGradingClickHandler,this)),$(".edit-grading").on("click",_.bind(this.openPopupEditGradingClickHandler,this)),$(".delete-grading").live("click",_.bind(this.deleteGradingClickHandler,this)),$("#save-grading").live("click",_.bind(this.saveGradingClickHandler,this)),$("#save-edit-grading").live("click",_.bind(this.saveEditGradingClickHandler,this)),$("#gview_instructorGradingTable input[type=checkbox]").live("click",_.bind(this.publishGradingClickHandler,this))},styleGradebook:function(e,t){$(".gradingInfo").show();if(!$.browser.msie&&(!$.browser.mozilla||$.browser.mozilla&&$.browser.version>=17)||$.browser.msie&&$.browser.version>8){var n=$('.ui-jqgrid-sdiv td[aria-describedby="instructorGradingTable_student"]').html(),r='<div id="frozen-footer-div" class="frozen-div ui-state-default ui-jqgrid-hdiv">'+n+"</div>";$("#gview_instructorGradingTable").append(r)}switch(e){case 0:jQuery("#instructorGradingTable").setGridWidth("408");break;case 1:jQuery("#instructorGradingTable").setGridWidth("593");break;case 2:jQuery("#instructorGradingTable").setGridWidth("778");break;default:jQuery("#instructorGradingTable").setGridWidth("778"),$("#gview_instructorGradingTable .ui-jqgrid-sdiv").attr("style","width: 761px !important;")}var i;if(t<=15){i=23*(t+2)+20;var s=jQuery("#instructorGradingTable").jqGrid("getGridParam","width")-17;jQuery("#instructorGradingTable").setGridWidth(s)}else e<=2?i=388:i=411;e<=2&&t>15&&($("#instructorGradingTable").css("margin-bottom","-3px"),$("#gview_instructorGradingTable .ui-jqgrid-sdiv").css("margin-top","-41px")),jQuery("#instructorGradingTable").setGridHeight(i)},openPopupAddGradingClickHandler:function(e){Utils.block(".middleBar"),$.ajax({type:"POST",url:this.config.ajaxUrlGradingHtml+"/addgrading",data:"idsection="+$("#idsection").val(),success:$.proxy(function(e){$("#popup_section").html(e),$("#popup_section").modal("show"),$("#addGradingForm").validate(this.validateTestGrading);var t=100-this.totalWeight;$("#weight").rules("add",{max:t,messages:{max:$.format(translate("max_weight_validation"))}})},this),dataType:"html"}).always(function(){Utils.unblock(".middleBar")})},openPopupEditGradingClickHandler:function(e){var t=$(e.currentTarget).attr("id").replace("edit-grading-","");Utils.block(".middleBar"),$.ajax({type:"POST",url:this.config.ajaxUrlGradingHtml+"/editgrading",data:"idgrading="+t+"&readonly="+$("#readonly").val(),success:$.proxy(function(e){$("#popup_section").html(e),$("#popup_section").modal("show");var t=$("#popup_section #weight").val(),n;if(t)n=100-this.totalWeight+parseInt(t);else{n=100-this.totalWeight;var r=this.totalGradingsWithWeight+1;this.totalGradings===r&&($("#editGradingForm").validate(this.validateTestGrading),$("#weight").rules("add",{min:n,messages:{min:$.format(translate("last_grading_weight_validation"))}}))}$("#gradingtype").val()=="test"?($("#editGradingForm").validate(this.validateTestGrading),$("#weight").rules("add",{number:!0,max:n,messages:{max:$.format(translate("max_weight_validation"))}})):($("#editGradingForm").validate(this.validateGrading),$("#weight").rules("add",{max:n,messages:{max:$.format(translate("max_weight_validation"))}}))},this),dataType:"html"}).always(function(){Utils.unblock(".middleBar")})},deleteGradingClickHandler:function(e){$("#popup_section").modal("hide");var t=this.config.ajaxUrlGradingJson,n=$(e.currentTarget).attr("id").replace("delete-grading-","");Utils.confirm(translate("delete_grading_title"),translate("delete_grading_content"),function(e){e=="yes"&&$.ajax({type:"POST",url:t+"/deletegrading",data:{idgrading:n,idsection:$("#idsection").val()},success:$.proxy(function(e){e.success?document.location.reload(!0):Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"})})},saveGradingClickHandler:function(e){if($("#addGradingForm").valid()){Utils.block("#popup_section");var t=$("#addGradingForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlGradingJson+"/savegrading",data:t+"&idsection="+$("#idsection").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_section");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_grading")}else document.location.reload(!0)},this),dataType:"json"})}},saveEditGradingClickHandler:function(e){if($("#editGradingForm").valid()){Utils.block("#popup_section");var t=$("#editGradingForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlGradingJson+"/savegrading",data:t+"&idsection="+$("#idsection").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_section");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_edit_grading")}else document.location.reload(!0)},this),dataType:"json"})}},publishGradingClickHandler:function(e){var t;$(e.currentTarget).is(":checked")&&(t="publish");var n=$(e.currentTarget),r=$(e.currentTarget).val(),i=this.config.ajaxUrlGradingJson;Utils.confirm(translate("publish_grading_title"),translate("publish_grading_content"),function(e){e=="yes"?$.ajax({type:"POST",url:i+"/publishgrading",data:"idgrading="+r+"&action="+t+"&idsection="+$("#idsection").val(),success:$.proxy(function(e){e.success?(Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("grading_published"),"#flashmessages",2e3),$.browser.msie&&$.browser.version<9?$("#instructorGradingTable").trigger("reloadGrid"):n.parent().html(translate("published"))):(Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flashmessages"),n.prop("checked",!1))},this),dataType:"json"}):n.prop("checked",!1)}),$("#_dialog_confirm a.close").on("click",function(){n.is(":checked")&&n.prop("checked",!1)})}});return o}),define("grading/main",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","grading/views/gradingView","grading/_templates"],function(e,t,n,r,i,s){var o=function(){var e={popupgrading:"popup-grading"};this.run=function(){var s=BAppConfig.get("site_sections","config").left_menu;_.each(s.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",$("#idsection").val())},this));var o=new r({el:"#content_left",config:s,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"grading"});o.render(),n.render();var u=new i;u.render();var a=$(t.renderTemplate(e.popupgrading,{}));$("body").append(a)}};return o}),define("text!quiz/templates.html",[],function(){return'<script type="text/template" id="add_quiz">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3><%= translate(\'add_new_quiz_title\') %></h3>\n            </div>\n        </div>\n        <div class="modal-body">\n            <div class="modalContent">\n                <div id="alert_quiz"></div>\n                <form method="POST" name="addQuizForm" id="addQuizForm">\n                    <ul class="modalForm">\n                        <li class="clearfix">\n                            <label><%= translate(\'quiz_name\') %>:</label>\n                            <input type="text" class="required" name="data[name]" />\n                        </li>\n                        <li class="clearfix">\n                            <label><%= translate(\'quiz_ungraded\') %>:</label>\n                            <input type="checkbox" id="ungraded" name="data[ungraded]" />\n                            <a class="questionTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_ungraded_tooltip\') %>"> ?</a>\n                        </li>\n                        <li class="dateImputContainer clearfix">\n                            <label><%= translate(\'quiz_duedate\') %>:</label>\n                            <input type="text" class="required datepicker-grading-period afterNowDate" name="date" />\n                            <input type="text" class="required timepicker afterNowTime" name="time" />\n                            <a class="questionTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_duedate_tooltip\') %>"> ?</a>\n                        </li>   \n                        <li class="clearfix">\n                            <label><%= translate(\'enable_comments\') %>:</label>\n                            <input type="checkbox" name="data[comments]" checked="checked" />\n                        </li>\n                    </ul>\n                    <input name="attachments" type="hidden">\n                </form>\n                <div id="attachments" class="userMessageAttachment userPostAttachements clearfix"></div>\n                <div id="attachmentsContainer" class="userMessageLinkright"></div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <div class="modalFooterContainer modalFooterContainerUser">\n                <div class="modalButtons">\n                    <button class="btn userDefaultBtn save-quiz" id="save-quiz"><%= translate(\'global_save\') %></button>\n                    <button class="btn cancel" data-dismiss="modal"><%= translate(\'global_cancel\') %></button>\n                </div>\n            </div>\n        </div>\n</script>\n\n<script type="text/template" id="popup-quiz">\n    <div id="popup_section" class="modal fade hide" data-backdrop="static"></div>\n</script>\n\n<script type="text/template" id="add_question_container">\n    <div class="questionContainer">\n        <div class="quizMain">\n            <div id="alert_question"></div>\n            <form method="POST" name="addQuestionForm" id="addQuestionForm" class="addEditFormQuestion">\n                <ul class="modalForm questionForm">\n                    <li class="clearfix questionHeader">\n                        <label><%= translate(\'quiz_type\') %>:</label>\n                        <select name="data[quiz_type]" id="quizType">\n                            <option value="1"><%= translate(\'true_false\') %></option>\n                            <option value="2"><%= translate(\'multiple_choice\') %></option>\n                            <option value="3"><%= translate(\'essay_question\') %></option>\n                        </select>\n                        <label><%= translate(\'question_points\') %>:</label>\n                        <input type="text" class="required" name="data[max_points]" value="10" />\n                        <a href="#" class="btn delete-question"><%= translate(\'remove_question\') %></a>\n                    </li>\n                    <li class="clearfix questionPrompt">\n                        <label><%= translate(\'question_prompt\') %>:</label>\n                        <textarea name="data[question_text]"></textarea>\n                    </li>\n                    <li class="clearfix attach">\n                        <a class="attachTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_picture_attachment_tooltip\') %>"> ?</a>\n                        <div id="questionAttachments" class="userMessageAttachment userPostAttachements clearfix"></div>\n                        <div id="questionAttachmentsContainer" class="userMessageLinkright"></div>\n                    </li>\n                </ul>\n                 <input name="questionAttachments" type="hidden">\n                 <input type="hidden" name="data[quizId]" id="quizId" value="<%= quizId %>" />\n                 <input type="hidden" name="data[questionId]" id="questionId" />\n            </form>\n        </div>\n        <div class="quizSettings"></div>\n    </div>\n</script>\n\n<script type="text/template" id="edit_question_container">\n    <div class="questionContainer">\n        <div class="quizMain">\n            <div id="alert_edit_question"></div>\n            <form method="POST" name="editQuestionForm" id="editQuestionForm" class="addEditFormQuestion">\n                <ul class="modalForm questionForm">\n                    <li class="clearfix questionHeader">\n                        <label><%= translate(\'quiz_type\') %>:</label>\n                        <select name="data[quiz_type]" id="quizType">\n                            <option value="1"><%= translate(\'true_false\') %></option>\n                            <option value="2"><%= translate(\'multiple_choice\') %></option>\n                            <option value="3"><%= translate(\'essay_question\') %></option>\n                        </select>\n                        <label><%= translate(\'question_points\') %>:</label>\n                        <input type="text" class="required" name="data[max_points]" value="<%= max_points %>" />\n                        <a href="#" class="btn delete-question" id="delete-question-<%= id %>"><%= translate(\'remove_question\') %></a>\n                    </li>\n                    <li class="clearfix">\n                        <label><%= translate(\'question_prompt\') %>:</label>\n                        <textarea name="data[question_text]"><%= question_text %></textarea> \n                    </li>\n                    <li class="attachementsBox">\n                        <input name="questionAttachments" type="hidden">\n                        <input id="questionprevattachments" name="questionprevattachments" type="hidden" value=\'<%= attach %>\'/>\n                    </li>\n                    <li class="clearfix attach">\n                        <a class="attachTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_picture_attachment_tooltip\') %>"> ?</a>\n                        <div id="questionAttachments" class="userMessageAttachment userPostAttachements clearfix"></div>\n                        <div id="questionAttachmentsContainer" class="userMessageLinkright"></div>\n                    </li>\n                </ul>              \n                <input type="hidden" name="data[quizId]" id="quizId" value="<%= quiz_id %>" />\n                <input type="hidden" name="data[questionId]" id="questionId" value="<%= id %>" />\n                <input type="hidden" name="loadQuestion" id="loadQuestion" value="<%= load %>" />\n            </form>\n        </div>\n        <div class="quizSettings"></div>\n    </div>\n</script>\n\n<script type="text/template" id="true_false_question">  \n    <li class="clearfix" id="trueFalse">\n        <label><%= translate(\'correct_answer\') %>:</label>\n        <select name="data[correct_answer]">\n            <option value="1" selected="selected"><%= translate(\'true\') %></option>\n            <option value="2"><%= translate(\'false\') %></option>\n        </select>\n    </li>\n</script>\n\n<script type="text/template" id="essay_question">\n    <li class="clearfix" id="essayQ"></li>\n</script>\n\n<script type="text/template" id="multiple_choice_question">\n    <li class="clearfix" id="multipleChoice">\n        <label><%= translate(\'responses\') %>:</label>\n        <label class="right"><%= translate(\'correct_answer\') %>:</label>\n        <ul class="responses">\n            <li class="clearfix">\n                <div class="question_option left">\n                    <div class="clearfix">\n                        <span class="character">A</span>\n                        <textarea name="data[question_option][1]"></textarea>\n                        <a href="#" class="remove-answer redTxt"><%= translate(\'remove_answer\') %></a>\n                        <input name="responseAttachments[1]" type="hidden">\n                    </div>\n                    <a class="attachTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_picture_attachment_tooltip\') %>"> ?</a>\n                    <div id="responseAttachments-1" class="userMessageAttachment userPostAttachements clearfix">\n                    </div>\n                    <div id="responseAttachmentsContainer-1" class="userMessageLinkright"></div>\n                </div>\n                <div class="question_correct_answer right">\n                    <input type="radio" name="data[correct_answer]" value="1" checked="checked"/>\n                </div>\n            </li>\n            <li class="clearfix">\n                <div class="question_option left">\n                    <div class="clearfix">\n                        <span class="character">B</span>\n                        <textarea name="data[question_option][2]"></textarea>\n                        <a href="#" class="remove-answer redTxt"><%= translate(\'remove_answer\') %></a>\n                        <input name="responseAttachments[2]" type="hidden">\n                    </div>\n                    <a class="attachTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_picture_attachment_tooltip\') %>"> ?</a>\n                    <div id="responseAttachments-2" class="userMessageAttachment userPostAttachements clearfix"></div>\n                    <div id="responseAttachmentsContainer-2" class="userMessageLinkright"></div>\n                </div>\n                <div class="question_correct_answer right">\n                    <input type="radio" name="data[correct_answer]" value="2" />\n                </div>\n            </li>\n        </ul>\n    </li>\n    <li class="clearfix">\n        <a href="#" class="btn addResponse"><%= translate(\'add_response\') %></a>\n    </li>\n</script>\n\n<script type="text/template" id="edit_multiple_choice_question">\n    <li class="clearfix" id="multipleChoice">\n        <label><%= translate(\'responses\') %>:</label>\n        <label class="right"><%= translate(\'correct_answer\') %>:</label>\n        <ul class="responses">\n            <% for(var i=0; i< options.length; i++) {%>\n                <li class="clearfix">\n                    <div class="question_option left">\n                        <div class="clearfix">\n                            <span class="character"><%= options[i][\'questionCharacter\'] %></span>\n                            <textarea name="data[question_option][<%= i+1 %>]"><%= options[i][\'options\'] %></textarea>\n                            <a href="#" class="remove-answer redTxt"><%= translate(\'remove_answer\') %></a>\n                            <input name="responseAttachments[<%= i+1 %>]" type="hidden">\n                            <% var optionAttach = options[i][\'attach\'] %>\n                            <input id="responseprevattachments-<%= i+1 %>" name="questionprevattachments-<%= i+1 %>" type="hidden" value=\'<%= optionAttach %>\'/>\n                        </div>\n                        <a class="attachTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_picture_attachment_tooltip\') %>"> ?</a>\n                        <div id="responseAttachments-<%= i+1 %>" class="userMessageAttachment userPostAttachements clearfix"></div>\n                        <div id="responseAttachmentsContainer-<%= i+1 %>" class="userMessageLinkright"></div>\n                    </div>\n                    <div class="question_correct_answer right">\n                    <% if(options[i][\'correct_answer\'] == 1) { %>\n                        <input type="radio" name="data[correct_answer]" value="<%= i+1 %>" checked="checked" />\n                    <% } else {%>\n                        <input type="radio" name="data[correct_answer]" value="<%= i+1 %>" />\n                    <% }%> \n                    </div>\n                </li>\n            <% } %>\n        </ul>\n    </li>\n    <li class="clearfix">\n        <a href="#" class="btn addResponse"><%= translate(\'add_response\') %></a>\n    </li>\n</script>\n\n<script type="text/template" id="add_question_buttons">\n    <div class="buttons">\n        <button class="btn userDefaultBtn save-question" id="save-question"><%= translate(\'create_question\') %></button>\n        <button class="btn cancel-question" id="cancel-<%= questionType %>"><%= translate(\'global_cancel\') %></button>\n    </div>\n</script>\n\n<script type="text/template" id="edit_question_buttons">\n    <div class="buttons">\n        <button class="btn userDefaultBtn edit-save-question" id="edit-save-question"><%= translate(\'save_question\') %></button>\n        <button class="btn cancel-question" id="cancel-<%= questionType %>"><%= translate(\'global_cancel\') %></button>\n    </div>\n</script>\n\n<script type="text/template" id="add_response">\n    <li class="clearfix">\n        <div class="question_option left">\n            <div class="clearfix">\n                <span class="character"><%= questionCharacter %></span>\n                <textarea name="data[question_option][<%= questionOrder %>]"></textarea>\n                <a href="#" class="remove-answer redTxt"><%= translate(\'remove_answer\') %></a>\n                <input name="responseAttachments[<%= questionOrder %>]" type="hidden">\n            </div>\n            <a class="attachTooltip" href="#" data-placement="top" data-original-title="<%= translate(\'quiz_picture_attachment_tooltip\') %>"> ?</a>\n            <div id="responseAttachments-<%= questionOrder %>" class="userMessageAttachment userPostAttachements clearfix"></div>\n            <div id="responseAttachmentsContainer-<%= questionOrder %>" class="userMessageLinkright"></div>\n        </div>\n        <div class="question_correct_answer right">\n        <input type="radio" name="data[correct_answer]" value="<%= questionOrder %>" />\n        </div>\n    </li>\n</script>\n\n<script type="text/template" id="popup_questions">\n    <div id="alert_loadPopup"></div>\n    <div id="search_container">\n        <a class="searchQuestionTopButton" href="#"></a>\n        <input type="text" id="search_question" placeholder="<%= translate(\'search_question\') %>" />\n    </div>\n    <div id="questions_list"></div>\n</script>\n\n<script type="text/template" id="instructor_question_list">\n    <div id="<%= id %>" class="questionsContainer">\n        <div id="<%= id %>_loading">\n            <im>\n        </div>\n        <% if(questions_list && questions_list.length > 0) { %>\n        <ul id="<%= id %>_list" class="questionsList"></ul> \n        <% } else { %>\n        <ul class="questionsList">\n            <li class="questionElem clearfix">\n                <span class="noResultMsg"><% print(translate(\'no_questions\')) %></span>\n            </li>\n        </ul>\n        <% } %>\n    </div>\n</script>  \n\n<script type="text/template" id="instructor_question_list_item">\n    <li class="questionElem clearfix" id="load-question-<%= itemId %>">\n        <span class="questionText clearfix">\n            <i class="quizSmallIcon"></i><a class="load-question" id="load-<%= itemId %>"><%= question_text %></a>\n        </span>\n        <span class="questionType"><%= question_type %></span>\n        <a href="#" class="load-question" id="load-<%= itemId %>"><% print(translate(\'load_this_question\')) %></a> |\n        <a href="#" class="delete-from-bank" id="delete-from-bank-<%= itemId %>"><% print(translate(\'global_delete\')) %></a>\n    </li>\n</script>\n\n<script type="text/template" id="instructor_question_list_view_more">\n    <div class="viewMorePosts" id="<%= id %>_view_more">\n        <button class="btn" id="<%= id %>_view_more_link">\n            <img id="<%= id %>_view_more_loading" src="<%- img %>" class="hide"/>&nbsp;\n            <% print(translate(\'questions_load_more\')) %>\n        </button>\n    </div>\n</script>\n\n<script type="text/template" id="popup_courses">\n    <div id="courses_list"></div>\n</script>\n\n<script type="text/template" id="popup_courses_footer">\n    <button class="btn userDefaultBtn copy-to-courses" id="copy-quiz-<%= quizId %>"><%= translate(\'global_copy\') %></button>\n    <button class="btn cancel" data-dismiss="modal"><%= translate(\'global_cancel\') %></button>\n</script>\n\n<script type="text/template" id="courses_container">\n    <div id="alert_copy_question"></div>\n    <form method="POST" name="copyQuizForm" id="copyQuizForm" class="copyQuizForm">\n        <%  if(!_.isEmpty(data)){  %>\n        <ul class="coursesList">\n            <% _.each(data,function(item){%>\n            <li class="courseElem clearfix">\n                <input type="checkbox" name="sectionsAdded[]" value="<%= item.section_id %>" id="section-<%= item.section_id %>"/>\n                <label class="sectionName" for="section-<%= item.section_id %>">\n                <i class="quizSmallIcon"></i>\n                <span><%= item.courseName %>:</span><%= item.sectionName %>\n                </label>\n            </li>\n            <li class="clearfix hide dateElem dateImputContainer" id="date-<%= item.section_id %>">\n                <label><%= translate(\'quiz_duedate\') %>:</label>\n                <div class="dateContainer">\n                    <input type="text" class="required datepicker-grading-period afterNowDate" name="sectionDates[<%=item.section_id %>][date]" value="<% if(!_.isNull(defaultdate)) print(defaultdate); %>"/>\n                </div>\n                <input type="text" class="required timepicker afterNowTime" name="sectionDates[<%=item.section_id %>][time]" value="<% if(!_.isNull(defaulttime)) print(defaulttime); %>" />\n            </li>\n            <% }) %>\n        </ul>\n        <% } %>\n    </form>\n</script>\n\n<script type="text/template" id="quiz_questions_page">\n    <div id="questionsWrapper">\n    <% if(!_.isEmpty(data)){ %>\n    <% var j = 1;%>\n    <ul class="quizLegend clearfix">\n        <li><%= translate(\'general_note\') %></li>\n        <li class="notViewed"> \n            <div></div>\n            <%= translate(\'quiz_not_viewed_question\') %>\n        </li>\n        <li class="answered">\n            <div></div>\n            <%= translate(\'quiz_answered_question\') %>\n        </li>\n        <li class="viewed">\n            <div></div>\n            <%= translate(\'quiz_viewed_question\') %>\n        </li>\n    </ul>\n    <div id="leftTime" class="hide clearfix">\n        <p><%= translate(\'left_time\') %></p>\n        <div id="timer"></div>\n    </div>\n    <ul class="question_menu clearfix">\n        <% _.each(data,function(item){%>\n        <li id="question-nav-<%= j%>" \n            <% if(!_.isUndefined(item.answer)) { questionsViewed.push(j); %>\n            <% if(item.answer) { %>\n                class="answeredQuestion"\n            <% } else { %>\n                class="viewedQuestion"\n            <% } }%>>\n            <a href="#" class="question_nav"><%= (j++) %></a>\n        </li>\n        <% if(isAdmin==0 && !_.isUndefined(item.answer)) {\n            var key = \'qS\'+quizStudentResultId+\'q\'+item.id;\n            var storedResult = sessionStorage.get(key);\n           \n            if(_.isUndefined(storedResult)) {\n                sessionStorage.set(key, item.answer);\n            }\n\n        } %>\n        <% }) %>\n    </ul>\n    <% } %>\n    <div class="questionsPagesWrapper">    \n        <% if(!_.isEmpty(data)){ %>\n        <% var i = 1;%>\n        <ul class="questions_pages" id="questions-<%= _.size(data)%>">\n            <% _.each(data,function(item){%>\n            <li class="question" id="question-<%= i%>">\n                <form name="saveQuestion" id="saveQuestion-<%= item.id%>">\n                    <ul class="question_data">\n                        <li class="question_header">\n                            <%= translate(\'question\') +\' \'+ i%>\n                            <span class="points">(<%= item.max_points +\' \'+ translate(\'points\')%>)</span>\n                            <button id="return-<%= i%>" class="btn return"><%= translate(\'return_to_question\') +\' \'+ i%></button>\n                        </li>\n                        <li>\n                            <p><%= item.question_text %></p>\n                        </li>\n                        <% if(!_.isEmpty(item.attach)) {%>\n                        <li class="viewAttachment">\n                            <div id="quiz_question_attachments_container_<%= item.id %>"></div>\n                        </li>\n                        <% } %>\n                        <li class="answers">\n                             <%  if(item.type == \'true_false\') {  %>\n                                <span><input type="radio" name="data[answer]" value="1" <% if(item.answer && item.answer == 1) { %>  checked="checked" <% } %> /> <%= translate(\'true\')%></span><br>\n                                <span><input type="radio" name="data[answer]" value="2" <% if(item.answer && item.answer == 2) { %>  checked="checked" <% } %> /> <%= translate(\'false\')%></span>\n                             <% } else if(item.type == \'multiple_choice\') {%>\n                                <% if(!_.isEmpty(item.options)){ %>\n                                    <% _.each(item.options,function(option){ %>\n                                    <span class="clearfix"><input class="multipleOption" type="radio" name="data[answer]" value="<%= option.id %>" <% if(item.answer && item.answer == option.id) { %>  checked="checked" <% } %> />\n                                        <span class="optionText"><%= option.options %></span></span>\n                                    <% if(!_.isEmpty(option.attach)) { %>\n                                    <ul>\n                                    <li class="viewAttachment">\n                                         <div id="quiz_question_options_attachments_container_<%= option.id %>"></div>\n                                    </li>\n                                    </ul>\n                                    <% } %>\n                                    <% }) %>\n                                <% } %>\n                             <% } else { %>\n                             <textarea placeholder="<%= translate(\'write_short_answer\')%>" name="data[short_answer]"><% if(item.answer) { %> <%= $.trim(item.answer) %><% } %></textarea>\n                             <% } %>\n                        </li>\n                    </ul>\n                </form>\n            </li>\n            <% i++; }) %>\n        </ul>\n        <% } else {%>\n        <div class="alert alert-error"><%= translate(\'no_questions\') %></div>\n        <% } %>\n        <div class="viewAllQuestions_warning alert alert-error">\n            <%= translate(\'view_all_questions_warning\') %>\n        </div>\n    </div>\n    </div>\n</script>\n\n<script type="text/template" id="preview_buttons">\n    <div class="preview-question">\n        <p><%= translate(\'preview_text\') %></p>\n        <button class="btn userDefaultBtn back"><%= translate(\'prev_question\') %></button>\n        <button class="btn userDefaultBtn next"><%= translate(\'next_question\') %></button>\n        <button class="btn userDefaultBtn review"><%= translate(\'review_answers\') %></button>\n        <button class="btn userDefaultBtn submit" disabled="disabled"><%= translate(\'submit_answers\') %></button>\n        <button class="btn userDefaultBtn closePreview"><%= translate(\'close_preview\') %></button>\n    </div>\n</script>\n\n<script type="text/template" id="student_quiz_buttons">\n    <div class="buttons">\n        <button class="btn userDefaultBtn back" id="btn-back-<%= studentResultId %>"><%= translate(\'prev_question\') %></button>\n        <button class="btn userDefaultBtn next" id="btn-next-<%= studentResultId %>"><%= translate(\'next_question\') %></button>\n        <button class="btn userDefaultBtn review" id="btn-review-<%= studentResultId %>"><%= translate(\'review_answers\') %></button>\n        <button class="btn userDefaultBtn submit" id="btn-submit-<%= studentResultId %>"><%= translate(\'submit_answers\') %></button>\n    </div>\n</script>\n<script type="text/template" id="no_questions">\n    <div class="buttons">\n        <button class="btn userDefaultBtn closePreview"><%= translate(\'close\') %></button>\n    </div>\n</script>\n<script type="text/template" id="quiz_comments">\n    <div id="quizCommentContainer" class="clearfix"></div>\n</script>    \n\n<script type="text/template" id="student_assessment">\n    <div class="studentAssessment">\n        <div class="clearfix"><%= student %></div>\n        <form method="POST" name="saveAssessmentChangesForm" id="saveAssessmentChangesForm">\n            <ul class="submissionResult">\n            <% if(!_.isEmpty(data)){ %>\n            <% var i = 1;%>\n                <% _.each(data,function(item){%>\n                <li class="clearfix">\n                    <div class="score">\n                        <% if(item.answer) {%>\n                        <%  if(item.type == \'essay\') {  %>\n                        <input type="text" name="data[<%= item.answer.answerId%>][points]" class="studScore" \n                                value="<% if(item.answer.points) {%><%=item.answer.points%><% } %>" <% if(readOnly == 1) { %> disabled="disabled" <% } %>/>\n                        <% } else { %>\n                        <span class="studScore"><%= item.answer.points %></span>\n                        <% } %>\n                        <% } %>\n                        &#47;\n                        <span id="itemMax-<%= item.max_points %>"> <%= item.max_points %></span>\n                    </div>\n                    <div class="question">\n                        <label><%= translate(\'question\') +\' \'+ i%></label>\n                        <span class="questionText"><%= item.question_text %></span>\n                        <%  if(item.type == \'true_false\') {  %>\n                        <span class="answerContainer"><span class="answer <%if(item.options[0].correct_answer == 1) {%>question_answer<% }; if(item.answer && item.answer.response==1 && item.options[0].correct_answer == 1) {%> correct_answer<% } else if(item.answer && item.answer.response==1) { %> wrong_answer<%}%>"><%= translate(\'true\')%></span></span>\n                        <span class="answerContainer"><span class="answer <%if(item.options[0].correct_answer == 2) {%>question_answer<% }; if(item.answer && item.answer.response==2 && item.options[0].correct_answer == 2) {%> correct_answer<% } else if(item.answer && item.answer.response==2) { %> wrong_answer<%}%>"><%= translate(\'false\')%></span></span>\n                        <% } else if(item.type == \'multiple_choice\') {%>\n                            <% if(!_.isEmpty(item.options)){ %>\n                                <% _.each(item.options,function(option){ %>\n                                <span class="answerContainer"><span class="answer <%if(option.correct_answer == 1) {%>question_answer<% }; if(item.answer && item.answer.response==option.id && option.correct_answer == 1) {%> correct_answer<% } else if(item.answer && item.answer.response==option.id) { %> wrong_answer<%}%>">\n                                    <%= option.options%>\n                                </span></span>\n                                <% }) %>\n                            <% } %>\n                         <% } else { %>\n                         <span class="answerContainer">\n                             <span class="answer">\n                            <%if(item.answer && item.answer.response) { %>\n                            <%= item.answer.response %>\n                            <% } %>\n                            </span>\n                         </span>\n                         <% } %>\n                        <% if(item.answer && item.answer.comment) {%>\n                        <div class="comment displayComment" id="questionComment-<%= item.answer.answerId%>">\n                            <% if(readOnly == 0) {%>\n                            <a href="#" class="addQuestionComment hide" id="addComment-<%= item.answer.answerId%>"><%= translate(\'add_comment\') %></a>\n                            <a href="#" class="removeQuestionComment" id="removeComment-<%= item.answer.answerId%>"><%= translate(\'remove_comment\') %></a>\n                            <textarea name="data[<%= item.answer.answerId%>][comment]"><%= item.answer.comment %></textarea>\n                            <% } else { %>\n                            <%= item.answer.comment %>\n                            <% } %> \n                        <% } else if(item.answer && readOnly == 0) { %>\n                        <div class="comment" id="questionComment-<%= item.answer.answerId%>">\n                            <a href="#" class="addQuestionComment" id="addComment-<%= item.answer.answerId%>"><%= translate(\'add_comment\') %></a>\n                            <a href="#" class="removeQuestionComment hide" id="removeComment-<%= item.answer.answerId%>"><%= translate(\'remove_comment\') %></a>\n                            <textarea name="data[<%= item.answer.answerId%>][comment]" class="hide"></textarea>   \n                        </div>\n                        <% } %>\n                    </div>\n                </li>\n                <% i++; }) %>\n            <% } %>\n            </ul>\n        </form>\n        <div class="buttons">\n            <% if(readOnly == 0) { %>\n            <button class="btn userDefaultBtn save_assessment_changes" id="save-assessment-<%=quizStudResult%>"><%= translate(\'save_changes\') %></button>\n            <% } %>\n            <button class="btn userDefaultBtn return_to_class"><%= translate(\'return_to_class_results\') %></button>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="student_result">\n    <% if(!_.isNull(data) && data.result) { %>\n    <span class="studResult editScore" id="edit-score-<%= data.id %>"><%= data.result %></span> &#47;\n    <span><%= maxPoints %></span>\n    <% } else if(_.isNull(data)) { %>\n        <span class="studResult">*</span> &#47;\n        <span><%= maxPoints %></span>\n    <% } else { %>\n    <span class="studResult editScore" id="edit-score-<%= data.id %>">*</span> &#47;\n    <span><%= maxPoints %></span>\n    <br>\n    <span class="pendingReview"><%= translate(\'pending_review\') %></span>\n    <% } %>\n</script>\n\n<script type="text/template" id="override_result">\n    <span class="studOverride editScore" id="edit-score-<%= data.id %>"><%= data.override %></span>/\n    <span><%= maxPoints %></span>\n    <br>\n    <a id="clear-override-<%= data.id %>" class="clearOverride" href="#"><%= translate(\'clear_override\') %></a>\n</script>\n\n<script type="text/template" id="edit_score">\n    <div class="overrideScore" id="override-<%= quizStudResultId %>">\n        <form id="overrideForm">\n            <input type="text" id="new-score-<%= quizStudResultId %>" name="data[new-score]"/>\n        </form>\n        <button class="btn saveOverride" id="save-override-<%= quizStudResultId %>"><%= translate(\'save\') %></button>\n        <button class="btn userDefaultBtn cancelOverride"><%= translate(\'global_cancel\') %></button>\n    </div>\n</script>\n\n<script type="text/template" id="question_stats">\n    <div class="questionResults">\n        <div class="version">\n            <a class="viewByStudent" href="#"><%= translate(\'view_by_student\') %></a>\n            <span class="separator">|</span>\n            <a class="viewByQuestion active" href="#"><%= translate(\'view_by_question\') %></a>\n        </div>\n        <% if(!_.isEmpty(data)){ %>\n        <% var i=1; %>\n        <ul class="questionStats">\n        <% _.each(data,function(item){%>\n            <li class="clearfix">\n                <h5><%= translate(\'question\') +\' \'+ i++%>: </h5> \n                <p class="questionText breakWord"><%= item.question_text %></p>\n                <span class="questionType">\n                    <span class="type">\n                    <%  if(item.type == \'true_false\') {  %>\n                    <%= translate(\'true_false\') %>\n                    <% } else if(item.type == \'multiple_choice\') {%>\n                    <%= translate(\'multiple_choice\') %>\n                    <% } else { %>\n                    <%= translate(\'essay_question\') %>\n                    <% } %>\n                    -\n                    </span>\n                    <%= item.max_points %> <%= translate(\'points\') %>\n                </span>\n                <p class="stats">\n                    <%= translate(\'points_earned\') %> : <br> \n                    <strong><%= translate(\'most\') %>: </strong> <span><%= item.max_score %> -</span> \n                    <strong><%= translate(\'least\') %>: </strong> <span><%= item.min_score %> - </span> \n                    <strong><%= translate(\'average\') %>: </strong> <span><%= item.avg_score %>  </span>          \n                </p>\n            </li>\n        <% }) %>\n        </ul>\n        <% } %>\n    </div>\n</script>'}),define("quiz/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("quiz_templates",n);return r}),define("quiz/views/questionBankList",["require","beyazpano","quiz/_templates"],function(e,t){var n=Backbone.View.extend({templateNames:{main:"instructor_question_list",list_item:"instructor_question_list_item",view_more:"instructor_question_list_view_more"},initialize:function(e){this.initHandlers(),this.config={},this.collection=null,e.config&&(this.config=_.extend(this.config,e.config)),this.onCollectionReset=_.bind(this.onCollectionReset,this),e.collection&&(this.collection=e.collection,this.collection.off("reset"),this.collection.on("reset",this.onCollectionReset),this.collection.on("questionsAdded",_.bind(function(e){this.renderQuestions(e)},this))),e.el&&(this.el=e.el),this.elId=_.uniqueId("questions_list_")},onCollectionReset:function(){this.render()},render:function(){var e=this.collection.toJSON(),n={questions_list:e,id:this.elId},r=$(t.renderTemplate(this.templateNames.main,n));$(this.el).html(r),this.renderQuestions(e)},renderQuestions:function(e){e.length>0&&_.each(e,_.bind(function(e){this.renderQuestionItem(e,"#"+this.elId+"_list")},this)),this.renderViewMoreQuestionsButton()},renderQuestionItem:function(e,n){var r={id:this.elId,itemId:e.id,question_text:e.question_text,question_type:e.type},i=$(t.renderTemplate(this.templateNames.list_item,r));i.hide(),$(n).append(i),i.fadeIn("slow")},initHandlers:function(){},renderViewMoreQuestionsButton:function(){$("#"+this.elId+"_view_more").remove();var e=this.collection.getPaginationData();if(e.page>0&&e.pages>e.page){var n=t.renderTemplate(this.templateNames.view_more,{id:this.elId,img:BAppConfig.get("global","ajaxLoadingImg")});$(this.el).append(n),$("#"+this.elId+"_view_more_link").on("click",_.bind(function(){$("#"+this.elId+"_view_more_loading").removeClass("hide"),$("#"+this.elId+"_view_more_link").attr("disabled","disabled"),this.trigger("viewMoreQuestions")},this))}}});return n}),define("quiz/model/questionBank",["beyazpano"],function(e){var t=Backbone.Model.extend({initialize:function(){}});return t}),define("quiz/collection/questionBank",["quiz/model/questionBank"],function(e){var t=Backbone.Collection.extend({initialize:function(){this.details={page:0,pages:0,limit:10,total:0,search:""}},model:e,parse:function(e){return this.details.page=e.data.page,this.details.pages=e.data.pages,this.details.limit=e.data.limit,this.details.total=e.data.total,this.details.search=e.data.search,e.data.questions},getPaginationData:function(){return this.details},loadMoreQuestions:function(e){var t=_.clone(this.details);t.page=t.page+1,this.fetch({data:t,add:!e,success:_.bind(function(t,n){e||t.trigger("questionsAdded",n.data.questions,t)},this)})}});return t}),define("webstorage",["require","beyazpano","default/_templates","order!jquery.json","order!amplify.store"],function(e,t){var n=Backbone.View.extend({initialize:function(e){e&&e.storageType&&(this.storageType=e.storageType)},set:function(e,t,n){!_.isUndefined(this.storageType)&&amplify.store.types[this.storageType]?amplify.store[this.storageType](e,t,n):amplify.store(e,t,n)},get:function(e){return!_.isUndefined(this.storageType)&&amplify.store.types[this.storageType]?amplify.store[this.storageType](e):amplify.store(e)},clear:function(e){amplify.store(e,null)}});return n}),function(e){var t={init:function(n){return this.each(function(){var r=this,i=e(r);r.opt=e.extend({},e.fn.chrony.defaults,n);if(i.data("chrony"))return;i.data("chrony",!0);var s=r.opt,o='<span style="float: left;">:</span>';if(s.text){var u=s.text.split(":");u.length!=3&&e.error("The format must be the following HH:mm:ss!"),s.second=u[2],s.minute=u[1],s.hour=u[0]}else s.hours?s.hours>=24?(s.hour=23,s.minute=59,s.second=59):(s.second=0,s.minute=0,s.hour=s.hours):s.minutes?(s.second=0,s.minute=s.minutes%60,s.hour=(s.minutes-s.minute)/60):s.seconds&&(s.second=s.seconds%60,s.minute=(s.seconds-s.second)/60%60,s.hour=(s.seconds-s.second-s.minute*60)/60/60);var a=t.checkTime(s.hour,s.minute,s.second);a&&(i.html('<div style="color: #F00; font-size: 9px;">Number out of range!</div>'),e.error(a));var f=t.getNumber(s.hour),l=t.getNumber(s.minute),c=t.getNumber(s.second),h=e("<div />",{id:"hour",html:f,style:"float: left;"}),p=e("<div />",{id:"minute",html:l,style:"float: left;"}),d=e("<div />",{id:"second",html:c,style:"float: left;"}),v=0;s.displayHours&&(i.append(h),(s.displayMinutes||s.displaySeconds)&&i.append(o)),s.displayMinutes&&(i.append(p),s.displaySeconds&&i.append(o)),s.displaySeconds&&i.append(d);var m=i.children("span");s.alert&&(s.alert.color||(s.alert.color="#F00"),s.alert.hour||(s.alert.hour=0),s.alert.minute||(s.alert.minute=0),s.alert.second||(s.alert.second=0)),t.checkAlert.call(r,f,l,c),v=setInterval(function(){r.opt.blink&&m.fadeOut(r.opt.blinkTime,function(){e(this).fadeIn(r.opt.blinkTime)}),c==0?l==0?f>0&&(f=t.getNumber(f-r.opt.decrement),l=59,c=59,h.html(f),p.html(l),d.html(c)):(l=t.getNumber(l-r.opt.decrement),c=59,p.html(l),d.html(c)):(c=t.getNumber(c-r.opt.decrement),d.html(c)),r.opt.finish&&c==0&&l==0&&f==0&&(r.opt.finish.call(r),clearInterval(v)),t.checkAlert.call(r,f,l,c)},1e3)})},checkAlert:function(t,n,r){var i=e(this),s=this.opt.alert;s&&i.css("color")!=""&&t<=s.hour&&n<=s.minute&&r<=s.second&&i.css("color",s.color)},checkTime:function(e,t,n){if(e<0||e>24)return"The hour must be >= 0 or <= 24";if(t<0||t>59)return"The minute must be >= 0 or <= 59";if(n<0||n>59)return"The second must be >= 0 or <= 59"},getNumber:function(e){return e<10?"0"+(e<0?"0":e):e},set:function(t){return this.each(function(){this.opt=e.extend({},e.fn.chrony.defaults,e(this).data("options"),t)})}};e.fn.chrony=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist!")},e.fn.chrony.defaults={alert:{color:"#F00",hour:0,minute:0,second:10},blink:!1,blinkTime:130,finish:undefined,decrement:1,displayHours:!0,displayMinutes:!0,displaySeconds:!0,hour:0,hours:undefined,minute:0,minutes:undefined,second:0,seconds:undefined,text:undefined}}(jQuery),define("jquery.chrony",function(){}),define("quiz/views/quiz",["require","beyazpano","order!jquery.validate","order!jquery.validate.messages_locale","quiz/_templates","attachment/views/component","quiz/views/questionBankList","quiz/collection/questionBank","comment/views/comment","attachment/views/list","webstorage","order!jquery.ui.locale","order!jquery.timepicker","jquery.json","order!jquery.chrony","order!bootstrap.tooltip"],function(e,t,n,r,i,s,o,u,a,f,l){var c=[],h=!1,p=Backbone.View.extend({templateNames:{addQuiz:"add_quiz",addOuestion:"add_question_container",editOuestion:"edit_question_container",addTrueFalseExtra:"true_false_question",addEssayExtra:"essay_question",addMultipleChoiceExtra:"multiple_choice_question",editMultipleChoiceExtra:"edit_multiple_choice_question",addResponse:"add_response",addButtons:"add_question_buttons",editButtons:"edit_question_buttons",popupQuestions:"popup_questions",popupCourses:"popup_courses",popupCoursesFooter:"popup_courses_footer",loadCoursesPopup:"courses_container",previewButtons:"preview_buttons",buttons:"student_quiz_buttons",quizQuestions:"quiz_questions_page",quizComments:"quiz_comments",noQuestions:"no_questions",studentAssessment:"student_assessment",studScore:"student_result",overrideScore:"override_result",scoreForm:"edit_score",questionStats:"question_stats"},initialize:function(e){this.config={ajaxUrlQuizHtml:BAppConfig.get("site_quiz","ajaxUrlQuizHtml"),ajaxUrlPrintQuizHtml:BAppConfig.get("site_quiz","ajaxUrlPrintQuizHtml"),ajaxUrlQuizJson:BAppConfig.get("site_quiz","ajaxUrlQuizJson"),quizInfo:BAppConfig.get("site_quiz","quizInfo"),urlQuizComment:BAppConfig.get("comment","getCommentsUrl")},this.questionCharacter="B",this.questionOrder=2,this.questionsViewed=new Array,this.sessionStorage,this.questionBankCollection=new u,this.isRTL=!1,this.lang=BAppConfig.get("global","currentLang"),this.lang==="ar"&&(this.isRTL=!0)},render:function(){if(typeof attachments!="undefined"&&!_.isEmpty(attachments)){var e=new f({el:"#quiz_attachments_container",config:{},attachments:attachments,postid:$("#idquiz").val()});e.render()}this.initHandlers(),this.initializeSettingsForm(".quizSettings"),this.questionBankCollection.url=this.config.ajaxUrlQuizJson,this.questionsList=new o({el:"#questions_list",collection:this.questionBankCollection}),this.questionsList.on("viewMoreQuestions",_.bind(function(){this.questionBankCollection.loadMoreQuestions(!1)},this)),$("#isCommentsEnabled").val()==1&&this.showCommentsClickHandler(),$(".editScore").tooltip({trigger:"hover",title:translate("click_to_edit_grade")})},validateQuiz:{rules:{"data[name]":{required:!0,minlength:2,maxlength:128},date:{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0},time:{required:!0,afterNow:!0},"data[max_points]":{required:!0,number:!0}},onfocusout:function(e){$(e).valid()}},validateQuizSettings:{rules:{date:{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0},time:{required:!0,afterNow:!0}},onfocusout:function(e){$(e).valid()}},validateQuestion:{ignore:".ignoreValidation, :hidden",rules:{"data[question_text]":{required:!0,minlength:2},"data[max_points]":{required:!0,digits:!0}}},validateMultiChoiceQuestion:{ignore:".ignoreValidation, :hidden",rules:{"data[question_text]":{required:!0,minlength:2},"data[max_points]":{required:!0,digits:!0},"data[correct_answer]":{required:!0},"data[question_option][1]":{required:!0,minlength:1},"data[question_option][2]":{required:!0,minlength:1}}},initialiseForm:function(e){var t=$(".datepicker-grading-period",e);t.datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:c+5",onSelect:function(){t.trigger("focusout")},dateFormat:"dd-mm-yy",isRTL:this.isRTL,minDate:new Date}),$(".timepicker").timeEntry({spinnerImage:"",show24Hours:!0,beforeShow:this.customDuedateTime}),$("#ungraded").click(function(){$("#ungraded").is(":checked")?$("#warning").show():$("#warning").hide()})},initializeSettingsForm:function(e){$("#quizSettingsForm").validate(this.validateQuizSettings);var t=$('#quizSettingsForm input[name="date"]'),n=$('#quizSettingsForm input[name="time"]');$("#availability").val()==="3"&&($.data(n[0],"dueDateSelect",t),$.data(t[0],"dueTimeSelect",n),$.data(n[0],"DueGlobal",{originalDueDateVal:t.val(),originalDueTimeVal:n.val()}),$.data(t[0],"DueGlobal",{originalDueDateVal:t.val(),originalDueTimeVal:n.val()}));var r=$(".datepicker-grading-period",e);r.datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:c+5",dateFormat:"dd-mm-yy",isRTL:this.isRTL,minDate:new Date,onSelect:function(){r.trigger("focusout")},maxDate:typeof dueDate!="undefined"?dueDate:null}),$(".timepicker").timeEntry({spinnerImage:"",show24Hours:!0,beforeShow:this.customFromTime}),$("#availability").on("change",function(){$(this).val()==="3"?($.data(n[0],"dueDateSelect",t),$(".dateImputContainer").show(),$(this).removeClass("quizHidden"),Utils.alert(translate("quiz_actions"),translate("date_time_functions_disabled"),function(){})):($(".dateImputContainer").hide(),$(this).val()==="2"?($(this).removeClass("quizHidden"),Utils.alert(translate("quiz_actions"),translate("available_now_functions_disabled"),function(){})):$(this).addClass("quizHidden"))}),$("#time_limit").val()==="2"&&$("#minutes").rules("add",{required:!0,number:!0,min:1,max:1440}),$("#time_limit").on("change",function(){$(this).val()==="2"?($(".timeLimit").show(),$("#minutes").rules("add",{required:!0,number:!0,min:1,max:1440})):($(".timeLimit").hide(),$("#minutes").removeAttr("value"),$("#minutes").rules("remove","required, number, min, max"))}),$("#show_results").click(function(){$(this).is(":checked")?$(".showCorrectAanswer").show():$(".showCorrectAanswer").hide()}),$("#grading_mechanism").change(function(){if($(this).val()!=="1"){var e="";_.isUndefined(gradingMechanismWarning.points)?"":e+=gradingMechanismWarning.points,_.isUndefined(gradingMechanismWarning.type)?"":e+=gradingMechanismWarning.type,_.isEmpty(e)||($('#grading_mechanism option[value="1"]').prop("selected",!0),Utils.alert(translate("quiz_grading_mechanism_warning_title"),e,function(){}))}})},customFromTime:function(){return{maxTime:$('#quizSettingsForm input[name="date"]').val()===dueDate?dueTime:null}},customDuedateTime:function(){return{minTime:$("#editQuizForm .datepicker-grading-period").val()===$("#dueDate").val()?$("#dueTime").val():null}},initHandlers:function(){$('input[name="date"]').live("focusout",function(){$('input[name="time"]').trigger("focusout")}),$(".add-quiz").on("click",_.bind(this.openPopupAddQuizClickHandler,this)),$(".edit-quiz").on("click",_.bind(this.openPopupEditQuizClickHandler,this)),$(".copy-quiz").on("click",_.bind(this.openPopupCopyQuizClickHandler,this)),$(".delete-quiz").on("click",_.bind(this.deleteQuizClickHandler,this)),$(".save-quiz").live("click",_.bind(this.saveQuizClickHandler,this)),$("#save-edit-quiz").live("click",_.bind(this.saveEditQuizClickHandler,this)),$(".copy-to-courses").live("click",_.bind(this.copyQuizClickHandler,this)),$(".save-quiz-settings").live("click",_.bind(this.saveQuizSettingsClickHandler,this)),$(".preview-quiz").on("click",_.bind(this.loadQuizQuestionsClickHandler,this)),$(".print-quiz").on("click",_.bind(this.printQuizClickHandler,this)),$(".begin-quiz").on("click",_.bind(this.loadQuizQuestionsClickHandler,this)),$(".view-assessment").on("click",_.bind(this.viewAssessmentClickHandler,this)),$(".return_to_class").live("click",_.bind(this.returnToClassResultsClickHandler,this)),$(".save_assessment_changes").live("click",_.bind(this.saveAssessmentChangesClickHandler,this)),$(".clearOverride").live("click",_.bind(this.clearOverrideClickHandler,this)),$(".editScore").live("click",_.bind(this.editScoreClickHandler,this)),$(".cancelOverride").live("click",_.bind(this.cancelOverrideClickHandler,this)),$(".saveOverride").live("click",_.bind(this.saveOverrideClickHandler,this)),$(".addQuestionComment").live("click",_.bind(this.addQuestionCommentClickHandler,this)),$(".removeQuestionComment").live("click",_.bind(this.removeQuestionCommentClickHandler,this)),$(".viewByStudent").live("click",_.bind(this.viewResultsByStudentClickHandler,this)),$(".viewByQuestion").live("click",_.bind(this.viewResultsByQuestionClickHandler,this)),$(".openLoadQuestion").on("click",_.bind(this.openPopupLoadQuestionClickHandler,this)),$(".true-false").on("click",_.bind(this.loadTrueFalseTemplateClickHandler,this)),$(".multiple").on("click",_.bind(this.loadMultipleChoiceTemplateClickHandler,this)),$(".essay").on("click",_.bind(this.loadEssayTemplateClickHandler,this)),$(".cancel-question").live("click",_.bind(this.cancelQuestionClickHandler,this)),$(".save-question").live("click",_.bind(this.saveQuestionClickHandler,this)),$(".edit-save-question").live("click",_.bind(this.editSaveQuestionClickHandler,this)),$(".addResponse").live("click",_.bind(this.addResponseClickHandler,this)),$("#addQuestionForm #quizType, #editQuestionForm #quizType").live("change",_.bind(this.changeTypeClickHandler,this)),$(".remove-answer").live("click",_.bind(this.removeAnswerClickHandler,this)),$(".delete-question").live("click",_.bind(this.removeQuestionFromQuizClickHandler,this)),$(".edit-question").live("click",_.bind(this.editQuestionClickHandler,this)),$(".delete-from-bank").live("click",_.bind(this.removeQuestionFromBankClickHandler,this)),$(".load-question").live("click",_.bind(this.loadQuestionClickHandler,this)),$("#search_question").live("keypress",_.bind(this.searchQuestionClickHandler,this)),$(".searchQuestionTopButton").live("click",_.bind(this.searchUpdateQuestionList,this)),$("#questionsWrapper .back").live("click",_.bind(this.prevQuestionClickHandler,this)),$("#questionsWrapper .next").live("click",_.bind(this.nextQuestionClickHandler,this)),$("#questionsWrapper .review").live("click",_.bind(this.reviewQuestionClickHandler,this)),$("#questionsWrapper .submit").live("click",_.bind(this.submitQuizClickHandler,this)),$("#questionsWrapper .return").live("click",_.bind(this.returnToQuestionClickHandler,this)),$("#questionsWrapper .closePreview").live("click",_.bind(this.closePreviewClickHandler,this)),$(".question_menu .question_nav").live("click",_.bind(this.changeQuestionClickHandler,this)),$(".quizFilterResults").on("click","a",_.bind(this.quizFilterResultsClickHandler,this))},initAttachments:function(){this.attachments=new Attachments("#attachments",{attachmentsContainer:"#attachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),canShare:!0,blockButtonId:"#save-quiz",initShareHandler:_.bind(s.getShareInitHandler(),this)})},attachmentsChanged:function(){$('#addQuizForm input[name="attachments"]').val($.toJSON(this.attachments.getAttachments()))},initSaveQuestionHandler:function(e){var t=e==1?"#edit-save-question":"#save-question";$(t).off("startFileUpload").on("startFileUpload",_.bind(function(e,n){c[n]=0,$(t).attr("disabled",!0)},this)),$(t).off("uploadedFile").on("uploadedFile",_.bind(function(e,t){c[t]=1},this)),$(t).off("filesFinishedUploading").on("filesFinishedUploading",_.bind(function(){var e=!0;for(var n in c)if(c[n]==0){e=!1;break}e==1&&(c=[],$(t).attr("disabled",!1))},this))},initQuestionAttachments:function(){this.initSaveQuestionHandler(),this.questionAttachments=new Attachments("#questionAttachments",{attachmentsContainer:"#questionAttachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsQuestionChanged,this),onAttachmentRemoved:_.bind(this.attachmentsQuestionChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),canShare:!0,questionButtonId:"#save-question",initShareHandler:_.bind(s.getShareInitHandler(),this)})},attachmentsQuestionChanged:function(){$('#addQuestionForm input[name="questionAttachments"]').val($.toJSON(this.questionAttachments.getAttachments()))},initResponseAttachments:function(e,t){function n(){$('.addEditFormQuestion input[name="responseAttachments['+e+']"]').val($.toJSON(this["responseAttachments-"+e].getAttachments()))}t==1?this.initSaveQuestionHandler(!0):this.initSaveQuestionHandler(),this["responseAttachments-"+e]=new Attachments("#responseAttachments-"+e,{attachmentsContainer:"#responseAttachmentsContainer-"+e,onAttachmentAdded:_.bind(n,this),onAttachmentRemoved:_.bind(n,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),canShare:!0,questionButtonId:t==1?"#edit-save-question":"#save-question",initShareHandler:_.bind(s.getShareInitHandler(),this)})},initAttachmentsEdit:function(){var e=null;$("#prevattachments").val()&&(e=$.parseJSON($("#prevattachments").val())),this.attachments=new Attachments("#attachments",{attachmentsContainer:"#attachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsChangedEdit,this),onAttachmentRemoved:_.bind(this.attachmentsChangedEdit,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),attachments:e,canShare:!0,blockButtonId:"#save-edit-quiz",initShareHandler:_.bind(s.getShareInitHandler(),this)})},attachmentsChangedEdit:function(){$('#editQuizForm input[name="attachments"]').val($.toJSON(this.attachments.getAttachments()))},initQuestionAttachmentsEdit:function(){var e=null;$("#questionprevattachments").val()&&(e=$.parseJSON($("#questionprevattachments").val())),this.initSaveQuestionHandler(!0),this.questionAttachments=new Attachments("#questionAttachments",{attachmentsContainer:"#questionAttachmentsContainer",onAttachmentAdded:_.bind(this.attachmentsQuestionChangedEdit,this),onAttachmentRemoved:_.bind(this.attachmentsQuestionChangedEdit,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),attachments:e,canShare:!0,questionButtonId:"#edit-save-question",initShareHandler:_.bind(s.getShareInitHandler(),this)})},attachmentsQuestionChangedEdit:function(){$('#editQuestionForm input[name="questionAttachments"]').val($.toJSON(this.questionAttachments.getAttachments()))},initResponseAttachmentsEdit:function(e){function n(){$('#editQuestionForm input[name="responseAttachments['+e+']"]').val($.toJSON(this["responseAttachments-"+e].getAttachments()))}var t=null;$("#responseprevattachments-"+e).val()&&(t=$.parseJSON($("#responseprevattachments-"+e).val())),this.initSaveQuestionHandler(!0),this["responseAttachments-"+e]=new Attachments("#responseAttachments-"+e,{attachmentsContainer:"#responseAttachmentsContainer-"+e,onAttachmentAdded:_.bind(n,this),onAttachmentRemoved:_.bind(n,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),attachments:t,canShare:!0,questionButtonId:"#edit-save-question",initShareHandler:_.bind(s.getShareInitHandler(),this)})},openPopupAddQuizClickHandler:function(e){var n=t.renderTemplate(this.templateNames.addQuiz);$("#popup_section").html(n),$(".questionTooltip").tooltip(),$("#popup_section").modal("show"),this.initialiseForm($("#popup_section")),$("#addQuizForm").validate(this.validateQuiz),this.initAttachments();var r=$('#addQuizForm input[name="date"]'),i=$('#addQuizForm input[name="time"]');$.data(i[0],"dueDateSelect",r),$.data(r[0],"dueTimeSelect",i),$.data(i[0],"DueGlobal",{originalDueDateVal:"",originalDueTimeVal:""}),$.data(r[0],"DueGlobal",{originalDueDateVal:"",originalDueTimeVal:""})},openPopupEditQuizClickHandler:function(e){Utils.block(".middleBar");if($(e.currentTarget).hasClass("disabled_link")||!$(e.currentTarget).attr("id")){e.preventDefault();return}var t=$(e.currentTarget).attr("id").replace("edit-quiz-","");$.ajax({type:"POST",url:this.config.ajaxUrlQuizHtml+"/editquiz",data:"quizId="+t+"&sectionId="+$("#idsection").val(),success:$.proxy(function(e){$("#popup_section").html(e),$(".questionTooltip").tooltip(),$("#popup_section").modal("show"),this.initialiseForm($("#popup_section"));var t=$("#dueDate").val();t!==""&&$("#editQuizForm .datepicker-grading-period").datepicker("option","minDate",t),$("#editQuizForm").validate(this.validateQuiz),this.initAttachmentsEdit();var n=$('#editQuizForm input[name="date"]'),r=$('#editQuizForm input[name="time"]');!_.isUndefined(r[0])&&!_.isUndefined(n[0])&&($.data(r[0],"dueDateSelect",n),$.data(n[0],"dueTimeSelect",r),$.data(r[0],"DueGlobal",{originalDueDateVal:n.val(),originalDueTimeVal:r.val()}),$.data(n[0],"DueGlobal",{originalDueDateVal:n.val(),originalDueTimeVal:r.val()}))},this),dataType:"html"}).always(function(){Utils.unblock(".middleBar")})},openPopupCopyQuizClickHandler:function(e){var n=$(e.currentTarget).attr("id").replace("copy-quiz-",""),r=t.renderTemplate(this.templateNames.popupCourses,{}),i=t.renderTemplate(this.templateNames.popupCoursesFooter,{quizId:n}),s="copy_to_other_courses";Utils.popup(translate(s),r,i),this.loadCourses(n)},loadCourses:function(e){Utils.block(".modalList"),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/getcourses",data:"sectionId="+$("#idsection").val()+"&courseId="+$("#idcourse").val()+"&quizId="+e,dataType:"json",success:$.proxy(function(e){Utils.unblock(".modalList");var n={data:e.data,defaultdate:e.defaultdate?e.defaultdate:null,defaulttime:e.defaulttime?e.defaulttime:null},r=t.renderTemplate(this.templateNames.loadCoursesPopup,n);$("#courses_list").html(r),this.manageDatePickers()},this)})},manageDatePickers:function(){$("#copyQuizForm").validate();var e=[],t=this.initializeCoursePopupDatePicker;$("#courses_list").on("change",'input[type="checkbox"]',function(){var n=$(this).val();$(this).is(":checked")?($.inArray(n,e)==-1&&(e.push(n),t(n)),$("#date-"+n).show()):$("#date-"+n).hide()})},initializeCoursePopupDatePicker:function(e){var t=$("#date-"+e+" .datepicker-grading-period"),n=$("#date-"+e+" .timepicker");t.datepicker({changeMonth:!0,changeYear:!0,showWeek:!0,firstDay:1,altFormat:"dd-mm-yy",yearRange:"1900:c+5",onSelect:function(){t.trigger("focusout")},dateFormat:"dd-mm-yy",isRTL:this.isRTL,minDate:new Date}),n.timeEntry({spinnerImage:"",show24Hours:!0,beforeShow:this.customDuedateTime}),t.rules("add",{required:!0,validFormatDate:!0,dateYearBiggerThanCurrent:!0}),n.rules("add",{required:!0,afterNow:!0}),$.data(n[0],"dueDateSelect",t),$.data(t[0],"dueTimeSelect",n)},deleteQuizClickHandler:function(e){if($(e.currentTarget).hasClass("disabled_link")||!$(e.currentTarget).attr("id")){e.preventDefault();return}var t=$(e.currentTarget).attr("id").replace("delete-quiz-",""),n=this.config.ajaxUrlQuizJson;Utils.confirm(translate("delete_quiz"),translate("delete_quiz_content"),function(e){e=="yes"&&$.ajax({type:"POST",url:n+"/deletequiz",data:{quizId:t,sectionId:$("#idsection").val()},success:$.proxy(function(e){e.success?document.location.href=e.data.url:Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"})})},saveQuizClickHandler:function(e){if($("#addQuizForm").valid()){Utils.block("#popup_section");var t=$("#addQuizForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/savequiz",data:t+"&sectionId="+$("#idsection").val()+"&courseId="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_section");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_quiz")}else window.location.href=this.config.quizInfo.replace("__QUIZ_ID__",e.quizId).replace("__TAB__","")},this),dataType:"json"})}},saveEditQuizClickHandler:function(e){if($("#editQuizForm").valid()){Utils.block("#popup_section");var t=$("#editQuizForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/savequiz",data:t+"&sectionId="+$("#idsection").val()+"&courseId="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_section");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_edit_quiz")}else document.location.reload(!0)},this),dataType:"json"})}},saveQuizSettingsClickHandler:function(e){e.preventDefault();if($("#quizSettingsForm").valid()){Utils.block(".quizSettings");var t=$(e.currentTarget).attr("id").replace("save-quiz-settings-",""),n=$("#quizSettingsForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/savequizsettings",data:n+"&quizId="+t+"&sectionId="+$("#idsection").val()+"&courseId="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock(".quizSettings");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],".alert_settings")}else{Utils.unblock(".quizSettings"),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("settings_saved"),".alert_settings",3e3);if(e.refresh=="1")document.location.reload(!0);else{e.status=="0"?($(".quizStatus > span").removeClass("greenTxt").addClass("redTxt").html(translate("quiz_unavailable")),$(".quizStatus > span").attr("title",translate("quiz_unavailable_student"))):e.status=="1"&&($(".quizStatus > span").removeClass("redTxt").addClass("greenTxt").html(translate("quiz_available")),$(".quizStatus > span").attr("title",translate("quiz_available_student")));if($("#availability").val()==="3"){var n=$('#quizSettingsForm input[name="date"]'),r=$('#quizSettingsForm input[name="time"]');$.data(r[0],"dueDateSelect",n),$.data(n[0],"dueTimeSelect",r),$.data(r[0],"DueGlobal",{originalDueDateVal:n.val(),originalDueTimeVal:r.val()}),$.data(n[0],"DueGlobal",{originalDueDateVal:n.val(),originalDueTimeVal:r.val()})}$("#availability").val()!="1"?$(".availability_info").hide():$(".availability_info").show()}}},this),dataType:"json"})}},loadQuizQuestionsClickHandler:function(e){var n=$("#idquiz").val(),r=$(e.currentTarget).attr("id"),i=BAppConfig.get("mydata","role");Utils.block(".quizMiddleScreen"),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/getquizquestions",data:"quizId="+n+"&sectionId="+$("#idsection").val(),success:$.proxy(function(e){Utils.unblock(".quizMiddleScreen");if(!e.success){e.url&&(document.location.href=e.url);for(var n in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[n],"#flashmessages")}else{isAdmin==0?this.sessionStorage=new l({storageType:"sessionStorage"}):($(".questionContainer > .quizSettings > .quizSettingsInner").appendTo("#quiz_questions > .quizSettings"),$(".questionContainer").remove());var s=t.renderTemplate(this.templateNames.quizQuestions,{data:e.questions,questionsViewed:this.questionsViewed,quizStudentResultId:e.quizStudentResultId,isAdmin:isAdmin,sessionStorage:this.sessionStorage});if(_.size(e.questions)>0)if(i=="INSTRUCTOR"&&isAdmin==1&&r=="preview")var o=t.renderTemplate(this.templateNames.previewButtons,{});else var o=t.renderTemplate(this.templateNames.buttons,{studentResultId:e.quizStudentResultId});else var o=t.renderTemplate(this.templateNames.noQuestions,{});$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer, .quizMiddleScreen .questionContainer").hide(),$(".quizMiddleScreen").append(s),$("#questionsWrapper").append(o),$(".questions_pages li:first").addClass("activeQuestion"),$(".question_menu li:first").addClass("question_nav_active viewedQuestion"),$("#questionsWrapper .back").hide(),$.each(e.questions,function(t,n){if(!_.isEmpty(e.questions[t].attach)){var r=new f({el:"#quiz_question_attachments_container_"+e.questions[t].id,config:{},attachments:e.questions[t].attach,postid:"q_"+e.questions[t].id});r.render()}}),$.each(e.questions,function(t,n){_.isUndefined(e.questions[t].options)||$.each(e.questions[t].options,function(n,r){if(!_.isEmpty(e.questions[t].options[n].attach)){var i=new f({el:"#quiz_question_options_attachments_container_"+e.questions[t].options[n].id,config:{},attachments:e.questions[t].options[n].attach,postid:"qq_"+e.questions[t].options[n].id});i.render()}})}),_.size(e.questions)==1&&($("#questionsWrapper .next").hide(),$("#questionsWrapper .review").show());if(e.leftTime!=undefined){h=!0;var u=parseInt(e.leftTime/3600),a=parseInt((e.leftTime-u*3600)/60),c=(e.leftTime-u*3600)%60,p=this;$("#leftTime").removeClass("hide"),$("#timer").chrony({hour:u,minute:a,second:c,finish:function(){if(i!="INSTRUCTOR"||isAdmin!=1||r!="preview"){var e=$("#questionsWrapper li.activeQuestion > form").attr("id").replace("saveQuestion-",""),t=$("#questionsWrapper .buttons .submit").attr("id").replace("btn-submit-","");p.saveStudentAnswer(t,e,!1),p.ajaxSubmitHandler()}}})}}},this),dataType:"json"})},viewAssessmentClickHandler:function(e){var n=$(e.currentTarget).attr("id").replace("view-assessment-","");Utils.block("#results"),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/getassessment",data:"quizStudResultId="+n,success:$.proxy(function(e){if(!e.success){Utils.unblock("#results");for(var r in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[r],"#flashmessages")}else{var i=$('.studentResultsTable tr[id="'+n+'"] td:first').html(),s=$("#readOnly").val(),o=t.renderTemplate(this.templateNames.studentAssessment,{data:e.studentAnswers,student:i,quizStudResult:e.quizResult.id,readOnly:s});$("#results .studentResults").hide(),$("#results").append(o),Utils.unblock("#results"),$("#saveAssessmentChangesForm").validate();var u;$("#saveAssessmentChangesForm").find("input.studScore").each(function(){u=$(this).next().attr("id").replace("itemMax-",""),$(this).rules("add",{number:!0,max:u})})}},this),dataType:"json"})},returnToClassResultsClickHandler:function(e){$("#results .studentAssessment").remove(),$("#results .studentResults").show()},saveAssessmentChangesClickHandler:function(e){e.preventDefault();if($("#saveAssessmentChangesForm").valid()){Utils.block(".studentAssessment");var t=$(e.currentTarget).attr("id").replace("save-assessment-",""),n=$("#idquiz").val(),r=$("#saveAssessmentChangesForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/saveassessmentchanges",data:r+"&sectionId="+$("#idsection").val()+"&quizStudResultId="+t,success:$.proxy(function(e){Utils.unblock(".studentAssessment");if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#flashmessages");else Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("assessment_successfully_saved"),"#flashmessages"),e.reloadStatus==1&&(window.location.href=this.config.quizInfo.replace("__QUIZ_ID__",n).replace("__TAB__","results"))},this),dataType:"json"})}},clearOverrideClickHandler:function(e){var n=$(e.currentTarget).attr("id").replace("clear-override-",""),r=this.config.ajaxUrlQuizJson,i=this.templateNames.studScore;Utils.confirm(translate("clear_override"),translate("clear_override_content"),function(e){e=="yes"&&(Utils.block("#results"),$.ajax({type:"POST",url:r+"/clearoverride",data:{quizStudResultId:n},success:$.proxy(function(e){if(!e.success)Utils.alert(e.msg.title,e.msg.message,function(){}),Utils.unblock("#results");else{Utils.unblock("#results");var r=e.quizResult?e.quizResult:null,s=t.renderTemplate(i,{data:r,max_points:maxPoints});$("#"+n+" td.final_score").html(s),$("#"+n+" td.final_score .editScore").tooltip({trigger:"hover",title:translate("click_to_edit_grade")}),e.quizResult&&e.quizResult.result==null&&($("#"+n).addClass("studPendingReview"),$("#"+n+" td.submission").append('<p class="redTxt needsGrade">'+translate("needs_grading")+"</p>")),e.quizResult||$(".studentResultsTable #"+n+" td:last-child").html("")}},this),dataType:"json"}))})},editScoreClickHandler:function(e){e.preventDefault();var n=$(e.currentTarget).attr("id").replace("edit-score-","");$("#results .overrideScore").remove();var r=t.renderTemplate(this.templateNames.scoreForm,{quizStudResultId:n});$(e.currentTarget).parent().append(r)},cancelOverrideClickHandler:function(e){$(e.currentTarget).parent().remove()},saveOverrideClickHandler:function(e){e.preventDefault(),$("#overrideForm").validate(),$('input[name="data[new-score]"]').rules("add",{required:!0,max:maxPoints});var n=$(e.currentTarget).attr("id").replace("save-override-","");if($("#overrideForm").valid()){Utils.block("#results");var r=$("#overrideForm").serialize();$("#results .overrideScore").remove(),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/saveoverride",data:r+"&sectionId="+$("#idsection").val()+"&quizStudResultId="+n,success:$.proxy(function(e){if(!e.success){Utils.unblock("#results");for(var r in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[r],"#alert_edit_quiz")}else{var i=t.renderTemplate(this.templateNames.overrideScore,{data:e.quizResult,max_points:maxPoints});$("#"+n+" td.final_score").html(i),$("#"+n+" td.final_score .editScore").tooltip({trigger:"hover",title:translate("click_to_edit_grade")}),$("#"+n).removeClass("studPendingReview"),$("#"+n+" td.submission .needsGrade").remove(),Utils.unblock("#results")}},this),dataType:"json"})}},addQuestionCommentClickHandler:function(e){e.preventDefault();var t=$(e.currentTarget).attr("id").replace("addComment-","");$("#questionComment-"+t).addClass("displayComment"),$('textarea[name="data['+t+'][comment]"], #removeComment-'+t).show(),$(e.currentTarget).hide()},removeQuestionCommentClickHandler:function(e){e.preventDefault();var t=$(e.currentTarget).attr("id").replace("removeComment-","");$("#questionComment-"+t).removeClass("displayComment"),$('textarea[name="data['+t+'][comment]"]').hide().val(""),$("#addComment-"+t).show(),$(e.currentTarget).hide()},viewResultsByStudentClickHandler:function(e){e.preventDefault(),$("#results .studentResults").show(),$("#results .questionResults").remove()},viewResultsByQuestionClickHandler:function(e){e.preventDefault();var n=$("#idquiz").val();Utils.block("#results"),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/quizquestionstats",data:"quizId="+n,success:$.proxy(function(e){Utils.unblock("#results");if(!e.success)Utils.alert(e.msg.title,e.msg.message,function(){});else{var n=t.renderTemplate(this.templateNames.questionStats,{data:e.quizQuestionStats});$("#results").append(n),$("#results .studentResults").hide()}},this),dataType:"json"})},printQuizClickHandler:function(e){var t=$("#idquiz").val();window.open(this.config.ajaxUrlPrintQuizHtml.replace("__QUIZ_ID__",t))},copyQuizClickHandler:function(e){var t=$(e.currentTarget).attr("id").replace("copy-quiz-",""),n=$("#copyQuizForm").serialize();$("#copyQuizForm").valid()&&(Utils.block("#_dialog_popup"),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/copyquiz",data:n+"&quizId="+t+"&sectionId="+$("#idsection").val()+"&courseId="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock("#_dialog_popup");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_copy_question")}else Utils.unblock("#_dialog_popup"),$("#_dialog_popup").modal("hide"),e.warning?Utils.flashMessage(Utils.FLASH_WARNING,"",e.warning,"#flashmessages"):Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("quiz_copied_successfully"),"#flashmessages",3e3,!0)},this),dataType:"json"}))},openPopupLoadQuestionClickHandler:function(e){if($(e.currentTarget).attr("disabled")=="disabled"){e.preventDefault();return}var n=t.renderTemplate(this.templateNames.popupQuestions,{}),r="load_previous_question";Utils.popup(translate(r),n,""),$("#_dialog_popup-footer").addClass("load-questions-footer"),this.questionBankCollection.fetch(this.questionBankCollection.details)},loadTrueFalseTemplateClickHandler:function(e){var n=$("#idquiz").val(),r=t.renderTemplate(this.templateNames.addOuestion,{quizId:n}),i=t.renderTemplate(this.templateNames.addTrueFalseExtra,{quizId:n}),s=t.renderTemplate(this.templateNames.addButtons,{questionType:"trueFalse"});$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").hide(),$(".quizMiddleScreen").append(r),$("ul.questionForm").append(i),$("#addQuestionForm").after(s),$("#quizType option[value='1']").prop("selected",!0),$("#addQuestionForm").validate(this.validateQuestion),this.initQuestionAttachments(),$("#quiz_questions > .quizSettings > .quizSettingsInner").appendTo(".questionContainer > .quizSettings"),$(".attachTooltip").tooltip()},loadEssayTemplateClickHandler:function(e){var n=$("#idquiz").val(),r=t.renderTemplate(this.templateNames.addOuestion,{quizId:n}),i=t.renderTemplate(this.templateNames.addEssayExtra,{quizId:n}),s=t.renderTemplate(this.templateNames.addButtons,{questionType:"essayQ"});$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").hide(),$(".quizMiddleScreen").append(r),$("ul.questionForm").append(i),$("#addQuestionForm").after(s),$("#quizType option[value='3']").prop("selected",!0),$("#addQuestionForm").validate(this.validateQuestion),this.initQuestionAttachments(),$("#quiz_questions > .quizSettings > .quizSettingsInner").appendTo(".questionContainer > .quizSettings"),$(".attachTooltip").tooltip()},loadMultipleChoiceTemplateClickHandler:function(e){var n=$("#idquiz").val(),r=t.renderTemplate(this.templateNames.addOuestion,{quizId:n}),i=t.renderTemplate(this.templateNames.addMultipleChoiceExtra,{quizId:n}),s=t.renderTemplate(this.templateNames.addButtons,{questionType:"multipleChoice"});$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").hide(),$(".quizMiddleScreen").append(r),$("ul.questionForm").append(i),$("#addQuestionForm").after(s),$("#quizType option[value='2']").prop("selected",!0),$("#addQuestionForm").validate(this.validateMultiChoiceQuestion),this.initQuestionAttachments(),this.initResponseAttachments("1"),this.initResponseAttachments("2"),this.questionCharacter="B",this.questionOrder=2,$("#quiz_questions > .quizSettings > .quizSettingsInner").appendTo(".questionContainer > .quizSettings"),$(".attachTooltip").tooltip()},cancelQuestionClickHandler:function(e){$(".questionContainer > .quizSettings > .quizSettingsInner").appendTo("#quiz_questions > .quizSettings"),$(".questionContainer").remove(),$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").show()},saveQuestionClickHandler:function(e){$('.questionContainer .attachmentOptions input[type="file"]').addClass("ignoreValidation");if($("#addQuestionForm").valid()){Utils.block(".quizMiddleScreen");var t=$("#addQuestionForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/savequestion",data:t+"&sectionId="+$("#idsection").val()+"&courseId="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock(".quizMiddleScreen");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_question")}else document.location.reload(!0)},this),dataType:"json"})}},editSaveQuestionClickHandler:function(e){$('.questionContainer .attachmentOptions input[type="file"]').addClass("ignoreValidation");if($("#editQuestionForm").valid()){Utils.block(".quizMiddleScreen");var t=$("#editQuestionForm").serialize();$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/savequestion",data:t+"&sectionId="+$("#idsection").val()+"&courseId="+$("#idcourse").val(),success:$.proxy(function(e){if(!e.success){Utils.unblock(".quizMiddleScreen");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_question")}else document.location.reload(!0)},this),dataType:"json"})}},addResponseClickHandler:function(e){e.preventDefault(),this.questionCharacter=this.nextChar(this.questionCharacter),this.questionOrder=this.questionOrder+1;var n=t.renderTemplate(this.templateNames.addResponse,{questionCharacter:this.questionCharacter,questionOrder:this.questionOrder});$(".responses").append(n),this.initResponseAttachments(this.questionOrder),this.questionCharacter!="A"&&this.questionCharacter!="B"&&$(".remove-answer").show(),$('textarea[name="data[question_option]['+this.questionOrder+']"]').rules("add",{required:!0}),$(".attachTooltip").tooltip()},changeTypeClickHandler:function(e){var n=$(e.currentTarget).val(),r=$(".cancel-question").attr("id").replace("cancel-","");r=="multipleChoice"&&$("#"+r).next().remove(),$("#"+r).remove(),$(".questionContainer .buttons").remove();var i=$("#idquiz").val(),s=$("#questionId").val(),o,u;switch(n){case"1":o=t.renderTemplate(this.templateNames.addTrueFalseExtra,{quizId:i}),s?u=t.renderTemplate(this.templateNames.editButtons,{questionType:"trueFalse"}):u=t.renderTemplate(this.templateNames.addButtons,{questionType:"trueFalse"}),$("ul.questionForm").append(o),$(".questionContainer .quizMain > form").after(u),$("#quizType option[value='1']").prop("selected",!0),s?this.initSaveQuestionHandler(!0):this.initSaveQuestionHandler();break;case"2":o=t.renderTemplate(this.templateNames.addMultipleChoiceExtra,{quizId:i}),s?u=t.renderTemplate(this.templateNames.editButtons,{questionType:"multipleChoice"}):u=t.renderTemplate(this.templateNames.addButtons,{questionType:"multipleChoice"}),$("ul.questionForm").append(o),$(".questionContainer .quizMain > form").after(u),$("#quizType option[value='2']").prop("selected",!0),s?(this.initResponseAttachments("1",!0),this.initResponseAttachments("2",!0),this.initSaveQuestionHandler(!0)):(this.initResponseAttachments("1"),this.initResponseAttachments("2"),this.initSaveQuestionHandler()),$('textarea[name="data[question_option][1]"]').rules("add",{required:!0}),$('textarea[name="data[question_option][2]"]').rules("add",{required:!0}),$('input[name="data[correct_answer]"]').rules("add",{required:!0}),this.questionCharacter="B",this.questionOrder=2,$(".attachTooltip").tooltip();break;default:o=t.renderTemplate(this.templateNames.addEssayExtra,{quizId:i}),s?u=t.renderTemplate(this.templateNames.editButtons,{questionType:"essayQ"}):u=t.renderTemplate(this.templateNames.addButtons,{questionType:"essayQ"}),$("ul.questionForm").append(o),$(".questionContainer .quizMain > form").after(u),$("#quizType option[value='3']").prop("selected",!0),s?this.initSaveQuestionHandler(!0):this.initSaveQuestionHandler()}},removeAnswerClickHandler:function(e){e.preventDefault(),$(e.currentTarget).parent().parent().parent().remove();var t="A",n=this.nextChar;$("ul.responses").find("span.character").each(function(){$(this).html(t),t=n(t)}),this.questionCharacter=this.prevChar(t),(this.questionCharacter=="A"||this.questionCharacter=="B")&&$(".remove-answer").hide()},nextChar:function(e){return String.fromCharCode(e.charCodeAt(0)+1)},prevChar:function(e){return String.fromCharCode(e.charCodeAt(0)-1)},removeQuestionFromQuizClickHandler:function(e){if($(e.currentTarget).hasClass("disabled_link")){e.preventDefault();return}e.preventDefault();if($(e.currentTarget).attr("id")&&$("#loadQuestion").val()!="1"){var t=$(e.currentTarget).attr("id").replace("delete-question-",""),n=this.config.ajaxUrlQuizJson;Utils.confirm(translate("delete_question"),translate("delete_question_content"),function(e){e=="yes"&&(Utils.block(".quizMiddleScreen"),$.ajax({type:"POST",url:n+"/deletequestion",data:{questionId:t,quizId:$("#idquiz").val(),sectionId:$("#idsection").val()},success:$.proxy(function(e){e.success?document.location.href=e.data.url:(Utils.alert(e.msg.title,e.msg.message,function(){}),Utils.unblock(".quizMiddleScreen"))},this),dataType:"json"}))})}else Utils.confirm(translate("delete_question"),translate("delete_question_content"),function(e){e=="yes"&&($(".questionContainer > .quizSettings > .quizSettingsInner").appendTo("#quiz_questions > .quizSettings"),$(".questionContainer").remove(),$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").show(),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("successful_delete_question"),"#flashmessages",3e3))})},removeQuestionFromBankClickHandler:function(e){e.preventDefault();var t=$(e.currentTarget).attr("id").replace("delete-from-bank-",""),n=this.config.ajaxUrlQuizJson;Utils.block("#_dialog_popup"),Utils.confirm(translate("delete_question"),translate("delete_question_from_bank_content"),function(e){$(this).on("hide",function(){Utils.unblock("#_dialog_popup")}),e=="yes"?$.ajax({type:"POST",url:n+"/deletefrombank",data:{questionId:t,quizId:$("#idquiz").val(),sectionId:$("#idsection").val()},success:$.proxy(function(e){e.success?($("#load-question-"+t).remove(),Utils.unblock("#_dialog_popup"),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("successful_delete_question_from_bank"),"#alert_loadPopup",2e3)):(Utils.alert(e.msg.title,e.msg.message,function(){}),Utils.unblock("#_dialog_popup"))},this),dataType:"json"}):Utils.unblock("#_dialog_popup")})},loadQuestionClickHandler:function(e){var n=$(e.currentTarget).attr("id").replace("load-","");Utils.block("#_dialog_popup"),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/questiondetails",data:"questionId="+n,success:$.proxy(function(e){$("#_dialog_popup").modal("hide");if(!e.success)Utils.alert(e.msg.title,e.msg.message,function(){});else{var n=e.data;n.quiz_id=$("#idquiz").val(),n.load=1;var r=t.renderTemplate(this.templateNames.editOuestion,n);$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").hide(),$(".quizMiddleScreen").append(r),$("#quizType option[value='"+e.data.type+"']").prop("selected",!0);var i,s;switch(n.type){case 1:i=t.renderTemplate(this.templateNames.addTrueFalseExtra,{}),s=t.renderTemplate(this.templateNames.editButtons,{questionType:"trueFalse"}),$("ul.questionForm").append(i);var o=n.options[0].correct_answer;$("select[name='data[correct_answer]'] option[value='"+o+"']").prop("selected",!0),$(".questionContainer .quizMain > form").after(s),this.initQuestionAttachmentsEdit(),$("#editQuestionForm").validate(this.validateQuestion);break;case 2:this.questionCharacter="A",this.questionOrder=1;for(var u=0;u<n.options.length;u++)n.options[u].questionCharacter=this.questionCharacter,n.options[u].questionOrder=this.questionOrder,this.questionCharacter=this.nextChar(this.questionCharacter),this.questionOrder=this.questionOrder+1;this.questionCharacter=this.prevChar(this.questionCharacter),this.questionOrder=this.questionOrder-1,i=t.renderTemplate(this.templateNames.editMultipleChoiceExtra,n),s=t.renderTemplate(this.templateNames.editButtons,{questionType:"multipleChoice"}),$("ul.questionForm").append(i),$(".questionContainer .quizMain > form").after(s),this.initQuestionAttachmentsEdit(),$("#editQuestionForm").validate(this.validateMultiChoiceQuestion);for(var a=0;a<n.options.length;a++)this.initResponseAttachmentsEdit(a+1),$('textarea[name="data[question_option]['+(a+1)+']"]').rules("add",{required:!0});this.questionOrder>2&&$(".remove-answer").show();break;default:i=t.renderTemplate(this.templateNames.addEssayExtra,{}),s=t.renderTemplate(this.templateNames.editButtons,{questionType:"essayQ"}),$("ul.questionForm").append(i),$(".questionContainer .quizMain > form").after(s),this.initQuestionAttachmentsEdit(),$("#editQuestionForm").validate(this.validateQuestion)}$("#quiz_questions > .quizSettings > .quizSettingsInner").appendTo(".questionContainer > .quizSettings"),$(".attachTooltip").tooltip()}},this),dataType:"json"})},editQuestionClickHandler:function(e){Utils.block(".contentList");if($(e.currentTarget).hasClass("disabled_link")||!$(e.currentTarget).attr("id")){e.preventDefault();return}var n=$(e.currentTarget).attr("id").replace("edit-question-","");$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/questiondetails",data:"questionId="+n,success:$.proxy(function(e){Utils.unblock(".contentList");if(!e.success)Utils.alert(e.msg.title,e.msg.message,function(){});else{var n=e.data;n.load=0;var r=t.renderTemplate(this.templateNames.editOuestion,n);$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").hide(),$(".quizMiddleScreen").append(r),$("#quizType option[value='"+e.data.type+"']").prop("selected",!0);var i,s;switch(n.type){case 1:i=t.renderTemplate(this.templateNames.addTrueFalseExtra,{}),s=t.renderTemplate(this.templateNames.editButtons,{questionType:"trueFalse"}),$("ul.questionForm").append(i);var o=n.options[0].correct_answer;$("select[name='data[correct_answer]'] option[value='"+o+"']").prop("selected",!0),$(".questionContainer .quizMain > form").after(s),this.initQuestionAttachmentsEdit(),$("#editQuestionForm").validate(this.validateQuestion);break;case 2:this.questionCharacter="A",this.questionOrder=1;for(var u=0;u<n.options.length;u++)n.options[u].questionCharacter=this.questionCharacter,n.options[u].questionOrder=this.questionOrder,this.questionCharacter=this.nextChar(this.questionCharacter),this.questionOrder=this.questionOrder+1;this.questionCharacter=this.prevChar(this.questionCharacter),this.questionOrder=this.questionOrder-1,i=t.renderTemplate(this.templateNames.editMultipleChoiceExtra,n),s=t.renderTemplate(this.templateNames.editButtons,{questionType:"multipleChoice"}),$("ul.questionForm").append(i),$(".questionContainer .quizMain > form").after(s),this.initQuestionAttachmentsEdit(),$("#editQuestionForm").validate(this.validateMultiChoiceQuestion);for(var a=0;a<n.options.length;a++)this.initResponseAttachmentsEdit(a+1),$('textarea[name="data[question_option]['+(a+1)+']"]').rules("add",{required:!0});this.questionOrder>2&&$(".remove-answer").show();break;default:i=t.renderTemplate(this.templateNames.addEssayExtra,{}),s=t.renderTemplate(this.templateNames.editButtons,{questionType:"essayQ"}),$("ul.questionForm").append(i),$(".questionContainer .quizMain > form").after(s),this.initQuestionAttachmentsEdit(),$("#editQuestionForm").validate(this.validateQuestion)}$("#quiz_questions > .quizSettings > .quizSettingsInner").appendTo(".questionContainer > .quizSettings"),$(".attachTooltip").tooltip()}},this),dataType:"json"})},searchQuestionClickHandler:function(e){var t=e.which;t=="13"&&this.searchUpdateQuestionList()},searchUpdateQuestionList:function(e){this.searchQuestionBankCollection=new u,this.searchQuestionBankCollection.details.search=$("#search_question").val(),this.searchQuestionBankCollection.details.page=1,this.searchQuestionBankCollection.url=this.config.ajaxUrlQuizJson,this.searchQuestionsList=new o({el:"#questions_list",collection:this.searchQuestionBankCollection}),this.searchQuestionsList.on("viewMoreQuestions",_.bind(function(){this.searchQuestionBankCollection.loadMoreQuestions(!1)},this)),this.searchQuestionBankCollection.fetch({data:this.searchQuestionBankCollection.details})},prevQuestionClickHandler:function(e){e.preventDefault();var t=parseInt($("#questionsWrapper li.activeQuestion").attr("id").replace("question-","")),n=parseInt($("#questionsWrapper .questions_pages").attr("id").replace("questions-","")),r=$("#questionsWrapper li.activeQuestion > form").attr("id").replace("saveQuestion-","");$.inArray(t,this.questionsViewed)==-1&&this.questionsViewed.push(t);if(isAdmin==0){var i=$(e.currentTarget).attr("id").replace("btn-back-","");this.saveStudentAnswer(i,r)}t==2&&$(e.currentTarget).hide(),t==n&&($("#questionsWrapper .review, #questionsWrapper .viewAllQuestions_warning").hide(),$("#questionsWrapper .next").show());var s=$(".question_menu li.question_nav_active");this.markQuestionAnswer(s,r),$("#questionsWrapper li.activeQuestion").removeClass("activeQuestion").prev().addClass("activeQuestion"),s.removeClass("question_nav_active").prev().addClass("question_nav_active viewedQuestion")},nextQuestionClickHandler:function(e){e.preventDefault();var t=parseInt($("#questionsWrapper li.activeQuestion").attr("id").replace("question-","")),n=parseInt($("#questionsWrapper .questions_pages").attr("id").replace("questions-","")),r=$("#questionsWrapper li.activeQuestion > form").attr("id").replace("saveQuestion-","");$.inArray(t,this.questionsViewed)==-1&&this.questionsViewed.push(t);if(isAdmin==0){var i=$(e.currentTarget).attr("id").replace("btn-next-","");this.saveStudentAnswer(i,r)}t==1&&$("#questionsWrapper .back").show(),t+1==n&&($(e.currentTarget).hide(),this.questionsViewed.length==n-1&&$.inArray(n,this.questionsViewed)==-1||this.questionsViewed.length==n?$("#questionsWrapper .review").show():$(".viewAllQuestions_warning").show());var s=$(".question_menu li.question_nav_active");this.markQuestionAnswer(s,r),$("#questionsWrapper li.activeQuestion").removeClass("activeQuestion").next().addClass("activeQuestion"),s.removeClass("question_nav_active").next().addClass("question_nav_active viewedQuestion")},markQuestionAnswer:function(e,t){var n=$("#saveQuestion-"+t).serialize();n===""||$("#saveQuestion-"+t+" .question_data > li > textarea").val()===""?e.removeClass("answeredQuestion").addClass("viewedQuestion"):e.addClass("answeredQuestion").removeClass("viewedQuestion")},reviewQuestionClickHandler:function(e){h==1&&$("#questionsWrapper").addClass("paddingTop25"),e.preventDefault(),$("#questionsWrapper .quizLegend").hide();var t=parseInt($("#questionsWrapper .questions_pages").attr("id").replace("questions-",""));if(this.questionsViewed.length==t-1&&$.inArray(t,this.questionsViewed)==-1||this.questionsViewed.length==t){var n=$("#questionsWrapper li.activeQuestion > form").attr("id").replace("saveQuestion-","");if(isAdmin==0){var r=$(e.currentTarget).attr("id").replace("btn-review-","");this.saveStudentAnswer(r,n)}this.markQuestionAnswer($(".question_menu > li.question_nav_active"),n),$("#questionsWrapper .question_data > li > span > input").attr("disabled","disabled"),$("#questionsWrapper .question_data > li > textarea").attr("readonly","readonly"),$("#questionsWrapper .question_data > li > span > input").each(function(){$(this).is(":checked")&&$(this).parent().addClass("chosen_answer")}),$("#questionsWrapper .questions_pages > li").addClass("activeQuestion"),$("#questionsWrapper .review, #questionsWrapper .back, .question_menu").hide(),$("#questionsWrapper .question_header .return, #questionsWrapper .submit").show()}else Utils.alert(translate("submit_quiz"),translate("view_all_questions_warning"),function(){})},submitQuizClickHandler:function(){var e=this,t=parseInt($("#questionsWrapper .questions_pages").attr("id").replace("questions-",""));this.questionsViewed.length==t-1&&$.inArray(t,this.questionsViewed)==-1||this.questionsViewed.length==t?Utils.confirm(translate("submit_quiz"),translate("submit_quiz_content"),function(t){t=="yes"&&e.ajaxSubmitHandler("submitBtn")}):Utils.alert(translate("submit_quiz"),translate("view_all_questions_warning"),function(){})},ajaxSubmitHandler:function(e){Utils.block("#questionsWrapper"),_.isUndefined(e)&&(e="auto");var t=this.config.ajaxUrlQuizJson,n=this.config.quizInfo,r=$("#questionsWrapper .submit").attr("id").replace("btn-submit-","");$.ajax({type:"POST",url:t+"/submitquiz",data:{quizStudentResultId:r,sectionId:$("#idsection").val(),type:e},success:$.proxy(function(e){if(!e.success){e.url&&(document.location.href=e.url),Utils.unblock("#questionsWrapper");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#flashmessages")}else e.quiz.show_results==1?window.location.href=n.replace("__QUIZ_ID__",e.quiz.id).replace("__TAB__","submission"):window.location.href=n.replace("__QUIZ_ID__",e.quiz.id).replace("__TAB__","quiz")},this),dataType:"json"})},returnToQuestionClickHandler:function(e){e.preventDefault(),h==1&&$("#questionsWrapper").removeClass("paddingTop25"),$("#questionsWrapper .quizLegend").show();var t=parseInt($(e.currentTarget).attr("id").replace("return-","")),n=parseInt($("#questionsWrapper .questions_pages").attr("id").replace("questions-",""));$("#questionsWrapper .question_data > li > span > input").removeAttr("disabled"),$("#questionsWrapper .question_data > li > textarea").removeAttr("readonly"),$("#questionsWrapper .questions_pages > li").removeClass("activeQuestion"),$(".question_menu li.question_nav_active").removeClass("question_nav_active"),$("#questionsWrapper .question_data > li > span.chosen_answer").removeClass("chosen_answer"),$("#questionsWrapper .questions_pages > #question-"+t).addClass("activeQuestion"),$(".question_menu > #question-nav-"+t).addClass("question_nav_active"),$(".question_menu").show(),$("#questionsWrapper .submit, #questionsWrapper .review, #questionsWrapper .question_header .return").hide(),t==1?n==1?$("#questionsWrapper .review").show():$("#questionsWrapper .next").show():t==n?$("#questionsWrapper .back, #questionsWrapper .review").show():$("#questionsWrapper .back, #questionsWrapper .next").show()},closePreviewClickHandler:function(e){e.preventDefault(),this.questionsViewed=new Array,$(".quizMiddleScreen #quizTabs, .quizMiddleScreen .tabsContainer").show(),$("#questionsWrapper").remove()},changeQuestionClickHandler:function(e){e.preventDefault();var t=parseInt($("#questionsWrapper li.activeQuestion").attr("id").replace("question-","")),n=parseInt($(e.currentTarget).parent().attr("id").replace("question-nav-","")),r=parseInt($("#questionsWrapper .questions_pages").attr("id").replace("questions-","")),i=$("#questionsWrapper li.activeQuestion > form").attr("id").replace("saveQuestion-","");$.inArray(t,this.questionsViewed)==-1&&this.questionsViewed.push(t);if(isAdmin==0){var s=$("#questionsWrapper .submit").attr("id").replace("btn-submit-","");this.saveStudentAnswer(s,i)}var o=$(".question_menu > li.question_nav_active");this.markQuestionAnswer(o,i),o.removeClass("question_nav_active"),$("#questionsWrapper .questions_pages > li.activeQuestion").removeClass("activeQuestion"),$(".question_menu > #question-nav-"+n).addClass("question_nav_active viewedQuestion"),$("#questionsWrapper .questions_pages > #question-"+n).addClass("activeQuestion"),n==1?r==1?($("#questionsWrapper .review").show(),$("#questionsWrapper .back, #questionsWrapper .next, #questionsWrapper .viewAllQuestions_warning").hide()):($("#questionsWrapper .next").show(),$("#questionsWrapper .back, #questionsWrapper .review, #questionsWrapper .viewAllQuestions_warning").hide()):n==r?($("#questionsWrapper .back").show(),$("#questionsWrapper .next").hide(),this.questionsViewed.length==r-1&&$.inArray(r,this.questionsViewed)==-1||this.questionsViewed.length==r?$("#questionsWrapper .review").show():$(".viewAllQuestions_warning").show()):($("#questionsWrapper .back, #questionsWrapper .next").show(),$("#questionsWrapper .review, #questionsWrapper .viewAllQuestions_warning").hide())},saveStudentAnswer:function(e,t,n){_.isUndefined(n)&&(n=!0);var r=$("#saveQuestion-"+t).serialize(),i=!1,s="update",o="qS"+e+"q"+t,u,a=this.sessionStorage.get(o);u=$("#saveQuestion-"+t+' input[name="data[answer]"]:checked').val(),_.isUndefined(u)&&(u=$("#saveQuestion-"+t+' textarea[name="data[short_answer]"]').val()),_.isUndefined(u)&&(u=""),a!==u&&(_.isUndefined(a)&&(s="save"),i=!0,this.sessionStorage.set(o,u)),i===!0&&(Utils.block("#questionsWrapper"),$.ajax({type:"POST",url:this.config.ajaxUrlQuizJson+"/savestudentanswer",data:r+"&quizStudentResultId="+e+"&questionId="+t+"&sectionId="+$("#idsection").val()+"&answerAction="+s,async:n,success:$.proxy(function(e){if(!e.success){e.url&&(document.location.href=e.url),Utils.unblock("#questionsWrapper");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#flashmessages")}else Utils.unblock("#questionsWrapper")},this),dataType:"json"}))},showCommentsClickHandler:function(){var e=$("#idquiz").val(),t=$("#readOnly").val(),n=new a({el:"#quizCommentContainer",additionalData:{quizId:e},showEmptyCommentBox:!0,canComment:t==1?!1:!0});$.ajax({type:"POST",url:this.config.urlQuizComment,data:{entityId:e,entityType:"quiz",todo:"refresh",additional:{quizId:e},pageEntityId:e},success:$.proxy(function(t){var r={entityType:"quiz",entityId:e,items:[],nrOfComments:0};_.isUndefined(t.data.comments[e])||(r=t.data.comments[e]),r.page_entity_id=e,n.renderComment(r,t.data.users,t.data.likes)},this),dataType:"json"})},quizFilterResultsClickHandler:function(e){e.preventDefault();var t=$(e.currentTarget).attr("data-status");$("#status_quiz").html($(e.currentTarget).html()),$(".studentResultsTable tbody tr").hide();switch(t){case"all":$(".studentResultsTable tbody tr").show(),$("#totals_quiz").html("("+totalStud+"/"+totalStud+")");break;case"onTime":$(".studentResultsTable tbody tr.onTime").show(),$("#totals_quiz").html("("+$("tr.onTime").length+"/"+totalStud+")");break;case"late":$(".studentResultsTable tbody tr.late").show(),$("#totals_quiz").html("("+$("tr.late").length+"/"+totalStud+")");break;case"notReceivedYet":$(".studentResultsTable tbody tr.notReceivedYet").show(),$("#totals_quiz").html("("+$("tr.notReceivedYet").length+"/"+totalStud+")");break;default:$(".studentResultsTable tbody tr.studPendingReview").show(),$("#totals_quiz").html("("+$("tr.studPendingReview").length+"/"+totalStud+")")}}});return p}),define("quiz/main",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","quiz/views/quiz","quiz/_templates","order!jquery.ui"],function(e,t,n,r,i,s,o){var u=function(){var e={popupquiz:"popup-quiz"};this.run=function(){var s=BAppConfig.get("site_sections","config").left_menu;_.each(s.items,_.bind(function(e,t,n){e.url=e.url.replace("__SECTION_ID__",$("#idsection").val())},this));var o=new r({el:"#content_left",config:s,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"quizzes"});o.render(),n.render(),$(".btn-group").button();var u=new i;u.render();var a=$(t.renderTemplate(e.popupquiz,{}));$("body").append(a)}};return u}),define("text!group/templates.html",[],function(){return'<script type="text/template" id="group_updates">\n    <div id="post_updates_container" class="postUpdatesContainer"></div>\n    <div id="updates_list_container"></div>\n</script>\n\n'}),define("group/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("group_templates",n);return r}),define("group/views/updates",["require","beyazpano","group/_templates","updates/views/postUpdate","updates/views/updatesList","updates/collection/updates"],function(e,t,n,r,i,s){var o=Backbone.View.extend({templateNames:{main:"group_updates"},initialize:function(e){this.el="#groupPostContainer",this.$el=$(this.el),this.setGroupId(e.groupId),this.postUpdateView=null,this.updatesCollection=new s,this.updatesCollection.url=BAppConfig.get("site_groups","config").updatesAjaxBaseUrl.replace("__groupid__",this.groupId),this.renderContent(),this.updatesCollection.fetch(this.updatesCollection.details)},render:function(){},groupId:null,setGroupId:function(e){this.groupId=e},renderContent:function(){var e={},n=$(t.renderTemplate(this.templateNames.main,e));this.$el.html(n);var s=parseInt($("#groupowner").val()),o=parseInt($("#isAdminOfGroup").val()),u=parseInt($("#groupreadonly").val());u!=1&&(this.postUpdateView=new r({el:"#post_updates_container",config:{walls:["2_"+this.groupId],savePostUrl:BAppConfig.get("site_post","savePostUrl"),canBeAnnouncement:s==parseInt(BAppConfig.get("mydata","id"))||o==1}}),this.postUpdateView.on("postSaved",_.bind(function(e){e&&e.approved&&e.approved==0?Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("post_needs_approval"),"#flashmessages",4e3):Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("post_saved"),"#flashmessages",3e3),this.updatesCollection.fetch()},this)),this.postUpdateView.render()),this.updatesList=new i({el:"#updates_list_container",collection:this.updatesCollection,wallType:2,wallOwner:this.groupId,updateType:"group_post"}),this.updatesList.on("viewMoreUpdates",_.bind(function(){this.updatesCollection.loadMoreUpdates(!1)},this))}});return o}),define("group/main",["require","beyazpano","group/views/updates","default/views/siteHeader","default/views/siteLeftMenu","add-members/main","order!jquery.ui"],function(e,t,n,r,i,s){var o=function(){this.run=function(){this.initMenus(),this.addmembers=new s,this.addmembers.init({type:"group",sendEmailUrl:BAppConfig.get("site_groups","sendEmailMembers")}),this.updates=new n({groupId:$("#idgroup").val()}),this.updates.render(),$("#approve-all").live("click",_.bind(this.approveAll,this))},this.approveAll=function(){$("#ajax-loading-approve-all").show(),$.ajax({type:"POST",data:{idgroup:$("#idgroup").val()},url:BAppConfig.get("site_post","approveAllPostUrl"),success:$.proxy(function(e){e.success&&($("#ajax-loading-approve-all").hide(),this.updates.render())},this),dataType:"json"})},this.initMenus=function(){var e=BAppConfig.get("site_groups","config").left_menu;_.each(e.items,_.bind(function(e,t,n){e.url=e.url.replace("__GROUP_ID__",$("#idgroup").val())},this));var t=new i({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"updates"});t.render(),r.render()}};return o}),define("groups/views/joinGroup",["require","beyazpano","groups/_templates","order!jquery.ui","order!jquery.validate","order!jquery.validate.messages_locale"],function(e,t,n){var r=Backbone.View.extend({ajaxUrlGroups:BAppConfig.get("site_groups","ajaxUrlGroups"),validateJoinGroup:{rules:{accesscode:{required:!0}}},initialize:function(e){this.onSuccess=_.isUndefined(e.onSuccess)?null:e.onSuccess},run:function(){},showPopup:function(e){_.isUndefined(e)&&(e="");var n=$(t.renderTemplate("join_group",{groupId:e})),r=n.find("#access-code-form-group");r.get(0).reset();var i=r.validate(this.validateJoinGroup);i.resetForm(),this.initEventHandlers(n),(navigator.appName=="Opera"||navigator.appVersion.indexOf("MSIE 10")!=-1)&&n.attr("class","modal hide"),n.modal("show")},initEventHandlers:function(e){e.find("#access-code-button-group").click(_.bind(function(){var t=e.find("#access-code-form-group");if(t.valid()){Utils.block("#popup_join_group");var n=t.serialize();$.ajax({type:"POST",url:this.ajaxUrlGroups+"/joinGroup",data:n,success:$.proxy(function(t){if(!t.success)for(var n in t.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",t.msg[n],e.find("#alert_access_code"),"",!0);else _.isFunction(this.onSuccess)&&(this.onSuccess({accessCode:e.find("#access-code").val(),groupId:e.find("#joinGroupGroupId").val(),idGroup:t.data.groupId,groupMembership:t.data.groupMembership}),e.modal("hide"))},this),complete:function(){Utils.unblock("#popup_join_group")},dataType:"json"})}},this))}});return r}),define("group-members/membersManagement",["require","beyazpano","section-members/views/sectionMembersView"],function(e,t,n){var r=function(){this.removeMember=function(e,t){var n=$("#idEntity").val(),r=$(e.target),i=r.attr("id").replace("remove-member-",""),s={idGroup:n,idUser:i};Utils.confirm(translate("remove_member_from_group_title"),translate("remove_member_from_group_question"),$.proxy(function(e){e=="yes"&&$.ajax({url:BAppConfig.get("group-members","deleteGroupMemberUrl"),data:s,type:"POST",success:$.proxy(function(e){var r={idEntity:n,offset:0,tab:"all_tab",ajaxUrl:BAppConfig.get("group-members","groupMembersUrl"),limit:10};e.success===!0?t.updateView(r):Utils.alert(e.msg.title,e.msg.message,function(){})},this)})},this))},this.removeAdmin=function(e,t){var n=$("#idEntity").val(),r=$(e.target),i=r.attr("id").replace("remove-admin-",""),s={idGroup:n,idUser:i};Utils.confirm(translate("remove_admin_member_group_title"),translate("remove_admin_member_group_question"),$.proxy(function(e){e=="yes"&&$.ajax({url:BAppConfig.get("group-members","removeGroupMemberAdminUrl"),data:s,type:"POST",success:$.proxy(function(e){var r={idEntity:n,offset:0,tab:"all_tab",ajaxUrl:BAppConfig.get("group-members","groupMembersUrl"),limit:10};e.success===!0?t.updateView(r):Utils.alert(e.msg.title,e.msg.message,function(){})},this)})},this))},this.makeAdmin=function(e,t){var n=$("#idEntity").val(),r=$(e.target),i=r.attr("id").replace("make-admin-",""),s={idGroup:n,idUser:i};Utils.confirm(translate("make_admin_member_group_title"),translate("make_admin_member_group_question"),$.proxy(function(e){e=="yes"&&$.ajax({url:BAppConfig.get("group-members","makeGroupMemberAdminUrl"),data:s,type:"POST",success:$.proxy(function(e){var r={idEntity:n,offset:0,tab:"all_tab",ajaxUrl:BAppConfig.get("group-members","groupMembersUrl"),limit:10};e.success===!0?t.updateView(r):Utils.alert(e.msg.title,e.msg.message,function(){})},this)})},this))}};return r}),define("groups/main",["require","beyazpano","order!bootstrap.tooltip","default/views/siteHeader","default/views/siteLeftMenu","section-members/views/sectionMembersView","groups/_templates","groups/views/joinGroup","group-members/membersManagement","order!jquery.ui","order!jquery.validate","order!jquery.validate.messages_locale"],function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p=function(){var e={popupgroup:"popup-group",editGroupMemberPopUp:"edit-members-popup-group",addMemberPopup:"group_add_member_popup_container"},n={ALL:0,MEMBERS:1,ADMINS:2},o={rules:{"group[name]":{required:!0,minlength:2,maxlength:128}}},f={rules:{emails:{required:!0}}},l={rules:{accesscode:{required:!0}}},p,d;this.run=function(){var e=new i({el:"#content_left",config:BAppConfig.get("site_general","left_menu_general"),userid:BAppConfig.get("mydata","id")}),t={section:"edit-group",name:"editGroup",operation:"edit_group"};this.joinGroup=new u({onSuccess:function(e){e.groupMembership==0?document.location=d.replace("__groupid__",e.idGroup):document.location.reload(!0)}}),this.initHandlers(),e.render(),r.render(),c=new s,c.initHandlers(),h=new a,c.on("removeMemberFromGroup",_.bind(function(e){h.removeMember(e,c)},this)),c.on("removeAdmin",_.bind(function(e){h.removeAdmin(e,c)},this)),c.on("makeAdmin",_.bind(function(e){h.makeAdmin(e,c)},this))},this.init=function(){p=BAppConfig.get("site_groups","ajaxUrlGroups"),d=BAppConfig.get("site_groups","groupUpdatesUrl")},this.initHandlers=function(){this.init(),$(".btn-group").button(),$("#add-group").live("click",_.bind(this.openPopupAddGroupClickHandler,this)),$(".edit-group").live("click",_.bind(this.openPopupEditGroupClickHandler,this)),$(".delete-group").live("click",_.bind(this.deleteGroupClickHandler,this)),$(".edit-member").live("click",_.bind(this.openPopupEditMemberClickHandler,this)),$(".add-member").live("click",_.bind(this.openPopupAddMemberClickHandler,this)),$("#send-email-members").live("click",_.bind(this.sendEmailsColleaguesClickHandler)),$("#save-edit-group").live("click",_.bind(this.updateGroupClickHandler,this)),$("#save-group").live("click",_.bind(this.saveGroupClickHandler,this)),$("#addGroupForm").live("submit",_.bind(this.saveGroupClickHandler,this)),$("#addGroupForm").validate(o),$("#join-group").live("click",_.bind(function(){this.joinGroup.showPopup()},this))},this.openPopupAddGroupClickHandler=function(n){var r={popupSection:"add_group",popupForm:"addGroup",saveBtnId:"save-group",groupId:"",groupName:"",moderation:"",membership:"",readonly:""},i=$(t.renderTemplate(e.popupgroup,r));$("body").append(i),$(".question").tooltip(),$("#addGroupForm").get(0).reset();var s=$("#addGroupForm").validate(o);s.resetForm(),$("#popup_add_group").modal("show")},this.openPopupAddMemberClickHandler=function(n){var r=$(n.currentTarget).attr("id").replace("add-member-",""),i=$(t.renderTemplate(e.addMemberPopup,{data:{type:"group",idEntity:r,loaderImg:""}}));$("body").append('<div id="popup_add_members" class="modal fade hide" data-backdrop="static"></div>'),$("#popup_add_members").html(i),$("#sendEmailForm").validate(f),$("#popup_add_members").modal("show")},this.sendEmailsColleaguesClickHandler=function(e){var t=BAppConfig.get("site_groups","sendEmailMembers");if($("#sendEmailForm").valid()){var n=$("#sendEmailForm").serialize();Utils.block("#popup_add_members"),$.ajax({type:"POST",url:t,data:n,success:$.proxy(function(e){Utils.unblock("#popup_add_members");if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_add_members");else document.location.reload(!0)},this),dataType:"json"})}},this.openPopupEditGroupClickHandler=function(n){Utils.block(".middleBar");var r=$(n.currentTarget).attr("id").replace("edit-group-",""),i={popupSection:"edit_group",popupForm:"editGroup",saveBtnId:"save-edit-group"};$.ajax({type:"POST",url:p+"/editGroup",data:"idgroup="+r,success:$.proxy(function(n){if(n!=undefined&&n.success==1){i.groupId=n.data.groupData.id,i.groupName=n.data.groupData.name,i.moderation=n.data.groupData.moderation,i.membership=n.data.groupData.membership,i.readonly=n.data.groupData.readonly,$("#popup_edit_group").remove();var r=$(t.renderTemplate(e.popupgroup,i));$("body").append(r),$(".question").tooltip(),$("#editGroupForm").get(0).reset(),$("#popup_edit_group").modal("show")}},this),dataType:"json"}).always(function(){Utils.unblock(".middleBar")})},this.saveGroupClickHandler=function(e){$("#alert_group").empty();if($("#addGroupForm").valid()){Utils.block("#popup_add_group");var t=$("#addGroupForm").serialize();$.ajax({type:"POST",url:p+"/createGroup",data:t,success:$.proxy(function(e){if(!e.success){Utils.unblock("#popup_add_group");for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_group")}else document.location=d.replace("__groupid__",e.data.groupId)},this),complete:function(e,t){t=="error"&&Utils.unblock("#popup_add_group")},dataType:"json"})}return!1},this.updateGroupClickHandler=function(e){var t=$("#editGroupForm").serialize();$.ajax({type:"POST",url:p+"/updateGroup",data:t,success:$.proxy(function(e){if(!e.success)for(var t in e.msg)Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg[t],"#alert_edit_group");else document.location.reload(!0)},this),dataType:"json"})},this.deleteGroupClickHandler=function(e){var t=$(e.currentTarget).attr("id").replace("delete-group-","");Utils.confirm(translate("delete_group"),translate("delete_group_content"),function(e){e=="yes"&&$.ajax({type:"POST",url:p+"/deleteGroup",data:"idgroup="+t,success:$.proxy(function(e){e.success?($("#details_"+t).remove(),Utils.flashMessage(Utils.FLASH_SUCCESS,"",e.msg.message,"#flashMsg",4e3)):Utils.alert(e.msg.title,e.msg.message,function(){})},this),dataType:"json"})})},this.openPopupEditMemberClickHandler=function(n){var r=$(n.currentTarget).attr("id").replace("edit-member-","");if($(".next-page-members").attr("id"))var i=$(".next-page-members").attr("id").replace("next-page-","");else var i=0;var o={idEntity:r,offset:i,tab:"all_tab",ajaxUrl:BAppConfig.get("group-members","groupMembersUrl"),limit:10};c=new s(o),c.render();var u=$(t.renderTemplate(e.editGroupMemberPopUp,{}));$("body").append(u),$("#popup_edit_members").modal("show")}};return p}),define("group-members/main",["require","beyazpano","section-members/views/sectionMembersView","default/views/siteHeader","default/views/siteLeftMenu","group-members/membersManagement","add-members/main"],function(e,t,n,r,i,s,o){var u=function(){var e,t;this.run=function(){var u=BAppConfig.get("site_groups","config").left_menu;_.each(u.items,_.bind(function(e,t,n){e.url=e.url.replace("__GROUP_ID__",$("#groupId").val())},this));var a=new i({el:"#content_left",config:u,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"members"});a.render(),r.render(),this.addmembers=new o,this.addmembers.init({type:"group",sendEmailUrl:BAppConfig.get("site_groups","sendEmailMembers")});var f=$("#groupId").val();this.initHandlers();if($(".next-page-members").attr("id"))var l=$(".next-page-members").attr("id").replace("next-page-","");else var l=0;var c={idEntity:f,offset:l,tab:"all_tab",ajaxUrl:BAppConfig.get("group-members","groupMembersUrl"),limit:10};e=new n(c),e.render(),t=new s,e.on("removeMemberFromGroup",_.bind(function(e){this.removeMember(e)},this)),e.on("removeAdmin",_.bind(function(e){this.removeAdmin(e)},this)),e.on("makeAdmin",_.bind(function(e){this.makeAdmin(e)},this))},this.initHandlers=function(){},this.removeMember=function(n){t.removeMember(n,e)},this.removeAdmin=function(n){t.removeAdmin(n,e)},this.makeAdmin=function(n){t.makeAdmin(n,e)}};return u}),define("text!group-library/templates.html",[],function(){return'<script type="text/template" id="group_library_container"> \n    <div class="filterContainer clearfix">\n        <div class="clearfix">\n            <div class="left">\n                <div class="left settingsAll courseLibrarySettingsAll">\n                    <% if(data.permissions.groupOperations){ %>\n                    <input type="checkbox" class="jqSelectAll left"/>\n                    <div class="settingsDetails left">\n                        <div class="jqGroupOperations"></div>\n                    </div>\n                    <% } %>\n                    <% if(data.permissions[\'delete\']){ %>\n                    <button class="btn userDefaultBtn left" id="remove_group_files"><% print(_.escape(translate(\'site_library_remove_files\'))) %></button>\n                    <% } %>\n                    <% if(data.permissions.filter){ %>\n                    <select id="filterBy" class="selectType left">\n                        <option value="all"><% print(_.escape(translate(\'global_all\'))) %></option>\n                        <% _.each(data.extensions,function(item,text){ %>\n                        <option value="<%= text %>"><%= text %></option>\n                        <% }); %>\n                        <option value="other"><% print(_.escape(translate(\'global_other\'))) %></option>\n                    </select>\n                    <% } %>\n                </div>\n            </div>\n            <div class="right">\n                <div id="upload_file" class="right uploadFile">\n                    <% if(data.permissions.upload){ %>\n                    <button class="btn userDefaultBtn" id="upload_file_browse"><% print(_.escape(translate(\'global_upload\'))) %></button>\n                    <% } %>\n                </div>\n                <% if(data.permissions.share){ %>\n                <button class="btn userDefaultBtn" id="share_file_browse"><% print(_.escape(translate(\'site_library_share\'))) %></button>\n                <% } %>\n            </div>\n        </div>   \n        <div id="upload_file_list" class="libraryFileListContanier"></div>\n    </div>\n    <div id="file_list_container"></div>\n</script>\n\n<script type="text/template" id="site_group_library_file_list">\n    <% if(files && files.length > 0){ %>\n    <table class="libraryTable">\n        <thead>\n            <tr>\n                <% if(permissions.groupOperations){ %>\n                <td class="checkboxCell">&nbsp;</td>\n                <% } %>\n                <td class="fileNameCell"><a id="jq_sort_name" href="javascript:void(0);"><%= translate(\'group_library_file_name\') %></a></td>\n                <% if(permissions.groupOperations){ %>\n                <td class="fileDescriptionCell"><a id="jq_sort_description" href="javascript:void(0);"><%= translate(\'group_library_description\') %></a></td>\n                <% }  else { %>\n                <td class="fileDescriptionCellS"><a id="jq_sort_description" href="javascript:void(0);"><%= translate(\'group_library_description\') %></a></td>\n                <% } %>\n                <td class="fileDateCell"><a id="jq_sort_date" href="javascript:void(0);"><%= translate(\'group_library_date\') %></a></td>\n                <td class="fileSmallCell"><a id="jq_sort_extension" href="javascript:void(0);"><%= translate(\'group_library_extension\') %></a></td>\n                <td class="fileSmallCell"><a id="jq_sort_size" href="javascript:void(0);"><%= translate(\'group_library_size\') %></a></td>\n                <td class="fileSmallCell"><%= translate(\'group_library_functions\') %></td>\n            </tr>\n        </thead>\n        <% _.each(files,function(item) {\n            var rawIdFile = item.id.substr(0, item.id.indexOf(\'_\'));\n            var getUrl = getFileUrl.replace(\'__FILE_ID__\', rawIdFile);\n        %>\n        <tr class="fileListItem clearfix jqFileItem <%= item[\'class\'] %>" id="<%= item.id %>">\n            <% if(permissions.groupOperations){ %>\n            <td class="libraryCheckbox"> <input type="checkbox" class="jqSelectFile" name="file[]" value="<%= item.id %>"/></td>\n            <% } %>\n            <td><div class="fileNameContainer left"></div><p class="filename left" id="<%= item.id %>_filename"><%= item.name %></p></td>\n            <% if(permissions.groupOperations){ %>\n            <td> <p class="description <% if(_.isEmpty(item.description)){ %>jqWriteDescription <% } %>" id="<%= item.id %>_description"><%= item.description %></p></td>\n            <% }  else { %>\n            <td> <p class="descriptionS <% if(_.isEmpty(item.description)){ %>jqWriteDescription <% } %>" id="<%= item.id %>_description"><%= item.description %></p></td>\n            <% } %>\n            <td><p class="date"><%= Utils.formatDate(item.created,\'dd MMM yyyy\') %></p></td> \n            <td><%= item.extension %></td>\n            <td><%= item.size %> MB</td>\n            <td class="groupDetails"><%= _.template($(\'#site_group_library_file_operations\').html(), {permissions:permissions, getUrl:getUrl}) %></td>\n        </tr>\n        <% }) %>\n    </table>\n    <% } else{ %>\n    <div>\n        <%= translate(\'group_library_no_files\') %>\n    </div>\n    <% } %>\n</script>\n\n<script type="text/template" id="site_group_library_file_operations">\n    <% if(permissions.operationsAllowed){ %>\n    <div class="btn-group">\n        <button  class="dropdown-toggle groupSettingsDropdownToggle " data-toggle="dropdown"></button>\n        <ul class="dropdown-menu pull-right groupSettingsDropdownToggleBox">\n            <% if(permissions.download){ %>\n            <li class="jq_downloadFile"><a href=<%= \'"\'+getUrl+\'"\' %> class="download-file"><i class="btnicon-download"></i><% print(_.escape(translate(\'site_library_download_file\'))) %></a></li>\n            <% }if(permissions.copy){ %>\n            <li class="jq_copyGroupFile"><a href="#" class="copy-file"><i class="btnicon-copy"></i><% print(_.escape(translate(\'site_library_copy_file\'))) %></a></li>\n            <% } %>\n            <% if(permissions[\'delete\']){ %>\n            <li class="jq_deleteFile"><a href="#" class="delete-file"><i class="btnicon-delete"></i><% print(_.escape(translate(\'site_library_delete_file\'))) %></a></li>\n            <% } %>\n        </ul>\n    </div>\n    <% } %>\n</script>\n\n<script type="text/template" id="site_group_library_folder">\n    <div class="libraryFolderContainer <% if (data.permissions.create || data.permissions[\'delete\'] || data.permissions.rename) {%>\n                    <%= \'libraryFolderContainerPadding\' %> <%} %>" >\n        <%  if(data.permissions.create || data.permissions[\'delete\'] || data.permissions.rename){ %>\n            <div id="folder_action_buttons" class="libraryFolderActionButtons clearfix">\n                <% if(data.permissions.create){ %>\n                <button class="btn createFolder" id="create_folder" data-placement="bottom" \n                        data-original-title="<%= translate(\'help_add_folder\') %>"><span>&nbsp;</span></button>\n                <% } %>\n                <% if(data.permissions[\'delete\']){ %>\n                <button class="btn deleteFolderDisabled" id="delete_folder"\n                        data-placement="bottom"\n                        data-original-title="<%= translate(\'help_delete_folder\') %>"><span>&nbsp;</span></button>\n                <% } %>\n                <% if(data.permissions.rename){ %>\n                <button class="btn renameFolderDisabled" id="rename_folder"\n                        data-placement="bottom"\n                        data-original-title="<%= translate(\'help_rename_folder\') %>"><span>&nbsp;</span></button>\n                <% } %>\n            </div>\n        <% } %>    \n        <div id="folders" class="libraryFolderStructure"></div>\n       \n    </div>\n</script>'}),define("group-library/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("group_library_templates",n);return r}),define("group-library/views/groupLibrary",["require","beyazpano","../_templates","library/views/fileList","library/views/folderCollection","library/views/shareFiles","order!plupload","order!plupload.html4","order!plupload.html5","order!plupload.flash","order!file.attachments","order!utils"],function(e,t,n,r,i,s){var o=Backbone.View.extend({templateNames:{main:"group_library_container",fileList:"site_group_library_file_list",folderList:"site_group_library_folder"},initialize:function(e){this.config={ownerId:null,sectionId:null,type:"group",folderId:"",foldersContainer:"#folder-list",filesListContainer:"#file_list_container",filesContainer:"#file_list_container",shareUrl:BAppConfig.get("site_group_library","shareFile"),uploadUrl:BAppConfig.get("site_group_library","uploadFile"),groupUrl:BAppConfig.get("library","groupOperation")},this.el="#groupContent",this.filePermissions={operationsAllowed:!1,share:!1,sort:!1,filter:!0,"delete":!1,download:!1,copy:!1,rename:!1,groupOperations:!1,upload:!1},this.folderPermissions={create:!1,"delete":!1},this.sortBy=null,this.sortOrder="asc",e.config&&(this.config=_.extend(this.config,e.config)),e.filePermissions&&(this.filePermissions=_.extend(this.filePermissions,e.filePermissions)),e.folderPermissions&&(this.folderPermissions=_.extend(this.folderPermissions,e.folderPermissions)),this.folders=new i({config:{ownerId:this.config.ownerId,el:"#folders",type:"group",showRoot:!1,initialFolderId:this.config.folderId!=""?this.config.folderId:"0"}}),this.files=new r({el:this.config.filesContainer,config:{ownerId:this.config.ownerId,type:this.config.type},templateNames:{fileList:this.templateNames.fileList},p:this.filePermissions}),$(this.config.foldersContainer).on("startUpload",_.bind(function(){Utils.block(this.config.foldersContainer),Utils.block(this.config.filesListContainer)},this)),$(this.config.foldersContainer).on("uploadFinished",_.bind(function(){Utils.unblock(this.config.foldersContainer),Utils.unblock(this.config.filesListContainer)},this))},render:function(){var e=$(t.renderTemplate(this.templateNames.main,{data:{permissions:this.filePermissions,extensions:BAppConfig.get("library","config").extensions}}));$(this.el).html(e),this.getSubfolders(),this.files.render(),this.config.folderId===""&&this.files.getFiles("0_"+this.config.ownerId+"_group"),this.initializeEventListeners(),this.filePermissions.share&&this.initializeShareFile(),this.filePermissions.upload&&this.initializeUploadFile()},initializeEventListeners:function(){$("#filterBy").change(_.bind(function(){this.files.changeFilterType($("#filterBy").val())},this)),$(".plupload").live("hover",function(e){e.type=="mouseenter"&&($("#upload_file_browse").hasClass("backgroundBtnHover")||$("#upload_file_browse").addClass("backgroundBtnHover")),e.type=="mouseleave"&&$("#upload_file_browse").hasClass("backgroundBtnHover")&&$("#upload_file_browse").removeClass("backgroundBtnHover")}),$("#jq_sort_date,#jq_sort_extension,#jq_sort_name,#jq_sort_description,#jq_sort_size").live("click",_.bind(function(e){var t=$(e.currentTarget);switch(t.attr("id")){case"jq_sort_date":this.sortBy="created";break;case"jq_sort_extension":this.sortBy="extension";break;case"jq_sort_name":this.sortBy="name";break;case"jq_sort_description":this.sortBy="description";break;case"jq_sort_size":this.sortBy="size"}this.sortOrder=="desc"?this.sortOrder="asc":this.sortOrder="desc",this.files.changeSort(this.sortBy+"_"+this.sortOrder)},this));var e=$(this.config.filesContainer);$(this.el).find(".jqSelectAll").click(function(){$(this).is(":checked")?e.find(".jqSelectFile").attr("checked","checked"):e.find(".jqSelectFile").removeAttr("checked")}),this.files.on("updatedFileList",_.bind(function(e){$(this.el).find(".jqSelectAll").removeAttr("checked"),Utils.setZIndex("#file_list_container")},this)),$("#remove_group_files").on("click",_.bind(function(){var e=this.files.getSelectedFileIds();_.isEmpty(e)?Utils.alert(translate("site_group_library_remove_no_file_seleted_error_title"),translate("site_group_library_remove_no_file_seleted_error_message")):this.files.deleteFile(e,{url:this.config.groupUrl,ids:e})},this)),$(this.config.filesContainer).find(".jq_copyGroupFile").live("click",_.bind(function(e){var t=$(e.currentTarget).closest(".jqFileItem").attr("id"),n=new s({shareLibraryType:"user",shareLibraryOwnerId:BAppConfig.get("mydata","id"),type:"folderSelection"});n.on("share_selected_folder",_.bind(function(e){$.ajax(this.config.groupUrl,{type:"post",dataType:"json",data:{operation:"copyToOtherCollection",ids:[t],newFolder:e}}).success(_.bind(function(e,t,n){e!=undefined&&e.success==1?Utils.alert(translate("site_group_library_copy_to_library_success_title"),translate("site_group_library_copy_to_library_success_message")):Utils.alert(translate("error_title"),translate("error_message"))},this))},this)),n.showPopup()},this))},initializeShareFile:function(){$("#share_file_browse").live("click",_.bind(function(){var e=new s({shareLibraryType:"user",shareLibraryOwnerId:BAppConfig.get("mydata","id"),type:"fileSelection"}),t;try{t=this.folders.getSelectedFolderId(),t===null&&(t="0_"+this.config.ownerId+"_group")}catch(n){t="0_"+this.config.ownerId+"_group"}var r=t.split("_");e.on("share_selected_files",_.bind(function(e){$.ajax(this.config.shareUrl,{type:"post",dataType:"json",data:{ids:e,ownerId:this.config.ownerId,groupId:this.config.groupId,currentFolder:r[0]}}).success(_.bind(function(e,t,n){e!==undefined&&e.success===!0?this.files.refresh():Utils.alert(translate("error_title"),translate("error_message"))},this))},this)),e.showPopup()},this))},initializeUploadFile:function(){var e=new FileAttachments("#upload_file",{onFileAttached:_.bind(function(e,t){var n;try{n=this.folders.getSelectedFolderId(),n===null&&(n="0_"+this.config.ownerId+"_group")}catch(r){n="0_"+this.config.ownerId+"_group"}var i=n.split("_");$.ajax(this.config.uploadUrl,{type:"post",dataType:"json",data:{id:e.fileId,ownerId:this.config.ownerId,folderId:i[0]}}).success(_.bind(function(e,t,n){e!==undefined&&e.success===!0?this.files.refresh():Utils.alert(translate("error_title"),translate("error_message"))},this))},this),clientUploader:BAppConfig.get("global","swfUploader"),uploaderUrl:BAppConfig.get("global","uploaderUrl"),fileSizeLimit:BAppConfig.get("global","max_file_size"),removeCompleted:!0,removeTimeout:5,listContainer:"upload_file_list",blockButtonId:this.config.foldersContainer})},getSubfolders:function(){var e=$(t.renderTemplate(this.templateNames.folderList,{data:{permissions:this.folderPermissions}}));$(this.config.foldersContainer).html(e),this.folders.render(),this.folders.on("folderSelected",_.bind(this.onFolderSelected,this)),$("#create_folder").click(_.bind(this.addFolder,this)),$("#delete_folder").click(_.bind(this.removeFolder,this)),$("#rename_folder").click(_.bind(this.renameFolder,this)),$("#create_folder,#delete_folder,#rename_folder").tooltip(),$("#content_left ul>li[class *= courselibraryMIcon]").click(_.bind(function(e){e.preventDefault(),this.getRootFiles()},this))},getRootFiles:function(){this.folders=new i({config:{ownerId:this.config.ownerId,el:"#folders",type:"group",showRoot:!1}}),this.folders.render(),this.folders.on("folderSelected",_.bind(this.onFolderSelected,this)),this.files.render(),this.files.getFiles("0_"+this.config.ownerId+"_group"),$("#delete_folder").removeClass("deleteFolder").addClass("deleteFolderDisabled"),$("#rename_folder").removeClass("renameFolder").addClass("renameFolderDisabled")},addFolder:function(){this.folders.addFolder()},removeFolder:function(){$("#delete_folder").hasClass("deleteFolder")&&(this.folders.on("folderRemoveFailure",function(){Utils.alert(translate("error_title"),translate("site_my_library_remove_folder_error"))}),this.folders.on("folderRemoved",_.bind(this.onFolderRemoved,this)),this.folders.deleteFolder())},renameFolder:function(){$("#rename_folder").hasClass("renameFolder")&&this.folders.renameSelectedFolder()},onFolderSelected:function(e){$("#delete_folder").removeClass("deleteFolderDisabled").addClass("deleteFolder"),$("#rename_folder").removeClass("renameFolderDisabled").addClass("renameFolder"),this.files.getFiles(e.id)},onFolderRemoved:function(){this.getRootFiles()}});return o}),define("group-library/main",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","group-library/views/groupLibrary"],function(e,t,n,r,i){var s=function(){this.run=function(){var e=$("#groupId").val();this.initMenus(e);var t=$("#folderId").val(),n=$("#folderPermissions").val(),r=$("#filePermissions").val();r=$.parseJSON(r),n=$.parseJSON(n);var s=new i({config:{ownerId:e,groupId:e,url:"",folderId:t},filePermissions:r,folderPermissions:n});s.render()},this.initMenus=function(e){var t=BAppConfig.get("site_groups","config").left_menu;_.each(t.items,_.bind(function(t,n,r){t.url=t.url.replace("__GROUP_ID__",e)},this));var i=new r({el:"#content_left",config:t,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"grouplibrary"});n.render(),i.render()}};return s}),define("text!group-discussion/templates.html",[],function(){return'<script type="text/template" id="group_updates">\n    <div id="post_updates_container" class="postUpdatesContainer"></div>\n    <div id="updates_list_container"></div>\n</script>\n<script type="text/template" id="group-create-discussion-form">\n    <div class="modal fade modal-narrow" id="create-discussion-dialog" data-backdrop="static">\n        <div class="modal-header">\n            <div class="modalHeaderContainer">\n                <a class="close" data-dismiss="modal"></a>\n                <h3><% print(_.escape(translate(\'discussion_create_dialog_title\'))) %></h3>\n            </div>\n        </div>\n        <div class="modal-body">\n            <div class="modalContent">\n                <form method="POST">\n                    <input type="hidden" name="discussion[group_id]" value="<% if(data.group_id) print(data.group_id) %>">\n                    <% if(data.id) {%>\n                    <input type="hidden" name="discussion[id]" value="<%= data.id %>">\n                    <%}%>\n                    <input type="hidden" name="discussion[attachments]" value="" />\n                    <ul class="modalForm">\n                        <li class="clearfix">\n                            <label><% print(_.escape(translate(\'global_title\'))) %></label>\n                            <input type="text" name="discussion[title]" class="required"  value="<% if(data.title) print(_.escape(data.title)) %>" >\n                        </li>\n                        <li class="clearfix">\n                            <label><% print(_.escape(translate(\'discussion_description\'))) %></label>\n                            <textarea name="discussion[description]" ><% if(data.description) print(_.escape(data.description)) %></textarea>\n                        </li>\n                        <li>\n                            <% if(data.role == \'INSTRUCTOR\') { %>\n                            <label><% print(_.escape(translate(\'discussion_privacy\'))) %></label>\n                            <p class="checkBoxContainer">\n                                <input type="radio" class="required" name="discussion[privacy]" value="COURSE" <% if(data.privacy == \'COURSE\') { %>checked<%}%> >\n                                <label><% print(_.escape(translate(\'discussion_privacy_course\'))) %></label>\n                            </p>\n                            <p class="checkBoxContainer">\n                                <input type="radio" name="discussion[privacy]" value="SECTION" <% if(data.privacy == \'SECTION\' || (data.privacy != \'COURSE\' && data.privacy != \'SECTION\')) { %>checked<%}%> >\n                                <label><% print(_.escape(translate(\'discussion_privacy_section\'))) %></label>\n                            </p>\n                            <% } %>\n                        </li>\n                    </ul>\n                </form>\n                <div id="discussion_attachemnts" class="userMessageAttachment userPostAttachements clearfix"></div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <div class="modalFooterContainer modalFooterContainerUser">\n                <div class="modalButtons">\n                    <button href="#" id="save-discussion-group" class="btn userDefaultBtn save"><% print(_.escape(translate(\'global_save\'))) %></button>\n                    <button href="#" class="btn cancel"><% print(_.escape(translate(\'global_cancel\'))) %></button>\n                </div>\n            </div>\n        </div>\n    </div>\n</script>\n<script type="text/template" id="group_discussion_updates">\n    <div id="post_group_discussion_updates_container" class="postUpdatesContainer"></div>\n    <div id="updates_group_discussion_list_container"></div>\n</script>\n'}),define("group-discussion/_templates",["require","beyazpano","text!./templates.html"],function(e,t,n){var r=t.appendTemplate("group_discussion_templates",n);return r}),define("group-discussion/views/createDiscussion",["require","beyazpano","order!jquery.form","order!jquery.validate","order!jquery.validate.messages_locale","group-discussion/_templates","attachment/views/component","jquery.json"],function(e,t,n,r,i,s,o,u){var a=Backbone.View.extend({templateNames:{main:"group-create-discussion-form"},el:null,url:null,submitCallback:null,data:null,initialize:function(e){this.url=e.url,this.submitCallback=e.submitCallback,this.data=e.data,this.render()},render:function(){$("#create-discussion-dialog").remove();var e=t.renderTemplate(this.templateNames.main,{url:this.url,data:this.data});$("body").append(e),$("#create-discussion-dialog").modal({show:!0,backdrop:"static"}),$("#create-discussion-dialog").modal("show").on("hidden",function(){$(this).remove()});var n=null;this.data.attachments&&(n=this.data.attachments),this.attachments=new Attachments("#discussion_attachemnts",{onAttachmentAdded:_.bind(this.attachmentsChanged,this),onAttachmentRemoved:_.bind(this.attachmentsChanged,this),uploaderUrl:BAppConfig.get("global","uploaderUrl"),clientUploader:BAppConfig.get("global","swfUploader"),attachments:n,canShare:!0,blockButtonId:"#save-discussion-group",initShareHandler:_.bind(o.getShareInitHandler(),this)}),this.initHandlers()},attachmentsChanged:function(){$('#create-discussion-dialog input[name="discussion[attachments]"]').val($.toJSON(this.attachments.getAttachments()))},initHandlers:function(){var e=$("#create-discussion-dialog").find("form");e.validate({submitHandler:_.bind(function(t){Utils.block("#create-discussion-dialog");var n=$("#create-discussion-dialog").find(".save");n.attr("disabled","disabled"),e.ajaxSubmit({url:this.url,format:"json",success:$.proxy(function(e){_.isFunction(this.submitCallback)&&this.submitCallback.apply(this,[e]),$("#create-discussion-dialog").modal("hide"),Utils.unblock("#create-discussion-dialog"),n.removeAttr("disabled")},this)})},this)}),$("#create-discussion-dialog").find(".save").on("click",_.bind(function(){e.submit()},this)),$("#create-discussion-dialog").find(".cancel").on("click",_.bind(function(){$("#create-discussion-dialog").modal("hide")},this))}});return a}),define("group-discussion/main",["require","beyazpano","group-discussion/views/createDiscussion","default/views/siteHeader","default/views/siteLeftMenu","add-members/main","order!jquery.ui"],function(e,t,n,r,i,s){var o=function(){var e=$("#source").attr("value");this.run=function(){this.init(),e=="page"&&this.initMenus(),this.initHandlers(),this.addmembers=new s,this.addmembers.init({type:"group",sendEmailUrl:BAppConfig.get("site_groups","sendEmailMembers")})},this.init=function(){},this.initHandlers=function(){$(".edit-discussion").on("click",_.bind(function(e){Utils.block(".middleBar");var t=$(e.currentTarget).attr("id").replace("edit-discussion-",""),r=BAppConfig.get("group_discussions","getEditGroupDiscussion"),i=$("#idgroup").attr("value"),s=$("#source").attr("value");$.ajax({type:"POST",url:r,data:{id:t},success:$.proxy(function(e){if(e.success)var t=new n({groupId:e.data.discussion.group_id,data:e.data.discussion,url:BAppConfig.get("group_discussions","ajaxSaveDiscussion")+"/"+i,submitCallback:_.bind(function(e){e.success?s=="single"?document.location.reload(!0):(this.reloadDiscussion(e.data),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_updated"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",translate("discussion_created"),"#flash-message",3e3)},this)});else Utils.flashMessage(Utils.FLASH_ERROR,"",e.msg,"#flash-message",3e3)},this),dataType:"json"}).always(function(){Utils.unblock(".middleBar")})},this)),$(".add-group-discussion").on("click",_.bind(function(e){var t=new n({groupId:$("#idgroup").attr("value"),data:"",url:BAppConfig.get("group_discussions","ajaxSaveDiscussion")+"/"+$("#idgroup").attr("value"),submitCallback:_.bind(function(e){e.success?(this.addDiscussion(e.data),Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_created"),"#flash-message",3e3)):Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_on_create"),"#flash-message",3e3)},this)})},this)),$(".delete-discussion").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("delete-discussion-",""),n=$("#source").attr("value");Utils.confirm(translate("delete_group_discussion"),translate("delete_group_discussion_content"),function(e){e=="yes"&&$.ajax({type:"POST",url:BAppConfig.get("group_discussions","ajaxRemoveDiscussion"),data:{id:t},success:$.proxy(function(e){e.success?n=="single"?document.location.reload(!0):(Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_deleted"),"#flash-message",3e3),$("li#li-delete-discussion-"+e.data.id).remove()):Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_on_delete"),"#flash-message",3e3)},this),dataType:"json"})})},this)),$(".approve-discussion").on("click",_.bind(function(e){var t=$(e.currentTarget).attr("id").replace("approve-discussion-","");$.ajax({type:"POST",url:BAppConfig.get("group_discussions","ajaxApproveDiscussion"),data:{id:t},success:$.proxy(function(e){e.success?(Utils.flashMessage(Utils.FLASH_SUCCESS,"",translate("discussion_approved"),"#flash-message",3e3),$("a#approve-discussion-"+e.data.id).remove(),$(".approve-buttons").find("a#delete-discussion-"+e.data.id).remove()):Utils.flashMessage(Utils.FLASH_ERROR,"",translate("error_on_approve"),"#flash-message",3e3)},this),dataType:"json"})},this))},this.initMenus=function(){var e=BAppConfig.get("site_groups","config").left_menu;_.each(e.items,_.bind(function(e,t,n){e.url=e.url.replace("__GROUP_ID__",$("#idgroup").val())},this));var t=new i({el:"#content_left",config:e,userid:BAppConfig.get("mydata","id"),insertMethod:"prepend",selected_item:"discussions"});t.render(),r.render()},this.reloadDiscussion=function(e){$("#discussion_title_"+e.discussion.id).html(e.discussion.title)},this.addDiscussion=function(e){document.location.reload(!0)}};return o}),define("profile/blocking",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","profile/block"],function(e,t,n,r,i){var s=function(){this.run=function(){n.render();var e=new r({el:"#content_left",config:BAppConfig.get("site_settings","config").left_menu,userid:BAppConfig.get("mydata","id"),selected_item:"blocking"});e.render();var t=new i;t.run({refresh:!0})}};return s}),define("requests/main",["require","beyazpano","default/views/siteHeader","default/views/siteLeftMenu","requests/views/requests","requests/_templates","order!jquery.ui"],function(e,t,n,r,i,s,o){var u=function(){this.run=function(){n.render();var e=new r({el:"#content_left",config:BAppConfig.get("site_general","left_menu_general"),selected_item:""});e.render();var t=new i({el:"#requestsMiddleZone",dropdown:!1});t.render()}};return u});